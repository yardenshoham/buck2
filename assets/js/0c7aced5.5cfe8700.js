"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2247],{3905:(e,t,n)=>{n.r(t),n.d(t,{MDXContext:()=>p,MDXProvider:()=>_,mdx:()=>f,useMDXComponents:()=>m,withMDXComponents:()=>d});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),d=function(e){return function(t){var n=m(t.components);return a.createElement(e,r({},t,{components:n}))}},m=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},_=function(e){var t=m(e.components);return a.createElement(p.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=m(n),_=i,c=d["".concat(l,".").concat(_)]||d[_]||h[_]||r;return n?a.createElement(c,s(s({ref:t},p),{},{components:n})):a.createElement(c,s({ref:t},p))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[c]="string"==typeof e?e:i,l[1]=s;for(var p=2;p<r;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},18706:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=n(87462),i=(n(67294),n(3905));const r={id:"rules"},l="Rules",s={unversionedId:"api/rules",id:"api/rules",title:"Rules",description:"These rules are available as standard in Buck2.",source:"@site/../docs/api/rules.generated.md",sourceDirName:"api",slug:"/api/rules",permalink:"/docs/api/rules",draft:!1,tags:[],version:"current",frontMatter:{id:"rules"},sidebar:"manualSidebar",previous:{title:"APIs",permalink:"/docs/api"},next:{title:"globals",permalink:"/docs/api/starlark/globals"}},o={},p=[{value:"Parameters",id:"parameters",level:4},{value:"android_aar",id:"android_aar",level:2},{value:"Parameters",id:"parameters-1",level:4},{value:"Details",id:"details",level:4},{value:"android_app_modularity",id:"android_app_modularity",level:2},{value:"Parameters",id:"parameters-2",level:4},{value:"android_binary",id:"android_binary",level:2},{value:"Parameters",id:"parameters-3",level:4},{value:"android_build_config",id:"android_build_config",level:2},{value:"Parameters",id:"parameters-4",level:4},{value:"Details",id:"details-1",level:4},{value:"android_bundle",id:"android_bundle",level:2},{value:"Parameters",id:"parameters-5",level:4},{value:"android_instrumentation_apk",id:"android_instrumentation_apk",level:2},{value:"Parameters",id:"parameters-6",level:4},{value:"Details",id:"details-2",level:4},{value:"android_instrumentation_test",id:"android_instrumentation_test",level:2},{value:"Parameters",id:"parameters-7",level:4},{value:"Details",id:"details-3",level:4},{value:"android_library",id:"android_library",level:2},{value:"Parameters",id:"parameters-8",level:4},{value:"Details",id:"details-4",level:4},{value:"android_manifest",id:"android_manifest",level:2},{value:"Parameters",id:"parameters-9",level:4},{value:"Details",id:"details-5",level:4},{value:"android_platform",id:"android_platform",level:2},{value:"Parameters",id:"parameters-10",level:4},{value:"android_prebuilt_aar",id:"android_prebuilt_aar",level:2},{value:"Parameters",id:"parameters-11",level:4},{value:"Details",id:"details-6",level:4},{value:"android_resource",id:"android_resource",level:2},{value:"Parameters",id:"parameters-12",level:4},{value:"Details",id:"details-7",level:4},{value:"apk_genrule",id:"apk_genrule",level:2},{value:"Parameters",id:"parameters-13",level:4},{value:"String parameter macros",id:"string-parameter-macros",level:5},{value:"Details",id:"details-8",level:4},{value:"apple_asset_catalog",id:"apple_asset_catalog",level:2},{value:"Parameters",id:"parameters-14",level:4},{value:"Details",id:"details-9",level:4},{value:"apple_binary",id:"apple_binary",level:2},{value:"Parameters",id:"parameters-15",level:4},{value:"Details",id:"details-10",level:4},{value:"apple_bundle",id:"apple_bundle",level:2},{value:"Parameters",id:"parameters-16",level:4},{value:"Details",id:"details-11",level:4},{value:"apple_library",id:"apple_library",level:2},{value:"Parameters",id:"parameters-17",level:4},{value:"Details",id:"details-12",level:4},{value:"apple_package",id:"apple_package",level:2},{value:"Parameters",id:"parameters-18",level:4},{value:"Details",id:"details-13",level:4},{value:"apple_resource",id:"apple_resource",level:2},{value:"Parameters",id:"parameters-19",level:4},{value:"Details",id:"details-14",level:4},{value:"apple_test",id:"apple_test",level:2},{value:"Parameters",id:"parameters-20",level:4},{value:"Details",id:"details-15",level:4},{value:"apple_toolchain",id:"apple_toolchain",level:2},{value:"Parameters",id:"parameters-21",level:4},{value:"apple_toolchain_set",id:"apple_toolchain_set",level:2},{value:"Parameters",id:"parameters-22",level:4},{value:"cgo_library",id:"cgo_library",level:2},{value:"Parameters",id:"parameters-23",level:4},{value:"Details",id:"details-16",level:4},{value:"command_alias",id:"command_alias",level:2},{value:"Parameters",id:"parameters-24",level:4},{value:"Details",id:"details-17",level:4},{value:"config_setting",id:"config_setting",level:2},{value:"Parameters",id:"parameters-25",level:4},{value:"configured_alias",id:"configured_alias",level:2},{value:"Parameters",id:"parameters-26",level:4},{value:"constraint_setting",id:"constraint_setting",level:2},{value:"Parameters",id:"parameters-27",level:4},{value:"constraint_value",id:"constraint_value",level:2},{value:"Parameters",id:"parameters-28",level:4},{value:"core_data_model",id:"core_data_model",level:2},{value:"Parameters",id:"parameters-29",level:4},{value:"Details",id:"details-18",level:4},{value:"csharp_library",id:"csharp_library",level:2},{value:"Parameters",id:"parameters-30",level:4},{value:"Details",id:"details-19",level:4},{value:"cxx_binary",id:"cxx_binary",level:2},{value:"Parameters",id:"parameters-31",level:4},{value:"Details",id:"details-20",level:4},{value:"cxx_genrule",id:"cxx_genrule",level:2},{value:"Parameters",id:"parameters-32",level:4},{value:"Macros",id:"macros",level:4},{value:"Parameterized Macros",id:"parameterized-macros",level:4},{value:"Variables",id:"variables",level:4},{value:"Details",id:"details-21",level:4},{value:"cxx_library",id:"cxx_library",level:2},{value:"Parameters",id:"parameters-33",level:4},{value:"Details",id:"details-22",level:4},{value:"Building requires a specified top-level target",id:"building-requires-a-specified-top-level-target",level:4},{value:"Dependencies of the cxx_library also require a top-level target",id:"dependencies-of-the-cxx_library-also-require-a-top-level-target",level:4},{value:"cxx_lua_extension",id:"cxx_lua_extension",level:2},{value:"Parameters",id:"parameters-34",level:4},{value:"Details",id:"details-23",level:4},{value:"cxx_precompiled_header",id:"cxx_precompiled_header",level:2},{value:"Parameters",id:"parameters-35",level:4},{value:"Details",id:"details-24",level:4},{value:"cxx_python_extension",id:"cxx_python_extension",level:2},{value:"Parameters",id:"parameters-36",level:4},{value:"Details",id:"details-25",level:4},{value:"cxx_test",id:"cxx_test",level:2},{value:"Parameters",id:"parameters-37",level:4},{value:"Details",id:"details-26",level:4},{value:"cxx_toolchain",id:"cxx_toolchain",level:2},{value:"Parameters",id:"parameters-38",level:4},{value:"d_binary",id:"d_binary",level:2},{value:"Parameters",id:"parameters-39",level:4},{value:"Details",id:"details-27",level:4},{value:"d_library",id:"d_library",level:2},{value:"Parameters",id:"parameters-40",level:4},{value:"Details",id:"details-28",level:4},{value:"d_test",id:"d_test",level:2},{value:"Parameters",id:"parameters-41",level:4},{value:"Details",id:"details-29",level:4},{value:"erlang_app",id:"erlang_app",level:2},{value:"Parameters",id:"parameters-42",level:4},{value:"Details",id:"details-30",level:4},{value:"Minimal Erlang Application",id:"minimal-erlang-application",level:4},{value:"With <code>priv/</code> directory",id:"with-priv-directory",level:4},{value:"Using OTP applications and <code>mod</code> field",id:"using-otp-applications-and-mod-field",level:4},{value:"Using Yecc and Leex",id:"using-yecc-and-leex",level:4},{value:"erlang_app_includes",id:"erlang_app_includes",level:2},{value:"Parameters",id:"parameters-43",level:4},{value:"erlang_escript",id:"erlang_escript",level:2},{value:"Parameters",id:"parameters-44",level:4},{value:"Details",id:"details-31",level:4},{value:"erlang_otp_binaries",id:"erlang_otp_binaries",level:2},{value:"Parameters",id:"parameters-45",level:4},{value:"Details",id:"details-32",level:4},{value:"erlang_release",id:"erlang_release",level:2},{value:"Parameters",id:"parameters-46",level:4},{value:"Details",id:"details-33",level:4},{value:"erlang_test",id:"erlang_test",level:2},{value:"Parameters",id:"parameters-47",level:4},{value:"Details",id:"details-34",level:4},{value:"export_file",id:"export_file",level:2},{value:"Parameters",id:"parameters-48",level:4},{value:"Details",id:"details-35",level:4},{value:"external_test_runner",id:"external_test_runner",level:2},{value:"Parameters",id:"parameters-49",level:4},{value:"filegroup",id:"filegroup",level:2},{value:"Parameters",id:"parameters-50",level:4},{value:"Details",id:"details-36",level:4},{value:"gen_aidl",id:"gen_aidl",level:2},{value:"Parameters",id:"parameters-51",level:4},{value:"Details",id:"details-37",level:4},{value:"genrule",id:"genrule",level:2},{value:"Parameters",id:"parameters-52",level:4},{value:"String parameter macros",id:"string-parameter-macros-1",level:5},{value:"Details",id:"details-38",level:4},{value:"git_fetch",id:"git_fetch",level:2},{value:"Parameters",id:"parameters-53",level:4},{value:"Details",id:"details-39",level:4},{value:"go_binary",id:"go_binary",level:2},{value:"Parameters",id:"parameters-54",level:4},{value:"Details",id:"details-40",level:4},{value:"go_exported_library",id:"go_exported_library",level:2},{value:"Parameters",id:"parameters-55",level:4},{value:"Details",id:"details-41",level:4},{value:"go_library",id:"go_library",level:2},{value:"Parameters",id:"parameters-56",level:4},{value:"Details",id:"details-42",level:4},{value:"go_test",id:"go_test",level:2},{value:"Parameters",id:"parameters-57",level:4},{value:"Details",id:"details-43",level:4},{value:"go_test_runner",id:"go_test_runner",level:2},{value:"Parameters",id:"parameters-58",level:4},{value:"groovy_library",id:"groovy_library",level:2},{value:"Parameters",id:"parameters-59",level:4},{value:"Details",id:"details-44",level:4},{value:"groovy_test",id:"groovy_test",level:2},{value:"Parameters",id:"parameters-60",level:4},{value:"gwt_binary",id:"gwt_binary",level:2},{value:"Parameters",id:"parameters-61",level:4},{value:"halide_library",id:"halide_library",level:2},{value:"Parameters",id:"parameters-62",level:4},{value:"Details",id:"details-45",level:4},{value:"haskell_binary",id:"haskell_binary",level:2},{value:"Parameters",id:"parameters-63",level:4},{value:"Details",id:"details-46",level:4},{value:"haskell_ghci",id:"haskell_ghci",level:2},{value:"Parameters",id:"parameters-64",level:4},{value:"haskell_haddock",id:"haskell_haddock",level:2},{value:"Parameters",id:"parameters-65",level:4},{value:"haskell_ide",id:"haskell_ide",level:2},{value:"Parameters",id:"parameters-66",level:4},{value:"haskell_library",id:"haskell_library",level:2},{value:"Parameters",id:"parameters-67",level:4},{value:"Details",id:"details-47",level:4},{value:"haskell_prebuilt_library",id:"haskell_prebuilt_library",level:2},{value:"Parameters",id:"parameters-68",level:4},{value:"Details",id:"details-48",level:4},{value:"http_archive",id:"http_archive",level:2},{value:"Parameters",id:"parameters-69",level:4},{value:"Details",id:"details-49",level:4},{value:"http_file",id:"http_file",level:2},{value:"Parameters",id:"parameters-70",level:4},{value:"Details",id:"details-50",level:4},{value:"jar_genrule",id:"jar_genrule",level:2},{value:"Parameters",id:"parameters-71",level:4},{value:"java_annotation_processor",id:"java_annotation_processor",level:2},{value:"Parameters",id:"parameters-72",level:4},{value:"java_binary",id:"java_binary",level:2},{value:"Parameters",id:"parameters-73",level:4},{value:"java_library",id:"java_library",level:2},{value:"Parameters",id:"parameters-74",level:4},{value:"Details",id:"details-51",level:4},{value:"java_plugin",id:"java_plugin",level:2},{value:"Parameters",id:"parameters-75",level:4},{value:"java_test",id:"java_test",level:2},{value:"Parameters",id:"parameters-76",level:4},{value:"java_test_runner",id:"java_test_runner",level:2},{value:"Parameters",id:"parameters-77",level:4},{value:"js_bundle",id:"js_bundle",level:2},{value:"Parameters",id:"parameters-78",level:4},{value:"js_bundle_genrule",id:"js_bundle_genrule",level:2},{value:"Parameters",id:"parameters-79",level:4},{value:"js_library",id:"js_library",level:2},{value:"Parameters",id:"parameters-80",level:4},{value:"julia_binary",id:"julia_binary",level:2},{value:"Parameters",id:"parameters-81",level:4},{value:"julia_jll_library",id:"julia_jll_library",level:2},{value:"Parameters",id:"parameters-82",level:4},{value:"julia_library",id:"julia_library",level:2},{value:"Parameters",id:"parameters-83",level:4},{value:"julia_test",id:"julia_test",level:2},{value:"Parameters",id:"parameters-84",level:4},{value:"keystore",id:"keystore",level:2},{value:"Parameters",id:"parameters-85",level:4},{value:"kotlin_library",id:"kotlin_library",level:2},{value:"Parameters",id:"parameters-86",level:4},{value:"Details",id:"details-52",level:4},{value:"kotlin_test",id:"kotlin_test",level:2},{value:"Parameters",id:"parameters-87",level:4},{value:"legacy_toolchain",id:"legacy_toolchain",level:2},{value:"Parameters",id:"parameters-88",level:4},{value:"lua_binary",id:"lua_binary",level:2},{value:"Parameters",id:"parameters-89",level:4},{value:"Details",id:"details-53",level:4},{value:"lua_library",id:"lua_library",level:2},{value:"Parameters",id:"parameters-90",level:4},{value:"Details",id:"details-54",level:4},{value:"ndk_library",id:"ndk_library",level:2},{value:"Parameters",id:"parameters-91",level:4},{value:"Details",id:"details-55",level:4},{value:"ndk_toolchain",id:"ndk_toolchain",level:2},{value:"Parameters",id:"parameters-92",level:4},{value:"ocaml_binary",id:"ocaml_binary",level:2},{value:"Parameters",id:"parameters-93",level:4},{value:"Details",id:"details-56",level:4},{value:"ocaml_library",id:"ocaml_library",level:2},{value:"Parameters",id:"parameters-94",level:4},{value:"Details",id:"details-57",level:4},{value:"ocaml_object",id:"ocaml_object",level:2},{value:"Parameters",id:"parameters-95",level:4},{value:"ocaml_shared",id:"ocaml_shared",level:2},{value:"Parameters",id:"parameters-96",level:4},{value:"platform",id:"platform",level:2},{value:"Parameters",id:"parameters-97",level:4},{value:"prebuilt_apple_framework",id:"prebuilt_apple_framework",level:2},{value:"Parameters",id:"parameters-98",level:4},{value:"Details",id:"details-58",level:4},{value:"prebuilt_cxx_library",id:"prebuilt_cxx_library",level:2},{value:"Parameters",id:"parameters-99",level:4},{value:"Details",id:"details-59",level:4},{value:"prebuilt_cxx_library_group",id:"prebuilt_cxx_library_group",level:2},{value:"Parameters",id:"parameters-100",level:4},{value:"Details",id:"details-60",level:4},{value:"prebuilt_dotnet_library",id:"prebuilt_dotnet_library",level:2},{value:"Parameters",id:"parameters-101",level:4},{value:"Details",id:"details-61",level:4},{value:"prebuilt_go_library",id:"prebuilt_go_library",level:2},{value:"Parameters",id:"parameters-102",level:4},{value:"Details",id:"details-62",level:4},{value:"prebuilt_jar",id:"prebuilt_jar",level:2},{value:"Parameters",id:"parameters-103",level:4},{value:"Details",id:"details-63",level:4},{value:"prebuilt_native_library",id:"prebuilt_native_library",level:2},{value:"Parameters",id:"parameters-104",level:4},{value:"Details",id:"details-64",level:4},{value:"prebuilt_ocaml_library",id:"prebuilt_ocaml_library",level:2},{value:"Parameters",id:"parameters-105",level:4},{value:"prebuilt_python_library",id:"prebuilt_python_library",level:2},{value:"Parameters",id:"parameters-106",level:4},{value:"Details",id:"details-65",level:4},{value:"prebuilt_rust_library",id:"prebuilt_rust_library",level:2},{value:"Parameters",id:"parameters-107",level:4},{value:"Details",id:"details-66",level:4},{value:"python_binary",id:"python_binary",level:2},{value:"Parameters",id:"parameters-108",level:4},{value:"Details",id:"details-67",level:4},{value:"python_bootstrap_binary",id:"python_bootstrap_binary",level:2},{value:"Parameters",id:"parameters-109",level:4},{value:"python_bootstrap_library",id:"python_bootstrap_library",level:2},{value:"Parameters",id:"parameters-110",level:4},{value:"python_library",id:"python_library",level:2},{value:"Parameters",id:"parameters-111",level:4},{value:"Details",id:"details-68",level:4},{value:"python_needed_coverage_test",id:"python_needed_coverage_test",level:2},{value:"Parameters",id:"parameters-112",level:4},{value:"python_test",id:"python_test",level:2},{value:"Parameters",id:"parameters-113",level:4},{value:"Details",id:"details-69",level:4},{value:"python_test_runner",id:"python_test_runner",level:2},{value:"Parameters",id:"parameters-114",level:4},{value:"remote_file",id:"remote_file",level:2},{value:"Parameters",id:"parameters-115",level:4},{value:"Details",id:"details-70",level:4},{value:"robolectric_test",id:"robolectric_test",level:2},{value:"Parameters",id:"parameters-116",level:4},{value:"rust_binary",id:"rust_binary",level:2},{value:"Parameters",id:"parameters-117",level:4},{value:"Details",id:"details-71",level:4},{value:"rust_library",id:"rust_library",level:2},{value:"Parameters",id:"parameters-118",level:4},{value:"Details",id:"details-72",level:4},{value:"rust_test",id:"rust_test",level:2},{value:"Parameters",id:"parameters-119",level:4},{value:"Details",id:"details-73",level:4},{value:"scala_library",id:"scala_library",level:2},{value:"Parameters",id:"parameters-120",level:4},{value:"scala_test",id:"scala_test",level:2},{value:"Parameters",id:"parameters-121",level:4},{value:"scene_kit_assets",id:"scene_kit_assets",level:2},{value:"Parameters",id:"parameters-122",level:4},{value:"sh_binary",id:"sh_binary",level:2},{value:"Parameters",id:"parameters-123",level:4},{value:"Details",id:"details-74",level:4},{value:"sh_test",id:"sh_test",level:2},{value:"Parameters",id:"parameters-124",level:4},{value:"Details",id:"details-75",level:4},{value:"supermodule_target_graph",id:"supermodule_target_graph",level:2},{value:"Parameters",id:"parameters-125",level:4},{value:"swift_library",id:"swift_library",level:2},{value:"Parameters",id:"parameters-126",level:4},{value:"swift_toolchain",id:"swift_toolchain",level:2},{value:"Parameters",id:"parameters-127",level:4},{value:"test_suite",id:"test_suite",level:2},{value:"Parameters",id:"parameters-128",level:4},{value:"Details",id:"details-76",level:4},{value:"versioned_alias",id:"versioned_alias",level:2},{value:"Parameters",id:"parameters-129",level:4},{value:"worker_tool",id:"worker_tool",level:2},{value:"Parameters",id:"parameters-130",level:4},{value:"Details",id:"details-77",level:4},{value:"xcode_postbuild_script",id:"xcode_postbuild_script",level:2},{value:"Parameters",id:"parameters-131",level:4},{value:"xcode_prebuild_script",id:"xcode_prebuild_script",level:2},{value:"Parameters",id:"parameters-132",level:4},{value:"xcode_workspace_config",id:"xcode_workspace_config",level:2},{value:"Parameters",id:"parameters-133",level:4},{value:"zip_file",id:"zip_file",level:2},{value:"Parameters",id:"parameters-134",level:4},{value:"Details",id:"details-78",level:4}],d={toc:p};function m(e){let{components:t,...n}=e;return(0,i.mdx)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.mdx)("h1",{id:"rules"},"Rules"),(0,i.mdx)("p",null,"These rules are available as standard in Buck2."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def alias(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    actual: str.type,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_aar"},"android","_","aar"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def android_aar(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    abi_generation_mode: [None, str.type] = _,\n    annotation_processing_tool: [None, str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    build_config_values: [str.type] = _,\n    build_config_values_file: [None, str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    enable_relinker: bool.type = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    extra_kotlinc_arguments: [str.type] = _,\n    extra_non_source_only_abi_kotlinc_arguments: [str.type] = _,\n    friend_paths: [str.type] = _,\n    include_build_config_class: bool.type = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    kotlin_compiler_plugins: {str.type: {str.type: str.type}} = _,\n    labels: [str.type] = _,\n    language: [None, str.type] = _,\n    licenses: [str.type] = _,\n    manifest: [None, str.type] = _,\n    manifest_file: [None, str.type] = _,\n    manifest_skeleton: str.type,\n    maven_coords: [None, str.type] = _,\n    native_library_merge_code_generator: [None, str.type] = _,\n    native_library_merge_glue: [None, str.type] = _,\n    native_library_merge_localized_symbols: [None, [str.type]] = _,\n    native_library_merge_map: [None, {str.type: [str.type]}] = _,\n    native_library_merge_sequence: [None, [(str.type, [str.type])]] = _,\n    native_library_merge_sequence_blocklist: [None, [str.type]] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    provided_deps_query: [None, str.type] = _,\n    relinker_whitelist: [str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resource_union_package: [None, str.type] = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    srcs: [str.type] = _,\n    target: [None, str.type] = _,\n    use_jvm_abi_gen: [None, bool.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_aar()")," rule is used to generate an Android AAR."),(0,i.mdx)("h4",{id:"parameters-1"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"build_config_values"),": See the documentation on the values argument for ",(0,i.mdx)("inlineCode",{parentName:"li"},"android\\_build\\_config()"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": List of build targets whose corresponding compiled Java code, Android resources, and native libraries will be included in the AAR along with their transitive dependencies. For compile time deps which should not be included in the final AAR, use ",(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps")," instead. ",(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"android_library()")," Will be included in the final ",(0,i.mdx)("inlineCode",{parentName:"em"},"classes.jar"))," ",(0,i.mdx)("inlineCode",{parentName:"li"},"android_resource()")," Will be included in the final ",(0,i.mdx)("inlineCode",{parentName:"li"},"R.txt"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"res/")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"assets/"),(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"android_build_config()")," Will be included in the final ",(0,i.mdx)("inlineCode",{parentName:"em"},"classes.jar")," if ",(0,i.mdx)("inlineCode",{parentName:"em"},"include_build_config_class")," is True ")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"groovy_library()")," Will be included in the final ",(0,i.mdx)("inlineCode",{parentName:"li"},"classes.jar"),(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"java_library()")," Will be included in the final ",(0,i.mdx)("inlineCode",{parentName:"em"},"classes.jar"))," ",(0,i.mdx)("inlineCode",{parentName:"li"},"prebuilt_jar()")," Will be included in the final ",(0,i.mdx)("inlineCode",{parentName:"li"},"classes.jar"),(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"ndk_library()")," Will be included in the final ",(0,i.mdx)("inlineCode",{parentName:"em"},"jni/")," or ",(0,i.mdx)("inlineCode",{parentName:"em"},"assets/")," if ",(0,i.mdx)("inlineCode",{parentName:"em"},"is_asset")," is True ")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"prebuilt_native_library()")," Will be included in the final ",(0,i.mdx)("inlineCode",{parentName:"li"},"jni/")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"assets/")," if ",(0,i.mdx)("inlineCode",{parentName:"li"},"is_asset")," is True"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"include_build_config_class"),": Whether to include the ",(0,i.mdx)("inlineCode",{parentName:"li"},"BuildConfig")," class files in the final .aar file. Needs to be set to ",(0,i.mdx)("inlineCode",{parentName:"li"},"True")," if any build","_","config","_","values are specified. This is normally only needed if the build tool that is consuming the .aar file does not generate ",(0,i.mdx)("inlineCode",{parentName:"li"},"BuildConfig")," classes. Note: the AAR format does not specify a way to pass defaults that should be injected into the final ",(0,i.mdx)("inlineCode",{parentName:"li"},"BuildConfig")," class, therefore that information might need to be replicated manually in the build that's consuming the .aar file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"manifest_skeleton"),": The skeleton manifest file used to generate the final ",(0,i.mdx)("inlineCode",{parentName:"li"},"AndroidManifest.xml")," . May either be a file or a ",(0,i.mdx)("inlineCode",{parentName:"li"},"android\\_manifest()"),"target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"remove_classes"),": List of classes to remove from the output aar. It removes classes from the target's own sources, and its dependencies.")),(0,i.mdx)("h4",{id:"details"},"Details"),(0,i.mdx)("p",null,"See the ",(0,i.mdx)("a",{parentName:"p",href:"https://developer.android.com/studio/projects/android-library#aar-contents"},"official Android documentation")," for details about the ",(0,i.mdx)("inlineCode",{parentName:"p"},".aar")," format."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nandroid_resource(\n  name = 'res',\n  res = 'res',\n  assets = 'assets',\n  package = 'com.example',\n)\n\nandroid_library(\n  name = 'lib',\n  srcs = glob(['**/*.java']),\n)\n\nandroid_aar(\n  name = 'app',\n  manifest_skeleton = 'AndroidManifestSkeleton.xml',\n  deps = [\n    ':res',\n    ':lib',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_app_modularity"},"android","_","app","_","modularity"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def android_app_modularity(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _build_only_native_code: bool.type = _,\n    application_module_blacklist: [None, [str.type]] = _,\n    application_module_configs: {str.type: [str.type]} = _,\n    application_module_dependencies: [None, {str.type: [str.type]}] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    no_dx: [str.type] = _,\n    should_include_classes: bool.type = _,\n    should_include_libraries: bool.type = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-2"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_binary"},"android","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def android_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _dex_toolchain: str.type = _,\n    _is_building_android_binary: bool.type = _,\n    _is_force_single_cpu: bool.type = _,\n    _is_force_single_default_cpu: bool.type = _,\n    _java_toolchain: str.type = _,\n    aapt2_keep_raw_values: bool.type = _,\n    aapt2_locale_filtering: bool.type = _,\n    aapt_mode: str.type = _,\n    additional_aapt_params: [str.type] = _,\n    allow_r_dot_java_in_secondary_dex: bool.type = _,\n    allowed_duplicate_resource_types: [str.type] = _,\n    android_sdk_proguard_config: [None, str.type] = _,\n    application_module_blacklist: [None, [str.type]] = _,\n    application_module_configs: {str.type: [str.type]} = _,\n    application_module_dependencies: [None, {str.type: [str.type]}] = _,\n    asset_compression_algorithm: [None, str.type] = _,\n    banned_duplicate_resource_types: [str.type] = _,\n    build_config_values: [str.type] = _,\n    build_config_values_file: [None, str.type] = _,\n    build_string_source_map: bool.type = _,\n    compress_asset_libraries: bool.type = _,\n    constraint_overrides: [str.type] = _,\n    contacts: [str.type] = _,\n    cpu_filters: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    dex_compression: [None, str.type] = _,\n    dex_group_lib_limit: int.type = _,\n    dex_tool: str.type = _,\n    disable_pre_dex: bool.type = _,\n    duplicate_resource_behavior: str.type = _,\n    duplicate_resource_whitelist: [None, str.type] = _,\n    enable_relinker: bool.type = _,\n    exopackage_modes: [str.type] = _,\n    extra_filtered_resources: [str.type] = _,\n    field_ref_count_buffer_space: int.type = _,\n    ignore_aapt_proguard_config: bool.type = _,\n    includes_vector_drawables: bool.type = _,\n    is_cacheable: bool.type = _,\n    is_voltron_language_pack_enabled: bool.type = _,\n    keystore: str.type,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    linear_alloc_hard_limit: int.type = _,\n    locales: [str.type] = _,\n    manifest: [None, str.type] = _,\n    manifest_entries: {str.type: ""} = _,\n    manifest_skeleton: [None, str.type] = _,\n    method_ref_count_buffer_space: int.type = _,\n    min_sdk_version: [None, int.type] = _,\n    minimize_primary_dex_size: bool.type = _,\n    module_manifest_skeleton: [None, str.type] = _,\n    native_library_merge_code_generator: [None, str.type] = _,\n    native_library_merge_glue: [None, str.type] = _,\n    native_library_merge_localized_symbols: [None, [str.type]] = _,\n    native_library_merge_map: [None, {str.type: [str.type]}] = _,\n    native_library_merge_sequence: [None, [(str.type, [str.type])]] = _,\n    native_library_merge_sequence_blocklist: [None, [str.type]] = _,\n    no_auto_add_overlay_resources: bool.type = _,\n    no_auto_version_resources: bool.type = _,\n    no_dx: [str.type] = _,\n    no_version_transitions_resources: bool.type = _,\n    optimization_passes: int.type = _,\n    package_asset_libraries: bool.type = _,\n    package_type: str.type = _,\n    packaged_locales: [str.type] = _,\n    post_filter_resources_cmd: [None, str.type] = _,\n    preprocess_java_classes_bash: [None, str.type] = _,\n    preprocess_java_classes_cmd: [None, str.type] = _,\n    preprocess_java_classes_deps: [str.type] = _,\n    primary_dex_patterns: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    proguard_jvm_args: [str.type] = _,\n    relinker_whitelist: [str.type] = _,\n    resource_compression: str.type = _,\n    resource_filter: [str.type] = _,\n    resource_stable_ids: [None, str.type] = _,\n    resource_union_package: [None, str.type] = _,\n    secondary_dex_weight_limit: [None, int.type] = _,\n    skip_crunch_pngs: [None, bool.type] = _,\n    skip_proguard: bool.type = _,\n    trim_resource_ids: bool.type = _,\n    use_split_dex: bool.type = _,\n    xz_compression_level: int.type = _\n) -> None\n')),(0,i.mdx)("h4",{id:"parameters-3"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_build_config"},"android","_","build","_","config"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def android_build_config(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _build_only_native_code: bool.type = _,\n    _is_building_android_binary: bool.type = _,\n    _java_toolchain: str.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    package: str.type = _,\n    values: [str.type] = _,\n    values_file: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_build_config()")," rule is used to generate a ",(0,i.mdx)("inlineCode",{parentName:"p"},"BuildConfig")," class with global configuration variables that other ",(0,i.mdx)("inlineCode",{parentName:"p"},"android\\_library()"),"rules can compile against. Currently, the only variable exposed by ",(0,i.mdx)("inlineCode",{parentName:"p"},"BuildConfig")," is a global ",(0,i.mdx)("inlineCode",{parentName:"p"},"boolean")," named ",(0,i.mdx)("inlineCode",{parentName:"p"},"DEBUG"),", much like the ",(0,i.mdx)("inlineCode",{parentName:"p"},"BuildConfig.java")," generated by the official Android build tools based on Gradle."),(0,i.mdx)("h4",{id:"parameters-4"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"package"),": Name of the Java package to use in the generated ",(0,i.mdx)("inlineCode",{parentName:"li"},"BuildConfig.java")," file. Most developers set this to the application id declared in the manifest via ",(0,i.mdx)("inlineCode",{parentName:"li"},'<manifest package="APP_ID">'),". Example: ",(0,i.mdx)("inlineCode",{parentName:"li"},"com.facebook.orca"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"values"),": List of strings that defines additional fields (and values) that should be declared in the generated ",(0,i.mdx)("inlineCode",{parentName:"li"},"BuildConfig.java")," file. Like ",(0,i.mdx)("inlineCode",{parentName:"li"},"DEBUG"),", the values will be non-constant-expressions that evaluate to the value specified in the file at compilation time. To override the values in an APK, specify build","_","config","_","values or build","_","config","_","values","_","file in ",(0,i.mdx)("inlineCode",{parentName:"li"},"android\\_binary()"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"values_file"),": Optional path to a file that defines additional fields (and values) that should be declared in the generated ",(0,i.mdx)("inlineCode",{parentName:"li"},"BuildConfig.java")," file. Like ",(0,i.mdx)("inlineCode",{parentName:"li"},"DEBUG"),", the values will be non-constant-expressions that evaluate to the value specified in the file at compilation time. To override the values in an APK, specify build","_","config","_","values or build","_","config","_","values","_","file in ",(0,i.mdx)("inlineCode",{parentName:"li"},"android\\_binary()"),".")),(0,i.mdx)("p",null,"Note that values","_","file can be a generated file, as can build","_","config","_","values","_","file as\ndemonstrated in the example below."),(0,i.mdx)("h4",{id:"details-1"},"Details"),(0,i.mdx)("p",null,"The fields in the generated ",(0,i.mdx)("inlineCode",{parentName:"p"},"BuildConfig")," class will\nbe non-constant-expressions (see ",(0,i.mdx)("a",{parentName:"p",href:"http://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.28"},"JLS 15.28"),").\nHowever, if ",(0,i.mdx)("inlineCode",{parentName:"p"},"BuildConfig")," is packaged into an APK, it will\nbe replaced with a new version where:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"The fields will be set to literal values (i.e., constant expressions)."),(0,i.mdx)("li",{parentName:"ul"},"The ",(0,i.mdx)("inlineCode",{parentName:"li"},"boolean BuildConfig.DEBUG")," field will correspond to\nthat of the ",(0,i.mdx)("inlineCode",{parentName:"li"},"package_type")," argument to the ",(0,i.mdx)("inlineCode",{parentName:"li"},"android\\_binary()"),"rule\nthat is packaging it.")),(0,i.mdx)("p",null,"This transformation is done before ProGuard is applied (if applicable), so\nthat it can propagate constants from ",(0,i.mdx)("inlineCode",{parentName:"p"},"BuildConfig")," and eliminate\ndead code."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Here is an example of an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_build_config()")," rule that\nis transitively included by both ",(0,i.mdx)("em",{parentName:"p"},"debug")," and ",(0,i.mdx)("em",{parentName:"p"},"release")," versions\nof an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android\\_binary()"),"rule. The value\nof ",(0,i.mdx)("inlineCode",{parentName:"p"},"com.example.pkg.BuildConfig.DEBUG")," will be different in each APK\neven though they both transitively depend on the same ",(0,i.mdx)("inlineCode",{parentName:"p"},":build_config")," rule."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nandroid_build_config(\n  name = 'build_config',\n  package = 'com.example.pkg',\n  values = [\n    'String COMMIT_ID = \"0000000000000000000000000000000000000000\"',\n  ],\n)\n\n# The .java files in this library may contain references to the boolean\n# com.example.pkg.BuildConfig.DEBUG because :build_config is in the deps.\n# It could also reference BuildConfig.COMMIT_ID.\nandroid_library(\n  name = 'mylib',\n  srcs = glob(['src/**/*.java']),\n  deps = [\n    ':build_config',\n  ],\n)\n\nandroid_binary(\n  name = 'debug',\n  package_type = 'DEBUG',\n  keystore =  '//keystores:debug',\n  manifest = 'AndroidManifest.xml',\n  target = 'Google Inc.:Google APIs:19',\n  deps = [\n    ':mylib',\n  ],\n)\n\n# The contents of the file generated by this rule might be:\n#\n# String COMMIT_ID = \"7bf804bdf71fdbfc99cce3b155b3643f022c6fa4\"\n#\n# Note that the output of :build_config_release_values will be cached by Buck.\n# Assuming that generate_release_build_config.py depends on state that is not\n# expressed by its deps (which violates a fundamental invariant in Buck!), a\n# workaround is to ensure that the inputs to :build_config_release_values are\n# changed in some way before :release is built to ensure that the output from\n# :build_config_release_values is not pulled from cache. For example:\n#\n# $ buck build :release\n# $ uuidgen > dummy_state_file.txt\n# $ buck build :release\n#\n# This makes sure that generate_release_build_config.py is re-run before\n# :release is rebuilt. This is much cheaper than deleting your build cache\n# before rebuilding.\ngenrule(\n  name = 'build_config_release_values',\n  srcs = [ 'generate_release_build_config.py', 'dummy_state_file.txt' ],\n  bash = 'generate_release_build_config.py $OUT',\n  out = 'build_config_release_values.txt',\n)\n\nandroid_binary(\n  name = 'release',\n  package_type = 'RELEASE',\n  keystore =  '//keystores:release',\n  manifest = 'AndroidManifest.xml',\n  target = 'Google Inc.:Google APIs:19',\n  build_config_values_file = ':build_config_release_values',\n  deps = [\n    ':mylib',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_bundle"},"android","_","bundle"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def android_bundle(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _dex_toolchain: str.type = _,\n    _is_building_android_binary: bool.type = _,\n    _is_force_single_cpu: bool.type = _,\n    _is_force_single_default_cpu: bool.type = _,\n    _java_toolchain: str.type = _,\n    aapt2_keep_raw_values: bool.type = _,\n    aapt2_locale_filtering: bool.type = _,\n    aapt_mode: str.type = _,\n    additional_aapt_params: [str.type] = _,\n    allow_r_dot_java_in_secondary_dex: bool.type = _,\n    allowed_duplicate_resource_types: [str.type] = _,\n    android_sdk_proguard_config: [None, str.type] = _,\n    application_module_blacklist: [None, [str.type]] = _,\n    application_module_configs: {str.type: [str.type]} = _,\n    application_module_dependencies: [None, {str.type: [str.type]}] = _,\n    asset_compression_algorithm: [None, str.type] = _,\n    banned_duplicate_resource_types: [str.type] = _,\n    build_config_values: [str.type] = _,\n    build_config_values_file: [None, str.type] = _,\n    build_string_source_map: bool.type = _,\n    bundle_config_file: [None, str.type] = _,\n    compress_asset_libraries: bool.type = _,\n    contacts: [str.type] = _,\n    cpu_filters: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    dex_compression: [None, str.type] = _,\n    dex_group_lib_limit: int.type = _,\n    dex_tool: str.type = _,\n    disable_pre_dex: bool.type = _,\n    duplicate_resource_behavior: str.type = _,\n    duplicate_resource_whitelist: [None, str.type] = _,\n    enable_relinker: bool.type = _,\n    exopackage_modes: [str.type] = _,\n    extra_filtered_resources: [str.type] = _,\n    field_ref_count_buffer_space: int.type = _,\n    ignore_aapt_proguard_config: bool.type = _,\n    includes_vector_drawables: bool.type = _,\n    is_cacheable: bool.type = _,\n    is_voltron_language_pack_enabled: bool.type = _,\n    keystore: str.type,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    linear_alloc_hard_limit: int.type = _,\n    locales: [str.type] = _,\n    manifest: [None, str.type] = _,\n    manifest_entries: {str.type: ""} = _,\n    manifest_skeleton: [None, str.type] = _,\n    method_ref_count_buffer_space: int.type = _,\n    min_sdk_version: [None, int.type] = _,\n    minimize_primary_dex_size: bool.type = _,\n    module_manifest_skeleton: [None, str.type] = _,\n    native_library_merge_code_generator: [None, str.type] = _,\n    native_library_merge_glue: [None, str.type] = _,\n    native_library_merge_localized_symbols: [None, [str.type]] = _,\n    native_library_merge_map: [None, {str.type: [str.type]}] = _,\n    native_library_merge_sequence: [None, [(str.type, [str.type])]] = _,\n    native_library_merge_sequence_blocklist: [None, [str.type]] = _,\n    no_auto_add_overlay_resources: bool.type = _,\n    no_auto_version_resources: bool.type = _,\n    no_dx: [str.type] = _,\n    no_version_transitions_resources: bool.type = _,\n    optimization_passes: int.type = _,\n    package_asset_libraries: bool.type = _,\n    package_type: str.type = _,\n    packaged_locales: [str.type] = _,\n    post_filter_resources_cmd: [None, str.type] = _,\n    preprocess_java_classes_bash: [None, str.type] = _,\n    preprocess_java_classes_cmd: [None, str.type] = _,\n    preprocess_java_classes_deps: [str.type] = _,\n    primary_dex_patterns: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    proguard_jvm_args: [str.type] = _,\n    relinker_whitelist: [str.type] = _,\n    resource_compression: str.type = _,\n    resource_filter: [str.type] = _,\n    resource_stable_ids: [None, str.type] = _,\n    resource_union_package: [None, str.type] = _,\n    secondary_dex_weight_limit: [None, int.type] = _,\n    skip_crunch_pngs: [None, bool.type] = _,\n    skip_proguard: bool.type = _,\n    trim_resource_ids: bool.type = _,\n    use_split_dex: bool.type = _,\n    xz_compression_level: int.type = _\n) -> None\n')),(0,i.mdx)("h4",{id:"parameters-5"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_instrumentation_apk"},"android","_","instrumentation","_","apk"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def android_instrumentation_apk(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _dex_toolchain: str.type = _,\n    _is_building_android_binary: bool.type = _,\n    _is_force_single_cpu: bool.type = _,\n    _is_force_single_default_cpu: bool.type = _,\n    _java_toolchain: str.type = _,\n    aapt_mode: str.type = _,\n    apk: str.type,\n    contacts: [str.type] = _,\n    cpu_filters: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    dex_tool: str.type = _,\n    disable_pre_dex: bool.type = _,\n    includes_vector_drawables: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    manifest: [None, str.type] = _,\n    manifest_skeleton: [None, str.type] = _,\n    min_sdk_version: [None, int.type] = _,\n    primary_dex_patterns: [str.type] = _,\n    use_split_dex: [None, bool.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_instrumentation_apk()")," rule is used to generate an Android Instrumentation APK."),(0,i.mdx)("h4",{id:"parameters-6"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("h4",{id:"details-2"},"Details"),(0,i.mdx)("p",null,"Android's ",(0,i.mdx)("a",{parentName:"p",href:"http://developer.android.com/tools/testing/testing_android.html"},"Testing Fundamentals"),' documentation includes a diagram that shows\nthe relationship between an "application package" and a "test package"\nwhen running a test. This rule corresponds to a test package. Note\nthat a test package has an interesting quirk where it is ',(0,i.mdx)("em",{parentName:"p"},"compiled\nagainst")," an application package, but ",(0,i.mdx)("em",{parentName:"p"},"must not include")," the\nresources or Java classes of the application package. Therefore, this\nclass takes responsibility for making sure the appropriate bits are\nexcluded. Failing to do so will generate mysterious runtime errors\nwhen running the test."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Here is an example of an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_instrumentation_apk()")," rule that tests a ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_binary()"),", and depends on a test\npackage."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nandroid_library(\n  name = 'test',\n  srcs = glob(['test/**/*.java']),\n)\n\nandroid_binary(\n  name = 'messenger',\n  manifest = 'AndroidManifest.xml',\n  keystore = '//keystores:prod',\n  package_type = 'release',\n  proguard_config = 'proguard.cfg',\n  deps = [\n    ...\n  ],\n)\n\n# Building this rule will produce a file named messenger_test.apk\nandroid_instrumentation_apk(\n  name = 'messenger_test',\n  manifest = 'AndroidInstrumentationManifest.xml',\n  apk = ':messenger',\n  deps = [\n    ':test',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_instrumentation_test"},"android","_","instrumentation","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def android_instrumentation_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _inject_test_env: str.type = _,\n    _java_toolchain: str.type = _,\n    apk: str.type,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    test_rule_timeout_ms: [None, int.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_instrumentation_test()")," rule is used to define apks that should be used to run Android instrumentation tests."),(0,i.mdx)("h4",{id:"parameters-7"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"apk"),": The APK containing the tests. Can be an ",(0,i.mdx)("inlineCode",{parentName:"li"},"android\\_binary()"),", an ",(0,i.mdx)("inlineCode",{parentName:"li"},"apk\\_genrule()"),"or an ",(0,i.mdx)("inlineCode",{parentName:"li"},"android\\_instrumentation\\_apk()"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": A list of labels to be applied to these tests. These labels are arbitrary text strings and have no meaning within buck itself. They can, however, have meaning for you as a test author (e.g., ",(0,i.mdx)("inlineCode",{parentName:"li"},"smoke")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"fast"),"). A label can be used to filter or include a specific test rule when executing ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck test")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"test_rule_timeout_ms"),": If set specifies the maximum amount of time (in milliseconds) in which all of the tests in this rule should complete. This overrides the default ",(0,i.mdx)("inlineCode",{parentName:"li"},"rule_timeout")," if any has been specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig")," .")),(0,i.mdx)("h4",{id:"details-3"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Here is an example of an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_instrumentation_test()"),"\nrule that tests an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_binary()"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nandroid_binary(\n  name = 'messenger',\n  manifest = 'AndroidManifest.xml',\n  keystore = '//keystores:prod',\n  package_type = 'release',\n  proguard_config = 'proguard.cfg',\n  deps = [\n    ...\n  ],\n)\n\nandroid_instrumentation_apk(\n  name = 'messenger_test',\n  manifest = 'AndroidInstrumentationManifest.xml',\n  apk = ':messenger',\n  deps = [\n    ...\n  ],\n)\n\nandroid_instrumentation_test(\n  name = 'messenger_instrumentation_test',\n  apk = ':messenger_test',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_library"},"android","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def android_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _build_only_native_code: bool.type = _,\n    _dex_min_sdk_version: [None, int.type] = _,\n    _dex_toolchain: str.type = _,\n    _is_building_android_binary: bool.type = _,\n    _java_toolchain: str.type = _,\n    _kotlin_toolchain: str.type = _,\n    abi_generation_mode: [None, str.type] = _,\n    annotation_processing_tool: [None, str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    extra_kotlinc_arguments: [str.type] = _,\n    extra_non_source_only_abi_kotlinc_arguments: [str.type] = _,\n    friend_paths: [str.type] = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    kotlin_compiler_plugins: {str.type: {str.type: str.type}} = _,\n    labels: [str.type] = _,\n    language: [None, str.type] = _,\n    licenses: [str.type] = _,\n    manifest: [None, str.type] = _,\n    manifest_file: [None, str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    provided_deps_query: [None, str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resource_union_package: [None, str.type] = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    srcs: [str.type] = _,\n    target: [None, str.type] = _,\n    use_jvm_abi_gen: [None, bool.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_library()")," rule is used to define a set of Java files that can be compiled together against the Android SDK. The main output of an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_library()")," rule is a single JAR file containing all of the compiled class files and resources."),(0,i.mdx)("h4",{id:"parameters-8"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"name"),": name of the target")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"within_view"),": a list of visibility patterns restricting what this target can depend on")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"annotation_processing_tool"),': Specifies the tool to use for annotation processing. Possible values: "kapt" or "javac". "kapt" allows running Java annotation processors against Kotlin sources while backporting it for Java sources too. "javac" works only against Java sources, Kotlin sources won\'t have access to generated classes at compile time.')),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"deps"),": Rules (usually other ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_library")," rules) that are used to generate the classpath required to compile this ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_library"),".")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"deps_query"),": Status: ",(0,i.mdx)("strong",{parentName:"p"},"experimental/unstable"),". The deps query takes a query string that accepts the following query functions, and appends the output of the query to the declared deps:")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"attrfilter"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"deps"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"except"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"intersect"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"filter"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"kind"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"set"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"union")))),(0,i.mdx)("p",null," The macro ",(0,i.mdx)("inlineCode",{parentName:"p"},"$declared_deps")," may be used anywhere a target literal pattern is expected\nin order to refer to the explicit deps of this rule as they appear in the rule's definition.\nFor example, if your build rule declares"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n  android_library(\n    name = 'lib',\n    deps = ['//foo:foo'],\n    deps_query = '$declared_deps',\n  )\n")),(0,i.mdx)("p",null," then the macro ",(0,i.mdx)("inlineCode",{parentName:"p"},"$declared_deps")," would be expanded to a\nliteral ",(0,i.mdx)("inlineCode",{parentName:"p"},"set(//foo:foo)"),".\nSome example queries:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n  "filter({name_regex}, $declared_deps)".format(name_regex=\'//.*\')\n  "attrfilter(annotation_processors, com.foo.Processor, $declared_deps)"\n  "deps(\'//foo:foo\', 1)"\n')),(0,i.mdx)("p",null," Note: any targets included in this query must also be present in ",(0,i.mdx)("inlineCode",{parentName:"p"},"deps"),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),": Other  rules that depend on this rule will also include its ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps")," in their classpaths. This is useful when the public API of a rule has return types or checked exceptions that are defined in another rule, which would otherwise require callers to add an extra dependency. It's also useful for exposing e.g. a collection of ",(0,i.mdx)("inlineCode",{parentName:"li"},"prebuilt_jar")," rules as a single target for callers to depend on. Targets in ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps")," are implicitly included in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps")," of this rule, so they don't need to be repeated there."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_provided_deps"),": This is a combination of ",(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),". Rules listed in this parameter will be added to classpath of rules that depend on this rule, but they will not be included in a binary if binary depends on a such target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_arguments"),": List of additional arguments to pass into the Java compiler. These arguments follow the ones specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_kotlinc_arguments"),": List of additional arguments to pass into the Kotlin compiler."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"javac"),': Specifies the Java compiler program to use for this rule. The value is a source path (e.g., //foo/bar:bar). Overrides the value in "javac" in the "tools" section of ',(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"manifest"),": An optional ",(0,i.mdx)("a",{parentName:"li",href:"http://developer.android.com/guide/topics/manifest/manifest-intro.html"},"Android Manifest")," for the to declare any permissions or intents it may need or want to handle. May either be a file or a ",(0,i.mdx)("inlineCode",{parentName:"li"},"android\\_manifest()"),"target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps"),": These represent dependencies that are known to be provided at run time, but are required in order for the code to compile. Examples of ",(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps")," include the JEE servlet APIs. When this rule is included in a , the ",(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps")," will not be packaged into the output."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps_query"),": Status: ",(0,i.mdx)("strong",{parentName:"li"},"experimental/unstable"),". The provided deps query functions in the same way as the deps query, but the referenced deps using ",(0,i.mdx)("inlineCode",{parentName:"li"},"$declared")," are the provided deps of the target, and the results of the query are appended to the declared provided deps."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"remove_classes"),": List of classes to remove from the output jar. It only removes classes from the target's own sources, not from any of its dependencies."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"required_for_source_only_abi"),": Indicates that this rule must be present on the classpath during ",(0,i.mdx)("inlineCode",{parentName:"li"},"source-only ABI generation")," of any rule that depends on it. Typically this is done when a rule contains annotations, enums, constants, or interfaces.")),(0,i.mdx)("p",null,"Having rules present on the classpath during source-only ABI generation prevents Buck from\ncompletely flattening the build graph, thus reducing the performance win from source-only\nABI generation. These rules should be kept small (ideally just containing annotations,\nconstants, enums, and interfaces) and with minimal dependencies of their own."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": Static files to include among the compiled ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," files. These files can be loaded via ",(0,i.mdx)("a",{parentName:"li",href:"http://docs.oracle.com/javase/7/docs/api/java/lang/Class.html#getResource(java.lang.String)"},"Class.getResource()"),".")),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Note:")," Buck uses the ",(0,i.mdx)("inlineCode",{parentName:"p"},"src_roots")," property in\n",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"\nto help determine where resources should be placed within the generated JAR file."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"source"),': Specifies the version of Java (as a string) to interpret source files as. Overrides the value in "source',"_",'level" in the "java" section of ',(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"source_only_abi_deps"),": These are dependencies that must be present during ",(0,i.mdx)("inlineCode",{parentName:"li"},"source-only ABI generation"),". Typically such dependencies are added when some property of the code in this rule prevents source-only ABI generation from being correct without these dependencies being present.")),(0,i.mdx)("p",null,"Having ",(0,i.mdx)("inlineCode",{parentName:"p"},"source_only_abi_deps")," prevents Buck from\ncompletely flattening the build graph, thus reducing the performance win from source-only\nABI generation. They should be avoided when possible. Often only a small code change is needed to avoid them.\nFor more information on such code changes, read about\n",(0,i.mdx)("inlineCode",{parentName:"p"},"source-only ABI generation"),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of ",(0,i.mdx)("inlineCode",{parentName:"li"},".java")," files to compile for this rule."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target"),': Specifies the version of Java (as a string) for which to generate code. Overrides the value in "target',"_",'level" in the "java" section of ',(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),".")),(0,i.mdx)("h4",{id:"details-4"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_library")," rule used in concert with an\n",(0,i.mdx)("inlineCode",{parentName:"p"},"android\\_resource()"),"rule.\nThis would be a common arrangement for a standard Android Library project\nas defined by\n",(0,i.mdx)("a",{parentName:"p",href:"http://developer.android.com/tools/projects/index.html"},"http://developer.android.com/tools/projects/index.html")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nandroid_resource(\n  name = 'res',\n  res = 'res',\n  package = 'com.example',\n)\n\nandroid_library(\n  name = 'my_library',\n  srcs = glob(['src/**/*.java']),\n  deps = [\n    ':res',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_manifest"},"android","_","manifest"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def android_manifest(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    skeleton: str.type\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_manifest()")," rule is used to generate an ",(0,i.mdx)("a",{parentName:"p",href:"http://developer.android.com/guide/topics/manifest/manifest-intro.html"},"Android Manifest")," to be used by ",(0,i.mdx)("inlineCode",{parentName:"p"},"android\\_binary()"),"and ",(0,i.mdx)("inlineCode",{parentName:"p"},"android\\_aar()"),"rules. This rule takes a skeleton manifest, and merges it with manifests found in any deps."),(0,i.mdx)("h4",{id:"parameters-9"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": A collection of dependencies that includes android","_","library rules. The manifest files of the ",(0,i.mdx)("inlineCode",{parentName:"li"},"android\\_library()"),"rules will be filtered out to become dependent source files for the manifest."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"skeleton"),": Either a ",(0,i.mdx)("inlineCode",{parentName:"li"},"build target"),"or a path to a file representing the manifest that will be merged with any manifests associated with this rule's ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),".")),(0,i.mdx)("h4",{id:"details-5"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Here's an example of an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_manifest()")," that has no deps."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nandroid_manifest(\n  name = 'my-manifest',\n  skeleton = 'AndroidManifestSkeleton.xml',\n)\n\n")),(0,i.mdx)("p",null," This is what ",(0,i.mdx)("inlineCode",{parentName:"p"},"AndroidManifestSkeleton.xml")," looks like."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n<?xml version="1.0" encoding="utf-8"?>\n<manifest xmlns:android="http://schemas.android.com/apk/res/android"\n          package="com.example"\n          android:versionCode="1"\n          android:versionName="1.0">\n\n    <uses-sdk targetSdkVersion="19" minSdkVersion="17"/>\n    <application\n        android:label="@string/app_name"\n        android:icon="@drawable/ic_launcher">\n        <activity\n            android:name="MyActivity"\n            android:label="@string/app_name">\n            <intent-filter>\n                <action android:name="android.intent.action.MAIN"/>\n                <category android:name="android.intent.category.LAUNCHER"/>\n            </intent-filter>\n        </activity>\n    </application>\n</manifest>\n\n')),(0,i.mdx)("p",null," You could also use a ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),"to generate the manifest file and reference the\n",(0,i.mdx)("inlineCode",{parentName:"p"},"build target"),"in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"skeleton")," argument."),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_platform"},"android","_","platform"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def android_platform(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    base_platform: str.type,\n    native_platforms: {str.type: str.type} = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-10"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_prebuilt_aar"},"android","_","prebuilt","_","aar"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def android_prebuilt_aar(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _build_only_native_code: bool.type = _,\n    _dex_min_sdk_version: [None, int.type] = _,\n    _dex_toolchain: str.type = _,\n    _java_toolchain: str.type = _,\n    aar: str.type,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    javadoc_url: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    maven_coords: [None, str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    source_jar: [None, str.type] = _,\n    use_system_library_loader: bool.type = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_prebuilt_aar()")," rule takes an ",(0,i.mdx)("inlineCode",{parentName:"p"},".aar")," file and makes it available as an Android dependency. As expected, an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android\\_binary()"),"that transitively depends on an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_prebuilt_aar()")," will include its contents in the generated APK."),(0,i.mdx)("h4",{id:"parameters-11"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"aar"),": Path to the ",(0,i.mdx)("inlineCode",{parentName:"li"},".aar")," file. This may also be a build target to a rule (such as a ",(0,i.mdx)("inlineCode",{parentName:"li"},"genrule()"),") whose output is an ",(0,i.mdx)("inlineCode",{parentName:"li"},".aar")," file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"javadoc_url"),": URL to the Javadoc for the ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," files in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"aar"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"source_jar"),": Path to a JAR file that contains the ",(0,i.mdx)("inlineCode",{parentName:"li"},".java")," files to create the ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"aar"),". This is frequently provided for debugging purposes."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"use_system_library_loader"),": If this ",(0,i.mdx)("inlineCode",{parentName:"li"},".aar")," file contains native prebuilt ",(0,i.mdx)("inlineCode",{parentName:"li"},".so")," libraries and the Java code uses these libraries via a call to ",(0,i.mdx)("inlineCode",{parentName:"li"},"System.loadLibrary()"),", then many optimizations\u2014such as exopackage, compression, or asset packaging\u2014may not be compatible with these prebuilt libs. Setting this parameter to ",(0,i.mdx)("inlineCode",{parentName:"li"},"True")," causes all of these optimizations to skip the prebuilt ",(0,i.mdx)("inlineCode",{parentName:"li"},".so")," files originating from this ",(0,i.mdx)("inlineCode",{parentName:"li"},".aar")," file. The ",(0,i.mdx)("inlineCode",{parentName:"li"},".so")," files will always be packaged directly into the main ",(0,i.mdx)("inlineCode",{parentName:"li"},".apk"),".")),(0,i.mdx)("h4",{id:"details-6"},"Details"),(0,i.mdx)("p",null,"See the ",(0,i.mdx)("a",{parentName:"p",href:"https://developer.android.com/studio/projects/android-library#aar-contents"},"official Android documentation")," for details about the ",(0,i.mdx)("inlineCode",{parentName:"p"},".aar")," format."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nandroid_prebuilt_aar(\n  name = 'play-services',\n  aar = 'play-services-4.0.30.aar',\n  source_jar = 'play-services-4.0.30-sources.jar',\n  javadoc_url = 'file:///opt/android-sdk/extras/google/google_play_services/docs/reference',\n)\n\nandroid_library(\n  name = 'lib',\n  # This Java code can compile against Play services and reference its resources.\n  srcs = glob(['*.java']),\n  deps = [ ':play-services' ],\n)\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"android_resource"},"android","_","resource"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def android_resource(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _build_only_native_code: bool.type = _,\n    allowlisted_locales: [None, [str.type]] = _,\n    assets: [None, str.type, {str.type: str.type}] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    has_whitelisted_strings: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    manifest: [None, str.type] = _,\n    package: [None, str.type] = _,\n    project_assets: [None, str.type] = _,\n    project_res: [None, str.type] = _,\n    res: [None, str.type, {str.type: str.type}] = _,\n    resource_union: bool.type = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_resource()")," rule is used to bundle Android resources that are traditionally stored in ",(0,i.mdx)("inlineCode",{parentName:"p"},"res")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"assets")," directories."),(0,i.mdx)("h4",{id:"parameters-12"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Other ",(0,i.mdx)("inlineCode",{parentName:"li"},"android_resource")," rules to include via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-S")," when running ",(0,i.mdx)("inlineCode",{parentName:"li"},"aapt"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"manifest"),": An optional ",(0,i.mdx)("a",{parentName:"li",href:"http://developer.android.com/guide/topics/manifest/manifest-intro.html"},"Android Manifest")," for the to declare any permissions or intents it may need or want to handle. May either be a file or a ",(0,i.mdx)("inlineCode",{parentName:"li"},"android\\_manifest()"),"target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"package"),": Java package for the ",(0,i.mdx)("inlineCode",{parentName:"li"},"R.java")," file that will be generated for these resources.")),(0,i.mdx)("h4",{id:"details-7"},"Details"),(0,i.mdx)("p",null,"The output of an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_resource()")," is an ",(0,i.mdx)("inlineCode",{parentName:"p"},"R.txt")," file\ngenerated via ",(0,i.mdx)("inlineCode",{parentName:"p"},"aapt --output-text-symbols"),"."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Most of the time, an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_resource")," rule defines only ",(0,i.mdx)("inlineCode",{parentName:"p"},"name"),", ",(0,i.mdx)("inlineCode",{parentName:"p"},"res"),", and ",(0,i.mdx)("inlineCode",{parentName:"p"},"package"),". By convention,\nsuch simple rules are often named ",(0,i.mdx)("inlineCode",{parentName:"p"},"res"),":"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nandroid_resource(\n  name = 'res',\n  res = subdir_glob([('res', '**')]),\n  package = 'com.example',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"apk_genrule"},"apk","_","genrule"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def apk_genrule(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _genrule_toolchain: str.type = _,\n    aab: [None, str.type] = _,\n    apk: [None, str.type] = _,\n    bash: [None, str.type] = _,\n    cacheable: [None, bool.type] = _,\n    cmd: [None, str.type] = _,\n    cmd_exe: [None, str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    enable_sandbox: [None, bool.type] = _,\n    environment_expansion_separator: [None, str.type] = _,\n    is_cacheable: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    metadata_env_var: [None, str.type] = _,\n    metadata_path: [None, str.type] = _,\n    need_android_tools: bool.type = _,\n    no_outputs_cleanup: bool.type = _,\n    out: [None, str.type] = _,\n    remote: [None, bool.type] = _,\n    srcs: [[str.type], {str.type: str.type}] = _,\n    type: str.type = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"apk_genrule()")," rule is used to post-process an APK. What separates an apk","_","genrule from a genrule is apk","_","genrules are known by BUCK to produce APKs, so commands like ",(0,i.mdx)("inlineCode",{parentName:"p"},"buck install")," or ",(0,i.mdx)("inlineCode",{parentName:"p"},"buck uninstall")," still work. Additionally, ",(0,i.mdx)("inlineCode",{parentName:"p"},"apk_genrule()")," rules can be inputs to other ",(0,i.mdx)("inlineCode",{parentName:"p"},"apk_genrule()")," rules."),(0,i.mdx)("h4",{id:"parameters-13"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"apk"),": The input ",(0,i.mdx)("inlineCode",{parentName:"li"},"android_binary()")," rule. The path to the APK can be accessed with the ",(0,i.mdx)("inlineCode",{parentName:"li"},"$APK")," shell variable."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"bash"),": A platform-specific version of the shell command parameter ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". It runs on Linux and UNIX systems\u2014including OSX\u2014on which ",(0,i.mdx)("inlineCode",{parentName:"li"},"bash")," is installed. It has a higher priority than ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". The ",(0,i.mdx)("inlineCode",{parentName:"li"},"bash")," argument is run with ",(0,i.mdx)("inlineCode",{parentName:"li"},"/usr/bin/env bash -c"),". It has access to the same set of macros and variables as the ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd")," argument."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),": The shell command to run to generate the output file. It is the fallback for ",(0,i.mdx)("inlineCode",{parentName:"li"},"bash")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd_exe")," arguments. The following environment variables are populated by Buck and available to the shell command. They are accessed using the syntax:")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"${<variable>}\n")),(0,i.mdx)("p",null," Example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"${SRCS}\n")),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${SRCS}")),(0,i.mdx)("p",null," A string expansion of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"srcs")," argument delimited\nby the ",(0,i.mdx)("inlineCode",{parentName:"p"},"environment_expansion_separator")," argument\nwhere each element of ",(0,i.mdx)("inlineCode",{parentName:"p"},"srcs")," will be translated\ninto an absolute path."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${SRCDIR}")),(0,i.mdx)("p",null," The absolute path to a directory to which sources are copied\nprior to running the command."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${OUT}")),(0,i.mdx)("p",null," The output file or directory for the ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),".\nThis variable will have whatever value is specified by\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"out")," argument if not using\xc2\xa0\nnamed outputs\nusing named outputs, this variable will be the output directory."),(0,i.mdx)("p",null," The value should be a valid filepath. The semantics of the shell\ncommand determine whether this filepath is treated as a file or a\ndirectory. If the filepath is a directory, then the shell command\nneeds to create it if not using named outputs. Otherwise, it will\nbe automatically created."),(0,i.mdx)("p",null," The file or directory specified by this variable must always\nbe written by this command. If not, the execution of this\nrule will be considered a failure, halting the build process."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${TMP}")),(0,i.mdx)("p",null," A temporary directory which can be used for intermediate\nresults and will not be bundled into the output."),(0,i.mdx)("h5",{id:"string-parameter-macros"},"String parameter macros"),(0,i.mdx)("p",null," It is also possible to expand references to other rules within the\n",(0,i.mdx)("inlineCode",{parentName:"p"},"cmd"),", using builtin ",(0,i.mdx)("inlineCode",{parentName:"p"},"string parameter macros"),"\n.\nAll build rules expanded in the command are automatically considered\nto be dependencies of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),"."),(0,i.mdx)("p",null," Note that the paths returned by these macros are ",(0,i.mdx)("em",{parentName:"p"},"absolute")," paths. You should convert these paths to be relative paths before\nembedding them in, for example, a shell script or batch file. Using\nrelative paths ensures that your builds are ",(0,i.mdx)("em",{parentName:"p"},"hermetic"),", that\nis, they are reproducible across different machine environments."),(0,i.mdx)("p",null," Additionally, if you embed these paths in a shell script, you should\nexecute that script using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"sh\\_binary()"),"rule and include\nthe targets for these paths in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"resources")," argument of\nthat ",(0,i.mdx)("inlineCode",{parentName:"p"},"sh_binary")," rule. These are the same targets that you\npass to the string parameter macros."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(classpath //path/to:target)")),(0,i.mdx)("p",null," Expands to the transitive classpath of the specified build\nrule, provided that the rule has a Java classpath. If the rule\ndoes not have (or contribute to) a classpath, then an\nexception is thrown and the build breaks."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(exe //path/to:target)")),(0,i.mdx)("p",null," Expands a build rule that results in an executable to the\ncommands necessary to run that executable. For example,\na ",(0,i.mdx)("inlineCode",{parentName:"p"},"java_binary()"),"  might expand to a call\nto ",(0,i.mdx)("inlineCode",{parentName:"p"},"java -jar path/to/target.jar")," . Files that are\nexecutable (perhaps generated by a ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),")\nare also expanded. If the build rule does not generate an\nexecutable output, then an exception is thrown and the build\nbreaks."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(location //path/to:target)")),(0,i.mdx)("p",null," Expands to the location of the output of the specified build\nrule. This means that you can refer to the output without\nneeding to be aware of how Buck is storing data on the disk\nmid-build."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(maven_coords //path/to:target)")),(0,i.mdx)("p",null," Expands to the Maven coordinates for the specified build rule.\nThis allows you to access the Maven coordinates for\nMaven-aware build rules. The format of the expansion is:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"cmd_exe"),": A platform-specific version of the shell command parameter ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". It runs on Windows and has a higher priority than ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". The ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd_exe")," argument is run with ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd.exe /v:off /c"),". It has access to the same set of macros and variables as the ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd")," argument."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"environment_expansion_separator"),": The delimiter between paths in environment variables, such as SRCS, that can contain multiple paths. It can be useful to specify this parameter if the paths could contain spaces."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"out"),": This argument only exists for historical reasons and it does not have any effect. It will be deprecated and removed in the future."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": Either a list or a map of the source files which Buck makes available to the shell command at the path in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"SRCDIR")," environment variable. If you specify a list, the source files are the names in the list. If you specify a map, the source files are made available as the names in the keys of the map, where the values of the map are the original source file names.")),(0,i.mdx)("h4",{id:"details-8"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Here is an example of a couple ",(0,i.mdx)("inlineCode",{parentName:"p"},"apk_genrule()")," open up an APK, do\nsome super signing, and then zipalign that APK again."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\n# Building this rule will produce a file named messenger.apk.\nandroid_binary(\n  name = 'messenger',\n  manifest = 'AndroidManifest.xml',\n  target = 'Google Inc.:Google APIs:16',\n  keystore = '//keystores:prod',\n  package_type = 'release',\n  proguard_config = 'proguard.cfg',\n  deps = [\n    ':res',\n    ':src',\n  ],\n)\n\napk_genrule(\n  name = 'messenger_super_sign_unalign',\n  apk = ':messenger',\n  bash = '$(exe //java/com/facebook/sign:super_sign) --input $APK --output $OUT',\n  cmd_exe = '$(exe //java/com/facebook/sign:super_sign) --input %APK% --output %OUT%',\n  out = 'messenger_super_sign_unalign.apk',\n)\n\napk_genrule(\n  name = 'messenger_super_sign',\n  apk = ':messenger_super_sign_unalign',\n  bash = '$ANDROID_HOME/tools/zipalign -f 4 $APK $OUT',\n  cmd_exe = '%ANDROID_HOME%\\tools\\zipalign -f 4 %APK% %OUT%',\n  out = 'messenger_super_sign.apk',\n)\n\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"apple_asset_catalog"},"apple","_","asset","_","catalog"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def apple_asset_catalog(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    app_icon: [None, str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    dirs: [str.type] = _,\n    labels: [str.type] = _,\n    launch_image: [None, str.type] = _,\n    licenses: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_asset_catalog()")," rule contains resources stored in Apple asset catalog directories. This rule does not have any output on its own and can be built only as a dependency (either direct or transitive) of an ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_bundle()")," rule, in which case all ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_asset_catalog()")," rules that the bundle rule depends on are merged and placed into the final output bundle together."),(0,i.mdx)("h4",{id:"parameters-14"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"app_icon"),": An optional reference to a ",(0,i.mdx)("inlineCode",{parentName:"li"},".appiconset")," containing a image set representing an application icon. (The extension itself should not be included.) This parameter may be specified at most once in a given ",(0,i.mdx)("inlineCode",{parentName:"li"},"apple_bundle"),"'s transitive dependencies."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"launch_image"),": An optional reference to a ",(0,i.mdx)("inlineCode",{parentName:"li"},".launchimage")," containing a image set representing an application launch image. (The extension itself should not be included.) This parameter may be specified at most once in a given ",(0,i.mdx)("inlineCode",{parentName:"li"},"apple_bundle"),"'s transitive dependencies.")),(0,i.mdx)("h4",{id:"details-9"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\napple_asset_catalog(\n  name = 'MyAssetCatalog',\n  dirs = [\n    'MyResources.xcassets',\n  ],\n)\n\n# A asset catalog with a app icon and launch image\napple_asset_catalog(\n  name = 'AssetCatalog',\n  dirs = [ 'AssetCatalog.xcassets' ],\n  app_icon = 'Icon',\n  launch_image = 'LaunchImage',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"apple_binary"},"apple","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def apple_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _apple_toolchain: str.type = _,\n    _apple_tools: str.type = _,\n    _apple_xctoolchain: str.type = _,\n    _apple_xctoolchain_bundle_id: str.type = _,\n    _omnibus_environment: [None, str.type] = _,\n    binary_linker_flags: [str.type] = _,\n    bridging_header: [None, str.type] = _,\n    can_be_asset: [None, bool.type] = _,\n    compiler_flags: [str.type] = _,\n    configs: {str.type: {str.type: str.type}} = _,\n    contacts: [str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    devirt_enabled: bool.type = _,\n    diagnostics: {str.type: str.type} = _,\n    enable_cxx_interop: bool.type = _,\n    enable_distributed_thinlto: bool.type = _,\n    entitlements_file: [None, str.type] = _,\n    executable_name: [None, str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_header_style: str.type = _,\n    exported_headers: [[str.type], {str.type: str.type}] = _,\n    exported_lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    exported_lang_preprocessor_flags: {str.type: [str.type]} = _,\n    exported_linker_flags: [str.type] = _,\n    exported_platform_deps: [(str.type, [str.type])] = _,\n    exported_platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    exported_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    exported_post_linker_flags: [str.type] = _,\n    exported_post_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_preprocessor_flags: [str.type] = _,\n    extra_xcode_files: [str.type] = _,\n    extra_xcode_sources: [str.type] = _,\n    fat_lto: bool.type = _,\n    focused_list_target: [None, str.type] = _,\n    force_static: [None, bool.type] = _,\n    frameworks: [str.type] = _,\n    header_namespace: [None, str.type] = _,\n    header_path_prefix: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    info_plist: [None, str.type] = _,\n    info_plist_substitutions: {str.type: str.type} = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_execution_preference: [None, str.type] = _,\n    link_group: [None, str.type] = _,\n    link_group_map: [None, str.type, [(str.type, [([None, str.type], str.type, [None, str.type, [str.type]], [None, str.type])], [None, {str.type: ""}])]] = _,\n    link_ordering: [None, str.type] = _,\n    link_style: [None, str.type] = _,\n    link_whole: [None, bool.type] = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    modular: bool.type = _,\n    module_name: [None, str.type] = _,\n    module_requires_cxx: bool.type = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    prefer_stripped_objects: bool.type = _,\n    preferred_linkage: str.type = _,\n    prefix_header: [None, str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    public_include_directories: [str.type] = _,\n    public_system_include_directories: [str.type] = _,\n    raw_headers: [str.type] = _,\n    reexport_all_header_dependencies: [None, bool.type] = _,\n    sdk_modules: [str.type] = _,\n    serialize_debugging_options: bool.type = _,\n    soname: [None, str.type] = _,\n    srcs: [[str.type, (str.type, [str.type])]] = _,\n    static_library_basename: [None, str.type] = _,\n    stripped: bool.type = _,\n    supported_platforms_regex: [None, str.type] = _,\n    supports_merged_linking: [None, bool.type] = _,\n    swift_compiler_flags: [str.type] = _,\n    swift_version: [None, str.type] = _,\n    target_sdk_version: [None, str.type] = _,\n    thin_lto: bool.type = _,\n    use_submodules: bool.type = _,\n    uses_cxx_explicit_modules: bool.type = _,\n    uses_explicit_modules: bool.type = _,\n    uses_modules: bool.type = _,\n    xcode_private_headers_symlinks: [None, bool.type] = _,\n    xcode_public_headers_symlinks: [None, bool.type] = _\n) -> None\n')),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_binary()")," rule builds a native executable\xe2\x80\x94such as an iOS or OSX app\xe2\x80\x94from the supplied set of Objective-C/C++ source files and dependencies. It is similar to a ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx\\_binary()"),"rule with which it shares many attributes. In addition to those common attributes, ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_binary()")," has a some additional attributes that are specific to binaries intended to be built using the Apple toolchain. Note, however, that ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_binary()")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_binary()")," differ in the way that they import header files, in order to better accommodate existing conventions. See the sections for the ",(0,i.mdx)("inlineCode",{parentName:"p"},"headers")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"exported_headers")," attributes for more details."),(0,i.mdx)("h4",{id:"parameters-15"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": Flags to use when compiling any of the above sources (which require compilation)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"entitlements_file"),": An optional name of a plist file to be embedded in the binary. Some platforms like ",(0,i.mdx)("inlineCode",{parentName:"li"},"iphonesimulator")," require this to run properly."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_headers"),": The set of header files that are made available for inclusion to the source files in this target and all targets that transitively depend on this one. These should be specified as either a list of header files or a dictionary of header names to header files. The header names can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). If a list of header files is specified, the headers can be imported with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_PATH_PREFIX/$HEADER_NAME"')," or, if a header file that belongs to the same rule is being imported, with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_NAME"'),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_PATH_PREFIX")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix")," attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the filename of the header file. If a dictionary is specified, each header can be imported with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_NAME"'),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the key corresponding to this file. In this case, the ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix")," attribute is ignored. In either case, quotes in the import statements can be replaced with angle brackets."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_linker_flags"),": Flags to add to the linker command line when the output from this rule, or the output from any rule that transitively depends on this rule, is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_xcode_files"),': When the project is generated, this is the list of files that will added to the project. Those files won\'t be added to the build phase "Compile Sources".'),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"frameworks"),": A list of system frameworks that the code in this target uses. Each entry should be a path starting with ",(0,i.mdx)("inlineCode",{parentName:"li"},"$SDKROOT")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"$PLATFORM_DIR")," to denote that the rest of the path is relative to the root of the SDK used for the build or to the platform toolchain directory."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix"),": A path prefix when including headers of this target. For example, headers from a library defined using")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\napple_library(\n    name = "Library",\n    headers = glob(["**/*.h"]),\n    header_path_prefix = "Lib",\n)\n\n')),(0,i.mdx)("p",null,"can be imported using following mapping"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nLibrary/SubDir/Header1.h -> Lib/Header1.h\nLibrary/Header2.h -> Lib/Header2.h\n\n")),(0,i.mdx)("p",null,"Defaults to the short name of the target. Can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"p"},"/"),"), but\ncannot start with one. See ",(0,i.mdx)("inlineCode",{parentName:"p"},"headers")," for more information."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"headers"),": The set of header files that are made available for inclusion to the source files in this target. These should be specified as either a list of header files or a dictionary of header names to header files. The header names can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). If a list of header files is specified, the headers can be imported with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_PATH_PREFIX/$HEADER_NAME"')," or ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_NAME"'),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_PATH_PREFIX")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix")," attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the filename of the header file. If a dictionary is specified, each header can be imported with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_NAME"'),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the key corresponding to this file. In this case, the ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix")," attribute is ignored. In either case, quotes in the import statements can be replaced with angle brackets."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_execution_preference"),": The execution preference for linking. Options are:")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"any : No preference is set, and the link action will be performed based on buck2's executor configuration."),(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"full_hybrid : The link action will execute both locally and remotely, regardless of buck2's executor configuration (if"),(0,i.mdx)("pre",{parentName:"li"},(0,i.mdx)("code",{parentName:"pre"},"          the executor is capable of hybrid execution). The use_limited_hybrid setting of the hybrid executor is ignored.\n"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local : The link action will execute locally if compatible on current host platform.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local_only : The link action will execute locally, and error if the current platform is not compatible.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"remote : The link action will execute remotely if a compatible remote platform exists, otherwise locally."))))),(0,i.mdx)("p",null,"The default is None, expressing that no preference has been set on the target itself."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be either ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_extra_outputs"),": Declares extra outputs that the linker emits. These identifiers can be used in ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(output ...)")," macros in ",(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags")," to interpolate the output path into the linker command line. Useful for custom linkers that emit extra output files."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Flags to add to the linker command line whenever the output from this rule is used in a link operation, such as linked into an executable or a shared library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_compiler_flags"),": Platform specific compiler flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when compiling the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_linker_flags"),": Platform-specific linker flags. This argument is specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The second element in each pair is a list of linker flags. If the regex matches the platform, these flags are added to the linker command line when the output from this rule is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_srcs"),": Platform specific source files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of source files or a list of tuples of source files and a list of compilation flags to be preprocessed, compiled and assembled if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags"),": Flags to use when preprocessing any of the above sources (which require preprocessing)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of C, C++, Objective-C, Objective-C++, or assembly source files to be preprocessed, compiled, and assembled by this rule. We determine which stages to run on each input source based on its file extension. See the ",(0,i.mdx)("a",{parentName:"li",href:"https://gcc.gnu.org/onlinedocs/gcc/Overall-Options.html"},"GCC documentation")," for more detail on how file extensions are interpreted. Each element can be either a string specifying a source file (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"''"),") or a tuple of a string specifying a source file and a list of compilation flags (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"('', ['-Wall', '-Werror'])")," ). In the latter case the specified flags will be used in addition to the rule's other flags when preprocessing and compiling that file (if applicable)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_sdk_version"),": The minimum OS version that the library target should support, overriding the minimum set in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),". When set, Buck will automatically add flags to both Objective-C and Swift compilation that will allow the use of the new APIs without guarding code inside availability checks.")),(0,i.mdx)("h4",{id:"details-10"},"Details"),(0,i.mdx)("p",null,"Buck enables you to override components of the Apple toolchain with\nalternate tools, either from the Xcode search paths or from directories\nthat you specify.\nSee ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"\nand ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"\nfor more information."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\napple_binary(\n  name = 'MyBinary',\n  deps = [\n    ':MyLibrary',\n    '//Libraries:AnotherLibrary',\n  ],\n  preprocessor_flags = ['-fobjc-arc'],\n  headers = [\n    'MyHeader.h',\n  ],\n  srcs = [\n    'MySource.m',\n  ],\n  frameworks = [\n    '$SDKROOT/System/Library/Frameworks/UIKit.framework',\n    '$SDKROOT/System/Library/Frameworks/Foundation.framework',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"apple_bundle"},"apple","_","bundle"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def apple_bundle(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _apple_toolchain: str.type = _,\n    _apple_tools: str.type = _,\n    _apple_xctoolchain: str.type = _,\n    _apple_xctoolchain_bundle_id: str.type = _,\n    _bundling_cache_buster: [None, str.type] = _,\n    _bundling_log_file_enabled: bool.type = _,\n    _codesign_entitlements: [None, str.type] = _,\n    _codesign_type: [None, str.type] = _,\n    _compile_resources_locally_override: [None, bool.type] = _,\n    _dry_run_code_signing: bool.type = _,\n    _fast_adhoc_signing_enabled: bool.type = _,\n    _incremental_bundling_enabled: bool.type = _,\n    _profile_bundling_enabled: bool.type = _,\n    _provisioning_profiles: str.type = _,\n    _resource_bundle: [None, str.type] = _,\n    _use_entitlements_when_adhoc_code_signing: [None, bool.type] = _,\n    asset_catalogs_compilation_options: {str.type: ""} = _,\n    binary: [None, str.type] = _,\n    codesign_flags: [str.type] = _,\n    codesign_identity: [None, str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    extension: str.type,\n    ibtool_flags: [None, [str.type]] = _,\n    ibtool_module_flag: [None, bool.type] = _,\n    incremental_bundling_enabled: [None, bool.type] = _,\n    info_plist: str.type,\n    info_plist_substitutions: {str.type: str.type} = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    platform_binary: [None, [(str.type, str.type)]] = _,\n    product_name: [None, str.type] = _,\n    resource_group: [None, str.type] = _,\n    resource_group_map: [None, str.type] = _,\n    selective_debugging: [None, str.type] = _,\n    skip_copying_swift_stdlib: [None, bool.type] = _,\n    try_skip_code_signing: [None, bool.type] = _,\n    use_entitlements_when_adhoc_code_signing: bool.type = _,\n    xcode_product_type: [None, str.type] = _\n) -> None\n')),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_bundle()")," rule takes an Apple binary and all of the resources and asset catalogs in the rule's transitive dependencies and generates a bundle containing all of those files. Optionally the generated bundle can also be signed using specified provisioning profiles."),(0,i.mdx)("h4",{id:"parameters-16"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"asset_catalogs_compilation_options"),": A dict holding parameters for asset catalogs compiler (actool). Its options include: ",(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"notices")," (defaults to ",(0,i.mdx)("inlineCode",{parentName:"em"},"True"),") ")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"warnings")," (defaults to ",(0,i.mdx)("inlineCode",{parentName:"li"},"True"),") ",(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"errors")," (defaults to ",(0,i.mdx)("inlineCode",{parentName:"em"},"True"),") ")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"compress_pngs")," (defaults to ",(0,i.mdx)("inlineCode",{parentName:"li"},"True"),") ",(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"optimization")," (defaults to ",(0,i.mdx)("inlineCode",{parentName:"em"},"'space'"),") ")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"output_format")," (defaults to ",(0,i.mdx)("inlineCode",{parentName:"li"},"'human-readable-text'"),") * ",(0,i.mdx)("inlineCode",{parentName:"li"},"extra_flags")," (defaults to ",(0,i.mdx)("inlineCode",{parentName:"li"},"[]"),")"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"binary"),": A ",(0,i.mdx)("inlineCode",{parentName:"li"},"build target")," identifying an ",(0,i.mdx)("inlineCode",{parentName:"li"},"apple_binary()")," rule or an ",(0,i.mdx)("inlineCode",{parentName:"li"},"apple_library()")," rule whose output will be used as the main executable binary of the generated bundle. The required rule type depends on the value in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"extension")," attribute. For example, application bundles expect a binary (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"'//Apps/MyApp:MyApp'"),"), application extension bundles expect a shared library (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"'//Libraries/MyLibrary:MyLibrary#shared'"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": A list of dependencies of this bundle as build targets. You can embed application extensions by specifying the extension's bundle target. To include a WatchKit app, append the flavor ",(0,i.mdx)("inlineCode",{parentName:"li"},"#watch")," to the target specification. Buck will automatically substitute the appropriate platform flavor (either ",(0,i.mdx)("inlineCode",{parentName:"li"},"watchsimulator")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"watchos"),") based on the parent."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extension"),": The extension of the generated bundle. For example ",(0,i.mdx)("inlineCode",{parentName:"li"},"'app'")," for an application bundle or ",(0,i.mdx)("inlineCode",{parentName:"li"},"'appex'")," for an application extension bundle."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"ibtool_flags"),": List of flags to be passed to ibtool during interface builder file compilation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"info_plist"),": A path to an ",(0,i.mdx)("inlineCode",{parentName:"li"},"Info.plist")," file that will be placed in the bundle. The specified file will be processed by substituting variable names with their values (see ",(0,i.mdx)("inlineCode",{parentName:"li"},"info_plist_substitutions")," for more information)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"info_plist_substitutions"),": A dictionary that assigns variable names to their values. It is used for variable substitution when processing the file specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},"info_plist"),". For example if this argument is set to ",(0,i.mdx)("inlineCode",{parentName:"li"},"{'VAR': 'MyValue'}"),", then each occurrence of ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(VAR)")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"${VAR}")," in the file will be replaced by ",(0,i.mdx)("inlineCode",{parentName:"li"},"MyValue"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"product_name"),": The name of the resulting bundle and binary. The setting behaves like PRODUCT","_",'NAME Xcode build setting. For example, if your rule is named "MyApp" and extension is "app", by default buck will generate MyApp.app bundle. But if you will set product name to "SuperApp", bundle will get "SuperApp.app" name.')),(0,i.mdx)("h4",{id:"details-11"},"Details"),(0,i.mdx)("p",null,"Code signing will embed entitlements pointed to by the ",(0,i.mdx)("inlineCode",{parentName:"p"},"entitlements_file")," arg in\nthe bundle's ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_binary"),". This is the preferred way to specify entitlements\nwhen building with Buck."),(0,i.mdx)("p",null,"If the entitlements file is not present, it falls back to the ",(0,i.mdx)("inlineCode",{parentName:"p"},"CODE_SIGN_ENTITLEMENTS")," entry in\n",(0,i.mdx)("inlineCode",{parentName:"p"},"info_plist_substitutions"),"."),(0,i.mdx)("p",null,"If after these checks, an entitlements file is still not specified, it will be derived based\non the entitlements of the selected provisioning profile. Provisioning profiles will be selected\nfrom profiles pointed to by ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple.provisioning_profile_search_path"),", based on a\nnon-expired profile that matches the bundle id and entitlements."),(0,i.mdx)("p",null,"Code signing will embed entitlements pointed to by the ",(0,i.mdx)("inlineCode",{parentName:"p"},"CODE_SIGN_ENTITLEMENTS")," entry in\n",(0,i.mdx)("inlineCode",{parentName:"p"},"info_plist_substitutions"),". If an entitlements file is omitted, it will be derived based\non the entitlements of the selected provisioning profile. Provisioning profiles will be selected\nfrom profiles pointed to by ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple.provisioning_profile_search_path"),", based on a\nnon-expired profile that matches the bundle id and entitlements."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\napple_bundle(\n  name = 'AppBundle',\n  binary = ':MyBinary',\n  extension = 'app',\n  info_plist = 'Info.plist',\n)\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# iOS app with embedded WatchOS 2.0 app/extension\napple_bundle(\n  name = 'DemoWatchAppExtension',\n  binary = ':DemoWatchAppExtensionBinary',\n  extension = 'appex',\n  info_plist = 'WatchExtension/Resources/Info.plist',\n)\n\napple_bundle(\n  name = 'DemoWatchApp',\n  binary = ':DemoWatchAppBinary',\n  deps = [':DemoWatchAppResources', ':DemoWatchAppExtension'],\n  extension = 'app',\n  info_plist = 'WatchApplication/Info.plist',\n)\n\napple_bundle(\n  name = 'DemoApp',\n  binary = ':DemoAppBinary',\n  deps = [':DemoWatchApp#watch'],\n  extension = 'app',\n  info_plist = 'Info.plist',\n)\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# iOS app using safeAreaInsets delivering to iOS 9.x\napple_bundle(\n  name = 'DemoIBApp',\n  binary = ':DemoIBAppBinary',\n  deps = [':DemoIBAppResources'],\n  extension = 'app',\n  ibtool_flags = [\"--minimum-deployment-target\", \"9.0\"],\n  info_plist = 'Info.plist',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"apple_library"},"apple","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def apple_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _apple_toolchain: str.type = _,\n    _apple_tools: str.type = _,\n    _apple_xctoolchain: str.type = _,\n    _apple_xctoolchain_bundle_id: str.type = _,\n    _archive_objects_locally_override: [None, bool.type] = _,\n    _omnibus_environment: [None, str.type] = _,\n    bridging_header: [None, str.type] = _,\n    can_be_asset: [None, bool.type] = _,\n    compiler_flags: [str.type] = _,\n    configs: {str.type: {str.type: str.type}} = _,\n    contacts: [str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    devirt_enabled: bool.type = _,\n    diagnostics: {str.type: str.type} = _,\n    enable_cxx_interop: bool.type = _,\n    executable_name: [None, str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_header_style: str.type = _,\n    exported_headers: [[str.type], {str.type: str.type}] = _,\n    exported_lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    exported_lang_preprocessor_flags: {str.type: [str.type]} = _,\n    exported_linker_flags: [str.type] = _,\n    exported_platform_deps: [(str.type, [str.type])] = _,\n    exported_platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    exported_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    exported_post_linker_flags: [str.type] = _,\n    exported_post_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_preprocessor_flags: [str.type] = _,\n    extra_xcode_files: [str.type] = _,\n    extra_xcode_sources: [str.type] = _,\n    fat_lto: bool.type = _,\n    focused_list_target: [None, str.type] = _,\n    force_static: [None, bool.type] = _,\n    frameworks: [str.type] = _,\n    header_namespace: [None, str.type] = _,\n    header_path_prefix: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    info_plist: [None, str.type] = _,\n    info_plist_substitutions: {str.type: str.type} = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_execution_preference: [None, str.type] = _,\n    link_group: [None, str.type] = _,\n    link_group_map: [None, str.type, [(str.type, [([None, str.type], str.type, [None, str.type, [str.type]], [None, str.type])], [None, {str.type: ""}])]] = _,\n    link_ordering: [None, str.type] = _,\n    link_style: [None, str.type] = _,\n    link_whole: [None, bool.type] = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    modular: bool.type = _,\n    module_name: [None, str.type] = _,\n    module_requires_cxx: bool.type = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    preferred_linkage: str.type = _,\n    prefix_header: [None, str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    public_include_directories: [str.type] = _,\n    public_system_include_directories: [str.type] = _,\n    raw_headers: [str.type] = _,\n    reexport_all_header_dependencies: [None, bool.type] = _,\n    sdk_modules: [str.type] = _,\n    serialize_debugging_options: bool.type = _,\n    soname: [None, str.type] = _,\n    srcs: [[str.type, (str.type, [str.type])]] = _,\n    static_library_basename: [None, str.type] = _,\n    stripped: bool.type = _,\n    supported_platforms_regex: [None, str.type] = _,\n    supports_header_symlink_subtarget: bool.type = _,\n    supports_merged_linking: [None, bool.type] = _,\n    supports_shlib_interfaces: bool.type = _,\n    swift_compiler_flags: [str.type] = _,\n    swift_version: [None, str.type] = _,\n    target_sdk_version: [None, str.type] = _,\n    thin_lto: bool.type = _,\n    use_archive: [None, bool.type] = _,\n    use_submodules: bool.type = _,\n    uses_cxx_explicit_modules: bool.type = _,\n    uses_explicit_modules: bool.type = _,\n    uses_modules: bool.type = _,\n    xcode_private_headers_symlinks: [None, bool.type] = _,\n    xcode_public_headers_symlinks: [None, bool.type] = _\n) -> None\n')),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_library()")," rule represents a set of Objective-C/C++/Swift source files and is similar to a ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_library()")," rule with which it shares many attributes. In addition to those common attributes, ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_library()")," has a some additional attributes that are specific to binaries intended to be built using the Apple toolchain. Note, however, that ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_library()")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_library()")," differ in the way that they import header files, in order to better accommodate existing conventions. See the sections for the ",(0,i.mdx)("inlineCode",{parentName:"p"},"headers")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"exported_headers")," attributes for more details."),(0,i.mdx)("h4",{id:"parameters-17"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": Flags to use when compiling any of the above sources (which require compilation)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),": Dependencies that will also appear to belong to any rules that depend on this one. This has two effects: ",(0,i.mdx)("em",{parentName:"li"}," Exported dependencies will also be included in the link line of dependents of this rules, but normal dependencies will not. ")," When ",(0,i.mdx)("inlineCode",{parentName:"li"},"reexport_all_header_dependencies = False"),", only exported headers of the rules specified here are re-exported."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_headers"),": The set of header files that are made available for inclusion to the source files in this target and all targets that transitively depend on this one. These should be specified as either a list of header files or a dictionary of header names to header files. The header names can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). If a list of header files is specified, the headers can be imported with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_PATH_PREFIX/$HEADER_NAME"')," or, if a header file that belongs to the same rule is being imported, with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_NAME"'),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_PATH_PREFIX")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix")," attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the filename of the header file. If a dictionary is specified, each header can be imported with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_NAME"'),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the key corresponding to this file. In this case, the ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix")," attribute is ignored. In either case, quotes in the import statements can be replaced with angle brackets."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_linker_flags"),": Flags to add to the linker command line when the output from this rule, or the output from any rule that transitively depends on this rule, is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_platform_linker_flags"),": Platform-specific linker flags for this rule and for all rules that transitively depend on this rule. This argument is specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The second element in each pair is a list of linker flags. If the regex matches the platform, these flags are added to the linker command line when the output from this rule, or the output from any rule that transitively depends on this rule, is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_xcode_files"),': When the project is generated, this is the list of files that will added to the project. Those files won\'t be added to the build phase "Compile Sources".'),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"frameworks"),": A list of system frameworks that the code in this target uses. Each entry should be a path starting with ",(0,i.mdx)("inlineCode",{parentName:"li"},"$SDKROOT")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"$PLATFORM_DIR")," to denote that the rest of the path is relative to the root of the SDK used for the build or to the platform toolchain directory."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),": A path prefix when including headers of this target. Defaults to the path from the root of the repository to the directory where this target is defined. Can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"), but cannot start with one. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix"),": A path prefix when including headers of this target. For example, headers from a library defined using")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\napple_library(\n    name = "Library",\n    headers = glob(["**/*.h"]),\n    header_path_prefix = "Lib",\n)\n\n')),(0,i.mdx)("p",null,"can be imported using following mapping"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nLibrary/SubDir/Header1.h -> Lib/Header1.h\nLibrary/Header2.h -> Lib/Header2.h\n\n")),(0,i.mdx)("p",null,"Defaults to the short name of the target. Can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"p"},"/"),"), but\ncannot start with one. See ",(0,i.mdx)("inlineCode",{parentName:"p"},"headers")," for more information."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"headers"),": The set of header files that are made available for inclusion to the source files in this target. These should be specified as either a list of header files or a dictionary of header names to header files. The header names can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). If a list of header files is specified, the headers can be imported with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_PATH_PREFIX/$HEADER_NAME"')," or ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_NAME"'),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_PATH_PREFIX")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix")," attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the filename of the header file. If a dictionary is specified, each header can be imported with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_NAME"'),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the key corresponding to this file. In this case, the ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix")," attribute is ignored. In either case, quotes in the import statements can be replaced with angle brackets."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_execution_preference"),": The execution preference for linking. Options are:")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"any : No preference is set, and the link action will be performed based on buck2's executor configuration."),(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"full_hybrid : The link action will execute both locally and remotely, regardless of buck2's executor configuration (if"),(0,i.mdx)("pre",{parentName:"li"},(0,i.mdx)("code",{parentName:"pre"},"          the executor is capable of hybrid execution). The use_limited_hybrid setting of the hybrid executor is ignored.\n"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local : The link action will execute locally if compatible on current host platform.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local_only : The link action will execute locally, and error if the current platform is not compatible.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"remote : The link action will execute remotely if a compatible remote platform exists, otherwise locally."))))),(0,i.mdx)("p",null,"The default is None, expressing that no preference has been set on the target itself."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be either ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_extra_outputs"),": Declares extra outputs that the linker emits. These identifiers can be used in ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(output ...)")," macros in ",(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags")," to interpolate the output path into the linker command line. Useful for custom linkers that emit extra output files."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Flags to add to the linker command line whenever the output from this rule is used in a link operation, such as linked into an executable or a shared library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_compiler_flags"),": Platform specific compiler flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when compiling the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_srcs"),": Platform specific source files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of source files or a list of tuples of source files and a list of compilation flags to be preprocessed, compiled and assembled if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags"),": Flags to use when preprocessing any of the above sources (which require preprocessing)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"reexport_all_header_dependencies"),": Whether to automatically re-export the exported headers of all dependencies.")),(0,i.mdx)("p",null,"When this is set to false, only exported headers from\n",(0,i.mdx)("inlineCode",{parentName:"p"},"exported_deps")," are re-exported."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of C, C++, Objective-C, Objective-C++, or assembly source files to be preprocessed, compiled, and assembled by this rule. We determine which stages to run on each input source based on its file extension. See the ",(0,i.mdx)("a",{parentName:"li",href:"https://gcc.gnu.org/onlinedocs/gcc/Overall-Options.html"},"GCC documentation")," for more detail on how file extensions are interpreted. Each element can be either a string specifying a source file (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"''"),") or a tuple of a string specifying a source file and a list of compilation flags (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"('', ['-Wall', '-Werror'])")," ). In the latter case the specified flags will be used in addition to the rule's other flags when preprocessing and compiling that file (if applicable)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_sdk_version"),": The minimum OS version that the library target should support, overriding the minimum set in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),". When set, Buck will automatically add flags to both Objective-C and Swift compilation that will allow the use of the new APIs without guarding code inside availability checks.")),(0,i.mdx)("h4",{id:"details-12"},"Details"),(0,i.mdx)("p",null,"Buck enables you to override components of the Apple toolchain with\nalternate tools, either from the Xcode search paths or from directories\nthat you specify.\nSee ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"\nand ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"\nfor more information."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\napple_library(\n  name = 'MyLibrary',\n  deps = [\n    ':OtherLibrary',\n    '//Libraries:YetAnotherLibrary',\n  ],\n  preprocessor_flags = ['-fobjc-arc'],\n  headers = [\n    'MyHeader.h',\n  ],\n  srcs = [\n    'MySource.m',\n    'MySource.swift',\n  ],\n  frameworks = [\n    '$SDKROOT/System/Library/Frameworks/UIKit.framework',\n    '$SDKROOT/System/Library/Frameworks/Foundation.framework',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"apple_package"},"apple","_","package"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def apple_package(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _apple_toolchain: str.type = _,\n    _ipa_compression_level: str.type,\n    bundle: str.type,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    need_android_tools: bool.type = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_package()")," rule takes the output of an ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_bundle()")," rule and compresses it in an IPA (iOS App Store Package) file."),(0,i.mdx)("h4",{id:"parameters-18"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("h4",{id:"details-13"},"Details"),(0,i.mdx)("p",null,"This rule can be customized using the config options ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"\nand ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"\n."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\napple_package(\n  name = 'AppPackage',\n  bundle = ':AppBundle',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"apple_resource"},"apple","_","resource"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def apple_resource(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    codesign_on_copy: bool.type = _,\n    contacts: [str.type] = _,\n    content_dirs: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    destination: [None, str.type] = _,\n    dirs: [str.type] = _,\n    files: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    named_variants: {str.type: [str.type]} = _,\n    resources_from_deps: [str.type] = _,\n    variants: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_resource()")," rule contains sets of resource directories, files and file variants that can be bundled in an application bundle. This rule does not have any output on its own and can be built only as a dependency (either direct or transitive) of an ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_bundle()")," rule."),(0,i.mdx)("h4",{id:"parameters-19"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"destination"),': Specifies the destination in the final application bundle where resource will be copied. Possible values: "resources", "frameworks", "executables", "plugins", "xpcservices".'),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"named_variants"),": Mapping from a variant name to the list of resource file paths which should be placed in an application bundle. Those files will be placed in a directory with name equal to the corresponding key in this mapping. Keys should end with ",(0,i.mdx)("inlineCode",{parentName:"li"},".lproj")," suffix. (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"Base.lproj"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"en.lproj"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources_from_deps"),": Set of build targets whose transitive ",(0,i.mdx)("inlineCode",{parentName:"li"},"apple_resource"),"s should be considered as part of the current resource when collecting resources for bundles.")),(0,i.mdx)("p",null,"Usually, an ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_bundle")," collects all ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_resource")," rules transitively\nreachable through apple","_","library rules. This field allows for resources which are not reachable\nusing the above traversal strategy to be considered for inclusion in the bundle."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"variants"),": Set of paths of resource file variants that should be placed in an application bundle. The files mentioned here should be placed in a directory named ",(0,i.mdx)("inlineCode",{parentName:"li"},"$VARIANT_NAME.lproj"),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$VARIANT_NAME")," is the name of the variant (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"Base"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"en"),"). This argument makes it possible to use different resource files based on the active locale.")),(0,i.mdx)("h4",{id:"details-14"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\napple_resource(\n  name = 'Images',\n  files = glob([\n    '*.png',\n  ]),\n  dirs = [\n    'PrettyImages',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"apple_test"},"apple","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def apple_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _apple_toolchain: str.type = _,\n    _apple_tools: str.type = _,\n    _apple_xctoolchain: str.type = _,\n    _apple_xctoolchain_bundle_id: str.type = _,\n    _bundling_cache_buster: [None, str.type] = _,\n    _bundling_log_file_enabled: bool.type = _,\n    _codesign_type: [None, str.type] = _,\n    _compile_resources_locally_override: [None, bool.type] = _,\n    _dry_run_code_signing: bool.type = _,\n    _fast_adhoc_signing_enabled: bool.type = _,\n    _incremental_bundling_enabled: bool.type = _,\n    _inject_test_env: str.type = _,\n    _ios_booted_simulator: str.type = _,\n    _macos_idb_companion: str.type = _,\n    _omnibus_environment: [None, str.type] = _,\n    _profile_bundling_enabled: bool.type = _,\n    _resource_bundle: [None, str.type] = _,\n    _use_entitlements_when_adhoc_code_signing: [None, bool.type] = _,\n    asset_catalogs_compilation_options: {str.type: ""} = _,\n    binary: [None, str.type] = _,\n    bridging_header: [None, str.type] = _,\n    can_be_asset: [None, bool.type] = _,\n    codesign_flags: [str.type] = _,\n    codesign_identity: [None, str.type] = _,\n    compiler_flags: [str.type] = _,\n    configs: {str.type: {str.type: str.type}} = _,\n    contacts: [str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    destination_specifier: {str.type: str.type} = _,\n    devirt_enabled: bool.type = _,\n    diagnostics: {str.type: str.type} = _,\n    enable_cxx_interop: bool.type = _,\n    entitlements_file: [None, str.type] = _,\n    env: [None, {str.type: str.type}] = _,\n    executable_name: [None, str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_header_style: str.type = _,\n    exported_headers: [[str.type], {str.type: str.type}] = _,\n    exported_lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    exported_lang_preprocessor_flags: {str.type: [str.type]} = _,\n    exported_linker_flags: [str.type] = _,\n    exported_platform_deps: [(str.type, [str.type])] = _,\n    exported_platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    exported_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    exported_post_linker_flags: [str.type] = _,\n    exported_post_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_preprocessor_flags: [str.type] = _,\n    extension: str.type,\n    extra_xcode_files: [str.type] = _,\n    extra_xcode_sources: [str.type] = _,\n    fat_lto: bool.type = _,\n    focused_list_target: [None, str.type] = _,\n    force_static: [None, bool.type] = _,\n    frameworks: [str.type] = _,\n    header_namespace: [None, str.type] = _,\n    header_path_prefix: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    incremental_bundling_enabled: [None, bool.type] = _,\n    info_plist: str.type,\n    info_plist_substitutions: {str.type: str.type} = _,\n    is_ui_test: bool.type = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_execution_preference: [None, str.type] = _,\n    link_group: [None, str.type] = _,\n    link_group_map: [None, [(str.type, [(str.type, str.type, [None, str.type])])]] = _,\n    link_ordering: [None, str.type] = _,\n    link_style: str.type = _,\n    link_whole: [None, bool.type] = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    modular: bool.type = _,\n    module_name: [None, str.type] = _,\n    module_requires_cxx: bool.type = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    preferred_linkage: str.type = _,\n    prefix_header: [None, str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    public_include_directories: [str.type] = _,\n    public_system_include_directories: [str.type] = _,\n    raw_headers: [str.type] = _,\n    reexport_all_header_dependencies: [None, bool.type] = _,\n    resource_group: [None, str.type] = _,\n    resource_group_map: [None, str.type] = _,\n    run_test_separately: bool.type = _,\n    runner: [None, str.type] = _,\n    sdk_modules: [str.type] = _,\n    serialize_debugging_options: bool.type = _,\n    skip_copying_swift_stdlib: [None, bool.type] = _,\n    snapshot_reference_images_path: [None, str.type] = _,\n    soname: [None, str.type] = _,\n    specs: [None, str.type] = _,\n    srcs: [[str.type, (str.type, [str.type])]] = _,\n    static_library_basename: [None, str.type] = _,\n    stripped: bool.type = _,\n    supported_platforms_regex: [None, str.type] = _,\n    supports_merged_linking: [None, bool.type] = _,\n    swift_compiler_flags: [str.type] = _,\n    swift_version: [None, str.type] = _,\n    target_sdk_version: [None, str.type] = _,\n    test_host_app: [None, str.type] = _,\n    test_rule_timeout_ms: [None, int.type] = _,\n    thin_lto: bool.type = _,\n    try_skip_code_signing: [None, bool.type] = _,\n    ui_test_target_app: [None, str.type] = _,\n    use_entitlements_when_adhoc_code_signing: bool.type = _,\n    use_submodules: bool.type = _,\n    uses_cxx_explicit_modules: bool.type = _,\n    uses_explicit_modules: bool.type = _,\n    uses_modules: bool.type = _,\n    xcode_private_headers_symlinks: [None, bool.type] = _,\n    xcode_product_type: [None, str.type] = _,\n    xcode_public_headers_symlinks: [None, bool.type] = _\n) -> None\n')),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_test()")," rule contains Objective-C/C++ code which can be built and used to test code contained in other rules. The tests can be executed by running ",(0,i.mdx)("inlineCode",{parentName:"p"},"buck test"),"."),(0,i.mdx)("h4",{id:"parameters-20"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": Flags to use when compiling any of the above sources (which require compilation)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_xcode_files"),': When the project is generated, this is the list of files that will added to the project. Those files won\'t be added to the build phase "Compile Sources".'),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"frameworks"),": A list of system frameworks that the code in this target uses. Each entry should be a path starting with ",(0,i.mdx)("inlineCode",{parentName:"li"},"$SDKROOT")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"$PLATFORM_DIR")," to denote that the rest of the path is relative to the root of the SDK used for the build or to the platform toolchain directory."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix"),": A path prefix when including headers of this target. For example, headers from a library defined using")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\napple_library(\n    name = "Library",\n    headers = glob(["**/*.h"]),\n    header_path_prefix = "Lib",\n)\n\n')),(0,i.mdx)("p",null,"can be imported using following mapping"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nLibrary/SubDir/Header1.h -> Lib/Header1.h\nLibrary/Header2.h -> Lib/Header2.h\n\n")),(0,i.mdx)("p",null,"Defaults to the short name of the target. Can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"p"},"/"),"), but\ncannot start with one. See ",(0,i.mdx)("inlineCode",{parentName:"p"},"headers")," for more information."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"headers"),": The set of header files that are made available for inclusion to the source files in this target. These should be specified as either a list of header files or a dictionary of header names to header files. The header names can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). If a list of header files is specified, the headers can be imported with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_PATH_PREFIX/$HEADER_NAME"')," or ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_NAME"'),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_PATH_PREFIX")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix")," attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the filename of the header file. If a dictionary is specified, each header can be imported with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#import "$HEADER_NAME"'),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the key corresponding to this file. In this case, the ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_path_prefix")," attribute is ignored. In either case, quotes in the import statements can be replaced with angle brackets."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"info_plist"),": A path to an ",(0,i.mdx)("inlineCode",{parentName:"li"},"Info.plist")," file that will be placed in the bundle. The specified file will be processed by substituting variable names with their values (see ",(0,i.mdx)("inlineCode",{parentName:"li"},"info_plist_substitutions")," for more information)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"info_plist_substitutions"),": A dictionary that assigns variable names to their values. It is used for variable substitution when processing the file specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},"info_plist"),". For example if this argument is set to ",(0,i.mdx)("inlineCode",{parentName:"li"},"{'VAR': 'MyValue'}"),", then each occurrence of ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(VAR)")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"${VAR}")," in the file will be replaced by ",(0,i.mdx)("inlineCode",{parentName:"li"},"MyValue"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": A list of labels to be applied to these tests. These labels are arbitrary text strings and have no meaning within buck itself. They can, however, have meaning for you as a test author (e.g., ",(0,i.mdx)("inlineCode",{parentName:"li"},"smoke")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"fast"),"). A label can be used to filter or include a specific test rule when executing ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck test")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_execution_preference"),": The execution preference for linking. Options are:")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"any : No preference is set, and the link action will be performed based on buck2's executor configuration."),(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"full_hybrid : The link action will execute both locally and remotely, regardless of buck2's executor configuration (if"),(0,i.mdx)("pre",{parentName:"li"},(0,i.mdx)("code",{parentName:"pre"},"          the executor is capable of hybrid execution). The use_limited_hybrid setting of the hybrid executor is ignored.\n"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local : The link action will execute locally if compatible on current host platform.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local_only : The link action will execute locally, and error if the current platform is not compatible.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"remote : The link action will execute remotely if a compatible remote platform exists, otherwise locally."))))),(0,i.mdx)("p",null,"The default is None, expressing that no preference has been set on the target itself."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Flags to add to the linker command line whenever the output from this rule is used in a link operation, such as linked into an executable or a shared library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_compiler_flags"),": Platform specific compiler flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when compiling the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_srcs"),": Platform specific source files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of source files or a list of tuples of source files and a list of compilation flags to be preprocessed, compiled and assembled if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags"),": Flags to use when preprocessing any of the above sources (which require preprocessing)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of C, C++, Objective-C, Objective-C++, or assembly source files to be preprocessed, compiled, and assembled by this rule. We determine which stages to run on each input source based on its file extension. See the ",(0,i.mdx)("a",{parentName:"li",href:"https://gcc.gnu.org/onlinedocs/gcc/Overall-Options.html"},"GCC documentation")," for more detail on how file extensions are interpreted. Each element can be either a string specifying a source file (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"''"),") or a tuple of a string specifying a source file and a list of compilation flags (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"('', ['-Wall', '-Werror'])")," ). In the latter case the specified flags will be used in addition to the rule's other flags when preprocessing and compiling that file (if applicable)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_sdk_version"),": The minimum OS version that the library target should support, overriding the minimum set in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),". When set, Buck will automatically add flags to both Objective-C and Swift compilation that will allow the use of the new APIs without guarding code inside availability checks."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"test_host_app"),": A build target identifying an ",(0,i.mdx)("inlineCode",{parentName:"li"},"apple_bundle()")," rule that builds an application bundle. Output of the specified rule will be used as a test host of this test. This implies ",(0,i.mdx)("inlineCode",{parentName:"li"},"run_test_separately"),". Since symbols that are defined in the test host application and its dependencies will not be linked into the test binary, to make those symbols accessible to the test target they need to be specified as a dependency of this target and ",(0,i.mdx)("inlineCode",{parentName:"li"},"['-undefined', 'dynamic_lookup']"),"  needs to be added to this target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags")," (this will suppress undefined reference errors during compilation, but if the symbols do not exist, it might result in runtime crashes).")),(0,i.mdx)("h4",{id:"details-15"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\napple_test(\n  name = 'MyTest',\n  info_plist = 'MyTest-Info.plist',\n  preprocessor_flags = ['-fobjc-arc'],\n  srcs = [\n    'MyTest.m',\n  ],\n  deps = [\n    ':MyLibrary',\n  ],\n  frameworks = [\n    '$SDKROOT/System/Library/Frameworks/Foundation.framework',\n    '$SDKROOT/System/Library/Frameworks/UIKit.framework',\n    '$PLATFORM_DIR/Developer/Library/Frameworks/XCTest.framework',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"apple_toolchain"},"apple","_","toolchain"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def apple_toolchain(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _internal_platform_path: [None, str.type] = _,\n    _internal_sdk_path: [None, str.type] = _,\n    actool: str.type,\n    architecture: str.type = _,\n    build_version: [None, str.type] = _,\n    codesign: str.type,\n    codesign_allocate: str.type,\n    codesign_identities_command: [None, str.type] = _,\n    compile_resources_locally: bool.type = _,\n    contacts: [str.type] = _,\n    copy_scene_kit_assets: str.type,\n    cxx_toolchain: str.type,\n    default_host_platform: [None, str.type] = _,\n    developer_path: [None, str.type] = _,\n    dsymutil: str.type,\n    dwarfdump: [None, str.type] = _,\n    extra_linker_outputs: [str.type] = _,\n    ibtool: str.type,\n    installer: str.type = _,\n    labels: [str.type] = _,\n    libtool: str.type,\n    licenses: [str.type] = _,\n    lipo: str.type,\n    min_version: [None, str.type] = _,\n    momc: str.type,\n    odrcov: [None, str.type] = _,\n    placeholder_tool: [None, str.type] = _,\n    platform_path: [None, str.type] = _,\n    requires_xcode_version_match: bool.type = _,\n    sdk_environment: [None, str.type] = _,\n    sdk_name: str.type = _,\n    sdk_path: [None, str.type] = _,\n    swift_toolchain: [None, str.type] = _,\n    version: [None, str.type] = _,\n    watch_kit_stub_binary: [None, str.type] = _,\n    work_around_dsymutil_lto_stack_overflow_bug: [None, bool.type] = _,\n    xcode_build_version: [None, str.type] = _,\n    xcode_version: [None, str.type] = _,\n    xctest: str.type\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-21"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"apple_toolchain_set"},"apple","_","toolchain","_","set"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def apple_toolchain_set(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    apple_toolchains: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-22"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"cgo_library"},"cgo","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def cgo_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _go_toolchain: str.type = _,\n    cgo_compiler_flags: [str.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    devirt_enabled: bool.type = _,\n    embedcfg: [None, str.type] = _,\n    executable_name: [None, str.type] = _,\n    exported_deps: [str.type] = _,\n    fat_lto: bool.type = _,\n    focused_list_target: [None, str.type] = _,\n    frameworks: [str.type] = _,\n    go_assembler_flags: [str.type] = _,\n    go_compiler_flags: [str.type] = _,\n    go_srcs: [str.type] = _,\n    header_namespace: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_deps_query_whole: bool.type = _,\n    link_group: [None, str.type] = _,\n    link_group_map: [None, [(str.type, [(str.type, str.type, [None, str.type])])]] = _,\n    link_style: [None, str.type] = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    package_name: [None, str.type] = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    prefer_stripped_objects: bool.type = _,\n    prefix_header: [None, str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    raw_headers: [str.type] = _,\n    srcs: [[str.type, (str.type, [str.type])]] = _,\n    thin_lto: bool.type = _,\n    version_universe: [None, str.type] = _,\n    weak_framework_names: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A cgo","_","library() rule builds an object from the supplied set of Go/C source files and dependencies. The outputs are linked into go executable in the last step (compile)."),(0,i.mdx)("h4",{id:"parameters-23"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"cgo_compiler_flags"),": The set of additional compiler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"go tool cgo"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": Flags to use when compiling any of the above sources (which require compilation)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"go_assembler_flags"),": The set of additional assembler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"go tool asm"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"go_compiler_flags"),": The set of additional compiler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"go tool compile"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"go_srcs"),": The set of source files to be compiled by this rule. Go (",(0,i.mdx)("inlineCode",{parentName:"li"},".go"),") files are compiled with the Go compiler. In contrast to the ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," argument, these files ",(0,i.mdx)("em",{parentName:"li"},"cannot")," have ",(0,i.mdx)("inlineCode",{parentName:"li"},'import "C"')," declared."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"headers"),": The set of header files that are made available for inclusion to the source files in this target. These should be specified as either a list of header files or a dictionary of header names to header files. The header name can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). The headers can be included with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#include "$HEADER_NAMESPACE/$HEADER_NAME"')," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include <$HEADER_NAMESPACE/$HEADER_NAME>")," , where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAMESPACE")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),"  attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the header name if specified, and the filename of the header file otherwise. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be either ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_extra_outputs"),": Declares extra outputs that the linker emits. These identifiers can be used in ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(output ...)")," macros in ",(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags")," to interpolate the output path into the linker command line. Useful for custom linkers that emit extra output files."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Flags to add to the linker command line whenever the output from this rule is used in a link operation, such as linked into an executable or a shared library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"package_name"),': Sets the full name of the package being compiled. This defaults to the path from the buck root. (e.g. given a ./.buckconfig, a rule in ./a/b/BUCK defaults to package "a/b")'),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_compiler_flags"),": Platform specific compiler flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when compiling the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_linker_flags"),": Platform-specific linker flags. This argument is specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The second element in each pair is a list of linker flags. If the regex matches the platform, these flags are added to the linker command line when the output from this rule is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_preprocessor_flags"),": Platform specific preprocessor flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when preprocessing the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags"),": Flags to use when preprocessing any of the above sources (which require preprocessing)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers"),": The set of header files that can be used for inclusion to the source files in the target and all targets that transitively depend on it. Buck doesn't add raw headers to the search path of a compiler/preprocessor automatically. ",(0,i.mdx)("inlineCode",{parentName:"li"},"include_directories")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"public_include_directories")," are the recommended way to add raw headers to the search path (they will be added via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-I"),"). ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_preprocessor_flags")," can also be used to add such raw headers to the search path if inclusion via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-isystem")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"-iquote")," is needed. ",(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers")," cannot be used together with ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_headers")," in the same target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of source files to be compiled by this rule. .go files will be compiled with the CGO compiler. Each file needs to have ",(0,i.mdx)("inlineCode",{parentName:"li"},'import "C"')," declared.")),(0,i.mdx)("h4",{id:"details-16"},"Details"),(0,i.mdx)("p",null,"The 'go build' command would collect the cgo directives from the source files, however\nwith buck the flags needs to be passed in the cgo","_","library manually"),(0,i.mdx)("p",null,"This rule borrows from ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx\\_binary()"),"since C/C++ sources are being compiled."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n# A rule that builds a Go native executable with linked cgo library based on\n# C/C++ util library.\ngo_binary(\n    name = "bin",\n    srcs = ["main.go"],\n    deps = [":lib"]\n)\n\ncgo_library(\n    name = "lib",\n    srcs = ["cgo_source.go"],\n    deps = [":util"],\n)\n\ncxx_library(\n    name = "util",\n    srcs = ["util.c"],\n    headers = ["util.h"],\n)\n\n')),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"command_alias"},"command","_","alias"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def command_alias(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _exec_os_type: str.type = _,\n    _target_os_type: str.type = _,\n    args: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    exe: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    platform_exe: {str.type: str.type} = _,\n    resources: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"command_alias")," rule enables you to wrap build rules that create binaries and to pre-apply command-line arguments and environment variables."),(0,i.mdx)("h4",{id:"parameters-24"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"args"),": A string of arguments that is passed to the executable specified by ",(0,i.mdx)("inlineCode",{parentName:"li"},"exe")," at startup. These arguments support a subset of Buck's ",(0,i.mdx)("inlineCode",{parentName:"li"},"string parameter macros")," . Only the ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(location ...)")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(exe ...)")," macros are supported currently."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": A map of environment variables that will be passed to the executable represented by ",(0,i.mdx)("inlineCode",{parentName:"li"},"exe")," on startup. Environment variables support the same macros as arguments."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exe"),": A ",(0,i.mdx)("inlineCode",{parentName:"li"},"build target"),"for a rule that outputs an executable, such as an ",(0,i.mdx)("inlineCode",{parentName:"li"},"sh\\_binary()"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_exe"),": A mapping from platforms to ",(0,i.mdx)("inlineCode",{parentName:"li"},"build target"),". enables you to override ",(0,i.mdx)("inlineCode",{parentName:"li"},"exe")," per host platform.")),(0,i.mdx)("p",null,"If present, ",(0,i.mdx)("inlineCode",{parentName:"p"},"exe")," will be used as a fallback on host platforms that are not\nspecified in ",(0,i.mdx)("inlineCode",{parentName:"p"},"platform_exe"),"."),(0,i.mdx)("p",null,"It is possible to omit ",(0,i.mdx)("inlineCode",{parentName:"p"},"exe")," when providing ",(0,i.mdx)("inlineCode",{parentName:"p"},"platform_exe"),".\nIn that case, the build will fail if the command is invoked on a platform not specified in\nthe mapping."),(0,i.mdx)("p",null,"Valid platforms are all values of the ",(0,i.mdx)("a",{parentName:"p",href:"https://dev.buck.build/javadoc/com/facebook/buck/util/environment/Platform.html"},(0,i.mdx)("inlineCode",{parentName:"a"},"Platform")," enum")," :"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"FREEBSD")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"LINUX")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"MACOS")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"WINDOWS"))),(0,i.mdx)("h4",{id:"details-17"},"Details"),(0,i.mdx)("p",null,"Example uses include running a command written in a scripting\nlanguage with a specific interpreter, and transparently wrapping\nsub-commands of a binary."),(0,i.mdx)("p",null," You can reference a ",(0,i.mdx)("inlineCode",{parentName:"p"},"command_alias")," target in\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"cmd")," parameter of a ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),"by\nusing the ",(0,i.mdx)("inlineCode",{parentName:"p"},"exe")," macro:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\n$(exe //path/to:target)\n\n")),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n# Combining an interpreter and a script\n\ncxx_binary(\n    name = "node-js",\n    srcs = [\n        # ...\n    ],\n    headers = [\n        # ...\n    ],\n)\n\nexport_file(\n    name = "scripts"\n)\n\ncommand_alias(\n    name = "server",\n    exe = ":node-js",\n    args = [\n        "$(location :scripts)/start-server.js",\n    ],\n)\n\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n# Exposing sub commands\n\nexport_file(\n    name = "yarn",\n    src = "yarn.sh",\n)\n\ncommand_alias(\n    name = "add",\n    exe = ":yarn",\n    args = ["add"],\n)\n\ncommand_alias(\n    name = "install",\n    exe = ":yarn",\n    args = ["install"],\n)\n\ncommand_alias(\n    name = "run",\n    exe = ":yarn",\n    args = ["run"],\n)\n\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n# Platform specific commands\n\nexport_file(\n    name = "node-windows",\n    src = "windows/node.exe",\n)\n\nexport_file(\n    name = "node-linux",\n    src = "linux/node",\n)\n\nexport_file(\n    name = "node-macos",\n    src = "macos/node",\n)\n\ncommand_alias(\n    name = "node",\n    platform_exe = {\n        "windows": ":node-windows",\n        "linux": ":node-linux",\n        "macos": ":node-macos",\n    },\n)\n\n')),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"config_setting"},"config","_","setting"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def config_setting(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    constraint_values: [str.type] = _,\n    values: {str.type: str.type} = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-25"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"configured_alias"},"configured","_","alias"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def configured_alias(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    actual: str.type,\n    configured_actual: [None, (str.type, str.type)] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    fallback_actual: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    platform: [None, str.type] = _,\n    propagate_flavors: bool.type = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-26"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"constraint_setting"},"constraint","_","setting"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def constraint_setting(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-27"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"constraint_value"},"constraint","_","value"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def constraint_value(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    constraint_setting: str.type\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-28"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"core_data_model"},"core","_","data","_","model"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def core_data_model(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    path: str.type\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"core_data_model()")," rule contains models for Apple's Core Data framework. This rule does not have any output on its own and can be built only as a dependency (either direct or transitive) of an ",(0,i.mdx)("inlineCode",{parentName:"p"},"apple_bundle()")," rule in which case all ",(0,i.mdx)("inlineCode",{parentName:"p"},"core_data_model()")," rules that the bundle rule depends on are merged and placed into the final output bundle together."),(0,i.mdx)("h4",{id:"parameters-29"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("h4",{id:"details-18"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\ncore_data_model(\n  name = 'MyCoreDataModel',\n  path = 'MyCoreDataModel.xcdatamodeld',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"csharp_library"},"csharp","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def csharp_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    dll_name: str.type = _,\n    framework_ver: str.type,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    resources: {str.type: str.type} = _,\n    srcs: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A csharp","_","library() rule builds a .Net library from the supplied set of C# source files and dependencies by invoking csc."),(0,i.mdx)("h4",{id:"parameters-30"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": The set of additional compiler flags to pass to the compiler."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of targets or system-provided assemblies to rely on. Any values that are targets must be either csharp","_","library or ",(0,i.mdx)("inlineCode",{parentName:"li"},"prebuilt_dotnet_library")," instances."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"dll_name"),": The output name of the dll. This allows you to specify the name of the dll exactly. When this is not set, the dll will be named after the short name of the target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"framework_ver"),": The version of the .Net framework that this library targets. This is one of 'net35', 'net40', 'net45' and 'net46'."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": Resources that should be embedded within the built DLL. The format is the name of the resource once mapped into the DLL as the key, and the value being the resource that should be merged. This allows non-unique keys to be identified quickly."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The collection of source files to compile.")),(0,i.mdx)("h4",{id:"details-19"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"For more examples, check out our ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/rust/testdata/"},"integration tests"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\ncsharp_library(\n  name = 'simple',\n  dll_name = 'Cake.dll',\n  framework_ver = 'net46',\n  srcs = [\n    'Hello.cs',\n  ],\n  resources = {\n    'greeting.txt': '//some:target',\n  },\n  deps=[\n    ':other',\n    'System.dll',\n  ],\n)\n\nprebuilt_dotnet_library(\n  name = 'other',\n  assembly = 'other-1.0.dll',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"cxx_binary"},"cxx","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def cxx_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_hacks: str.type = _,\n    _cxx_toolchain: str.type = _,\n    auto_link_groups: bool.type = _,\n    binary_linker_flags: [str.type] = _,\n    bolt_flags: [str.type] = _,\n    bolt_gdb_index: [None, str.type] = _,\n    bolt_profile: [None, str.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    devirt_enabled: bool.type = _,\n    enable_distributed_thinlto: bool.type = _,\n    executable_name: [None, str.type] = _,\n    fat_lto: bool.type = _,\n    focused_list_target: [None, str.type] = _,\n    frameworks: [str.type] = _,\n    header_namespace: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_deps_query_whole: bool.type = _,\n    link_execution_preference: [None, str.type] = _,\n    link_group: [None, str.type] = _,\n    link_group_map: [None, str.type, [(str.type, [([None, str.type], str.type, [None, str.type, [str.type]], [None, str.type])], [None, {str.type: ""}])]] = _,\n    link_group_min_binary_node_count: [None, int.type] = _,\n    link_ordering: [None, str.type] = _,\n    link_style: [None, str.type] = _,\n    link_whole: bool.type = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    prefer_stripped_objects: bool.type = _,\n    prefix_header: [None, str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    raw_headers: [str.type] = _,\n    resources: [[str.type], {str.type: str.type}] = _,\n    srcs: [[str.type, (str.type, [str.type])]] = _,\n    thin_lto: bool.type = _,\n    version_universe: [None, str.type] = _,\n    weak_framework_names: [str.type] = _\n) -> None\n')),(0,i.mdx)("p",null,"A cxx","_","binary() rule builds a native executable from the supplied set of C/C++ source files and dependencies. If C/C++ library dependencies are listed, the generated native executable will request and link against their static archives (which are ","*","not","*"," built using ",(0,i.mdx)("a",{parentName:"p",href:"http://en.wikipedia.org/wiki/Position-independent_code"},"PIC"),")."),(0,i.mdx)("h4",{id:"parameters-31"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"name"),": name of the target")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"within_view"),": a list of visibility patterns restricting what this target can depend on")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"compiler_flags"),": Flags to use when compiling any of the above sources (which require compilation).")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"deps_query"),": Status: ",(0,i.mdx)("strong",{parentName:"p"},"experimental/unstable"),". The deps query takes a query string that accepts the following query functions, and appends the output of the query to the declared deps:")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"attrfilter"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"deps"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"except"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"intersect"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"filter"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"kind"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"set"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"union")))),(0,i.mdx)("p",null," The macro ",(0,i.mdx)("inlineCode",{parentName:"p"},"$declared_deps")," may be used anywhere a target literal pattern is expected\nin order to refer to the explicit deps of this rule as they appear in the rule's definition.\nFor example, if your build rule declares"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n  android_library(\n    name = 'lib',\n    deps = ['//foo:foo'],\n    deps_query = '$declared_deps',\n  )\n")),(0,i.mdx)("p",null," then the macro ",(0,i.mdx)("inlineCode",{parentName:"p"},"$declared_deps")," would be expanded to a\nliteral ",(0,i.mdx)("inlineCode",{parentName:"p"},"set(//foo:foo)"),".\nSome example queries:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n  "filter({name_regex}, $declared_deps)".format(name_regex=\'//.*\')\n  "attrfilter(annotation_processors, com.foo.Processor, $declared_deps)"\n  "deps(\'//foo:foo\', 1)"\n')),(0,i.mdx)("p",null," Note: any targets included in this query must also be present in ",(0,i.mdx)("inlineCode",{parentName:"p"},"deps"),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),": A path prefix when including headers of this target. Defaults to the path from the root of the repository to the directory where this target is defined. Can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"), but cannot start with one. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"headers"),": The set of header files that are made available for inclusion to the source files in this target. These should be specified as either a list of header files or a dictionary of header names to header files. The header name can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). The headers can be included with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#include "$HEADER_NAMESPACE/$HEADER_NAME"')," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include <$HEADER_NAMESPACE/$HEADER_NAME>")," , where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAMESPACE")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),"  attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the header name if specified, and the filename of the header file otherwise. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"include_directories"),": A list of include directories (with ",(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers"),") to be added to the compile command for compiling this target (via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-I"),"). An include directory is relative to the current package."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_execution_preference"),": The execution preference for linking. Options are:")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"any : No preference is set, and the link action will be performed based on buck2's executor configuration."),(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"full_hybrid : The link action will execute both locally and remotely, regardless of buck2's executor configuration (if"),(0,i.mdx)("pre",{parentName:"li"},(0,i.mdx)("code",{parentName:"pre"},"          the executor is capable of hybrid execution). The use_limited_hybrid setting of the hybrid executor is ignored.\n"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local : The link action will execute locally if compatible on current host platform.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local_only : The link action will execute locally, and error if the current platform is not compatible.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"remote : The link action will execute remotely if a compatible remote platform exists, otherwise locally."))))),(0,i.mdx)("p",null,"The default is None, expressing that no preference has been set on the target itself."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be either ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_extra_outputs"),": Declares extra outputs that the linker emits. These identifiers can be used in ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(output ...)")," macros in ",(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags")," to interpolate the output path into the linker command line. Useful for custom linkers that emit extra output files."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Flags to add to the linker command line whenever the output from this rule is used in a link operation, such as linked into an executable or a shared library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_compiler_flags"),": Platform specific compiler flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when compiling the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_headers"),": Platform specific header files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of header files or a dictionary of header names to header files that will be made available for inclusion to the source files in the target if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_linker_flags"),": Platform-specific linker flags. This argument is specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The second element in each pair is a list of linker flags. If the regex matches the platform, these flags are added to the linker command line when the output from this rule is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_preprocessor_flags"),": Platform specific preprocessor flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when preprocessing the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_srcs"),": Platform specific source files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of source files or a list of tuples of source files and a list of compilation flags to be preprocessed, compiled and assembled if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags"),": Flags to use when preprocessing any of the above sources (which require preprocessing)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers"),": The set of header files that can be used for inclusion to the source files in the target and all targets that transitively depend on it. Buck doesn't add raw headers to the search path of a compiler/preprocessor automatically. ",(0,i.mdx)("inlineCode",{parentName:"li"},"include_directories")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"public_include_directories")," are the recommended way to add raw headers to the search path (they will be added via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-I"),"). ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_preprocessor_flags")," can also be used to add such raw headers to the search path if inclusion via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-isystem")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"-iquote")," is needed. ",(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers")," cannot be used together with ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_headers")," in the same target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of C, C++, Objective-C, Objective-C++, or assembly source files to be preprocessed, compiled, and assembled by this rule. We determine which stages to run on each input source based on its file extension. See the ",(0,i.mdx)("a",{parentName:"li",href:"https://gcc.gnu.org/onlinedocs/gcc/Overall-Options.html"},"GCC documentation")," for more detail on how file extensions are interpreted. Each element can be either a string specifying a source file (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"''"),") or a tuple of a string specifying a source file and a list of compilation flags (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"('', ['-Wall', '-Werror'])")," ). In the latter case the specified flags will be used in addition to the rule's other flags when preprocessing and compiling that file (if applicable).")),(0,i.mdx)("h4",{id:"details-20"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that builds a C/C++ native executable from a single .cpp file\n# its corresponding header, and a C/C++ library dependency.\ncxx_binary(\n  name = 'echo',\n  srcs = [\n    'echo.cpp',\n  ],\n  headers = [\n    'echo.h',\n  ],\n  deps = [\n    ':util',\n  ],\n)\n\ncxx_library(\n  name = 'util',\n  srcs = [\n    'util.cpp',\n  ],\n  headers = [\n    'util.h',\n  ],\n)\n\n# To build without stripping:\nbuck build :echo\n\n# To build with stripping debug symbols only:\nbuck build :echo#strip-debug\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"cxx_genrule"},"cxx","_","genrule"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def cxx_genrule(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _exec_os_type: str.type = _,\n    _genrule_toolchain: str.type = _,\n    bash: [None, str.type] = _,\n    cacheable: [None, bool.type] = _,\n    cmd: [None, str.type] = _,\n    cmd_exe: [None, str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_outs: [None, [str.type]] = _,\n    enable_sandbox: [None, bool.type] = _,\n    environment_expansion_separator: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    metadata_env_var: [None, str.type] = _,\n    metadata_path: [None, str.type] = _,\n    need_android_tools: bool.type = _,\n    no_outputs_cleanup: bool.type = _,\n    out: [None, str.type] = _,\n    outs: [None, {str.type: [str.type]}] = _,\n    remote: [None, bool.type] = _,\n    srcs: [[str.type], {str.type: str.type}] = _,\n    type: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_genrule()")," enables you to run shell commands as part of the Buck build process. A ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_genrule()")," exposes\xe2\x80\x94through a set of string parameter macros and variables\xe2\x80\x94information about the tools and configuration options used by the Buck environment, specifically those related to the C/C++ toolchain."),(0,i.mdx)("h4",{id:"parameters-32"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"bash"),": A platform-specific version of the shell command parameter ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". It runs on Linux and UNIX systems\u2014including OSX\u2014on which ",(0,i.mdx)("inlineCode",{parentName:"li"},"bash")," is installed. It has a higher priority than ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". The ",(0,i.mdx)("inlineCode",{parentName:"li"},"bash")," argument is run with ",(0,i.mdx)("inlineCode",{parentName:"li"},"/usr/bin/env bash -c"),". It has access to the same set of macros and variables as the ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd")," argument."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),": The shell command to run to generate the output file. It is the fallback of ",(0,i.mdx)("inlineCode",{parentName:"li"},"bash")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd_exe"),". The shell command can access information about the buck build environment through a set of ",(0,i.mdx)("em",{parentName:"li"},"macros"),", ",(0,i.mdx)("em",{parentName:"li"},"parameterized macros"),", and ",(0,i.mdx)("em",{parentName:"li"},"variables"),".")),(0,i.mdx)("h4",{id:"macros"},"Macros"),(0,i.mdx)("p",null," The following macros are available to the shell command and are\naccessed using the following syntax."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"$(<macro>)\n")),(0,i.mdx)("p",null," Example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"$(cc)\n")),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(cc)"),"\nPath to the C compiler."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(cxx)"),"\nPath to the C++ compiler."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(cflags)"),"\nFlags passed to the C compiler."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(cppflags)"),"\nFlags passed to the C preprocessor."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(cxxflags)"),"\nFlags passed to the C++ compiler."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(cxxppflags)"),"\nFlags to pass to the C++ preprocessor."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(ld)"),"\nPath to the linker."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(ldflags-pic)"),"\nFlags passed to the linker for binaries that use\nposition-independent code (PIC)."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(ldflags-pic-filter <pattern>)"),"\nFlags passed to the linker for binaries that use position-independent code (PIC).\nUse the ",(0,i.mdx)("em",{parentName:"p"},"pattern")," parameter to specify a regular expression that matches the build targets that use these flags."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(ldflags-shared)"),"\nFlags passed to the linker for shared libraries, such as dynamic-link libraries (DLLs)."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(ldflags-shared-filter <pattern>)"),"\nFlags passed to the linker for shared libraries, such as dynamic-link libraries (DLLs).\nUse the ",(0,i.mdx)("em",{parentName:"p"},"pattern")," parameter to specify a regular expression that matches the build targets that use these flags."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(ldflags-static)"),"\nFlags passed to the linker for statically-linked libraries."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(ldflags-static-filter <pattern>)"),"\nFlags passed to the linker for statically-linked libraries.\nUse the ",(0,i.mdx)("em",{parentName:"p"},"pattern")," parameter to specify a regular expression that matches the build targets that use these flags."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(platform-name)"),"\nThe platform flavor with which this ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_genrule")," was specified."),(0,i.mdx)("h4",{id:"parameterized-macros"},"Parameterized Macros"),(0,i.mdx)("p",null," It is also possible to expand references to other rules within the\nshell command, using the following subset of the\nbuiltin ",(0,i.mdx)("inlineCode",{parentName:"p"},"string parameter macros"),"\n.\nNote that all build rules expanded in the command are automatically\nconsidered to be dependencies of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),"."),(0,i.mdx)("p",null," Note that the paths returned by these macros are ",(0,i.mdx)("em",{parentName:"p"},"absolute")," paths. You should convert these paths to be relative paths before\nembedding them in, for example, a shell script or batch file. Using\nrelative paths ensures that your builds are ",(0,i.mdx)("em",{parentName:"p"},"hermetic"),", that\nis, they are reproducible across different machine environments."),(0,i.mdx)("p",null," Additionally, if you embed these paths in a shell script, you should\nexecute that script using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"sh\\_binary()"),"rule and include\nthe targets for these paths in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"resources")," argument of\nthat ",(0,i.mdx)("inlineCode",{parentName:"p"},"sh_binary")," rule. These are the same targets that you\npass to the string parameter macros."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(exe //path/to:target)"),"\nExpands to the commands necessary to run the executable\ngenerated by the specified build rule. For a C++ executable, this\nwill typically just be the name of the output executable itself,\nsuch as ",(0,i.mdx)("inlineCode",{parentName:"p"},"main"),". If the specified build rule does not generate an\nexecutable output, an exception will be thrown and the build will\nfail."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(location //path/to:target)"),"\nExpands to the path of the output of the build rule. This\nmeans that you can refer to these without needing to be aware of\nhow Buck is storing data on the disk mid-build."),(0,i.mdx)("h4",{id:"variables"},"Variables"),(0,i.mdx)("p",null," Finally, Buck adds the following variables to the environment in\nwhich the shell command runs. They are accessed using the following syntax.\nNote the use of braces rather than parentheses."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"${<variable>}\n")),(0,i.mdx)("p",null," Example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"${SRCS}\n")),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${SRCS}"),"\nA string expansion of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"srcs")," argument delimited by\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"environment_expansion_separator")," argument where each element\nof ",(0,i.mdx)("inlineCode",{parentName:"p"},"srcs")," will be translated into an absolute path."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${SRCDIR}"),"\nThe absolute path to the to which sources are copied\nprior to running the command."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${OUT}"),"\nThe output file for the ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),". The file\nspecified by this variable must always be written by this\ncommand. If not, the execution of this rule will be considered a\nfailure, halting the build process."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${TMP}"),"\nA temporary directory which can be used for intermediate results and will not be\nbundled into the output."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"cmd_exe"),": A platform-specific version of the shell command parameter ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". It runs on Windows and has a higher priority than ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". The ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd_exe")," argument is run with ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd.exe /v:off /c"),". It has access to the same set of macros and variables as the ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd")," argument."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"enable_sandbox"),": Whether this target should be executed in a sandbox or not."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"environment_expansion_separator"),": The delimiter between paths in environment variables, such as SRCS, that can contain multiple paths. It can be useful to specify this parameter if the paths could contain spaces."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"out"),": The name of the output file or directory. The complete path to this argument is provided to the shell command through the ",(0,i.mdx)("inlineCode",{parentName:"li"},"OUT")," environment variable."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": Either a list or a map of the source files which Buck makes available to the shell command at the path in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"SRCDIR")," environment variable. If you specify a list, the source files are the names in the list. If you specify a map, the source files are made available as the names in the keys of the map, where the values of the map are the original source file names."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"type"),": Specifies the ",(0,i.mdx)("em",{parentName:"li"},"type"),' of this genrule. This is used for logging and is particularly useful for grouping genrules that share an underlying logical "type".')),(0,i.mdx)("p",null,"For example, if you have the following ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_genrule")," defined\nin the root directory of your Buck project"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\ncxx_genrule(\n  name = 'cxx_gen',\n  type = 'epilog',\n  cmd  = 'touch finish.txt; cp finish.txt $OUT',\n  out  = 'finish.txt'\n)\n\n")),(0,i.mdx)("p",null," then the following ",(0,i.mdx)("inlineCode",{parentName:"p"},"buck query")," command"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\nbuck query \"attrfilter( type, 'epilog', '//...' )\"\n\n")),(0,i.mdx)("p",null," returns"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\n//:cxx_gen\n\n")),(0,i.mdx)("h4",{id:"details-21"},"Details"),(0,i.mdx)("p",null,"The information exposed through these tools and configuration options is a reflection of:\nBuck's built-in settings,\nthe settings in ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"\nand ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig.local"),",\nand the result of various command-line overrides specified through\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"common\\_parameters"),"command-line option."),(0,i.mdx)("p",null,"This information is available only\nto the shell commands specified in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_genrule"),".\nThe information is not available to other arguments of the rule."),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_genrule()")," can be an input to\nanother ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_genrule()"),"."),(0,i.mdx)("p",null,"Note that if you specify the ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_genrule")," as a command-line\ntarget to ",(0,i.mdx)("inlineCode",{parentName:"p"},"buck build"),", you must include a platform flavor.\nFor example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\nbuck build :cxx_gr_name#iphonesimulator-x86_64\n\n")),(0,i.mdx)("p",null,"You could also just specify the default platform flavor explicitly:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\nbuck build :cxx_gr_name#default\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"cxx_library"},"cxx","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def cxx_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_hacks: str.type = _,\n    _cxx_toolchain: str.type = _,\n    _is_building_android_binary: bool.type = _,\n    _omnibus_environment: [None, str.type] = _,\n    auto_link_groups: bool.type = _,\n    bridging_header: [None, str.type] = _,\n    can_be_asset: [None, bool.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    devirt_enabled: bool.type = _,\n    diagnostics: {str.type: str.type} = _,\n    executable_name: [None, str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_header_style: str.type = _,\n    exported_headers: [[str.type], {str.type: str.type}] = _,\n    exported_lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    exported_lang_preprocessor_flags: {str.type: [str.type]} = _,\n    exported_linker_flags: [str.type] = _,\n    exported_platform_deps: [(str.type, [str.type])] = _,\n    exported_platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    exported_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    exported_post_linker_flags: [str.type] = _,\n    exported_post_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_preprocessor_flags: [str.type] = _,\n    extra_xcode_files: [str.type] = _,\n    extra_xcode_sources: [str.type] = _,\n    fat_lto: bool.type = _,\n    focused_list_target: [None, str.type] = _,\n    force_emit_omnibus_shared_root: bool.type = _,\n    force_static: [None, bool.type] = _,\n    frameworks: [str.type] = _,\n    header_mode: [None, str.type] = _,\n    header_namespace: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    include_in_android_merge_map_output: bool.type = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_deps_query_whole: bool.type = _,\n    link_execution_preference: [None, str.type] = _,\n    link_group: [None, str.type] = _,\n    link_group_map: [None, str.type, [(str.type, [([None, str.type], str.type, [None, str.type, [str.type]], [None, str.type])], [None, {str.type: ""}])]] = _,\n    link_ordering: [None, str.type] = _,\n    link_style: [None, str.type] = _,\n    link_whole: [None, bool.type] = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    module_name: [None, str.type] = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    prefer_stripped_objects: bool.type = _,\n    preferred_linkage: str.type = _,\n    prefix_header: [None, str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    public_include_directories: [str.type] = _,\n    public_system_include_directories: [str.type] = _,\n    raw_headers: [str.type] = _,\n    reexport_all_header_dependencies: [None, bool.type] = _,\n    resources: [[str.type], {str.type: str.type}] = _,\n    sdk_modules: [str.type] = _,\n    soname: [None, str.type] = _,\n    srcs: [[str.type, (str.type, [str.type])]] = _,\n    static_library_basename: [None, str.type] = _,\n    supported_platforms_regex: [None, str.type] = _,\n    supports_header_symlink_subtarget: bool.type = _,\n    supports_merged_linking: [None, bool.type] = _,\n    supports_python_dlopen: [None, bool.type] = _,\n    supports_shlib_interfaces: bool.type = _,\n    thin_lto: bool.type = _,\n    use_archive: [None, bool.type] = _,\n    used_by_wrap_script: bool.type = _,\n    uses_cxx_explicit_modules: bool.type = _,\n    uses_explicit_modules: bool.type = _,\n    version_universe: [None, str.type] = _,\n    weak_framework_names: [str.type] = _,\n    xcode_private_headers_symlinks: [None, bool.type] = _,\n    xcode_public_headers_symlinks: [None, bool.type] = _\n) -> None\n')),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_library()")," rule specifies a set of C/C++ source files and also provides flags that specify how those files should be built."),(0,i.mdx)("h4",{id:"parameters-33"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": Flags to use when compiling any of the above sources (which require compilation)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),": Dependencies that will also appear to belong to any rules that depend on this one. This has two effects: ",(0,i.mdx)("em",{parentName:"li"}," Exported dependencies will also be included in the link line of dependents of this rules, but normal dependencies will not. ")," When ",(0,i.mdx)("inlineCode",{parentName:"li"},"reexport_all_header_dependencies = False"),", only exported headers of the rules specified here are re-exported."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_header_style"),": How dependents should include exported headers from this rule. Can be either ",(0,i.mdx)("inlineCode",{parentName:"li"},"local")," (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"-I"),") or ",(0,i.mdx)("inlineCode",{parentName:"li"},"system")," (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"-isystem"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_headers"),": The set of header files that are made available for inclusion to the source files in the target and all targets that transitively depend on it. These should be specified as either a list of header files or a dictionary of header names to header files. The headers can be included with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#include "$HEADER_NAMESPACE/$HEADER_NAME"')," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include <$HEADER_NAMESPACE/$HEADER_NAME>"),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAMESPACE")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace")," attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the header name if specified, and the filename of the header file otherwise. Note that the header name can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). See ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_lang_platform_preprocessor_flags"),": Just as ",(0,i.mdx)("inlineCode",{parentName:"li"},"lang_platform_preprocessor_flags"),", but these flags also apply to rules that transitively depend on this rule."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_lang_preprocessor_flags"),": Just as ",(0,i.mdx)("inlineCode",{parentName:"li"},"lang_preprocessor_flags"),", but these flags also apply to rules that transitively depend on this rule."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_linker_flags"),": Flags to add to the linker command line when the output from this rule, or the output from any rule that transitively depends on this rule, is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_platform_deps"),": Platform specific dependencies that will also appear to belong to any rules that depend on this one. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of external dependencies (same format as ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),") that are exported if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_platform_headers"),": Platform specific header files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of header files or a dictionary of header names to header files that will be made available for inclusion to the source files in the target and all targets that transitively depend on it if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_platform_linker_flags"),": Platform-specific linker flags for this rule and for all rules that transitively depend on this rule. This argument is specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The second element in each pair is a list of linker flags. If the regex matches the platform, these flags are added to the linker command line when the output from this rule, or the output from any rule that transitively depends on this rule, is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_platform_preprocessor_flags"),": Platform specific exported preprocessor flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when preprocessing the source files in the target and all targets that transitively depend on it if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_preprocessor_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_post_linker_flags"),": Flags to add to the linker command line when the output from this rule, or the output from any rule that transitively depends on this rule, is used in a link operation\u2014with the additional feature that these flags are guaranteed to be placed ",(0,i.mdx)("em",{parentName:"li"},"after")," the compiled object (",(0,i.mdx)("inlineCode",{parentName:"li"},".o"),") files on the linker command line."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_post_platform_linker_flags"),": Platform-specific linker flags for this rule and for all rules that transitively depend on this rule\u2014and that are guaranteed to be placed ",(0,i.mdx)("em",{parentName:"li"},"after")," the compiled object (",(0,i.mdx)("inlineCode",{parentName:"li"},".o"),") files on the linker command line. In other respects, the syntax and semantics of this argument are the same as for the ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_platform_linker_flags")," argument."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_xcode_files"),': When the project is generated, this is the list of files that will added to the project. Those files won\'t be added to the build phase "Compile Sources".'),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),": A path prefix when including headers of this target. Defaults to the path from the root of the repository to the directory where this target is defined. Can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"), but cannot start with one. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"headers"),": The set of header files that are made available for inclusion to the source files in this target. These should be specified as either a list of header files or a dictionary of header names to header files. The header name can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). The headers can be included with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#include "$HEADER_NAMESPACE/$HEADER_NAME"')," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include <$HEADER_NAMESPACE/$HEADER_NAME>")," , where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAMESPACE")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),"  attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the header name if specified, and the filename of the header file otherwise. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"include_directories"),": A list of include directories (with ",(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers"),") to be added to the compile command for compiling this target (via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-I"),"). An include directory is relative to the current package."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"lang_compiler_flags"),": Language-specific compiler flags. These should be specified as a map of C-family language short names to lists of flags and is used to target flags to sources files for a specific language in the C-family (C, C++, assembler, etc.). The keys in the map can be: ",(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"cpp-output")," for C ")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"c++-cpp-output")," for C++ ",(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"objective-c-cpp-output")," for Objective-C ")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"objective-c++-cpp-output")," for Objective-C++ ",(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"cuda-cpp-output")," for Cuda ")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"assembler")," for Assembly * ",(0,i.mdx)("inlineCode",{parentName:"li"},"asm")," for ASM"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"lang_platform_compiler_flags"),": Language- and platform-specific compiler flags. These should be specified as a map of C-family language short names, as described in ",(0,i.mdx)("inlineCode",{parentName:"li"},"lang_compiler_flags"),", to lists of pairs, as described in ",(0,i.mdx)("inlineCode",{parentName:"li"},"platform_compiler_flags"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"lang_platform_preprocessor_flags"),": Language- and platform-specific preprocessor flags. These should be specified as a map of C-family language short names, as described in ",(0,i.mdx)("inlineCode",{parentName:"li"},"lang_preprocessor_flags"),", to lists of pairs, as described in ",(0,i.mdx)("inlineCode",{parentName:"li"},"platform_preprocessor_flags"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"lang_preprocessor_flags"),": Language-specific preprocessor flags. These should be specified as a map of C-family language short names to lists of flags and is used to target flags to sources files for a specific language in the C-family (C, C++, assembler, etc.). The keys in the map can be: ",(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"c")," for C ")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"c++")," for C++ ",(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"objective-c")," for Objective-C ")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"objective-c++")," for Objective-C++ ",(0,i.mdx)("em",{parentName:"li"}," ",(0,i.mdx)("inlineCode",{parentName:"em"},"cuda")," for Cuda ")," ",(0,i.mdx)("inlineCode",{parentName:"li"},"assembler-with-cpp")," for Assembly * ",(0,i.mdx)("inlineCode",{parentName:"li"},"asm-with-cpp")," for ASM"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_execution_preference"),": The execution preference for linking. Options are:")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"any : No preference is set, and the link action will be performed based on buck2's executor configuration."),(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"full_hybrid : The link action will execute both locally and remotely, regardless of buck2's executor configuration (if"),(0,i.mdx)("pre",{parentName:"li"},(0,i.mdx)("code",{parentName:"pre"},"          the executor is capable of hybrid execution). The use_limited_hybrid setting of the hybrid executor is ignored.\n"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local : The link action will execute locally if compatible on current host platform.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local_only : The link action will execute locally, and error if the current platform is not compatible.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"remote : The link action will execute remotely if a compatible remote platform exists, otherwise locally."))))),(0,i.mdx)("p",null,"The default is None, expressing that no preference has been set on the target itself."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be either ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_extra_outputs"),": Declares extra outputs that the linker emits. These identifiers can be used in ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(output ...)")," macros in ",(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags")," to interpolate the output path into the linker command line. Useful for custom linkers that emit extra output files."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Flags to add to the linker command line whenever the output from this rule is used in a link operation, such as linked into an executable or a shared library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_compiler_flags"),": Platform specific compiler flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when compiling the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_headers"),": Platform specific header files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of header files or a dictionary of header names to header files that will be made available for inclusion to the source files in the target if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_linker_flags"),": Platform-specific linker flags. This argument is specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The second element in each pair is a list of linker flags. If the regex matches the platform, these flags are added to the linker command line when the output from this rule is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_preprocessor_flags"),": Platform specific preprocessor flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when preprocessing the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_srcs"),": Platform specific source files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of source files or a list of tuples of source files and a list of compilation flags to be preprocessed, compiled and assembled if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags"),": Flags to use when preprocessing any of the above sources (which require preprocessing)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"public_include_directories"),": A list of include directories (with ",(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers"),") to be added to the compile command for compiling this target and every target that depends on it (via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-I"),"). An include directory is relative to the current package."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"public_system_include_directories"),": A list of include directories (with ",(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers"),") to be added to the compile command for compiling this target and every target that depends on it (via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-isystem")," if the compiler supports it of via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-I")," otherwise). An include directory is relative to the current package."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers"),": The set of header files that can be used for inclusion to the source files in the target and all targets that transitively depend on it. Buck doesn't add raw headers to the search path of a compiler/preprocessor automatically. ",(0,i.mdx)("inlineCode",{parentName:"li"},"include_directories")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"public_include_directories")," are the recommended way to add raw headers to the search path (they will be added via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-I"),"). ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_preprocessor_flags")," can also be used to add such raw headers to the search path if inclusion via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-isystem")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"-iquote")," is needed. ",(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers")," cannot be used together with ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_headers")," in the same target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"reexport_all_header_dependencies"),": Whether to automatically re-export the exported headers of all dependencies.")),(0,i.mdx)("p",null,"When this is set to false, only exported headers from\n",(0,i.mdx)("inlineCode",{parentName:"p"},"exported_deps")," are re-exported."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"soname"),': Sets the soname ("shared object name") of any shared library produced from this rule. The default value is based on the full rule name. The macro ',(0,i.mdx)("inlineCode",{parentName:"li"},"$(ext)")," will be replaced with a platform-appropriate extension. An argument can be provided, which is a library version. For example ",(0,i.mdx)("inlineCode",{parentName:"li"},"soname = 'libfoo.$(ext 2.3)'")," will be ",(0,i.mdx)("inlineCode",{parentName:"li"},"libfoo.2.3.dylib")," on Mac and ",(0,i.mdx)("inlineCode",{parentName:"li"},"libfoo.so.2.3")," on Linux."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of C, C++, Objective-C, Objective-C++, or assembly source files to be preprocessed, compiled, and assembled by this rule. We determine which stages to run on each input source based on its file extension. See the ",(0,i.mdx)("a",{parentName:"li",href:"https://gcc.gnu.org/onlinedocs/gcc/Overall-Options.html"},"GCC documentation")," for more detail on how file extensions are interpreted. Each element can be either a string specifying a source file (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"''"),") or a tuple of a string specifying a source file and a list of compilation flags (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"('', ['-Wall', '-Werror'])")," ). In the latter case the specified flags will be used in addition to the rule's other flags when preprocessing and compiling that file (if applicable)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"supported_platforms_regex"),": If present, an un-anchored regex (in java.util.regex.Pattern syntax) that matches all platforms that this library supports. It will not be built for other platforms."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"used_by_wrap_script"),": When using an exopackage Android, if this parameter is set to ",(0,i.mdx)("inlineCode",{parentName:"li"},"True"),", then the library is included in the primary APK even if native libraries would otherwise not be placed in it. This is intended for native libraries that are used by a ",(0,i.mdx)("a",{parentName:"li",href:"https://developer.android.com/ndk/guides/wrap-script"},"wrap.sh")," script, which must be placed in the primary APK. Only one of ",(0,i.mdx)("inlineCode",{parentName:"li"},"can_be_asset")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"used_by_wrap_script")," can be set for a rule.")),(0,i.mdx)("h4",{id:"details-22"},"Details"),(0,i.mdx)("h4",{id:"building-requires-a-specified-top-level-target"},"Building requires a specified top-level target"),(0,i.mdx)("p",null,"Whether a Buck command builds the ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_library")," is\ndetermined by the inclusion of a top-level target, such as\na ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx\\_binary()"),"or ",(0,i.mdx)("inlineCode",{parentName:"p"},"android\\_binary()"),", that\ntransitively depends on the ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_library"),". The set of\ntargets specified to the Buck command (",(0,i.mdx)("inlineCode",{parentName:"p"},"buck build"),", ",(0,i.mdx)("inlineCode",{parentName:"p"},"buck run"),", etc) must\ninclude one of these top-level targets in order for Buck to build\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_library"),". Note that you could specify the top-level target\nimplicitly using a ",(0,i.mdx)("inlineCode",{parentName:"p"},"build target pattern"),"or you could also specify\nthe top-level target using an buckconfig#",(0,i.mdx)("inlineCode",{parentName:"p"},"alias"),"defined in ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"."),(0,i.mdx)("p",null,(0,i.mdx)("em",{parentName:"p"},"How")," Buck builds the library also depends on the specified top-level target.\nFor example, a C/C++ binary (",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_binary"),") would require a static non-PIC build of the library,\nwhereas an Android APK (",(0,i.mdx)("inlineCode",{parentName:"p"},"android_binary"),") would require a shared PIC-enabled build.\n(PIC stands for position-independent code.)"),(0,i.mdx)("h4",{id:"dependencies-of-the-cxx_library-also-require-a-top-level-target"},"Dependencies of the cxx","_","library also require a top-level target"),(0,i.mdx)("p",null,"Similarly, in order for Buck to build a target that\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_library")," depends on, such as a ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx\\_genrule()"),",\nyou must specify in the Buck command a top-level target that depends on\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_library"),". For example, you could specify\nto ",(0,i.mdx)("inlineCode",{parentName:"p"},"build"),"a ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_binary")," that\ndepends on the ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_library"),". If you specify as\nyour build target the ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_library")," itself, the build targets\nthat the ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_library")," depends on ",(0,i.mdx)("em",{parentName:"p"},"might not be built"),"."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that includes a single .cpp file and its corresponding header and\n# also supplies an additional flag for compilation.\ncxx_library(\n  name = 'fileutil',\n  srcs = [\n    'fileutil.cpp',\n  ],\n  exported_headers = [\n    'fileutil.h',\n  ],\n  compiler_flags = [\n    '-fno-omit-frame-pointer',\n  ],\n)\n\n# A rule that defines explicit names for its headers\ncxx_library(\n  name = 'mathutils',\n  header_namespace = 'math',\n  srcs = [\n    'trig/src/cos.cpp',\n    'trig/src/tan.cpp',\n  ],\n  exported_headers = {\n    # These are included as <math/trig/cos.h> and <math/trig/tan.h>\n    'trig/cos.h': 'trig/include/cos.h',\n    'trig/tan.h': 'trig/include/tan.h',\n  },\n  compiler_flags = [\n    '-fno-omit-frame-pointer',\n  ],\n)\n\n# A rule that uses different headers and sources per platform\ncxx_library(\n  name = 'vector',\n  # Because of platform_headers, this file can include \"config.h\"\n  # and get the architecture specific header\n  srcs = ['vector.cpp'],\n  platform_srcs = [\n    ('.*armv7$', 'armv7.S'),\n    ('.*x86_64$', 'x86_64.S'),\n  ],\n  exported_headers = [\n    'vector.h',\n  ],\n  platform_headers = [\n    (\n      '.*armv7$',\n      {\n        'config.h': 'config-armv7.h',\n      }\n    ),\n    (\n      '.*x86_64$',\n      {\n        'config.h': 'config-x86_64.h',\n      }\n    ),\n  ],\n)\n\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"cxx_lua_extension"},"cxx","_","lua","_","extension"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def cxx_lua_extension(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    base_module: [None, str.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    executable_name: [None, str.type] = _,\n    frameworks: [str.type] = _,\n    header_namespace: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    prefix_header: [None, str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    raw_headers: [str.type] = _,\n    srcs: [[str.type, (str.type, [str.type])]] = _,\n    version_universe: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A cxx","_","lua","_","extension() rule is a variant of a C/C++ library which is built as a Lua module. As such, it has a module name formed by the ",(0,i.mdx)("inlineCode",{parentName:"p"},"base_module")," parameter and the rule name and implicitly depends on Lua C library (configured via the ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig")," parameter."),(0,i.mdx)("h4",{id:"parameters-34"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"base_module"),": The package for which the given specified sources and resources should reside in their final location in the top-level binary. If unset, the project relative directory that houses the BUCK file is used."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": Flags to use when compiling any of the above sources (which require compilation)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),": A path prefix when including headers of this target. Defaults to the path from the root of the repository to the directory where this target is defined. Can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"), but cannot start with one. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"headers"),": The set of header files that are made available for inclusion to the source files in this target. These should be specified as either a list of header files or a dictionary of header names to header files. The header name can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). The headers can be included with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#include "$HEADER_NAMESPACE/$HEADER_NAME"')," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include <$HEADER_NAMESPACE/$HEADER_NAME>")," , where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAMESPACE")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),"  attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the header name if specified, and the filename of the header file otherwise. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Flags to add to the linker command line whenever the output from this rule is used in a link operation, such as linked into an executable or a shared library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_compiler_flags"),": Platform specific compiler flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when compiling the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_headers"),": Platform specific header files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of header files or a dictionary of header names to header files that will be made available for inclusion to the source files in the target if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_linker_flags"),": Platform-specific linker flags. This argument is specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The second element in each pair is a list of linker flags. If the regex matches the platform, these flags are added to the linker command line when the output from this rule is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_preprocessor_flags"),": Platform specific preprocessor flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when preprocessing the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_srcs"),": Platform specific source files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of source files or a list of tuples of source files and a list of compilation flags to be preprocessed, compiled and assembled if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags"),": Flags to use when preprocessing any of the above sources (which require preprocessing)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of C, C++, Objective-C, Objective-C++, or assembly source files to be preprocessed, compiled, and assembled by this rule. We determine which stages to run on each input source based on its file extension. See the ",(0,i.mdx)("a",{parentName:"li",href:"https://gcc.gnu.org/onlinedocs/gcc/Overall-Options.html"},"GCC documentation")," for more detail on how file extensions are interpreted. Each element can be either a string specifying a source file (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"''"),") or a tuple of a string specifying a source file and a list of compilation flags (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"('', ['-Wall', '-Werror'])")," ). In the latter case the specified flags will be used in addition to the rule's other flags when preprocessing and compiling that file (if applicable).")),(0,i.mdx)("h4",{id:"details-23"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that builds a Lua extension from a single .cpp file.\ncxx_lua_extension(\n  name = 'mymodule',\n  base_module = 'foo.bar',\n  srcs = [\n    'mymodule.cpp',\n  ],\n  compiler_flags = [\n    '-fno-omit-frame-pointer',\n  ],\n)\n\n# A library rule which has a single source importing the above extension.\nlua_library(\n  name = 'utils',\n  srcs = [\n    'utils.lua',\n  ],\n  deps = [\n    ':mymodule',\n  ],\n)\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n-- The `utils.lua` source, wrapped by the `utils` rule above.\n\n-- Import the C/C++ extension build above.\nrequire "foo.bar.mymodule"\n\n...\n\n')),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"cxx_precompiled_header"},"cxx","_","precompiled","_","header"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def cxx_precompiled_header(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    src: str.type,\n    version_universe: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_precompiled_header")," rule specifies a single header file that can be precompiled and made available for use in other build rules such as a ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx\\_library()"),"or a ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx\\_binary()"),"."),(0,i.mdx)("h4",{id:"parameters-35"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Dependency rules which export headers used by the header specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},"src"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"src"),": The path to the header file that should be precompiled. Only one header file can be specified. But of course this header could include any number of other headers. The included headers could belong to -- that is, be ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_headers")," from -- another rule, in which case, the rule would have to be added to ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps")," as usual.")),(0,i.mdx)("h4",{id:"details-24"},"Details"),(0,i.mdx)("p",null,"This header file is precompiled by the preprocessor on behalf of the\nC, C++, Objective-C, or Objective-C++ rule using it, via its ",(0,i.mdx)("inlineCode",{parentName:"p"},"precompiled_header")," parameter.\nAfterwards the precompiled header is applied during the rule's own compilation\n(often with an appreciable reduction in build time, the main benefit of PCH)."),(0,i.mdx)("p",null,' This PCH is built once per combination of build flags which might affect the PCH\'s compatibility.\nFor example, a distinct pre-compilation of the header occurs per combination of flags related to\noptimization, debug, architecture, and so on, used by rules which employ PCH.\nThe flags used during the build of the dependent rule (that is, the "PCH-using rule")\nare in effect while building the PCH itself. Similarly, to the same end, the include paths used\nwhen building the PCH are applied to the dependent rule. For example, ',(0,i.mdx)("inlineCode",{parentName:"p"},"deps")," in the\nPCH rule are propagated back to the dependent rule, and the PCH's header search paths\n(e.g. ",(0,i.mdx)("inlineCode",{parentName:"p"},"-I")," or ",(0,i.mdx)("inlineCode",{parentName:"p"},"-isystem")," options) are prefixed onto the list of\ninclude paths for the dependent rule."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"The best way to see how the ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_precompiled_header()")," rule works is with an\nexample. Let there be a header called ",(0,i.mdx)("inlineCode",{parentName:"p"},"common.h")," which has the following:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n#pragma once\n\n/* Include common C++ files. */\n#include <string>\n#include <map>\n#include <set>\n#include <type_traits>\n#include <vector>\n\n/* Some frequently-used headers from the Folly project. */\n#include <folly/Conv.h>\n#include <folly/Executor.h>\n#include <folly/io/async/EventBase.h>\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\ncxx_precompiled_header(\n  name = 'common_pch',\n  src = 'common.h',\n  deps = [\n    # Needed for standard C++ headers:\n    '//external/libcxx:headers',\n    # Needed for the Folly includes:\n    '//folly:folly',\n    '//folly/io/async:async',\n  ],\n)\n\ncxx_binary(\n  name = 'main',\n  srcs = ['main.cpp'],\n  precompiled_header = ':common_pch',\n  deps = [ ... ],\n  compiler_flags = ['-g', '-O2', '-fPIC'],\n)\n\n")),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_precompiled_header"),' rule declares a precompiled header "template"\ncontaining the header file path, and dependencies.\nIn this example we indicate that ',(0,i.mdx)("inlineCode",{parentName:"p"},"common.h")," is to be precompiled when used by another build rule."),(0,i.mdx)("p",null,"Note that, by itself, this ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_precompiled_header")," rule will not result\nin anything being built. The ",(0,i.mdx)("em",{parentName:"p"},"usage"),' of this rule from another rule --\nan "instantiation" of this precompiled header template -- is what will trigger the\nPCH build.'),(0,i.mdx)("p",null,"In the example above, the build for the binary named ",(0,i.mdx)("inlineCode",{parentName:"p"},'"main"')," will depend on\nthe header being precompiled in a separate step, prior to compiling ",(0,i.mdx)("inlineCode",{parentName:"p"},"main.cpp"),",\nand the resulting PCH will be used in ",(0,i.mdx)("inlineCode",{parentName:"p"},"main"),"'s compilation."),(0,i.mdx)("p",null,"The dependencies specified in this precompiled header rule's ",(0,i.mdx)("inlineCode",{parentName:"p"},"deps")," are transitive; they\nwill propagate to rules using this PCH, so that during link time, any libraries which are\nrequired by the code made available in the header will be included in the final binary build."),(0,i.mdx)("p",null,'The precompiled header dynamically created from the "template" will be built with flags\nwhich would be used in the dependent rule. In this case, ',(0,i.mdx)("inlineCode",{parentName:"p"},"main"),"'s use of specific\ncompiler flags ",(0,i.mdx)("inlineCode",{parentName:"p"},"-g -O2 -fPIC")," will result in the production of a precompiled header\nwith the same flags. This is so the precompiled code fully jives with rules using the PCH,\ni.e. they will have the same debug, optimization, CPU, etc. options. (The compiler is usually\nsmart enough to reject a bad PCH, fortunately. But we want to ensure we take the appropriate\nsteps to ensure we ",(0,i.mdx)("em",{parentName:"p"},"always have")," a PCH which works with any build that uses it.)"),(0,i.mdx)("p",null,"Another effect of a rule using a precompiled header is that the rule's list of\nbuild flags will change; not just to employ PCH with e.g. ",(0,i.mdx)("inlineCode",{parentName:"p"},"-include-pch"),' (if using Clang), but also, to alter the sequence of header search paths.\nThe rule using the precompiled header will "inherit" the lists of paths used\nduring the PCH build, applying them ',(0,i.mdx)("em",{parentName:"p"},"first")," in its own search paths.\nThis is to ensure that an ",(0,i.mdx)("inlineCode",{parentName:"p"},"#include")," directive will resolve in exactly\nthe same way in this build as it would have in the PCH, to ensure full compatibility\nbetween the PCH and other rule's builds. For example, if the PCH were to use one version\nof ",(0,i.mdx)("inlineCode",{parentName:"p"},"stdcxx")," and another rule use a different version, the version differences\nwon't clash, thereby avoiding different versions of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"<cstring>")," header\nused between the precompiled header and the dependent rule, and preventing confused\nstructure definitions, ABI incompatibility, and so on (catastrophe, in other words)."),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"cxx_python_extension"},"cxx","_","python","_","extension"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def cxx_python_extension(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_hacks: str.type = _,\n    _cxx_toolchain: str.type = _,\n    _omnibus_environment: [None, str.type] = _,\n    _python_toolchain: str.type = _,\n    _target_os_type: str.type = _,\n    allow_embedding: bool.type = _,\n    allow_suffixing: bool.type = _,\n    auto_link_groups: bool.type = _,\n    base_module: [None, str.type] = _,\n    bridging_header: [None, str.type] = _,\n    can_be_asset: [None, bool.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    devirt_enabled: bool.type = _,\n    diagnostics: {str.type: str.type} = _,\n    executable_name: [None, str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_header_style: str.type = _,\n    exported_headers: [[str.type], {str.type: str.type}] = _,\n    exported_lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    exported_lang_preprocessor_flags: {str.type: [str.type]} = _,\n    exported_linker_flags: [str.type] = _,\n    exported_platform_deps: [(str.type, [str.type])] = _,\n    exported_platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    exported_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    exported_post_linker_flags: [str.type] = _,\n    exported_post_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_preprocessor_flags: [str.type] = _,\n    extra_xcode_files: [str.type] = _,\n    extra_xcode_sources: [str.type] = _,\n    fat_lto: bool.type = _,\n    focused_list_target: [None, str.type] = _,\n    force_static: [None, bool.type] = _,\n    frameworks: [str.type] = _,\n    header_namespace: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    include_in_android_merge_map_output: bool.type = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_group: [None, str.type] = _,\n    link_group_map: [None, [(str.type, [(str.type, str.type, [None, str.type])])]] = _,\n    link_ordering: [None, str.type] = _,\n    link_style: [None, str.type] = _,\n    link_whole: bool.type = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    module_name: [None, str.type] = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    preferred_linkage: str.type = _,\n    prefix_header: [None, str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    public_include_directories: [str.type] = _,\n    public_system_include_directories: [str.type] = _,\n    raw_headers: [str.type] = _,\n    reexport_all_header_dependencies: [None, bool.type] = _,\n    resources: [[str.type], {str.type: str.type}] = _,\n    sdk_modules: [str.type] = _,\n    soname: [None, str.type] = _,\n    srcs: [[str.type, (str.type, [str.type])]] = _,\n    static_library_basename: [None, str.type] = _,\n    suffix_all: bool.type = _,\n    support_shlib_interfaces: bool.type = _,\n    supported_platforms_regex: [None, str.type] = _,\n    supports_merged_linking: [None, bool.type] = _,\n    thin_lto: bool.type = _,\n    type_stub: [None, str.type] = _,\n    use_archive: [None, bool.type] = _,\n    used_by_wrap_script: bool.type = _,\n    uses_cxx_explicit_modules: bool.type = _,\n    uses_explicit_modules: bool.type = _,\n    version_universe: [None, str.type] = _,\n    weak_framework_names: [str.type] = _,\n    xcode_private_headers_symlinks: [None, bool.type] = _,\n    xcode_public_headers_symlinks: [None, bool.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_python_extension()")," rule is a variant of a C/C++ library which is built as a Python module. As such, it has a module name formed by the ",(0,i.mdx)("inlineCode",{parentName:"p"},"base_module")," parameter and the rule name."),(0,i.mdx)("h4",{id:"parameters-36"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"base_module"),": The package in which the specified source files and resources should reside in their final location in the top-level binary. If unset, Buck uses the project-relative directory that contains the BUCK file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": Flags to use when compiling any of the above sources (which require compilation)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Other rules that list ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," from which this rule imports."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),": A path prefix when including headers of this target. Defaults to the path from the root of the repository to the directory where this target is defined. Can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"), but cannot start with one. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"headers"),": The set of header files that are made available for inclusion to the source files in this target. These should be specified as either a list of header files or a dictionary of header names to header files. The header name can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). The headers can be included with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#include "$HEADER_NAMESPACE/$HEADER_NAME"')," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include <$HEADER_NAMESPACE/$HEADER_NAME>")," , where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAMESPACE")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),"  attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the header name if specified, and the filename of the header file otherwise. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": Set of arbitrary strings which allow you to annotate a ",(0,i.mdx)("inlineCode",{parentName:"li"},"build rule"),"with tags that can be searched for over an entire dependency tree using ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck query()")," ."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be either ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),". Note: since shared libraries re-export its dependencies, depending on multiple shared libraries which themselves have overlapping static dependencies may cause problems if they init using global state."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_extra_outputs"),": Declares extra outputs that the linker emits. These identifiers can be used in ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(output ...)")," macros in ",(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags")," to interpolate the output path into the linker command line. Useful for custom linkers that emit extra output files."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Flags to add to the linker command line whenever the output from this rule is used in a link operation, such as linked into an executable or a shared library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_compiler_flags"),": Platform specific compiler flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when compiling the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_headers"),": Platform specific header files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of header files or a dictionary of header names to header files that will be made available for inclusion to the source files in the target if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_linker_flags"),": Platform-specific linker flags. This argument is specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The second element in each pair is a list of linker flags. If the regex matches the platform, these flags are added to the linker command line when the output from this rule is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_preprocessor_flags"),": Platform specific preprocessor flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when preprocessing the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_srcs"),": Platform specific source files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of source files or a list of tuples of source files and a list of compilation flags to be preprocessed, compiled and assembled if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags"),": Flags to use when preprocessing any of the above sources (which require preprocessing)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of C, C++, Objective-C, Objective-C++, or assembly source files to be preprocessed, compiled, and assembled by this rule. We determine which stages to run on each input source based on its file extension. See the ",(0,i.mdx)("a",{parentName:"li",href:"https://gcc.gnu.org/onlinedocs/gcc/Overall-Options.html"},"GCC documentation")," for more detail on how file extensions are interpreted. Each element can be either a string specifying a source file (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"''"),") or a tuple of a string specifying a source file and a list of compilation flags (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"('', ['-Wall', '-Werror'])")," ). In the latter case the specified flags will be used in addition to the rule's other flags when preprocessing and compiling that file (if applicable).")),(0,i.mdx)("h4",{id:"details-25"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that builds a Python extension from a single .cpp file.\ncxx_python_extension(\n  name = 'mymodule',\n  base_module = 'foo.bar',\n  srcs = [\n    'mymodule.cpp',\n  ],\n)\n\n# A library rule which has a single source importing the above extension.\npython_library(\n  name = 'utils',\n  srcs = [\n    'utils.py',\n  ],\n  deps = [\n    ':mymodule',\n  ],\n)\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n## The `utils.py` source, wrapped by the `utils` rule above.\n\n## Import the C/C++ extension build above.\nfrom foo.bar import mymodule\n\n...\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"cxx_test"},"cxx","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def cxx_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_hacks: str.type = _,\n    _cxx_toolchain: str.type = _,\n    _inject_test_env: str.type = _,\n    additional_coverage_targets: [str.type] = _,\n    args: [str.type] = _,\n    auto_link_groups: bool.type = _,\n    binary_linker_flags: [str.type] = _,\n    bolt_flags: [str.type] = _,\n    bolt_gdb_index: [None, str.type] = _,\n    bolt_profile: [None, str.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    devirt_enabled: bool.type = _,\n    enable_distributed_thinlto: bool.type = _,\n    env: {str.type: str.type} = _,\n    executable_name: [None, str.type] = _,\n    fat_lto: bool.type = _,\n    focused_list_target: [None, str.type] = _,\n    framework: [None, str.type] = _,\n    frameworks: [str.type] = _,\n    header_namespace: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_deps_query_whole: bool.type = _,\n    link_execution_preference: [None, str.type] = _,\n    link_group: [None, str.type] = _,\n    link_group_map: [None, str.type, [(str.type, [([None, str.type], str.type, [None, str.type, [str.type]], [None, str.type])], [None, {str.type: ""}])]] = _,\n    link_group_min_binary_node_count: [None, int.type] = _,\n    link_ordering: [None, str.type] = _,\n    link_style: [None, str.type] = _,\n    link_whole: bool.type = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    prefer_stripped_objects: bool.type = _,\n    prefix_header: [None, str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    raw_headers: [str.type] = _,\n    remote_execution: [None, {str.type: [None, bool.type, str.type, {str.type: str.type}]}] = _,\n    resources: [[str.type], {str.type: str.type}] = _,\n    run_test_separately: [None, bool.type] = _,\n    srcs: [[str.type, (str.type, [str.type])]] = _,\n    test_rule_timeout_ms: [None, int.type] = _,\n    thin_lto: bool.type = _,\n    use_default_test_main: [None, bool.type] = _,\n    version_universe: [None, str.type] = _,\n    weak_framework_names: [str.type] = _\n) -> None\n')),(0,i.mdx)("p",null,"A cxx","_","test() rule builds a C/C++ binary against a C/C++ testing framework and runs it as part of ",(0,i.mdx)("inlineCode",{parentName:"p"},"test"),"."),(0,i.mdx)("h4",{id:"parameters-37"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"args"),": A list of additional arguments to pass to the test when it's run.")),(0,i.mdx)("p",null,"It is also possible to expand references to other rules within these\narguments, using builtin ",(0,i.mdx)("inlineCode",{parentName:"p"},"string parameter macros"),"\n:"),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(location //path/to:target)"),"\nExpands to the location of the output of the build rule. This\nmeans that you can refer to these without needing to be aware of how\nBuck is storing data on the disk mid-build."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"compiler_flags"),": Flags to use when compiling any of the above sources (which require compilation).")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"deps_query"),": Status: ",(0,i.mdx)("strong",{parentName:"p"},"experimental/unstable"),". The deps query takes a query string that accepts the following query functions, and appends the output of the query to the declared deps:")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"attrfilter"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"deps"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"except"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"intersect"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"filter"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"kind"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"set"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"union")))),(0,i.mdx)("p",null," The macro ",(0,i.mdx)("inlineCode",{parentName:"p"},"$declared_deps")," may be used anywhere a target literal pattern is expected\nin order to refer to the explicit deps of this rule as they appear in the rule's definition.\nFor example, if your build rule declares"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n  android_library(\n    name = 'lib',\n    deps = ['//foo:foo'],\n    deps_query = '$declared_deps',\n  )\n")),(0,i.mdx)("p",null," then the macro ",(0,i.mdx)("inlineCode",{parentName:"p"},"$declared_deps")," would be expanded to a\nliteral ",(0,i.mdx)("inlineCode",{parentName:"p"},"set(//foo:foo)"),".\nSome example queries:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n  "filter({name_regex}, $declared_deps)".format(name_regex=\'//.*\')\n  "attrfilter(annotation_processors, com.foo.Processor, $declared_deps)"\n  "deps(\'//foo:foo\', 1)"\n')),(0,i.mdx)("p",null," Note: any targets included in this query must also be present in ",(0,i.mdx)("inlineCode",{parentName:"p"},"deps"),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": A map of environment names and values to set when running the test.")),(0,i.mdx)("p",null,"It is also possible to expand references to other rules within the ",(0,i.mdx)("strong",{parentName:"p"},"values")," of\nthese environment variables, using builtin ",(0,i.mdx)("inlineCode",{parentName:"p"},"string parameter macros"),"\n:"),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(location //path/to:target)"),"\nExpands to the location of the output of the build rule. This\nmeans that you can refer to these without needing to be aware of how\nBuck is storing data on the disk mid-build."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"framework"),": Unused."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"headers"),": The set of header files that are made available for inclusion to the source files in this target. These should be specified as either a list of header files or a dictionary of header names to header files. The header name can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). The headers can be included with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#include "$HEADER_NAMESPACE/$HEADER_NAME"')," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include <$HEADER_NAMESPACE/$HEADER_NAME>")," , where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAMESPACE")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),"  attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the header name if specified, and the filename of the header file otherwise. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"include_directories"),": A list of include directories (with ",(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers"),") to be added to the compile command for compiling this target (via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-I"),"). An include directory is relative to the current package."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_execution_preference"),": The execution preference for linking. Options are:")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"any : No preference is set, and the link action will be performed based on buck2's executor configuration."),(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"full_hybrid : The link action will execute both locally and remotely, regardless of buck2's executor configuration (if"),(0,i.mdx)("pre",{parentName:"li"},(0,i.mdx)("code",{parentName:"pre"},"          the executor is capable of hybrid execution). The use_limited_hybrid setting of the hybrid executor is ignored.\n"))),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local : The link action will execute locally if compatible on current host platform.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"local_only : The link action will execute locally, and error if the current platform is not compatible.")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"remote : The link action will execute remotely if a compatible remote platform exists, otherwise locally."))))),(0,i.mdx)("p",null,"The default is None, expressing that no preference has been set on the target itself."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Flags to add to the linker command line whenever the output from this rule is used in a link operation, such as linked into an executable or a shared library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags"),": Flags to use when preprocessing any of the above sources (which require preprocessing)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers"),": The set of header files that can be used for inclusion to the source files in the target and all targets that transitively depend on it. Buck doesn't add raw headers to the search path of a compiler/preprocessor automatically. ",(0,i.mdx)("inlineCode",{parentName:"li"},"include_directories")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"public_include_directories")," are the recommended way to add raw headers to the search path (they will be added via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-I"),"). ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"preprocessor_flags")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_preprocessor_flags")," can also be used to add such raw headers to the search path if inclusion via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-isystem")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"-iquote")," is needed. ",(0,i.mdx)("inlineCode",{parentName:"li"},"raw_headers")," cannot be used together with ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_headers")," in the same target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of C, C++, Objective-C, Objective-C++, or assembly source files to be preprocessed, compiled, and assembled by this rule. We determine which stages to run on each input source based on its file extension. See the ",(0,i.mdx)("a",{parentName:"li",href:"https://gcc.gnu.org/onlinedocs/gcc/Overall-Options.html"},"GCC documentation")," for more detail on how file extensions are interpreted. Each element can be either a string specifying a source file (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"''"),") or a tuple of a string specifying a source file and a list of compilation flags (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"('', ['-Wall', '-Werror'])")," ). In the latter case the specified flags will be used in addition to the rule's other flags when preprocessing and compiling that file (if applicable)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"test_rule_timeout_ms"),": If set specifies the maximum amount of time (in milliseconds) in which all of the tests in this rule should complete. This overrides the default ",(0,i.mdx)("inlineCode",{parentName:"li"},"rule_timeout")," if any has been specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig")," .")),(0,i.mdx)("h4",{id:"details-26"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that builds and runs C/C++ test using gtest.\ncxx_test(\n  name = 'echo_test',\n  srcs = [\n    'echo_test.cpp',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"cxx_toolchain"},"cxx","_","toolchain"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def cxx_toolchain(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _dep_files_processor: str.type = _,\n    _dist_lto_tools: str.type = _,\n    _mk_comp_db: str.type = _,\n    _mk_hmap: str.type = _,\n    _msvc_hermetic_exec: str.type = _,\n    archive_contents: str.type = _,\n    archiver: str.type,\n    archiver_flags: [str.type] = _,\n    archiver_supports_argfiles: bool.type = _,\n    archiver_type: str.type,\n    asm_compiler: [None, str.type] = _,\n    asm_compiler_flags: [str.type] = _,\n    asm_compiler_type: [None, str.type] = _,\n    asm_preprocessor: [None, str.type] = _,\n    asm_preprocessor_flags: [str.type] = _,\n    asm_preprocessor_type: [None, str.type] = _,\n    assembler: str.type,\n    assembler_flags: [str.type] = _,\n    assembler_preprocessor: [None, str.type] = _,\n    assembler_preprocessor_flags: [str.type] = _,\n    assembler_preprocessor_type: [None, str.type] = _,\n    assembler_type: [None, str.type] = _,\n    binary_extension: [None, str.type] = _,\n    bolt_enabled: bool.type = _,\n    c_compiler: str.type,\n    c_compiler_flags: [str.type] = _,\n    c_compiler_type: [None, str.type] = _,\n    c_preprocessor_flags: [str.type] = _,\n    cache_links: bool.type = _,\n    clang_trace: [None, bool.type] = _,\n    compiler_type: [None, str.type] = _,\n    conflicting_header_basename_exemptions: [str.type] = _,\n    contacts: [str.type] = _,\n    cpp_dep_tracking_mode: str.type = _,\n    cuda_compiler: [None, str.type] = _,\n    cuda_compiler_flags: [str.type] = _,\n    cuda_compiler_type: [None, str.type] = _,\n    cuda_dep_tracking_mode: str.type = _,\n    cuda_preprocessor_flags: [str.type] = _,\n    cxx_compiler: str.type,\n    cxx_compiler_flags: [str.type] = _,\n    cxx_compiler_type: [None, str.type] = _,\n    cxx_preprocessor_flags: [str.type] = _,\n    debug_path_prefix_map_sanitizer_format: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    detailed_untracked_header_messages: bool.type = _,\n    filepath_length_limited: bool.type = _,\n    generate_linker_maps: bool.type = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    headers_whitelist: [str.type] = _,\n    hip_compiler: [None, str.type] = _,\n    hip_compiler_flags: [str.type] = _,\n    hip_compiler_type: [None, str.type] = _,\n    hip_preprocessor_flags: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    link_ordering: str.type = _,\n    link_path_normalization_args_enabled: bool.type = _,\n    linker: str.type,\n    linker_flags: [str.type] = _,\n    linker_type: str.type,\n    llvm_link: [None, str.type] = _,\n    lto_mode: str.type = _,\n    nm: str.type,\n    objcopy_for_shared_library_interface: str.type,\n    objcopy_recalculates_layout: bool.type = _,\n    object_file_extension: str.type = _,\n    object_format: str.type = _,\n    pic_behavior: str.type = _,\n    pic_type_for_shared_linking: str.type = _,\n    placeholder_tool: [None, str.type] = _,\n    platform_name: [None, str.type] = _,\n    private_headers_symlinks_enabled: bool.type = _,\n    public_headers_symlinks_enabled: bool.type = _,\n    ranlib: [None, str.type] = _,\n    ranlib_flags: [str.type] = _,\n    requires_archives: bool.type = _,\n    requires_objects: bool.type = _,\n    shared_dep_runtime_ld_flags: [str.type] = _,\n    shared_library_extension: str.type = _,\n    shared_library_interface_flags: [str.type] = _,\n    shared_library_interface_type: str.type,\n    shared_library_versioned_extension_format: str.type = _,\n    split_debug_mode: str.type = _,\n    static_dep_runtime_ld_flags: [str.type] = _,\n    static_library_extension: str.type = _,\n    static_pic_dep_runtime_ld_flags: [str.type] = _,\n    strip: str.type,\n    strip_all_flags: [None, [str.type]] = _,\n    strip_debug_flags: [None, [str.type]] = _,\n    strip_non_global_flags: [None, [str.type]] = _,\n    supports_distributed_thinlto: bool.type = _,\n    use_archiver_flags: bool.type = _,\n    use_arg_file: bool.type = _,\n    use_dep_files: [None, bool.type] = _,\n    use_header_map: bool.type = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-38"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"d_binary"},"d","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def d_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    linker_flags: [str.type] = _,\n    srcs: [[str.type], {str.type: str.type}] = _\n) -> None\n")),(0,i.mdx)("p",null,"A d","_","binary() rule builds a native executable from the supplied set of D source files and dependencies."),(0,i.mdx)("h4",{id:"parameters-39"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Each element should be a string specifying a d","_","library rule defined elsewhere (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"':foo'")," or '//foo:bar')."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": The list of flags to be passed to the linker. Each element should be a string specifying a linker flag (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"'--as-needed'"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of D source files to be compiled by this rule. Each element should be a string specifying a source file (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"'foo/bar.d'"),").")),(0,i.mdx)("h4",{id:"details-27"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that builds a D native executable from a single .d file\n# and a library dependency.\nd_binary(\n  name='greet',\n  srcs=[\n    'greet.d',\n  ],\n  deps=[\n    ':greeting',\n  ],\n)\n\nd_library(\n  name='greeting',\n  srcs=[\n    'greeting.d',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\nd_library(\n  name='join',\n  srcs=[\n    'join.d',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"d_library"},"d","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def d_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    linker_flags: [str.type] = _,\n    srcs: [[str.type], {str.type: str.type}] = _\n) -> None\n")),(0,i.mdx)("p",null,"A d","_","library() rule represents a set of D source files."),(0,i.mdx)("h4",{id:"parameters-40"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Each element should be a string specifying a d","_","library rule defined elsewhere (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"':foo'")," or '//foo:bar')."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of D source files to be compiled by this rule. Each element should be a string specifying a source file (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"'foo/bar.d'"),").")),(0,i.mdx)("h4",{id:"details-28"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A simple library with a single source file and a single dependency.\nd_library(\n  name='greeting',\n  srcs=[\n    'greeting.d',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\nd_library(\n  name='join',\n  srcs=[\n    'join.d',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"d_test"},"d","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def d_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    linker_flags: [str.type] = _,\n    srcs: [[str.type], {str.type: str.type}] = _,\n    test_rule_timeout_ms: [None, int.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"d_test()")," rule is used to define a set of D source files that contain tests to run via D's unittest support. The source code of the test must provide a main() function."),(0,i.mdx)("h4",{id:"parameters-41"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Each element should be a string specifying a d","_","library rule defined elsewhere (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"':foo'")," or '//foo:bar')."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": A list of labels to be applied to these tests. These labels are arbitrary text strings and have no meaning within buck itself. They can, however, have meaning for you as a test author (e.g., ",(0,i.mdx)("inlineCode",{parentName:"li"},"smoke")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"fast"),"). A label can be used to filter or include a specific ",(0,i.mdx)("inlineCode",{parentName:"li"},"d_test()")," rule when executing ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck test")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of D source files to be compiled by this rule. Each element should be a string specifying a source file (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"'foo/bar.d'"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"test_rule_timeout_ms"),": If set specifies the maximum amount of time (in milliseconds) in which all of the tests in this rule should complete. This overrides the default ",(0,i.mdx)("inlineCode",{parentName:"li"},"rule_timeout")," if any has been specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig")," .")),(0,i.mdx)("h4",{id:"details-29"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that builds and runs D test with a single source file.\nd_test(\n  name = 'test',\n  srcs = [\n    'test.d',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"erlang_app"},"erlang","_","app"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def erlang_app(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _toolchain: str.type = _,\n    app_src: [None, str.type] = _,\n    applications: [str.type] = _,\n    build_edoc_chunks: bool.type = _,\n    contacts: [str.type] = _,\n    env: [None, {str.type: str.type}] = _,\n    erl_opts: [None, [str.type]] = _,\n    extra_includes: [str.type] = _,\n    included_applications: [str.type] = _,\n    includes: [str.type] = _,\n    labels: [str.type] = _,\n    metadata: [None, {str.type: [str.type, [str.type]]}] = _,\n    mod: [None, (str.type, [str.type])] = _,\n    os_env: [None, {str.type: str.type}] = _,\n    resources: [str.type] = _,\n    shell_configs: [str.type] = _,\n    shell_libs: [str.type] = _,\n    srcs: [str.type] = _,\n    use_global_parse_transforms: bool.type = _,\n    version: str.type = _\n) -> None\n")),(0,i.mdx)("p",null,"This rule is the main rule for Erlang applications. It gets generated by using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_application")," macro, that takes as attributes the same attributes as this rule. You should always use the ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_application")," macro instead of using this rule directly."),(0,i.mdx)("h4",{id:"parameters-42"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"app_src"),": The ",(0,i.mdx)("inlineCode",{parentName:"li"},"app_src")," field allows to optionally reference a ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.app.src")," template file. This template file will then be used by buck2 to generate the ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.app")," output file in the applications ",(0,i.mdx)("inlineCode",{parentName:"li"},"ebin/")," directory. This is useful during the migration from rebar3 to buck2 to avoid duplicated entries, of e.g. the ",(0,i.mdx)("inlineCode",{parentName:"li"},"version"),".")),(0,i.mdx)("p",null,"Buck2 will use or check all fields present in the template, and fill out the fields with the information provided in the\ntarget, e.g. if the ",(0,i.mdx)("inlineCode",{parentName:"p"},"version")," is specified in both, buck2 will check that they are identical. Otherwise, it uses the\ninformation from the template if the target doesn't specify it, and vice versa."),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"NOTE"),": ",(0,i.mdx)("em",{parentName:"p"},"If you use the ",(0,i.mdx)("inlineCode",{parentName:"em"},"app_src")," field and the references application resource file template specifies ",(0,i.mdx)("inlineCode",{parentName:"em"},"applications"),"\nor ",(0,i.mdx)("inlineCode",{parentName:"em"},"included_applications")," buck2 checks that the target definitions and information in the template are equivalent to\nprevent these definitions from drifting apart during migration.")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"applications"),": Equivalent to the corresponding ",(0,i.mdx)("inlineCode",{parentName:"li"},"applications")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"included_applications")," fields you will find in ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.app.src")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.app")," files and specify the application dependencies. Contrary to the fields in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.app.src")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.app")," files, ",(0,i.mdx)("strong",{parentName:"li"},"it is necessary to use target paths to the application")," where a dependency is desired. These fields will be used to construct equally named fields in the generated ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.app")," file for the application.")),(0,i.mdx)("p",null,"OTP applications are specified with the target path ",(0,i.mdx)("inlineCode",{parentName:"p"},"otp//:<application>"),"."),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"NOTE"),": ",(0,i.mdx)("em",{parentName:"p"},"If you use the ",(0,i.mdx)("inlineCode",{parentName:"em"},"app_src")," field and the references application resource file template specifies\n",(0,i.mdx)("inlineCode",{parentName:"em"},"applications")," or ",(0,i.mdx)("inlineCode",{parentName:"em"},"included_applications")," buck2 checks that the target definitions and information in the template are\nequivalent to prevent these definitions from drifting apart during migration.")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"build_edoc_chunks"),": This attribute controls if the output of the builds also create edoc chunks."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": The ",(0,i.mdx)("inlineCode",{parentName:"li"},"env")," field allows to set the application env variables. The key value pairs will materialise in tha applications ",(0,i.mdx)("inlineCode",{parentName:"li"},".app")," file and can then be accessed by ",(0,i.mdx)("a",{parentName:"li",href:"https://www.erlang.org/doc/man/application.html#get_env-2"},(0,i.mdx)("inlineCode",{parentName:"a"},"application:get_env/2")),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"erl_opts"),": Typically compile options are managed by global config files, however, sometimes it is desirable to overwrite the pre-defined compile options. The ",(0,i.mdx)("inlineCode",{parentName:"li"},"erl_opts")," field allows developers to do so for individual applications.")),(0,i.mdx)("p",null,"The main use-case are the applications listed in ",(0,i.mdx)("inlineCode",{parentName:"p"},"third-party/"),". This option should not be used by other applications\nwithout consultation. Please ask in the ",(0,i.mdx)("a",{parentName:"p",href:"https://fb.workplace.com/groups/728545201114362"},"WhatsApp Dev Infra Q&A"),"\nworkplace group for support."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_includes"),": In some cases we might have the situation, where an application ",(0,i.mdx)("inlineCode",{parentName:"li"},"app_a")," depends through the ",(0,i.mdx)("inlineCode",{parentName:"li"},"applications")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"included_applications")," fields on application ",(0,i.mdx)("inlineCode",{parentName:"li"},"app_b")," and a source file in ",(0,i.mdx)("inlineCode",{parentName:"li"},"app_b")," includes a header file from ",(0,i.mdx)("inlineCode",{parentName:"li"},"app_a")," (e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},'-include_lib("app_a/include/header.hrl'),"). This technically creates circular dependency from ",(0,i.mdx)("inlineCode",{parentName:"li"},"app_a")," to ",(0,i.mdx)("inlineCode",{parentName:"li"},"app_b")," (e.g. via ",(0,i.mdx)("inlineCode",{parentName:"li"},"applications")," field) and back from ",(0,i.mdx)("inlineCode",{parentName:"li"},"app_b")," to ",(0,i.mdx)("inlineCode",{parentName:"li"},"app_a")," (via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-include_lib"),"). To break the dependency developers can specify targets in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"extra_includes")," field, whose public include files are accessible to the application target during build time.")),(0,i.mdx)("p",null,"Only the includes of the specified application are available and eventual transitive dependencies need to be managed\nmanually."),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"NOTE"),": ",(0,i.mdx)("em",{parentName:"p"},"It is not possible (or even desired) to add OTP applications with this field.")),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"NOTE"),": ",(0,i.mdx)("em",{parentName:"p"},"This mechanism is added to circumvent unclean dependency relationships and the goal for\ndevelopers should be to reduce usages of this field.")," ",(0,i.mdx)("strong",{parentName:"p"},"DO NOT ADD ANY MORE USAGES!!")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"included_applications"),": Check the documentation for ",(0,i.mdx)("inlineCode",{parentName:"li"},"applications"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"includes"),": The public header files accessible via ",(0,i.mdx)("inlineCode",{parentName:"li"},'-include_lib("appname/include/header.hrl")')," from other erlang files."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"metadata"),": The metadata field can be used to specify extra key-value pairs which is are not defined in ",(0,i.mdx)("a",{parentName:"li",href:"https://www.erlang.org/doc/man/application.html#load-2"},"application_opt()"),". The key-value pair will be stored in the applications ",(0,i.mdx)("inlineCode",{parentName:"li"},".app")," file and can be accessed by ",(0,i.mdx)("inlineCode",{parentName:"li"},"file:consult/1"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"mod"),": The ",(0,i.mdx)("inlineCode",{parentName:"li"},"mod")," field specifies the equivalent field in the generated ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.app")," files. The format is similar, with the difference, that the module name, and the individual start arguments need to be given as the string representation of the corresponding Erlang terms."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"os_env"),": This attribute allows to set additional values for the operating system environment for invocations to the Erlang toolchain."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": The ",(0,i.mdx)("inlineCode",{parentName:"li"},"resources")," field specifies targets whose default output are placed in the applications ",(0,i.mdx)("inlineCode",{parentName:"li"},"priv/")," directory. For regular files this field is typically combined with ",(0,i.mdx)("inlineCode",{parentName:"li"},"export_file"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"filegroup"),", or similar targets. However, it is general, and any target can be used, e.g. if you want to place a built escript in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"priv/")," directory, you can use an ",(0,i.mdx)("inlineCode",{parentName:"li"},"erlang_escript")," target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"shell_configs"),": This attribute allows to set config files for the shell. The dependencies that are typically used here are ",(0,i.mdx)("inlineCode",{parentName:"li"},"export_file")," targets."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"shell_libs"),": This attribute allows to define additional dependencies for the shell. By default this is set to ",(0,i.mdx)("inlineCode",{parentName:"li"},'["prelude//erlang/shell:buck2_shell_utils"]')," which includes a ",(0,i.mdx)("inlineCode",{parentName:"li"},"user_default")," module that loads and compiles modules with buck2 mechanisms."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": A list of ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.erl"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.hrl"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.xrl"),", or ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.yrl")," source inputs that are typically located in an application's ",(0,i.mdx)("inlineCode",{parentName:"li"},"src/")," folder. Header files (i.e. ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.hrl")," files) specified in this field are considered application private headers, and can only be accessed by the ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.erl")," files of the application itself. ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.xrl")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.yrl")," files are processed into ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.erl")," files before all ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.erl")," files are compiled into ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.beam")," files."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"use_global_parse_transforms"),": This field indicates if global parse_tranforms should be applied to this application as well. It often makes sense for third-party dependencies to not be subjected to global parse_transforms, similar to OTP applications."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"version"),": The ",(0,i.mdx)("inlineCode",{parentName:"li"},"version")," field specifies the applications version that is materialized as ",(0,i.mdx)("inlineCode",{parentName:"li"},"vsn")," field in the generated ",(0,i.mdx)("inlineCode",{parentName:"li"},"*.app")," file. If you use the the ",(0,i.mdx)("inlineCode",{parentName:"li"},"app_src")," field and specify a version in the referenced template in addition to the version field, the versions need to be identical.")),(0,i.mdx)("p",null,"If no version is specified in either the ",(0,i.mdx)("inlineCode",{parentName:"p"},"app_src")," template or the ",(0,i.mdx)("inlineCode",{parentName:"p"},"version")," field, a fallback version string of\n",(0,i.mdx)("inlineCode",{parentName:"p"},'"1.0.0"')," is used."),(0,i.mdx)("h4",{id:"details-30"},"Details"),(0,i.mdx)("p",null,"Erlang Applications are the basic building block of our buck2 integration and used by many other Erlang\ntargets, e.g. ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_escript"),", ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_test"),", or ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_release"),"."),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_application")," targets build OTP applications and as such many attributes that are used have\nequivalent meaning to the fields in the currently (by rebar3) used ",(0,i.mdx)("inlineCode",{parentName:"p"},"*.app.src")," files and OTP ",(0,i.mdx)("inlineCode",{parentName:"p"},"*.app"),"\nfiles. Please familiarize yourself with the semantics of these fields by consulting the\n",(0,i.mdx)("a",{parentName:"p",href:"https://erlang.org/doc/man/app.html"},"OTP documentation"),"."),(0,i.mdx)("p",null,"The target enforces uniqueness during builds, and fails to build if duplicated artifacts in the\nglobal namespaces are detected:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"duplicated application names in the dependencies"),(0,i.mdx)("li",{parentName:"ul"},"duplicated module names across any of the applications or dependencies modules"),(0,i.mdx)("li",{parentName:"ul"},"ambiguity when resolving header files")),(0,i.mdx)("p",null,"The default output of this rule is the application folder of the target application and all transitive dependencies."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("h4",{id:"minimal-erlang-application"},"Minimal Erlang Application"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'erlang_application(\n    name = "minimal",\n)\n')),(0,i.mdx)("h4",{id:"with-priv-directory"},"With ",(0,i.mdx)("inlineCode",{parentName:"h4"},"priv/")," directory"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'erlang_application(\n    name = "app_a",\n    srcs = [\n        "src/app_a.erl",\n    ],\n    includes = [],\n    applications = [\n        ":app_b",\n    ],\n    app_src = "src/app_a.app.src",\n    resources = [\n        ":readme",\n    ],\n)\n\nexport_file(\n    name = "readme",\n    src = "README.md",\n)\n')),(0,i.mdx)("h4",{id:"using-otp-applications-and-mod-field"},"Using OTP applications and ",(0,i.mdx)("inlineCode",{parentName:"h4"},"mod")," field"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'erlang_application(\n    name = "app_b",\n    srcs = [\n        "src/app_b.erl",\n        "src/app_b.hrl",\n    ],\n    includes = [],\n    applications = [\n        "kernel",\n        "stdlib",\n        ":app_c",\n    ],\n    mod = ("app_b", [\n        "some_atom",\n        ""some string"",\n        "{tagged_tuple, 42}",\n    ]),\n)\n')),(0,i.mdx)("h4",{id:"using-yecc-and-leex"},"Using Yecc and Leex"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'erlang_application(\n    name = "yecc_leex",\n    srcs = [\n        "src/leex_stub.xrl",\n        "src/yecc_stub.yrl",\n    ],\n)\n')),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"erlang_app_includes"},"erlang","_","app","_","includes"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def erlang_app_includes(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _toolchain: str.type = _,\n    application_name: str.type,\n    contacts: [str.type] = _,\n    includes: [str.type] = _,\n    labels: [str.type] = _,\n    os_env: [None, {str.type: str.type}] = _\n) -> None\n")),(0,i.mdx)("p",null,"This rule is a supplementary rule for Erlang applications. It gets generated by using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_application")," macro, that takes as attributes the same attributes as this rule. You should always use the ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_application")," macro instead of using this rule directly."),(0,i.mdx)("h4",{id:"parameters-43"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"os_env"),": This attribute allows to set additional values for the operating system environment for invocations to the Erlang toolchain.")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"erlang_escript"},"erlang","_","escript"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def erlang_escript(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _toolchain: str.type = _,\n    contacts: [str.type] = _,\n    deps: [str.type],\n    emu_args: [str.type] = _,\n    include_priv: bool.type = _,\n    labels: [str.type] = _,\n    main_module: [None, str.type] = _,\n    os_env: [None, {str.type: str.type}] = _,\n    resources: [str.type] = _,\n    script_name: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_escript")," target builds and runs bundled escripts. Please refer to the ",(0,i.mdx)("a",{parentName:"p",href:"https://www.erlang.org/doc/man/escript.html"},"OTP documentation")," for more details about escripts."),(0,i.mdx)("h4",{id:"parameters-44"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": List of Erlang applications that are bundled in the escript. This includes all transitive dependencies as well."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"emu_args"),": This field specifies the emulator flags that the escript uses on execution. It is often desirable to specify the number of threads and schedulers the escript uses. Please refer to the ",(0,i.mdx)("a",{parentName:"li",href:"https://www.erlang.org/doc/man/erl.html#emu_flags"},"OTP documentation")," for details."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"include_priv"),": Setting this flag, will package the applications ",(0,i.mdx)("inlineCode",{parentName:"li"},"priv")," directory in the escript. Similar to files added through the ",(0,i.mdx)("inlineCode",{parentName:"li"},"resources")," field, the ",(0,i.mdx)("inlineCode",{parentName:"li"},"priv")," folders files can then be accessed by ",(0,i.mdx)("inlineCode",{parentName:"li"},'escript"extract/2'),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"main_module"),": Overrides the default main module. Instead of defering the main module from the scripts filename, the specified module is used. That module needs to export a ",(0,i.mdx)("inlineCode",{parentName:"li"},"main/1")," function that is called as entry point."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"os_env"),": This attribute allows to set additional values for the operating system environment for invocations to the Erlang toolchain."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": This adds the targets default output to the escript archive. To access these files, you need to use ",(0,i.mdx)("inlineCode",{parentName:"li"},"escript:extract/2"),", which will extract the entire escript in memory. The relevant files can then be accessed through the ",(0,i.mdx)("inlineCode",{parentName:"li"},"archive")," section.")),(0,i.mdx)("p",null,"Please refer to the ",(0,i.mdx)("a",{parentName:"p",href:"https://www.erlang.org/doc/man/escript.html"},(0,i.mdx)("inlineCode",{parentName:"a"},"escript:extract/2"))," for more details."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"script_name"),": Overrides the filename of the produced escript.")),(0,i.mdx)("h4",{id:"details-31"},"Details"),(0,i.mdx)("p",null,"Escripts by default always try to use the module that has the same name as the escripts basename as entry point, e.g. if\nthe escript is called ",(0,i.mdx)("inlineCode",{parentName:"p"},"script.escript")," then running the escript will try to call ",(0,i.mdx)("inlineCode",{parentName:"p"},"script:main/1"),". Both name and\nmain module can be overwritten though."),(0,i.mdx)("p",null,"The target name doubles as the default escript name. If the ",(0,i.mdx)("inlineCode",{parentName:"p"},"main_module")," attribute is not used, the escript filename will\nbe ",(0,i.mdx)("inlineCode",{parentName:"p"},"<name>.escript"),"."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'erlang_escript(\n    name = "script",\n    main_module = "main_module",\n    script_name = "the_script",\n    deps = [\n        ":escript_app",\n    ],\n    emu_args = ["+sbtu", "+A1"],\n)\n\nerlang_application(\n    name = "escript_app",\n    srcs = ["src/main_module.erl"],\n    applications = [\n        "kernel",\n        "stdlib",\n    ],\n)\n')),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"erlang_otp_binaries"},"erlang","_","otp","_","binaries"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def erlang_otp_binaries(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    erl: str.type,\n    erlc: str.type,\n    escript: str.type,\n    labels: [str.type] = _,\n    os_env: [None, {str.type: str.type}] = _\n) -> None\n")),(0,i.mdx)("p",null,"This target defines the executables for the Erlang toolchains, and is required to defined a toolchain."),(0,i.mdx)("h4",{id:"parameters-45"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"erl"),": Reference to ",(0,i.mdx)("inlineCode",{parentName:"li"},"erl")," binary"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"erlc"),": Reference to ",(0,i.mdx)("inlineCode",{parentName:"li"},"erlc")," binary"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"escript"),": Reference to ",(0,i.mdx)("inlineCode",{parentName:"li"},"escript")," binary"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"os_env"),": This attribute allows to set additional values for the operating system environment for invocations to the Erlang toolchain.")),(0,i.mdx)("h4",{id:"details-32"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,'erlang_otp_binaries(\nname = "local",\nerl = "local/erl",\nerlc = "local/erlc",\nescript = "local/escript",\n)'),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"erlang_release"},"erlang","_","release"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def erlang_release(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _toolchain: str.type = _,\n    applications: [[str.type, (str.type, str.type)]],\n    contacts: [str.type] = _,\n    include_erts: bool.type = _,\n    labels: [str.type] = _,\n    multi_toolchain: [None, [str.type]] = _,\n    os_env: [None, {str.type: str.type}] = _,\n    overlays: {str.type: [str.type]} = _,\n    release_name: [None, str.type] = _,\n    version: str.type = _\n) -> None\n")),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_release")," target builds OTP releases. Please refer to the ",(0,i.mdx)("a",{parentName:"p",href:"https://www.erlang.org/doc/design_principles/release_structure.html"},"OTP documentation")," for more details about releases."),(0,i.mdx)("h4",{id:"parameters-46"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"applications"),": This field specifies the list of applications that the release should start in the given order, and optionally the start type. Top-level applications without given start type are started with type ",(0,i.mdx)("a",{parentName:"li",href:"https://www.erlang.org/doc/man/application.html#type-restart_type"},(0,i.mdx)("inlineCode",{parentName:"a"},"permanent")),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"include_erts"),": This field controls wether OTP applications and the Erlang runtime system should be included as part of the release. Please note, that at the moment the erts folder is just ",(0,i.mdx)("inlineCode",{parentName:"li"},"erts/"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"multi_toolchain"),": This field controls wether the release should be built with a single toolchain, or multiple toolchains. In the latter case, all output paths are prefixed with the toolchain name."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"os_env"),": This attribute allows to set additional values for the operating system environment for invocations to the Erlang toolchain."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"overlays"),": Overlays can be used to add files to the release. They are specified as mapping from path (from the release root) to list of targets. The targets files are places ",(0,i.mdx)("strong",{parentName:"li"},"flat")," at the target location with their basename."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"release_name"),": The release name can explicitly be set by this field. This overwrites the default from the target name."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"version"),": The ",(0,i.mdx)("inlineCode",{parentName:"li"},"version")," field specifies the release version. The release version is used in the release resource file, and is part of the path for the folder containing the boot scripts.")),(0,i.mdx)("h4",{id:"details-33"},"Details"),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_release")," target does by default (without overlays) package:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"applications that are required to start the release"),(0,i.mdx)("li",{parentName:"ul"},"release resource file ",(0,i.mdx)("inlineCode",{parentName:"li"},"<relname>.rel")," (see ",(0,i.mdx)("a",{parentName:"li",href:"https://www.erlang.org/doc/man/rel.html"},"rel(4)"),")"),(0,i.mdx)("li",{parentName:"ul"},"boot script ",(0,i.mdx)("inlineCode",{parentName:"li"},"start.script")," (see ",(0,i.mdx)("a",{parentName:"li",href:"https://www.erlang.org/doc/man/script.html"},"rel(4)"),")"),(0,i.mdx)("li",{parentName:"ul"},"binary boot script ",(0,i.mdx)("inlineCode",{parentName:"li"},"start.boot")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"bin/release_variables"))),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"release_variables")," file contains release name, version, and erts version in shell syntax, e.g."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'ERTS_VSN="12.1.2"\nREL_NAME="rel1"\nREL_VSN="1.0.0"\n')),(0,i.mdx)("p",null,"The target name doubles as the default release name. If the ",(0,i.mdx)("inlineCode",{parentName:"p"},"release_name")," attribute is used, the release name will be\nsources from there instead."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'erlang_release(\n    name = "world",\n    version = "1.0.0",\n    applications = [\n        "//apps//app_a:app_a",\n        "//apps//app_b:app_b",\n    ],\n    overlays = {\n        "releases/1.0.0": [\n            ":sys.config.src",\n        ],\n        "bin": [\n            ":start.sh",\n        ],\n    },\n)\n\nexport_file(\n    name = "sys.config.src",\n    src = "sys.config",\n)\n\nexport_file(\n    name = "start.sh",\n    src = "start.sh",\n)\n')),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"erlang_test"},"erlang","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def erlang_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cli_lib: str.type = _,\n    _ct_opts: str.type = _,\n    _providers: str.type,\n    _test_binary: str.type = _,\n    _test_binary_lib: str.type = _,\n    _toolchain: str.type = _,\n    _trampoline: [None, str.type] = _,\n    config_files: [str.type] = _,\n    contacts: [str.type] = _,\n    deps: [str.type] = _,\n    env: {str.type: str.type} = _,\n    extra_ct_hooks: [str.type] = _,\n    labels: [str.type] = _,\n    os_env: [None, {str.type: str.type}] = _,\n    preamble: str.type = _,\n    property_tests: [str.type] = _,\n    resources: [str.type] = _,\n    shell_configs: [str.type] = _,\n    shell_libs: [str.type] = _,\n    suite: str.type\n) -> None\n")),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_test")," ruls defines a test target for a single test suite. In most cases you want to define multiple suites in one go. The ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_tests")," macro allows users to generate ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_test")," targets for multiple test suites. Each suite ",(0,i.mdx)("inlineCode",{parentName:"p"},"<name>_SUITE.erl")," will have a generated hidden ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_test")," target whose name is ",(0,i.mdx)("inlineCode",{parentName:"p"},"<name>_SUITE"),"."),(0,i.mdx)("h4",{id:"parameters-47"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"config_files"),": Will specify what config files the erlang beam machine running test with should load, for reference look at ",(0,i.mdx)("a",{parentName:"li",href:"https://www.erlang.org/doc/man/config.html"},"OTP documentation"),". These ones should consist of default_output of some targets. In general, this field is filled with target coming from then ",(0,i.mdx)("inlineCode",{parentName:"li"},"export_file")," rule, as in the example below."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies needed for all suites included in the target to compile and run. They could be either ",(0,i.mdx)("inlineCode",{parentName:"li"},"erlang_app(lication)")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"erlang_test")," targets, although the latter is discouraged. If some suites need to access common methods, a common helper file should be created and included in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," field of the ",(0,i.mdx)("inlineCode",{parentName:"li"},"erlang_tests")," target. If some applications are included as dependencies of this target, their private include will automatically be pulled and made available for the test. That allows tests to access the private header files from the applications under test."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": Add the given values to the environment variables with which the test is executed."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_ct_hooks"),": List of additional Common Test hooks. The strings are interpreted as Erlang terms."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"os_env"),": This attribute allows to set additional values for the operating system environment for invocations to the Erlang toolchain."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": The ",(0,i.mdx)("inlineCode",{parentName:"li"},"resources")," field specifies targets whose default output are placed in the test ",(0,i.mdx)("inlineCode",{parentName:"li"},"data_dir")," directory for all the suites present in the macro target. Additionally, if data directory are present in the directory along the suite, this one will be pulled automatically for the relevant suite.")),(0,i.mdx)("p",null,"Any target can be used, e.g. if you want to place a built escript in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"data_dir")," directory, you can use\nan ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_escript")," target."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"shell_configs"),": This attribute allows to set config files for the shell. The dependencies that are typically used here are ",(0,i.mdx)("inlineCode",{parentName:"li"},"export_file")," targets."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"shell_libs"),": This attribute allows to define additional dependencies for the shell. By default this is set to ",(0,i.mdx)("inlineCode",{parentName:"li"},'["prelude//erlang/shell:buck2_shell_utils"]')," which includes a ",(0,i.mdx)("inlineCode",{parentName:"li"},"user_default")," module that loads and compiles modules with buck2 mechanisms."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"suite"),": The source file for the test suite. If you are using the macro, you should use the ",(0,i.mdx)("inlineCode",{parentName:"li"},"suites")," attribute instead.")),(0,i.mdx)("p",null,"The suites attribtue specify which erlang_test targets should be generated. For each suite \"path_to_suite/suite_SUITE.erl\" an\nimplicit 'erlang_test' target suite_SUITE will be generated."),(0,i.mdx)("h4",{id:"details-34"},"Details"),(0,i.mdx)("p",null,"Each ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_test")," target implements tests using the Common Test library\n",(0,i.mdx)("a",{parentName:"p",href:"https://www.erlang.org/doc/man/common_test.html"},"OTP documentation"),". They can,\nalthough ",(0,i.mdx)("strong",{parentName:"p"},"it is not recommended"),', also act as dependencies of other tests. The\ndefault output of this rule is a "test_folder", consisting of the compiled test suite\nand the data directory.'),(0,i.mdx)("p",null,"For each suite  ",(0,i.mdx)("inlineCode",{parentName:"p"},"<name>_SUITE.erl"),", if a data_dir ",(0,i.mdx)("inlineCode",{parentName:"p"},"<name>_SUITE_data")," is present along the suite,\n(as per ",(0,i.mdx)("a",{parentName:"p",href:"https://www.erlang.org/doc/apps/common_test/write_test_chapter.html#data-and-private-directories"},"the data_dir naming scheme for ct"),"),\nit will automatically adds the coresponding resource target to the generated test target of the suite.\nResources will be placed in the ",(0,i.mdx)("a",{parentName:"p",href:"https://www.erlang.org/doc/apps/common_test/write_test_chapter.html#data_priv_dir"},"Data directory (data_dir)"),"\nof each of the suite."),(0,i.mdx)("p",null,"It allows the writer of the rule to add global configuration files and global default\ndependencies (e.g ",(0,i.mdx)("inlineCode",{parentName:"p"},"meck"),"). These ones should be specified using global\nvariables ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang.erlang_tests_default_apps")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang.erlang_tests_default_config"),"\nrespectively."),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_tests")," macro forwards all attributes to the ",(0,i.mdx)("inlineCode",{parentName:"p"},"erlang_test"),". It defines some attributes\nthat control how the targets get generated:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"use_default_configs")," (bool): Parameter that controls if the config files specified by the global config variable\n",(0,i.mdx)("inlineCode",{parentName:"li"},"erlang.erlang_tests_default_config")," should be used, default to True."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"use_default_deps")," (bool): Parameter that controls if the dependencies specified by the global config variable\n",(0,i.mdx)("inlineCode",{parentName:"li"},"erlang.erlang_tests_default_apps")," should be pulled, default to True."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," (","[source]",'): Set of files that the suites might depend on and that are not part of any specific application.\nA "meta" application having those files as sources will automatically be created, and included in the dependencies\nof the tests.')),(0,i.mdx)("p",null,"Ene can call"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"buck2 build //my_app:test_SUITE")," to compile the test files together with its depedencies."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"buck2 test //my_app:other_test_SUITE")," to run the test."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"buck2 run //my_app:other_test_SUITE")," to open an interactive test shell, where tests can be run iteratively.")),(0,i.mdx)("p",null,"buck2 test will rely on tpx to run the suite. To get access to tpx commands, add ",(0,i.mdx)("inlineCode",{parentName:"p"},"--")," after the\ntarget. For example:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"buck2 test //my_app:other_test_SUITE -- --help")," will print the list of tpx available\ncommand line parameters."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"buck2 test //my_app:other_test_SUITE -- group.mycase")," will only run those test cases\nthat match the pattern ",(0,i.mdx)("inlineCode",{parentName:"li"},"group.mycase"))),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,'erlang_test(\nname = "unit_test_SUITE",\nsuite = "unit_test_SUTIE.erl",\ndeps = ','[":my_other_app"]',",\ncontacts = ",'["author@email.com"]',",\n)"),(0,i.mdx)("p",null,"erlang_tests(\nsuites = ",'["test_SUITE.erl", "other_test_SUITE".erl]',",\ndeps = ",'[":my_app"]',",\ncontacts = ",'["author@email.com"]',",\n)"),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"export_file"},"export","_","file"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def export_file(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    mode: [None, str.type] = _,\n    out: [None, str.type] = _,\n    src: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Warning:")," this build rule is deprecated for folders. Use ",(0,i.mdx)("inlineCode",{parentName:"p"},"filegroup()"),"instead. It is still supported for individual files."),(0,i.mdx)("h4",{id:"parameters-48"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"mode"),": How files are referenced internally in buck. If set to 'copy', then a full copy will be made into the new location in buck-out. If set to 'reference', the original file will be used by internal build rules in-place. However, this mode does not work across repositories or if the 'out' property is set. For read-only operations, 'reference' can be more performant."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"out"),": The name which the file will be called if another rule depends on it instead of the name it already has."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"src"),": The path to the file that should be exported.")),(0,i.mdx)("h4",{id:"details-35"},"Details"),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"export_file()")," takes a single file or folder and exposes it so other rules can\nuse it."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"The best way to see how the ",(0,i.mdx)("inlineCode",{parentName:"p"},"export_file()")," rule works is with some examples. The\ncommon case is:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nexport_file(\n  name = 'example.html',\n)\n\n# This is equivalent to\n\nexport_file(\n  name = 'example.html',\n  src = 'example.html',\n  out = 'example.html',\n)\n\n")),(0,i.mdx)("p",null," It is sometimes useful to refer to the file not by its path, but by a more logical name:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nexport_file(\n  name = 'example',\n  src = 'example.html',\n)\n\n# This is equivalent to\n\nexport_file(\n  name = 'example',\n  src = 'example.html',\n  out = 'example.html',\n)\n\n")),(0,i.mdx)("p",null," Finally, there are occasions where you want to export a file more than once but want to copy it to\na different name for each output:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nexport_file(\n  name = 'runner',\n  src = 'RemoteRunner.html',\n)\n\nexport_file(\n  name = 'runner_hta',\n  src = 'RemoteRunner.html',\n  out = 'RemoteRunner.hta',\n)\n\n")),(0,i.mdx)("p",null," Using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"export_file()")," rule is also simple:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nexport_file(\n  name = 'example',\n  src = 'example.html',\n)\n\ngenrule(\n  name = 'demo',\n  out = 'result.html'\n  cmd = 'cp $(location :example) $OUT',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"external_test_runner"},"external","_","test","_","runner"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def external_test_runner(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    binary: str.type,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-49"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"filegroup"},"filegroup"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def filegroup(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    copy: bool.type = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    srcs: [[str.type], {str.type: str.type}] = _\n) -> None\n")),(0,i.mdx)("p",null,"This rule provides access to a set of files."),(0,i.mdx)("h4",{id:"parameters-50"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of files to include in this rule.")),(0,i.mdx)("h4",{id:"details-36"},"Details"),(0,i.mdx)("p",null,"Files are accessible to ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),"s by using their relative path\nafter a ",(0,i.mdx)("inlineCode",{parentName:"p"},"$(location)")," string parameter macro."),(0,i.mdx)("p",null," Other rules may handle ",(0,i.mdx)("inlineCode",{parentName:"p"},"filegroup()")," rules natively for attributes\nsuch as resources."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"In this example a target exports ",(0,i.mdx)("inlineCode",{parentName:"p"},".xml")," files from all subdirectories\nin ",(0,i.mdx)("inlineCode",{parentName:"p"},"resources"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nfilegroup(\n  name = 'example',\n  srcs = glob(['resources/**/*.xml']),\n)\n\ngenrule(\n  name = 'process_xml',\n  out = 'processed.xml',\n  cmd = '$(exe //example:tool) -in $(location :example)/resources/file.xml > $OUT',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"gen_aidl"},"gen","_","aidl"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def gen_aidl(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _java_toolchain: str.type = _,\n    aidl: str.type,\n    aidl_srcs: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    import_path: str.type = _,\n    import_paths: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"gen_aidl()")," rule is used to generate ",(0,i.mdx)("inlineCode",{parentName:"p"},".java")," files from ",(0,i.mdx)("inlineCode",{parentName:"p"},".aidl")," files."),(0,i.mdx)("h4",{id:"parameters-51"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"aidl"),": The path to an ",(0,i.mdx)("inlineCode",{parentName:"li"},".aidl")," file to convert to a ",(0,i.mdx)("inlineCode",{parentName:"li"},".java")," file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"aidl_srcs"),": Path to ",(0,i.mdx)("inlineCode",{parentName:"li"},".aidl")," files the target ",(0,i.mdx)("inlineCode",{parentName:"li"},"aidl")," file imports."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": A list of rules that must be built before this rule."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"import_path"),": The search path for import statements for the aidl command. (This is the ",(0,i.mdx)("inlineCode",{parentName:"li"},"-I")," argument when invoking aidl from the command line. For many apps it will be the base dir where all aidl files are, with project root as its parent, e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},"app/src/main/aidl"),".). This is the same as the path to the ",(0,i.mdx)("inlineCode",{parentName:"li"},"aidl")," file relative to what would be returned from ",(0,i.mdx)("inlineCode",{parentName:"li"},"root"),".")),(0,i.mdx)("h4",{id:"details-37"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nandroid_library(\n  name = 'lib',\n  srcs = glob(['**/*.java']) + [':aidl'],\n  manifest = '//res/org/opencv:manifest',\n  deps = [\n    '//res/org/opencv:res',\n  ],\n  visibility = [ 'PUBLIC' ],\n)\n\ngen_aidl(\n    name = 'aidl',\n    aidl = 'engine/OpenCVEngineInterface.aidl',\n    import_path = 'java/',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"genrule"},"genrule"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def genrule(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _exec_os_type: str.type = _,\n    _genrule_toolchain: str.type = _,\n    bash: [None, str.type] = _,\n    cacheable: [None, bool.type] = _,\n    cmd: [None, str.type] = _,\n    cmd_exe: [None, str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_outs: [None, [str.type]] = _,\n    enable_sandbox: [None, bool.type] = _,\n    env: {str.type: str.type} = _,\n    environment_expansion_separator: [None, str.type] = _,\n    executable: [None, bool.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    metadata_env_var: [None, str.type] = _,\n    metadata_path: [None, str.type] = _,\n    need_android_tools: bool.type = _,\n    no_outputs_cleanup: bool.type = _,\n    out: [None, str.type] = _,\n    outs: [None, {str.type: [str.type]}] = _,\n    remote: [None, bool.type] = _,\n    srcs: [[str.type], {str.type: str.type}] = _,\n    type: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()")," is used to generate files from a shell command. It must produce a single output file or folder."),(0,i.mdx)("h4",{id:"parameters-52"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"bash"),": A platform-specific version of the shell command parameter ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". It runs on Linux and UNIX systems\u2014including OSX\u2014on which ",(0,i.mdx)("inlineCode",{parentName:"li"},"bash")," is installed. It has a higher priority than ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". The ",(0,i.mdx)("inlineCode",{parentName:"li"},"bash")," argument is run with ",(0,i.mdx)("inlineCode",{parentName:"li"},"/usr/bin/env bash -c"),". It has access to the same set of macros and variables as the ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd")," argument."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),": The shell command to run to generate the output file. It is the fallback for ",(0,i.mdx)("inlineCode",{parentName:"li"},"bash")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd_exe")," arguments. The following environment variables are populated by Buck and available to the shell command. They are accessed using the syntax:")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"${<variable>}\n")),(0,i.mdx)("p",null," Example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"${SRCS}\n")),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${SRCS}")),(0,i.mdx)("p",null," A string expansion of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"srcs")," argument delimited\nby the ",(0,i.mdx)("inlineCode",{parentName:"p"},"environment_expansion_separator")," argument\nwhere each element of ",(0,i.mdx)("inlineCode",{parentName:"p"},"srcs")," will be translated\ninto an absolute path."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${SRCDIR}")),(0,i.mdx)("p",null," The absolute path to a directory to which sources are copied\nprior to running the command."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${OUT}")),(0,i.mdx)("p",null," The output file or directory for the ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),".\nThis variable will have whatever value is specified by\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"out")," argument if not using\xc2\xa0\nnamed outputs\nusing named outputs, this variable will be the output directory."),(0,i.mdx)("p",null," The value should be a valid filepath. The semantics of the shell\ncommand determine whether this filepath is treated as a file or a\ndirectory. If the filepath is a directory, then the shell command\nneeds to create it if not using named outputs. Otherwise, it will\nbe automatically created."),(0,i.mdx)("p",null," The file or directory specified by this variable must always\nbe written by this command. If not, the execution of this\nrule will be considered a failure, halting the build process."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"${TMP}")),(0,i.mdx)("p",null," A temporary directory which can be used for intermediate\nresults and will not be bundled into the output."),(0,i.mdx)("h5",{id:"string-parameter-macros-1"},"String parameter macros"),(0,i.mdx)("p",null," It is also possible to expand references to other rules within the\n",(0,i.mdx)("inlineCode",{parentName:"p"},"cmd"),", using builtin ",(0,i.mdx)("inlineCode",{parentName:"p"},"string parameter macros"),"\n.\nAll build rules expanded in the command are automatically considered\nto be dependencies of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),"."),(0,i.mdx)("p",null," Note that the paths returned by these macros are ",(0,i.mdx)("em",{parentName:"p"},"absolute")," paths. You should convert these paths to be relative paths before\nembedding them in, for example, a shell script or batch file. Using\nrelative paths ensures that your builds are ",(0,i.mdx)("em",{parentName:"p"},"hermetic"),", that\nis, they are reproducible across different machine environments."),(0,i.mdx)("p",null," Additionally, if you embed these paths in a shell script, you should\nexecute that script using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"sh\\_binary()"),"rule and include\nthe targets for these paths in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"resources")," argument of\nthat ",(0,i.mdx)("inlineCode",{parentName:"p"},"sh_binary")," rule. These are the same targets that you\npass to the string parameter macros."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(classpath //path/to:target)")),(0,i.mdx)("p",null," Expands to the transitive classpath of the specified build\nrule, provided that the rule has a Java classpath. If the rule\ndoes not have (or contribute to) a classpath, then an\nexception is thrown and the build breaks."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(exe //path/to:target)")),(0,i.mdx)("p",null," Expands a build rule that results in an executable to the\ncommands necessary to run that executable. For example,\na ",(0,i.mdx)("inlineCode",{parentName:"p"},"java_binary()"),"  might expand to a call\nto ",(0,i.mdx)("inlineCode",{parentName:"p"},"java -jar path/to/target.jar")," . Files that are\nexecutable (perhaps generated by a ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),")\nare also expanded. If the build rule does not generate an\nexecutable output, then an exception is thrown and the build\nbreaks."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(location //path/to:target)")),(0,i.mdx)("p",null," Expands to the location of the output of the specified build\nrule. This means that you can refer to the output without\nneeding to be aware of how Buck is storing data on the disk\nmid-build."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(maven_coords //path/to:target)")),(0,i.mdx)("p",null," Expands to the Maven coordinates for the specified build rule.\nThis allows you to access the Maven coordinates for\nMaven-aware build rules. The format of the expansion is:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"cmd_exe"),": A platform-specific version of the shell command parameter ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". It runs on Windows and has a higher priority than ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd"),". The ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd_exe")," argument is run with ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd.exe /v:off /c"),". It has access to the same set of macros and variables as the ",(0,i.mdx)("inlineCode",{parentName:"li"},"cmd")," argument."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_outs"),": Default output which must be present if the ",(0,i.mdx)("inlineCode",{parentName:"li"},"outs")," arg is present. Otherwise does not apply.")),(0,i.mdx)("p",null,"If a rule with ",(0,i.mdx)("inlineCode",{parentName:"p"},"outs")," is consumed without an output label, the default output is returned. The\ndefault output does not need to be present in any of the named outputs defined in ",(0,i.mdx)("inlineCode",{parentName:"p"},"outs"),"."),(0,i.mdx)("p",null," Note that a maximum of one value may be present in this list. For example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'default_outs = [ "output_one", ]\n')),(0,i.mdx)("p",null,"is valid, whereas"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'default_outs = [ "output_one", "output_two", ]\n')),(0,i.mdx)("p",null,"is not."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"enable_sandbox"),": Whether this target should be executed in a sandbox or not."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"environment_expansion_separator"),": The delimiter between paths in environment variables, such as SRCS, that can contain multiple paths. It can be useful to specify this parameter if the paths could contain spaces."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"executable"),": Whether the output of the genrule is itself executable. Marking an output as executable makes ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck run")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(exe ...)")," macro expansion work with this target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"out"),": The name of the output file or directory. The complete path to this argument is provided to the shell command through the ",(0,i.mdx)("inlineCode",{parentName:"li"},"OUT")," environment variable. Only one of",(0,i.mdx)("inlineCode",{parentName:"li"},"out")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"outs")," may be present."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"outs"),": Mapping defining ",(0,i.mdx)("inlineCode",{parentName:"li"},"named outputs")," to output paths relative to the rule's output directory. Only one of ",(0,i.mdx)("inlineCode",{parentName:"li"},"out")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"outs")," may be present.")),(0,i.mdx)("p",null,"Example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\ngenrule(\n  name = "named_outputs",\n  outs = {\n    "output1": [\n      "out1.txt",\n    ],\n    "output2": [\n      "out2.txt",\n    ],\n  },\n  default_outs = [ "out1.txt" ],\n  cmd = "echo something> $OUT/out1.txt && echo another> $OUT/out2.txt",\n)\n\n')),(0,i.mdx)("p",null," Note that a maximum of one value may be present in the list in this map. For example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\nouts = {\n  "output1": [\n    "out1.txt",\n  ],\n},\n\n')),(0,i.mdx)("p",null,"is valid, whereas"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\nouts = {\n  "output1": [\n    "out1.txt",\n    "out2.txt",\n  ],\n},\n\n')),(0,i.mdx)("p",null,"is not."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"remote"),": Opts this genrule in to remote execution. Note that it is only safe to execute a genrule remotely if it is completely hermetic and completely and correctly describes its dependencies. Defaults to false. This parameter is unstable. It is subject to removal, default reversal, and other arbitrary changes in the future."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": Either a list or a map of the source files which Buck makes available to the shell command at the path in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"SRCDIR")," environment variable. If you specify a list, the source files are the names in the list. If you specify a map, the source files are made available as the names in the keys of the map, where the values of the map are the original source file names."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"type"),": Specifies the ",(0,i.mdx)("em",{parentName:"li"},"type"),' of this genrule. This is used for logging and is particularly useful for grouping genrules that share an underlying logical "type".')),(0,i.mdx)("p",null,"For example, if you have the following ",(0,i.mdx)("inlineCode",{parentName:"p"},"cxx_genrule")," defined\nin the root directory of your Buck project"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\ncxx_genrule(\n  name = 'cxx_gen',\n  type = 'epilog',\n  cmd  = 'touch finish.txt; cp finish.txt $OUT',\n  out  = 'finish.txt'\n)\n\n")),(0,i.mdx)("p",null," then the following ",(0,i.mdx)("inlineCode",{parentName:"p"},"buck query")," command"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\nbuck query \"attrfilter( type, 'epilog', '//...' )\"\n\n")),(0,i.mdx)("p",null," returns"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\n//:cxx_gen\n\n")),(0,i.mdx)("h4",{id:"details-38"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"This genrule() uses a Python script to derive a new\n",(0,i.mdx)("inlineCode",{parentName:"p"},"AndroidManifest.xml")," from an\n",(0,i.mdx)("inlineCode",{parentName:"p"},"AndroidManifest.xml")," in the source tree.\nNote you don't need to prepend execution commands with\n",(0,i.mdx)("inlineCode",{parentName:"p"},"python"),": Buck knows how to execute different\nkinds of binaries using ",(0,i.mdx)("inlineCode",{parentName:"p"},"$(exe)")," command."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\ngenrule(\n  name = 'generate_manifest',\n  srcs = [\n    'AndroidManifest.xml',\n  ],\n  bash = '$(exe //python/android:basic_to_full) '               '$SRCDIR/AndroidManifest.xml > $OUT',\n  cmd_exe = '$(exe //python/android:basic_to_full) '               '%SRCDIR%\\AndroidManifest.xml > %OUT%',\n  out = 'AndroidManifest.xml',\n)\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\ngenrule(\n  name = 'generate_manifest_with_named_outputs',\n  srcs = [\n    'AndroidManifest.xml',\n  ],\n  bash = '$(exe //python/android:basic_to_full) '               '$SRCDIR/AndroidManifest.xml > $OUT/AndroidManifest.xml',\n  cmd_exe = '$(exe //python/android:basic_to_full) '               '%SRCDIR%\\AndroidManifest.xml > %OUT%\\AndroidManifest.xml',\n  outs =  {\n    \"manifest\": [ \"AndroidManifest.xml\" ],\n  },\n  default_outs = [ \"AndroidManifest.xml\" ],\n)\n\n")),(0,i.mdx)("p",null,"For named outputs, build with any of the following:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n  buck build //:generate_manifest_with_named_outputs\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n  buck build //:generate_manifest_with_named_outputs[manifest]\n\n")),(0,i.mdx)("p",null,"Consume in ",(0,i.mdx)("inlineCode",{parentName:"p"},"srcs")," with:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\nexport_file(\n    name = "magic1",\n    src = ":generate_manifest_with_named_outputs",\n    out = "some_dir_to_copy_to/AndroidManifest.xml",\n)\n\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\nexport_file(\n    name = "magic2",\n    src = ":generate_manifest_with_named_outputs[manifest]",\n    out = "some_dir_to_copy_to/AndroidManifest.xml",\n)\n\n')),(0,i.mdx)("p",null,"Note that ",(0,i.mdx)("inlineCode",{parentName:"p"},"magic1")," consumes ",(0,i.mdx)("inlineCode",{parentName:"p"},"generate_manifest_with_named_outputs"),"'s default\noutput. ",(0,i.mdx)("inlineCode",{parentName:"p"},"magic2")," consumes ",(0,i.mdx)("inlineCode",{parentName:"p"},"generate_manifest_with_named_outputs"),'\'s named\noutput "manifest," which happen to be pointing to the same output as the default output in this\ncase, but they do not have to point to the same output.'),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"git_fetch"},"git","_","fetch"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def git_fetch(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _git_fetch_tool: str.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    repo: str.type,\n    rev: str.type\n) -> None\n")),(0,i.mdx)("p",null,"Checkout a commit from a git repository."),(0,i.mdx)("h4",{id:"parameters-53"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"repo"),": Url suitable as a git remote."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"rev"),": 40-digit hex SHA-1 of the git commit.")),(0,i.mdx)("h4",{id:"details-39"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'git_fetch(\n    name = "serde.git",\n    repo = "https://github.com/serde-rs/serde",\n    rev = "fccb9499bccbaca0b7eef91a3a82dfcb31e0b149",\n)\n')),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"go_binary"},"go","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def go_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _go_toolchain: str.type = _,\n    assembler_flags: [str.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    embedcfg: [None, str.type] = _,\n    external_linker_flags: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    link_mode: [None, str.type] = _,\n    link_style: [None, str.type] = _,\n    linker_flags: [str.type] = _,\n    platform: [None, str.type] = _,\n    platform_external_linker_flags: [(str.type, [str.type])] = _,\n    resources: [str.type] = _,\n    srcs: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A go","_","binary() rule builds a native executable from the supplied set of Go source files and dependencies. The files supplied are expected to be in the main package, implicitly."),(0,i.mdx)("h4",{id:"parameters-54"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"assembler_flags"),": The set of additional assembler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"go tool asm"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": The set of additional compiler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"go tool compile"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Currently, this only supports go","_","library rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"external_linker_flags"),": Extra external linker flags passed to go link via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-extld")," argument. If argument is non-empty or ",(0,i.mdx)("inlineCode",{parentName:"li"},"cgo_library")," is used, the link mode will switch to ",(0,i.mdx)("inlineCode",{parentName:"li"},"external"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_mode"),": Determines the link mode (equivalent of ",(0,i.mdx)("inlineCode",{parentName:"li"},"-mode"),"). Can be one of the following values: ",(0,i.mdx)("inlineCode",{parentName:"li"},"internal"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"external"),". If no value is provided, the mode is set automatically depending on the other args."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be one of the following values: ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),". This argument is relevant only if the cgo extension is enabled. Otherwise, Buck ignores this argument."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Extra linker flags passed to go link"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of source files to be compiled by this rule. .go files will be compiled with the Go compiler, .s files will be compiled with the assembler, and everything else is assumed to be files that may be ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include"),"d by the assembler.")),(0,i.mdx)("h4",{id:"details-40"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"For more examples, check out our ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/go/testdata"},"integration tests"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\ngo_binary(\n  name='greet',\n  srcs=[\n    'main.go',\n  ],\n  deps=[\n    ':greeting',\n  ],\n)\n\ngo_library(\n  name='greeting',\n  srcs=[\n    'greeting.go',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\ngo_library(\n  name='join',\n  srcs=[\n    'join.go',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"go_exported_library"},"go","_","exported","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def go_exported_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _go_toolchain: str.type = _,\n    assembler_flags: [str.type] = _,\n    build_mode: str.type,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    embedcfg: [None, str.type] = _,\n    external_linker_flags: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    link_mode: [None, str.type] = _,\n    link_style: [None, str.type] = _,\n    linker_flags: [str.type] = _,\n    platform: [None, str.type] = _,\n    platform_external_linker_flags: [(str.type, [str.type])] = _,\n    resources: [str.type] = _,\n    srcs: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A go","_","exported","_","library() rule builds a C library from the supplied set of Go source files and dependencies. This is done via ",(0,i.mdx)("inlineCode",{parentName:"p"},"-buildmode"),' flag and "//export" annotations in the code.'),(0,i.mdx)("h4",{id:"parameters-55"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"assembler_flags"),": The set of additional assembler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"go tool asm"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"build_mode"),": Determines the build mode (equivalent of ",(0,i.mdx)("inlineCode",{parentName:"li"},"-buildmode"),"). Can be one of the following values: ",(0,i.mdx)("inlineCode",{parentName:"li"},"c_archive"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"c_shared"),". This argument is valid only if at there is at least one ",(0,i.mdx)("inlineCode",{parentName:"li"},"cgo_library declared in deps. In addition you should make sure that "),"-shared",(0,i.mdx)("inlineCode",{parentName:"li"},"flag is added to"),"compiler_flags",(0,i.mdx)("inlineCode",{parentName:"li"},"and go version under"),"go.goroot",(0,i.mdx)("inlineCode",{parentName:"li"},"is compiled with that flag present in:"),"gcflags",(0,i.mdx)("inlineCode",{parentName:"li"},", "),"ldflags",(0,i.mdx)("inlineCode",{parentName:"li"},"and"),"asmflags``"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": The set of additional compiler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"go tool compile"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Currently, this only supports go","_","library rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"external_linker_flags"),": Extra external linker flags passed to go link via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-extld")," argument. If argument is non-empty or ",(0,i.mdx)("inlineCode",{parentName:"li"},"cgo_library")," is used, the link mode will switch to ",(0,i.mdx)("inlineCode",{parentName:"li"},"external"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_mode"),": Determines the link mode (equivalent of ",(0,i.mdx)("inlineCode",{parentName:"li"},"-mode"),"). Can be one of the following values: ",(0,i.mdx)("inlineCode",{parentName:"li"},"internal"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"external"),". If no value is provided, the mode is set automatically depending on the other args."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be one of the following values: ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),". This argument is relevant only if the cgo extension is enabled. Otherwise, Buck ignores this argument."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Extra linker flags passed to go link"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": Static files to be symlinked into the working directory of the test. You can access these in your by opening the files as relative paths, e.g. ",(0,i.mdx)("inlineCode",{parentName:"li"},'ioutil.ReadFile("testdata/input")'),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of source files to be compiled by this rule. .go files will be compiled with the Go compiler, .s files will be compiled with the assembler, and everything else is assumed to be files that may be ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include"),"d by the assembler.")),(0,i.mdx)("h4",{id:"details-41"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"For more examples, check out our ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/go/testdata"},"integration tests"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\ngo_exported_library(\n    name = "shared",\n    srcs = ["main.go"],\n    build_mode = "c_shared",\n    compiler_flags = ["-shared"],\n    deps = [":example"],\n)\n\ncgo_library(\n    name = "example",\n    package_name = "cgo",\n    srcs = [\n        "export-to-c.go",  # file with //export annotations\n    ],\n    cgo_compiler_flags = [],\n    compiler_flags = [],\n    headers = [],\n)\n\ncxx_genrule(\n    name = "cgo_exported_headers",\n    out = "includes",\n    cmd = (\n        "mkdir -p $OUT && " +\n        "cat `dirname $(location :shared)`/includes/*.h > $OUT/_cgo_export.h"\n    ),\n)\n\nprebuilt_cxx_library(\n    name = "cxx_so_with_header",\n    header_dirs = [":cgo_exported_headers"],\n    shared_lib = ":shared",\n)\n\n')),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"go_library"},"go","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def go_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _go_toolchain: str.type = _,\n    assembler_flags: [str.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    embedcfg: [None, str.type] = _,\n    exported_deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    package_name: [None, str.type] = _,\n    srcs: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A go","_","library() rule builds a native library from the supplied set of Go source files and dependencies."),(0,i.mdx)("h4",{id:"parameters-56"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"assembler_flags"),": The set of additional assembler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"go tool asm"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": The set of additional compiler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"go tool compile"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Currently, this only supports go","_","library rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"package_name"),': Sets the full name of the package being compiled. This defaults to the path from the buck root. (e.g. given a ./.buckconfig, a rule in ./a/b/BUCK defaults to package "a/b")'),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of source files to be compiled by this rule. .go files will be compiled with the Go compiler, .s files will be compiled with the assembler, and everything else is assumed to be files that may be ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include"),"d by the assembler.")),(0,i.mdx)("h4",{id:"details-42"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"For more examples, check out our ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/go/testdata"},"integration tests"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\ngo_library(\n  name='greeting',\n  srcs=[\n    'greeting.go',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"go_test"},"go","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def go_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _go_toolchain: str.type = _,\n    _inject_test_env: str.type = _,\n    _testmaingen: str.type = _,\n    assembler_flags: [str.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    coverage_mode: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    embedcfg: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    external_linker_flags: [str.type] = _,\n    labels: [str.type] = _,\n    library: [None, str.type] = _,\n    licenses: [str.type] = _,\n    link_mode: [None, str.type] = _,\n    link_style: [None, str.type] = _,\n    linker_flags: [str.type] = _,\n    package_name: [None, str.type] = _,\n    platform: [None, str.type] = _,\n    resources: [str.type] = _,\n    run_test_separately: bool.type = _,\n    runner: [None, str.type] = _,\n    specs: [None, str.type] = _,\n    srcs: [str.type] = _,\n    test_rule_timeout_ms: [None, int.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"go_test()")," rule builds a native binary from the specified Go source and resource files\u2014and a generated main file. It's similar to the ",(0,i.mdx)("inlineCode",{parentName:"p"},"go test")," command."),(0,i.mdx)("h4",{id:"parameters-57"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"assembler_flags"),": The set of additional assembler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"go tool asm"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": The set of additional compiler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"go tool compile"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Currently, this only supports go","_","library rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": A map of environment variables and values to set when running the test."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"external_linker_flags"),": Extra external linker flags passed to go link via ",(0,i.mdx)("inlineCode",{parentName:"li"},"-extld")," argument. If argument is non-empty or ",(0,i.mdx)("inlineCode",{parentName:"li"},"cgo_library")," is used, the link mode will switch to ",(0,i.mdx)("inlineCode",{parentName:"li"},"external"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": A list of labels to be applied to these tests. These labels are arbitrary text strings and have no meaning within buck itself. They can, however, have meaning for you as a test author (e.g., ",(0,i.mdx)("inlineCode",{parentName:"li"},"smoke")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"fast"),"). A label can be used to filter or include a specific test rule when executing ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck test")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"library"),": Specify the library that this internal test is testing. This will copy the ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"package_name")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps")," from the target specified so you don't have to duplicate them."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_mode"),": Determines the link mode (equivalent of ",(0,i.mdx)("inlineCode",{parentName:"li"},"-mode"),"). Can be one of the following values: ",(0,i.mdx)("inlineCode",{parentName:"li"},"internal"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"external"),". If no value is provided, the mode is set automatically depending on the other args."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be one of the following values: ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),". This argument is relevant only if the cgo extension is enabled. Otherwise, Buck ignores this argument."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Extra linker flags passed to go link"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"package_name"),': Sets the full name of the test package being compiled. This defaults to the path from the buck root with "',"_",'test" appended. (e.g. given a ./.buckconfig, a rule in ./a/b/BUCK defaults to package "a/b',"_",'test")')),(0,i.mdx)("p",null,"Note: if you want to test packages internally (i.e. same package name), use the ",(0,i.mdx)("inlineCode",{parentName:"p"},"library"),"\nparameter instead of setting ",(0,i.mdx)("inlineCode",{parentName:"p"},"package_name")," to include the tested source files."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of source files to be compiled by this rule. .go files will be compiled with the Go compiler, .s files will be compiled with the assembler, and everything else is assumed to be files that may be ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include"),"d by the assembler."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"test_rule_timeout_ms"),": If set specifies the maximum amount of time (in milliseconds) in which all of the tests in this rule should complete. This overrides the default ",(0,i.mdx)("inlineCode",{parentName:"li"},"rule_timeout")," if any has been specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig")," .")),(0,i.mdx)("h4",{id:"details-43"},"Details"),(0,i.mdx)("p",null,"If your test requires static files you should specify these in\nthe ",(0,i.mdx)("strong",{parentName:"p"},"resources")," argument. If you do not specify these\nfiles, they won't be available when your test runs."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"For more examples, check out our ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/go/testdata"},"integration tests"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\ngo_library(\n  name='greeting',\n  srcs=[\n    'greeting.go',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\ngo_test(\n  name='greeting-test',\n  srcs=[\n    'greeting_ext_test.go',\n  ],\n  deps=[\n    ':greeting'\n  ],\n)\n\ngo_test(\n  name='greeting-internal-test',\n  package_name='greeting',\n  srcs=[\n    'greeting.go',\n    'greeting_test.go',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\n# Or\n\ngo_test(\n  name='greeting-better-internal-test',\n  srcs=['greeting_test.go'],\n  library=':greeting',\n)\n\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"go_test_runner"},"go","_","test","_","runner"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def go_test_runner(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    test_runner_generator: str.type\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-58"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"groovy_library"},"groovy","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def groovy_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    extra_groovyc_arguments: [str.type] = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    manifest_file: [None, str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    srcs: [str.type] = _,\n    target: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"groovy_library()")," rule is used to define a set of Groovy files that can be compiled together. It can also be used to cross compile a set of Groovy and Java files. The main output of a ",(0,i.mdx)("inlineCode",{parentName:"p"},"groovy_library()")," rule is a single JAR file containing all of the compiled class files and resources."),(0,i.mdx)("h4",{id:"parameters-59"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Rules (usually other ",(0,i.mdx)("inlineCode",{parentName:"li"},"groovy_library")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"java_library()")," rules) that are used to generate the classpath required to compile this ",(0,i.mdx)("inlineCode",{parentName:"li"},"groovy_library"),".")),(0,i.mdx)("p",null,"This is the same as in ",(0,i.mdx)("inlineCode",{parentName:"p"},"java\\_library()"),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),": Other ",(0,i.mdx)("inlineCode",{parentName:"li"},"groovy_library")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"java_library()")," rules that depend on this rule will also include its ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps")," in their classpaths.")),(0,i.mdx)("p",null,"This is the same as in ",(0,i.mdx)("inlineCode",{parentName:"p"},"java\\_library()"),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_arguments"),": Only used during cross compilation.")),(0,i.mdx)("p",null,"This is the same as in ",(0,i.mdx)("inlineCode",{parentName:"p"},"java\\_library()"),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_groovyc_arguments"),": List of additional arguments to pass into the Groovy compiler."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"java_version"),": Only used during cross compilation.")),(0,i.mdx)("p",null,"This is the same as in ",(0,i.mdx)("inlineCode",{parentName:"p"},"java\\_library()"),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps"),": This is the same as in ",(0,i.mdx)("inlineCode",{parentName:"li"},"java\\_library()"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": This is the same as in ",(0,i.mdx)("inlineCode",{parentName:"li"},"java\\_library()"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"source"),": Only used during cross compilation.")),(0,i.mdx)("p",null,"This is the same as in ",(0,i.mdx)("inlineCode",{parentName:"p"},"java\\_library()"),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of files to compile for this rule. Usually these will all end in ",(0,i.mdx)("inlineCode",{parentName:"li"},".groovy"),", but if any of the files end in ",(0,i.mdx)("inlineCode",{parentName:"li"},".java"),", cross compilation using the jdk found in ",(0,i.mdx)("inlineCode",{parentName:"li"},"JAVA_HOME")," will occur."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target"),": Only used during cross compilation.")),(0,i.mdx)("p",null,"This is the same as in ",(0,i.mdx)("inlineCode",{parentName:"p"},"java\\_library()"),"."),(0,i.mdx)("h4",{id:"details-44"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that compiles a single .groovy file.\ngroovy_library(\n  name = 'example',\n  srcs = ['MySourceFile.groovy'],\n)\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that compiles all of the .groovy files under the directory in\n# which the rule is defined using glob()\ngroovy_library(\n  name = 'groovy-only',\n  srcs = glob(['**/*.groovy']),\n)\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that cross compiles all of the .groovy and .java files under\n# the directory in which the rule is defined, failing if compiling the\n# java files generates any compiler warnings\ngroovy_library(\n  name = 'cross-compilation',\n  srcs = glob(['**/*.groovy', '**/*.java']),\n  java_version = 8,\n  extra_arguments = [\n    '-Werror',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"groovy_test"},"groovy","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def groovy_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_library_whitelist: [str.type] = _,\n    default_cxx_platform: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    extra_groovyc_arguments: [str.type] = _,\n    fork_mode: str.type = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    manifest_file: [None, str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    run_test_separately: bool.type = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    srcs: [str.type] = _,\n    std_err_log_level: [None, int.type, str.type] = _,\n    std_out_log_level: [None, int.type, str.type] = _,\n    target: [None, str.type] = _,\n    test_case_timeout_ms: [None, int.type] = _,\n    test_rule_timeout_ms: [None, int.type] = _,\n    test_type: [None, str.type] = _,\n    use_cxx_libraries: [None, bool.type] = _,\n    use_dependency_order_classpath: [None, bool.type] = _,\n    vm_args: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-60"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"gwt_binary"},"gwt","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def gwt_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    draft_compile: [None, bool.type] = _,\n    experimental_args: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    local_workers: [None, int.type] = _,\n    module_deps: [str.type] = _,\n    modules: [str.type] = _,\n    optimize: [None, int.type] = _,\n    strict: [None, bool.type] = _,\n    style: [None, str.type] = _,\n    vm_args: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-61"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"halide_library"},"halide","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def halide_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    compiler_deps: [str.type] = _,\n    compiler_flags: [str.type] = _,\n    compiler_invocation_flags: [str.type] = _,\n    configs: {str.type: {str.type: str.type}} = _,\n    contacts: [str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    devirt_enabled: bool.type = _,\n    executable_name: [None, str.type] = _,\n    fat_lto: bool.type = _,\n    focused_list_target: [None, str.type] = _,\n    frameworks: [str.type] = _,\n    function_name: [None, str.type] = _,\n    header_namespace: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_deps_query_whole: bool.type = _,\n    link_group: [None, str.type] = _,\n    link_group_map: [None, [(str.type, [(str.type, str.type, [None, str.type])])]] = _,\n    link_style: [None, str.type] = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    prefer_stripped_objects: bool.type = _,\n    prefix_header: [None, str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    raw_headers: [str.type] = _,\n    srcs: [[str.type, (str.type, [str.type])]] = _,\n    supported_platforms_regex: [None, str.type] = _,\n    thin_lto: bool.type = _,\n    version_universe: [None, str.type] = _,\n    weak_framework_names: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A halide","_",'library() rule represents a set of Halide sources, along with the "compiler" code needed to compile them into object format (see ',(0,i.mdx)("a",{parentName:"p",href:"http://halide-lang.org"},"the Halide site")," for information about Halide and about static compilation of Halide pipelines). The object code will be generated for the target architecture."),(0,i.mdx)("h4",{id:"parameters-62"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_deps"),": The dependencies of the halide compiler itself. Targets that depend on the halide","_","library rule will not include or link the outputs of these targets."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": Flags to use when compiling any of the above sources (which require compilation)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The dependencies of the generated halide pipeline code. This is useful if, for example, your pipeline calls an external function using Halide::Func::define","_","extern."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Flags to add to the linker command line whenever the output from this rule is used in a link operation, such as linked into an executable or a shared library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_compiler_flags"),": Platform specific compiler flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when compiling the target's sources. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_linker_flags"),": Platform-specific linker flags. This argument is specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The second element in each pair is a list of linker flags. If the regex matches the platform, these flags are added to the linker command line when the output from this rule is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of halide sources to compile for this rule. The sources will be compiled and linked for the host architecture, and the resulting binary will be run to produce the object code for the Halide pipeline."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"supported_platforms_regex"),": If present, an un-anchored regex (in java.util.regex.Pattern syntax) that matches all platforms that this library supports. It will not be built for other platforms.")),(0,i.mdx)("h4",{id:"details-45"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nhalide_library(\n  # Your library name.\n  name = 'brighter',\n\n  # Your pipeline + compiler sources.\n  srcs = ['halide/main.cpp'],\n\n  # Any dependencies for your compiler. Note that targets that depend on\n  # this rule WILL NOT include or link the output(s) of these targets.\n  compiler_deps = [\n    # You'll need libHalide to use this rule; in our example, we assume it's\n    # located in the 'third-party/halide' directory.\n    '//third-party/halide:halide'\n  ],\n\n  # Any dependencies for your generated shader. Targets that depend on this\n  # rule will include and/or link the output(s) of these targets.\n  deps = [\n    # ...\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"haskell_binary"},"haskell","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def haskell_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _haskell_toolchain: str.type = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    enable_profiling: bool.type = _,\n    ghci_platform_preload_deps: [(str.type, [str.type])] = _,\n    ghci_preload_deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    link_deps_query_whole: bool.type = _,\n    link_style: [None, str.type] = _,\n    linker_flags: [str.type] = _,\n    main: [None, str.type] = _,\n    platform: [None, str.type] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    srcs: [[str.type], {str.type: str.type}] = _,\n    template_deps: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"haskell_binary()")," rule represents a groups of Haskell sources and deps which build an executable."),(0,i.mdx)("h4",{id:"parameters-63"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": Flags to pass to the Haskell compiler when compiling this rule's sources."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Either ",(0,i.mdx)("inlineCode",{parentName:"li"},"haskell\\_library()"),"or ",(0,i.mdx)("inlineCode",{parentName:"li"},"prebuilt\\_haskell\\_library()"),"rules from which this rules sources import modules or native linkable rules exporting symbols this rules sources call into."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be either ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"main"),": The main module serving as the entry point into the binary. If not specified, the compiler default is used."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_deps"),": Platform specific dependencies. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of dependencies (same format as ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),") that are exported if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": A list of Haskell sources to be built by this rule.")),(0,i.mdx)("h4",{id:"details-46"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nhaskell_binary(\n  name = 'foo',\n  srcs = [\n    'Foo.hs',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"haskell_ghci"},"haskell","_","ghci"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def haskell_ghci(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _haskell_toolchain: str.type = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    enable_profiling: bool.type = _,\n    extra_script_templates: [str.type] = _,\n    ghci_bin_dep: [None, str.type] = _,\n    ghci_init: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    linker_flags: [str.type] = _,\n    platform: [None, str.type] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_preload_deps: [(str.type, [str.type])] = _,\n    preload_deps: [str.type] = _,\n    srcs: [[str.type], {str.type: str.type}] = _,\n    template_deps: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-64"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"haskell_haddock"},"haskell","_","haddock"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def haskell_haddock(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    haddock_flags: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    platform: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-65"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"haskell_ide"},"haskell","_","ide"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def haskell_ide(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _haskell_toolchain: str.type = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    extra_script_templates: [str.type] = _,\n    include_projects: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    link_style: str.type,\n    linker_flags: [str.type] = _,\n    platform: [None, str.type] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    srcs: [[str.type], {str.type: str.type}] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-66"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"haskell_library"},"haskell","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def haskell_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _haskell_toolchain: str.type = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    enable_profiling: bool.type = _,\n    ghci_platform_preload_deps: [(str.type, [str.type])] = _,\n    ghci_preload_deps: [str.type] = _,\n    haddock_flags: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    link_whole: bool.type = _,\n    linker_flags: [str.type] = _,\n    platform: [None, str.type] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    preferred_linkage: str.type = _,\n    srcs: [[str.type], {str.type: str.type}] = _,\n    template_deps: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"haskell_library()")," rule is used to identity a group of Haskell sources."),(0,i.mdx)("h4",{id:"parameters-67"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": Flags to pass to the Haskell compiler when compiling this rule's sources."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Either ",(0,i.mdx)("inlineCode",{parentName:"li"},"haskell\\_library()"),"or ",(0,i.mdx)("inlineCode",{parentName:"li"},"prebuilt\\_haskell\\_library()"),"rules from which this rules sources import modules or native linkable rules exporting symbols this rules sources call into."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_deps"),": Platform specific dependencies. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of dependencies (same format as ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),") that are exported if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": A list of Haskell sources to be built by this rule.")),(0,i.mdx)("h4",{id:"details-47"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nhaskell_library(\n  name = 'fileutil',\n  srcs = [\n    'FileUtil.hs',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"haskell_prebuilt_library"},"haskell","_","prebuilt","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def haskell_prebuilt_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_header_dirs: [str.type] = _,\n    db: str.type,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    enable_profiling: bool.type = _,\n    exported_compiler_flags: [str.type] = _,\n    exported_linker_flags: [str.type] = _,\n    id: str.type = _,\n    import_dirs: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    pic_profiled_static_libs: [str.type] = _,\n    pic_static_libs: [str.type] = _,\n    profiled_static_libs: [str.type] = _,\n    shared_libs: {str.type: str.type} = _,\n    static_libs: [str.type] = _,\n    version: str.type = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"prebuilt_haskell_library()")," rule is used to identify Haskell prebuilt libraries and their associated interface files."),(0,i.mdx)("h4",{id:"parameters-68"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Other ",(0,i.mdx)("inlineCode",{parentName:"li"},"prebuilt_haskell_library()")," rules from which this library imports modules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_compiler_flags"),": Compiler flags used by dependent rules when compiling with this library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_linker_flags"),": Linker flags used by dependent rules when linking with this library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"shared_libs"),": A map of shared library names to shared library paths to use when building a dynamically linked top-level target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"static_libs"),": The libraries to use when building a statically linked top-level target.")),(0,i.mdx)("h4",{id:"details-48"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_haskell_library(\n  name = 'file',\n  static_interfaces = [\n    'interfaces',\n  ],\n  shared_interfaces = [\n    'interfaces_dyn',\n  ],\n  static_libs = [\n    'libFileUtil.a',\n  ],\n  shared_libs = {\n    'libFileUtil.so': 'libFileUtil.so',\n  },\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"http_archive"},"http","_","archive"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def http_archive(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    excludes: [str.type] = _,\n    exec_deps: str.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    out: [None, str.type] = _,\n    sha1: [None, str.type] = _,\n    sha256: [None, str.type] = _,\n    strip_prefix: [None, str.type] = _,\n    sub_targets: [str.type] = _,\n    type: [None, str.type] = _,\n    urls: [str.type] = _,\n    vpnless_urls: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"http_archive()")," rule is used to download and extract archives from the Internet to be used as dependencies for other rules. These rules are downloaded by running ",(0,i.mdx)("inlineCode",{parentName:"p"},"fetch"),", or can be downloaded as part of ",(0,i.mdx)("inlineCode",{parentName:"p"},"build"),"by setting ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig")),(0,i.mdx)("h4",{id:"parameters-69"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"excludes"),": An optional list of regex patterns. All file paths in the extracted archive which match any of the given patterns will be omitted."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_deps"),": When using http_archive as an anon target, the rule invoking the anon target needs to mirror this attribute into its own attributes, and forward the provider into the anon target invocation.")),(0,i.mdx)("p",null,"When using http_archive normally not as an anon target, the\ndefault value is always fine."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"out"),": An optional name to call the directory that the downloaded artifact is extracted into. Buck will generate a default name if one is not provided that uses the ",(0,i.mdx)("inlineCode",{parentName:"li"},"name")," of the rule."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"sha256"),": The ",(0,i.mdx)("a",{parentName:"li",href:"//wikipedia.org/wiki/SHA-2"},(0,i.mdx)("inlineCode",{parentName:"a"},"SHA-256"))," hash of the downloaded artifact. Buck verifies this is correct and fails the fetch command if it doesn't match in order to guarantee repeatable builds."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"strip_prefix"),": If set, files under this path will be extracted to the root of the output directory. Siblings or cousins to this prefix will not be extracted at all.")),(0,i.mdx)("p",null,"For example, if a tarball has the layout:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"foo/bar/bar-0.1.2/data.dat")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"foo/baz/baz-0.2.3")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},"foo","_","prime/bar-0.1.2"),(0,i.mdx)("p",{parentName:"li"},"Only ",(0,i.mdx)("inlineCode",{parentName:"p"},"data.dat")," will be extracted, and it will be extracted into the output\ndirectory specified in\xc2\xa0",(0,i.mdx)("inlineCode",{parentName:"p"},"http\\_archive()out"),".")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"sub_targets"),": A list of filepaths within the archive to be made accessible as sub-targets. For example if we have an http_archive with ",(0,i.mdx)("inlineCode",{parentName:"p"},'name = "archive"')," and ",(0,i.mdx)("inlineCode",{parentName:"p"},'sub_targets = ["src/lib.rs"]'),", then other targets would be able to refer to that file as ",(0,i.mdx)("inlineCode",{parentName:"p"},'":archive[src/lib.rs]"'),".")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("p",{parentName:"li"},(0,i.mdx)("inlineCode",{parentName:"p"},"type"),": Normally, archive type is determined by the file's extension. If ",(0,i.mdx)("inlineCode",{parentName:"p"},"type")," is set, then autodetection is overridden, and the specified type is used instead."))),(0,i.mdx)("p",null,"Supported values are: ",(0,i.mdx)("inlineCode",{parentName:"p"},"zip"),", ",(0,i.mdx)("inlineCode",{parentName:"p"},"tar"),", ",(0,i.mdx)("inlineCode",{parentName:"p"},"tar.gz"),",\n",(0,i.mdx)("inlineCode",{parentName:"p"},"tar.bz2"),", ",(0,i.mdx)("inlineCode",{parentName:"p"},"tar.xz"),", and ",(0,i.mdx)("inlineCode",{parentName:"p"},"tar.zst"),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"urls"),': A list of urls to attempt to download from. They are tried in order, and subsequent ones are only tried if the download fails. If validation fails, a new URL is not used. Supported protocols are "http", "https", and "mvn".'),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"vpnless_urls"),": Additional URLs from which this resource can be downloaded when off VPN. Meta-internal only.")),(0,i.mdx)("h4",{id:"details-49"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Using ",(0,i.mdx)("inlineCode",{parentName:"p"},"http_archive()"),", third party packages can be downloaded from\nan ",(0,i.mdx)("inlineCode",{parentName:"p"},"https")," URL and used in other library types."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nhttp_archive(\n  name = 'thrift-archive',\n  urls = [\n    'https://internal-mirror.example.com/bin/thrift-compiler-0.1.tar.gz.badextension',\n  ],\n  sha256 = '7baa80df284117e5b945b19b98d367a85ea7b7801bd358ff657946c3bd1b6596',\n  type='tar.gz',\n  strip_prefix='thrift-compiler-0.1'\n)\n\ngenrule(\n  name = 'thrift-compiler-bin',\n  out = 'thrift',\n  cmd = 'cp $(location :thrift-archive)/bin/thrift $OUT',\n  executable = True,\n)\n\ngenrule(\n  name=\"my-thrift-lib-cpp2\",\n  cmd=\"$(exe :thrift-compiler-bin) --gen cpp2 -o $OUT $(location //:thrift-file)\",\n  out=\"gen-cpp2\",\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"http_file"},"http","_","file"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def http_file(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    executable: [None, bool.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    out: [None, str.type] = _,\n    sha1: [None, str.type] = _,\n    sha256: [None, str.type] = _,\n    urls: [str.type] = _,\n    vpnless_urls: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"http_file()")," rule is used to download files from the Internet to be used as dependencies for other rules. This rule only downloads single files, and can optionally make them executable (see ",(0,i.mdx)("inlineCode",{parentName:"p"},"http\\_file()executable"),") These rules are downloaded by running ",(0,i.mdx)("inlineCode",{parentName:"p"},"fetch"),", or can be downloaded as part of ",(0,i.mdx)("inlineCode",{parentName:"p"},"build"),"by setting ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig")),(0,i.mdx)("h4",{id:"parameters-70"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"executable"),": Whether or not the file should be made executable after downloading. If true, this can also be used via ",(0,i.mdx)("inlineCode",{parentName:"li"},"run"),"and the ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(exe )"),"\xa0",(0,i.mdx)("inlineCode",{parentName:"li"},"string parameter macros")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"out"),": An optional name to call the downloaded artifact. Buck will generate a default name if one is not provided that uses the ",(0,i.mdx)("inlineCode",{parentName:"li"},"name")," of the rule."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"sha256"),": The ",(0,i.mdx)("a",{parentName:"li",href:"//wikipedia.org/wiki/SHA-2"},(0,i.mdx)("inlineCode",{parentName:"a"},"SHA-256"))," hash of the downloaded artifact. Buck verifies this is correct and fails the fetch command if it doesn't match in order to guarantee repeatable builds."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"urls"),': A list of urls to attempt to download from. They are tried in order, and subsequent ones are only tried if the download fails. If validation fails, a new URL is not used. Supported protocols are "http", "https", and "mvn".'),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"vpnless_urls"),": Additional URLs from which this resource can be downloaded when off VPN. Meta-internal only.")),(0,i.mdx)("h4",{id:"details-50"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Using ",(0,i.mdx)("inlineCode",{parentName:"p"},"http_file()"),", third party packages can be downloaded from\nan ",(0,i.mdx)("inlineCode",{parentName:"p"},"https")," URL and used in java libraries."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nhttp_file(\n  name = 'guava-23-bin',\n  urls = [\n    'http://search.maven.org/remotecontent?filepath=com/google/guava/guava/23.0/guava-23.0.jar',\n  ],\n  sha256 = '7baa80df284117e5b945b19b98d367a85ea7b7801bd358ff657946c3bd1b6596',\n)\nhttp_file(\n  name = 'guava-23-sources',\n  urls = [\n    'http://search.maven.org/remotecontent?filepath=com/google/guava/guava/23.0/guava-23.0-sources.jar',\n  ],\n  sha256 = '37fe8ba804fb3898c3c8f0cbac319cc9daa58400e5f0226a380ac94fb2c3ca14',\n)\n\nprebuilt_java_library(\n  name = 'guava-23',\n  binary_jar = ':guava-23-bin',\n  source_jar = ':guava-23-source',\n)\n\n")),(0,i.mdx)("p",null," Tooling can also be fetched with ",(0,i.mdx)("inlineCode",{parentName:"p"},"http_file()")," and used by a ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\ngenrule(\n  name=\"my-thrift-lib-cpp2\",\n  cmd=\"$(exe :thrift-compiler-bin) --gen cpp2 -o $OUT $(location //:thrift-file)\",\n  out=\"gen-cpp2\",\n)\n\nhttp_file(\n  name = 'thrift-compiler-bin',\n  url = 'https://internal-mirror.example.com/bin/thrift-compiler',\n  sha256 = 'c24932ccabb66fffb2d7122298f7f1f91e0b1f14e05168e3036333f84bdf58dc',\n  executable = True,\n)\n\n")),(0,i.mdx)("p",null," Here's an example of a ",(0,i.mdx)("inlineCode",{parentName:"p"},"http_file()")," using a mvn URI which uses a Maven classifier."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nhttp_file(\n  name = 'guava-23-bin',\n  urls = [\n    'mvn:com.google.guava:guava:jar:23.0',\n  ],\n  sha256 = '7baa80df284117e5b945b19b98d367a85ea7b7801bd358ff657946c3bd1b6596',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"jar_genrule"},"jar","_","genrule"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def jar_genrule(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _genrule_toolchain: str.type = _,\n    _java_toolchain: str.type = _,\n    bash: [None, str.type] = _,\n    cacheable: [None, bool.type] = _,\n    cmd: [None, str.type] = _,\n    cmd_exe: [None, str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    enable_sandbox: [None, bool.type] = _,\n    environment_expansion_separator: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    metadata_env_var: [None, str.type] = _,\n    metadata_path: [None, str.type] = _,\n    need_android_tools: bool.type = _,\n    no_outputs_cleanup: bool.type = _,\n    remote: [None, bool.type] = _,\n    srcs: [[str.type], {str.type: str.type}] = _,\n    type: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-71"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"java_annotation_processor"},"java","_","annotation","_","processor"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def java_annotation_processor(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _build_only_native_code: bool.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    does_not_affect_abi: bool.type = _,\n    isolate_class_loader: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    processor_class: str.type = _,\n    supports_abi_generation_from_source: bool.type = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-72"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"java_binary"},"java","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def java_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _build_only_native_code: bool.type = _,\n    _java_toolchain: str.type = _,\n    blacklist: [str.type] = _,\n    contacts: [str.type] = _,\n    default_cxx_platform: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    do_not_create_inner_jar: bool.type = _,\n    generate_wrapper: bool.type = _,\n    java_args_for_run_info: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    main_class: [None, str.type] = _,\n    manifest_file: [None, str.type] = _,\n    meta_inf_directory: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"java_binary()")," rule is used to create a JAR file of the compiled .class files and resources of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"java_library()")," rules on which it depends."),(0,i.mdx)("h4",{id:"parameters-73"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"blacklist"),": A list of patterns that identify files to exclude from the final generated JAR file. Example:")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\njava_binary(\n  name = 'example',\n  blacklist = [\n    # Excludes com.example.A and com.example.Alligator,\n    # as well as their inner classes and any non-class files that happen to match\n    # the pattern\n    'com.example.A',\n\n    # Excludes all files from org/slf4j/**/*.\n    'org.slf4j',\n  ],\n  deps = [\n    ':example1',\n    ':third-party-stuff',\n  ],\n)\n\n")),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Rules (normally of type ",(0,i.mdx)("inlineCode",{parentName:"li"},"java_library"),") that should be compiled and whose ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," files and resources should be included in the generated JAR file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"main_class"),": If provided, this will be the value specified as the ",(0,i.mdx)("inlineCode",{parentName:"li"},"Main-Class")," attribute of the ",(0,i.mdx)("inlineCode",{parentName:"li"},"META-INF/MANIFEST.MF")," file in the generated JAR file. Also, when this rule is used as an executable in a ",(0,i.mdx)("inlineCode",{parentName:"li"},"genrule()"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"main_class")," will indicate the class whose ",(0,i.mdx)("inlineCode",{parentName:"li"},"main()")," method will be invoked to process the command-line arguments. This is consistent with the expected usage of ",(0,i.mdx)("inlineCode",{parentName:"li"},"java -jar *<name.jar>* *<args>*"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"manifest_file"),": If provided, this manifest will be used when generating the JAR file. If combined with ",(0,i.mdx)("inlineCode",{parentName:"li"},"main_class"),", the specified manifest file will be used but the ",(0,i.mdx)("inlineCode",{parentName:"li"},"main_class")," will override the main class in the manifest.")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"java_library"},"java","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def java_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _build_only_native_code: bool.type = _,\n    _dex_min_sdk_version: [None, int.type] = _,\n    _dex_toolchain: [None, str.type] = _,\n    _is_building_android_binary: bool.type = _,\n    _java_toolchain: str.type = _,\n    abi_generation_mode: [None, str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    manifest_file: [None, str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    srcs: [str.type] = _,\n    target: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"java_library()")," rule defines a set of Java files that can be compiled together. The main output of a ",(0,i.mdx)("inlineCode",{parentName:"p"},"java_library()")," rule is a single JAR file containing all of the compiled class files, as well as the static files specified in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"resources")," argument."),(0,i.mdx)("h4",{id:"parameters-74"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Rules (usually other ",(0,i.mdx)("inlineCode",{parentName:"li"},"java_library")," rules) that are used to generate the classpath required to compile this ",(0,i.mdx)("inlineCode",{parentName:"li"},"java_library"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),": Other  rules that depend on this rule will also include its ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps")," in their classpaths. This is useful when the public API of a rule has return types or checked exceptions that are defined in another rule, which would otherwise require callers to add an extra dependency. It's also useful for exposing e.g. a collection of ",(0,i.mdx)("inlineCode",{parentName:"li"},"prebuilt_jar")," rules as a single target for callers to depend on. Targets in ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps")," are implicitly included in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps")," of this rule, so they don't need to be repeated there."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_provided_deps"),": This is a combination of ",(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),". Rules listed in this parameter will be added to classpath of rules that depend on this rule, but they will not be included in a binary if binary depends on a such target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_arguments"),": List of additional arguments to pass into the Java compiler. These arguments follow the ones specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"java_version"),": Equivalent to setting both ",(0,i.mdx)("inlineCode",{parentName:"li"},"source")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"target"),"  to the given value. Setting this and ",(0,i.mdx)("inlineCode",{parentName:"li"},"source")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"target")," (or both!) is an error."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"on_unused_dependencies"),": Action performed when Buck detects that some dependencies are not used during Java compilation.")),(0,i.mdx)("p",null,"Note that this feature is experimental and does not handle runtime dependencies."),(0,i.mdx)("p",null,"The valid values are:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"ignore")," (default): ignore unused dependencies,"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"warn"),": emit a warning to the console,"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"fail"),": fail the compilation.")),(0,i.mdx)("p",null,"This option overrides the default value from\n."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps"),": These represent dependencies that are known to be provided at run time, but are required in order for the code to compile. Examples of ",(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps")," include the JEE servlet APIs. When this rule is included in a , the ",(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps")," will not be packaged into the output."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"remove_classes"),": Specifies a list of ",(0,i.mdx)("inlineCode",{parentName:"li"},"Patterns")," that are used to exclude ",(0,i.mdx)("inlineCode",{parentName:"li"},"classes")," from the ",(0,i.mdx)("inlineCode",{parentName:"li"},"JAR"),". The pattern matching is based on the name of the class. This can be used to exclude a member class or delete a local view of a class that will be replaced during a later stage of the build."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"required_for_source_only_abi"),": Indicates that this rule must be present on the classpath during ",(0,i.mdx)("inlineCode",{parentName:"li"},"source-only ABI generation")," of any rule that depends on it. Typically this is done when a rule contains annotations, enums, constants, or interfaces.")),(0,i.mdx)("p",null,"Having rules present on the classpath during source-only ABI generation prevents Buck from\ncompletely flattening the build graph, thus reducing the performance win from source-only\nABI generation. These rules should be kept small (ideally just containing annotations,\nconstants, enums, and interfaces) and with minimal dependencies of their own."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": Static files to include with the compiled ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," files. These files can be loaded via ",(0,i.mdx)("a",{parentName:"li",href:"http://docs.oracle.com/javase/7/docs/api/java/lang/Class.html#getResource(java.lang.String)"},"Class.getResource()"),".")),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Note:")," If ",(0,i.mdx)("inlineCode",{parentName:"p"},"resources_root")," isn't set,\nBuck uses the ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"\nproperty in ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig")," to\ndetermine where resources should be placed within the generated JAR\nfile."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"source"),': Specifies the version of Java (as a string) to interpret source files as. Overrides the value in "source',"_",'level" in the "java" section of ',(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"source_only_abi_deps"),": These are dependencies that must be present during ",(0,i.mdx)("inlineCode",{parentName:"li"},"source-only ABI generation"),". Typically such dependencies are added when some property of the code in this rule prevents source-only ABI generation from being correct without these dependencies being present.")),(0,i.mdx)("p",null,"Having ",(0,i.mdx)("inlineCode",{parentName:"p"},"source_only_abi_deps")," prevents Buck from\ncompletely flattening the build graph, thus reducing the performance win from source-only\nABI generation. They should be avoided when possible. Often only a small code change is needed to avoid them.\nFor more information on such code changes, read about\n",(0,i.mdx)("inlineCode",{parentName:"p"},"source-only ABI generation"),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of ",(0,i.mdx)("inlineCode",{parentName:"li"},".java")," files to compile for this rule. If any of the files in this list end in ",(0,i.mdx)("inlineCode",{parentName:"li"},".src.zip"),", then the entries in the ZIP file that end in ",(0,i.mdx)("inlineCode",{parentName:"li"},".java")," will be included as ordinary inputs to compilation. This is common when using a ",(0,i.mdx)("inlineCode",{parentName:"li"},"genrule()"),"to auto-generate some Java source code that needs to be compiled with some hand-written Java code."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target"),': Specifies the version of Java (as a string) for which to generate code. Overrides the value in "target',"_",'level" in the "java" section of ',(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),".")),(0,i.mdx)("h4",{id:"details-51"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that compiles a single .java file.\njava_library(\n  name = 'JsonUtil',\n  srcs = ['JsonUtil.java'],\n  deps = [\n    '//third_party/guava:guava',\n    '//third_party/jackson:jackson',\n  ],\n)\n\n# A rule that compiles all of the .java files under the directory in\n# which the rule is defined using glob(). It also excludes an\n# individual file that may have additional dependencies, so it is\n# compiled by a separate rule.\njava_library(\n  name = 'messenger',\n  srcs = glob(['**/*.java'], excludes = ['MessengerModule.java']),\n  deps = [\n    '//src/com/facebook/base:base',\n    '//third_party/guava:guava',\n  ],\n)\n\njava_library(\n  name = 'MessengerModule',\n  srcs = ['MessengerModule.java'],\n  deps = [\n    '//src/com/facebook/base:base',\n    '//src/com/google/inject:inject',\n    '//third_party/guava:guava',\n    '//third_party/jsr-330:jsr-330',\n  ],\n)\n\n# A rule that builds a library with both relative and\n# fully-qualified deps.\njava_library(\n  name = 'testutil',\n  srcs = glob(['tests/**/*.java'], excludes = 'tests/**/*Test.java'),\n  deps = [\n    ':lib-fb4a',\n    '//java/com/facebook/base:base',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"java_plugin"},"java","_","plugin"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def java_plugin(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _build_only_native_code: bool.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    does_not_affect_abi: bool.type = _,\n    isolate_class_loader: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    plugin_name: str.type = _,\n    supports_abi_generation_from_source: bool.type = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-75"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"java_test"},"java","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def java_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _build_only_native_code: bool.type = _,\n    _inject_test_env: str.type = _,\n    _is_building_android_binary: bool.type = _,\n    _java_test_toolchain: str.type = _,\n    _java_toolchain: str.type = _,\n    abi_generation_mode: [None, str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_library_whitelist: [str.type] = _,\n    default_cxx_platform: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    fork_mode: str.type = _,\n    java: [None, str.type] = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    manifest_file: [None, str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    run_test_separately: bool.type = _,\n    runner: [None, str.type] = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    specs: [None, str.type] = _,\n    srcs: [str.type] = _,\n    std_err_log_level: [None, int.type, str.type] = _,\n    std_out_log_level: [None, int.type, str.type] = _,\n    target: [None, str.type] = _,\n    test_case_timeout_ms: [None, int.type] = _,\n    test_rule_timeout_ms: [None, int.type] = _,\n    test_type: [None, str.type] = _,\n    use_cxx_libraries: [None, bool.type] = _,\n    use_dependency_order_classpath: [None, bool.type] = _,\n    vm_args: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"java_test()")," rule is used to define a set of ",(0,i.mdx)("inlineCode",{parentName:"p"},".java")," files that contain tests to run via JUnit."),(0,i.mdx)("h4",{id:"parameters-76"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"cxx_library_whitelist"),": EXPERIMENTAL. List of cxx","_","libraries to build, if use","_","cxx","_","libraries is true. This can be useful if some dependencies are Android-only and won't build on the default platform."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Same as ",(0,i.mdx)("inlineCode",{parentName:"li"},"java_library()"),". // org.junit.rules.Timeout was not introduced until 4.7. Must include JUnit (version 4.7 or later) as a dependency for JUnit tests. Must include TestNG (version 6.2 or later) and hamcrest as a dependencies for TestNG tests."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": A map of environment names and values to set when running the test."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"fork_mode"),": Controls whether tests will all be run in the same process or a process will be started for each set of tests in a class.")),(0,i.mdx)("p",null,"(This is mainly useful when porting Java tests to Buck from Apache Ant which\nallows JUnit tasks to set a ",(0,i.mdx)("inlineCode",{parentName:"p"},'fork="yes"')," property. It should not be\nused for new tests since it encourages tests to not cleanup after themselves and\nincreases the tests' computational resources and running time.)"),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"none"),"\nAll tests will run in the same process.\n",(0,i.mdx)("inlineCode",{parentName:"p"},"per_test"),"\nA process will be started for each test class in which all tests of that test class\nwill run."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": A list of labels to be applied to these tests. These labels are arbitrary text strings and have no meaning within buck itself. They can, however, have meaning for you as a test author (e.g., ",(0,i.mdx)("inlineCode",{parentName:"li"},"smoke")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"fast"),"). A label can be used to filter or include a specific test rule when executing ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck test")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": Same as ",(0,i.mdx)("inlineCode",{parentName:"li"},"java_library()"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"source"),": Java language level for compiling. Corresponds to the ",(0,i.mdx)("inlineCode",{parentName:"li"},"-source")," argument for ",(0,i.mdx)("inlineCode",{parentName:"li"},"javac"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": Like ",(0,i.mdx)("inlineCode",{parentName:"li"},"java_library()"),", all of the ",(0,i.mdx)("inlineCode",{parentName:"li"},".java")," files specified by the ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," argument will be compiled when this rule is built. In addition, all of the corresponding ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," files that are built by this rule will be passed as arguments to JUnit when this rule is run as a test. ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," files that are passed to JUnit that do not have any methods annotated with ",(0,i.mdx)("inlineCode",{parentName:"li"},"@Test")," are considered failed tests, so make sure that only test case classes are specified as ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),". This is frequently done by specifying ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," as ",(0,i.mdx)("inlineCode",{parentName:"li"},"glob(['**/*Test.java'])"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"std_err_log_level"),": Same as ",(0,i.mdx)("inlineCode",{parentName:"li"},"std_out_log_level"),", but for std err."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"std_out_log_level"),": Log level for messages from the source under test that buck will output to std out. Value must be a valid ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.logging.Level")," value."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target"),": Bytecode target level for compiling. Corresponds to the ",(0,i.mdx)("inlineCode",{parentName:"li"},"-target")," argument for ",(0,i.mdx)("inlineCode",{parentName:"li"},"javac"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"test_rule_timeout_ms"),": If set specifies the maximum amount of time (in milliseconds) in which all of the tests in this rule should complete. This overrides the default ",(0,i.mdx)("inlineCode",{parentName:"li"},"rule_timeout")," if any has been specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig")," ."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"test_type"),": Specifies which test framework to use. The currently supported options are 'junit' and 'testng'."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"use_cxx_libraries"),": Whether or not to build and link against ",(0,i.mdx)("inlineCode",{parentName:"li"},"cxx\\_library()"),"dependencies when testing."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"vm_args"),": Runtime arguments to the JVM running the tests.")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"java_test_runner"},"java","_","test","_","runner"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def java_test_runner(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    abi_generation_mode: [None, str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    main_class: str.type = _,\n    manifest_file: [None, str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    srcs: [str.type] = _,\n    target: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-77"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"js_bundle"},"js","_","bundle"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def js_bundle(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _is_release: bool.type = _,\n    _platform: str.type = _,\n    android_package: [None, str.type] = _,\n    bundle_name: [None, str.type] = _,\n    bundle_name_for_flavor: [(str.type, str.type)] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    entry: [str.type, [str.type]],\n    extra_json: [None, str.type] = _,\n    fallback_transform_profile: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    worker: str.type\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-78"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"js_bundle_genrule"},"js","_","bundle","_","genrule"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def js_bundle_genrule(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _genrule_toolchain: str.type = _,\n    _is_release: bool.type = _,\n    _platform: str.type = _,\n    bash: [None, str.type] = _,\n    bundle_name: [None, str.type] = _,\n    bundle_name_for_flavor: [(str.type, str.type)] = _,\n    cacheable: [None, bool.type] = _,\n    cmd: [None, str.type] = _,\n    cmd_exe: [None, str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    enable_sandbox: [None, bool.type] = _,\n    environment_expansion_separator: [None, str.type] = _,\n    js_bundle: str.type,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    metadata_env_var: [None, str.type] = _,\n    metadata_path: [None, str.type] = _,\n    need_android_tools: bool.type = _,\n    no_outputs_cleanup: bool.type = _,\n    remote: [None, bool.type] = _,\n    rewrite_deps_file: bool.type = _,\n    rewrite_misc: bool.type = _,\n    rewrite_sourcemap: bool.type = _,\n    skip_resources: bool.type = _,\n    srcs: [[str.type], {str.type: str.type}] = _,\n    type: str.type = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-79"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"js_library"},"js","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def js_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _build_only_native_code: bool.type = _,\n    _is_release: bool.type = _,\n    _platform: str.type = _,\n    asset_extensions: [None, [str.type]] = _,\n    asset_platforms: [None, [str.type]] = _,\n    base_path: [None, str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    extra_json: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    srcs: [[str.type, (str.type, str.type)]] = _,\n    worker: str.type\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-80"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"julia_binary"},"julia","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def julia_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _julia_toolchain: str.type = _,\n    deps: [str.type] = _,\n    julia_args: [str.type] = _,\n    julia_flags: [str.type] = _,\n    main: str.type,\n    srcs: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-81"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"julia_jll_library"},"julia","_","jll","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def julia_jll_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _julia_toolchain: str.type = _,\n    jll_name: str.type,\n    lib_mapping: [[str.type], {str.type: str.type}],\n    uuid: str.type\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-82"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"julia_library"},"julia","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def julia_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _julia_toolchain: str.type = _,\n    deps: [str.type] = _,\n    project_toml: str.type,\n    resources: [str.type] = _,\n    srcs: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-83"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"julia_test"},"julia","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def julia_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _inject_test_env: str.type = _,\n    _julia_toolchain: str.type = _,\n    contacts: [str.type] = _,\n    deps: [str.type] = _,\n    julia_args: [str.type] = _,\n    julia_flags: [str.type] = _,\n    main: str.type,\n    srcs: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-84"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"keystore"},"keystore"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def keystore(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    properties: str.type,\n    store: str.type\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"keystore()")," contains the data for a key pair created by the ",(0,i.mdx)("inlineCode",{parentName:"p"},"keytool")," executable that comes with the JDK. This is a required input for an ",(0,i.mdx)("inlineCode",{parentName:"p"},"android\\_binary()"),"rule."),(0,i.mdx)("h4",{id:"parameters-85"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"properties"),": The path to the ",(0,i.mdx)("inlineCode",{parentName:"li"},".properties")," file that contains the following values:")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n# The value that you passed as the argument to -alias\n# when you ran keytool.\nkey.alias=my_alias\n\n# The value that you entered in response to\n# the "Enter keystore password:" prompt.\nkey.store.password=store_password\n\n# The value that you entered in response to\n# the "Enter key password for <my_alias>" prompt.\nkey.alias.password=alias_password\n')),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"store"),": The path to the file that contains the key. This is the path that was passed as the ",(0,i.mdx)("inlineCode",{parentName:"li"},"-keystore")," argument when you ran ",(0,i.mdx)("inlineCode",{parentName:"li"},"keytool"),".")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"kotlin_library"},"kotlin","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def kotlin_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _build_only_native_code: bool.type = _,\n    _dex_min_sdk_version: [None, int.type] = _,\n    _dex_toolchain: [None, str.type] = _,\n    _is_building_android_binary: bool.type = _,\n    _java_toolchain: str.type = _,\n    _kotlin_toolchain: str.type = _,\n    abi_generation_mode: [None, str.type] = _,\n    annotation_processing_tool: [None, str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    extra_kotlinc_arguments: [str.type] = _,\n    extra_non_source_only_abi_kotlinc_arguments: [str.type] = _,\n    friend_paths: [str.type] = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    kotlin_compiler_plugins: {str.type: {str.type: str.type}} = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    manifest_file: [None, str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    srcs: [str.type] = _,\n    target: [None, str.type] = _,\n    use_jvm_abi_gen: [None, bool.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"kotlin_library()")," rule is used to define a set of Kotlin files that can be compiled together. The main output of a ",(0,i.mdx)("inlineCode",{parentName:"p"},"kotlin_library()")," rule is a single JAR file containing all of the compiled class files, as well as the static files specified in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"resources")," argument."),(0,i.mdx)("h4",{id:"parameters-86"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"annotation_processing_tool"),': Specifies the tool to use for annotation processing. Possible values: "kapt" or "javac". "kapt" allows running Java annotation processors against Kotlin sources while backporting it for Java sources too. "javac" works only against Java sources, Kotlin sources won\'t have access to generated classes at compile time.'),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Rules (usually other ",(0,i.mdx)("inlineCode",{parentName:"li"},"kotlin_library")," rules) that are used to generate the classpath required to compile this ",(0,i.mdx)("inlineCode",{parentName:"li"},"kotlin_library"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),": Other  rules that depend on this rule will also include its ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps")," in their classpaths. This is useful when the public API of a rule has return types or checked exceptions that are defined in another rule, which would otherwise require callers to add an extra dependency. It's also useful for exposing e.g. a collection of ",(0,i.mdx)("inlineCode",{parentName:"li"},"prebuilt_jar")," rules as a single target for callers to depend on. Targets in ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps")," are implicitly included in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps")," of this rule, so they don't need to be repeated there."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_provided_deps"),": This is a combination of ",(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),". Rules listed in this parameter will be added to classpath of rules that depend on this rule, but they will not be included in a binary if binary depends on a such target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_kotlinc_arguments"),": List of additional arguments to pass into the Kotlin compiler."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"friend_paths"),": List of source paths to pass into the Kotlin compiler as friend-paths, that is, modules you can have access to internal methods."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"kotlin_compiler_plugins"),": Use this to specify ",(0,i.mdx)("a",{parentName:"li",href:"https://kotlinlang.org/docs/reference/compiler-plugins.html"},"Kotlin compiler plugins")," to use when compiling this library. This takes a map, with each entry specify one plugin. Entry's key is plugin source path, and value is a map of plugin option key value pair. Unlike ",(0,i.mdx)("inlineCode",{parentName:"li"},"extra_kotlinc_arguments"),", these can be ",(0,i.mdx)("em",{parentName:"li"},"source paths"),", not just strings.")),(0,i.mdx)("p",null,"A special option value is\n",(0,i.mdx)("inlineCode",{parentName:"p"},"__codegen_dir__"),", in which case Buck will provide a default codegen folder's path as\noption value instead.\nE.g."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\nkotlin_compiler_plugins = {\n    "somePluginSourcePath": {\n        "plugin:somePluginId:somePluginOptionKey": "somePluginOptionValue",\n        "plugin:somePluginId:someDirectoryRelatedOptionKey": "__codegen_dir__",\n    },\n},\n\n')),(0,i.mdx)("p",null,"Each plugin source path will be prefixed with ",(0,i.mdx)("inlineCode",{parentName:"p"},"-Xplugin=")," and passed as extra\narguments to the compiler. Plugin options will be appended after its plugin with ",(0,i.mdx)("inlineCode",{parentName:"p"},"-P"),"."),(0,i.mdx)("p",null," A specific example is, if you want to use ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/Kotlin/kotlinx.serialization"},"kotlinx.serialization"),"\nwith ",(0,i.mdx)("inlineCode",{parentName:"p"},"kotlin_library()"),", you need to specify ",(0,i.mdx)("inlineCode",{parentName:"p"},"kotlinx-serialization-compiler-plugin.jar")," under ",(0,i.mdx)("inlineCode",{parentName:"p"},"kotlin_compiler_plugins")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"kotlinx-serialization-runtime.jar")," (which you may have to fetch from Maven) in your ",(0,i.mdx)("inlineCode",{parentName:"p"},"deps"),":"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\nkotlin_library(\n    name = "example",\n    srcs = glob(["*.kt"]),\n    deps = [\n        ":kotlinx-serialization-runtime",\n    ],\n    kotlin_compiler_plugins = {\n        # Likely copied from your $KOTLIN_HOME directory.\n        "kotlinx-serialization-compiler-plugin.jar": {},\n    },\n)\n\nprebuilt_jar(\n    name = "kotlinx-serialization-runtime",\n    binary_jar = ":kotlinx-serialization-runtime-0.10.0",\n)\n\n# Note you probably want to set\n# maven_repo=http://jcenter.bintray.com/ in your .buckconfig until\n# https://github.com/Kotlin/kotlinx.serialization/issues/64\n# is closed.\nremote_file(\n    name = "kotlinx-serialization-runtime-0.10.0",\n    out = "kotlinx-serialization-runtime-0.10.0.jar",\n    url = "mvn:org.jetbrains.kotlinx:kotlinx-serialization-runtime:jar:0.10.0",\n    sha1 = "23d777a5282c1957c7ce35946374fff0adab114c"\n)\n\n')),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": Set of arbitrary strings which allow you to annotate a ",(0,i.mdx)("inlineCode",{parentName:"li"},"build rule"),"with tags that can be searched for over an entire dependency tree using ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck query()")," ."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps"),": These represent dependencies that are known to be provided at run time, but are required in order for the code to compile. Examples of ",(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps")," include the JEE servlet APIs. When this rule is included in a , the ",(0,i.mdx)("inlineCode",{parentName:"li"},"provided_deps")," will not be packaged into the output."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"remove_classes"),": Specifies a list of ",(0,i.mdx)("inlineCode",{parentName:"li"},"Patterns")," that are used to exclude ",(0,i.mdx)("inlineCode",{parentName:"li"},"classes")," from the ",(0,i.mdx)("inlineCode",{parentName:"li"},"JAR"),". The pattern matching is based on the name of the class. This can be used to exclude a member class or delete a local view of a class that will be replaced during a later stage of the build."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": Static files to include with the compiled ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," files. These files can be loaded via ",(0,i.mdx)("a",{parentName:"li",href:"http://docs.oracle.com/javase/7/docs/api/java/lang/Class.html#getResource(java.lang.String)"},"Class.getResource()"),".")),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Note:")," If ",(0,i.mdx)("inlineCode",{parentName:"p"},"resources_root")," isn't set,\nBuck uses the ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"\nproperty in ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig")," to\ndetermine where resources should be placed within the generated JAR\nfile."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of ",(0,i.mdx)("inlineCode",{parentName:"li"},".kt"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},".java")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},".kts")," files to compile for this rule. If any of the files in this list end in ",(0,i.mdx)("inlineCode",{parentName:"li"},".src.zip"),", then the entries in the ZIP file that end in ",(0,i.mdx)("inlineCode",{parentName:"li"},".java")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},".kt")," will be included as ordinary inputs to compilation.")),(0,i.mdx)("h4",{id:"details-52"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that compiles a single .kt file.\nkotlin_library(\n  name = 'JsonUtil',\n  srcs = ['JsonUtil.kt'],\n  deps = [\n    '//third_party/guava:guava',\n    '//third_party/jackson:jackson',\n  ],\n)\n\n# A rule that compiles all of the .kt files under the directory in\n# which the rule is defined using glob(). It also excludes an\n# individual file that may have additional dependencies, so it is\n# compiled by a separate rule.\nkotlin_library(\n  name = 'messenger',\n  srcs = glob(['**/*.kt'], excludes = ['MessengerModule.kt']),\n  deps = [\n    '//src/com/facebook/base:base',\n    '//third_party/guava:guava',\n  ],\n)\n\nkotlin_library(\n  name = 'MessengerModule',\n  srcs = ['MessengerModule.kt'],\n  deps = [\n    '//src/com/facebook/base:base',\n    '//src/com/google/inject:inject',\n    '//third_party/guava:guava',\n    '//third_party/jsr-330:jsr-330',\n  ],\n)\n\n# A rule that builds a library with both relative and\n# fully-qualified deps.\nkotlin_library(\n  name = 'testutil',\n  srcs = glob(['tests/**/*.kt'], excludes = 'tests/**/*Test.kt'),\n  deps = [\n    ':lib-fb4a',\n    '//java/com/facebook/base:base',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"kotlin_test"},"kotlin","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def kotlin_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _build_only_native_code: bool.type = _,\n    _inject_test_env: str.type = _,\n    _is_building_android_binary: bool.type = _,\n    _java_test_toolchain: str.type = _,\n    _java_toolchain: str.type = _,\n    _kotlin_toolchain: str.type = _,\n    abi_generation_mode: [None, str.type] = _,\n    annotation_processing_tool: [None, str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_library_whitelist: [str.type] = _,\n    default_cxx_platform: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    extra_kotlinc_arguments: [str.type] = _,\n    extra_non_source_only_abi_kotlinc_arguments: [str.type] = _,\n    fork_mode: str.type = _,\n    friend_paths: [str.type] = _,\n    java: [None, str.type] = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    kotlin_compiler_plugins: {str.type: {str.type: str.type}} = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    manifest_file: [None, str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    run_test_separately: bool.type = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    srcs: [str.type] = _,\n    std_err_log_level: [None, int.type, str.type] = _,\n    std_out_log_level: [None, int.type, str.type] = _,\n    target: [None, str.type] = _,\n    test_case_timeout_ms: [None, int.type] = _,\n    test_rule_timeout_ms: [None, int.type] = _,\n    test_type: [None, str.type] = _,\n    use_cxx_libraries: [None, bool.type] = _,\n    use_dependency_order_classpath: [None, bool.type] = _,\n    use_jvm_abi_gen: [None, bool.type] = _,\n    vm_args: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"kotlin_test()")," rule is used to define a set of ",(0,i.mdx)("inlineCode",{parentName:"p"},".kt")," files that contain tests to run via JUnit."),(0,i.mdx)("h4",{id:"parameters-87"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Same as ",(0,i.mdx)("inlineCode",{parentName:"li"},"kotlin\\_library()"),". // org.junit.rules.Timeout was not introduced until 4.7. Must include JUnit (version 4.7 or later) as a dependency for JUnit tests. Must include TestNG (version 6.2 or later) and hamcrest as a dependencies for TestNG tests."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": A map of environment names and values to set when running the test."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"fork_mode"),": Controls whether tests will all be run in the same process or a process will be started for each set of tests in a class.")),(0,i.mdx)("p",null,"(This is mainly useful when porting Java tests to Buck from Apache Ant which\nallows JUnit tasks to set a ",(0,i.mdx)("inlineCode",{parentName:"p"},'fork="yes"')," property. It should not be\nused for new tests since it encourages tests to not cleanup after themselves and\nincreases the tests' computational resources and running time.)"),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"none"),"\nAll tests will run in the same process.\n",(0,i.mdx)("inlineCode",{parentName:"p"},"per_test"),"\nA process will be started for each test class in which all tests of that test class\nwill run."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": A list of labels to be applied to these tests. These labels are arbitrary text strings and have no meaning within buck itself. They can, however, have meaning for you as a test author (e.g., ",(0,i.mdx)("inlineCode",{parentName:"li"},"smoke")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"fast"),"). A label can be used to filter or include a specific test rule when executing ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck test")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": Same as ",(0,i.mdx)("inlineCode",{parentName:"li"},"kotlin\\_library()"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": Like ",(0,i.mdx)("inlineCode",{parentName:"li"},"kotlin_library()"),", all of the ",(0,i.mdx)("inlineCode",{parentName:"li"},".kt")," files specified by the ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," argument will be compiled when this rule is built. In addition, all of the corresponding ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," files that are built by this rule will be passed as arguments to JUnit when this rule is run as a test. ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," files that are passed to JUnit that do not have any methods annotated with ",(0,i.mdx)("inlineCode",{parentName:"li"},"@Test")," are considered failed tests, so make sure that only test case classes are specified as ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),". This is frequently done by specifying ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," as ",(0,i.mdx)("inlineCode",{parentName:"li"},"glob(['**/*Test.kt'])"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"std_err_log_level"),": Same as ",(0,i.mdx)("inlineCode",{parentName:"li"},"std_out_log_level"),", but for std err."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"std_out_log_level"),": Log level for messages from the source under test that buck will output to std out. Value must be a valid ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.logging.Level")," value."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"test_rule_timeout_ms"),": If set specifies the maximum amount of time (in milliseconds) in which all of the tests in this rule should complete. This overrides the default ",(0,i.mdx)("inlineCode",{parentName:"li"},"rule_timeout")," if any has been specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig")," ."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"test_type"),": Specifies which test framework to use. The currently supported options are 'junit' and 'testng'."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"vm_args"),": Runtime arguments to the JVM running the tests.")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"legacy_toolchain"},"legacy","_","toolchain"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def legacy_toolchain(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    toolchain_name: str.type = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-88"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"lua_binary"},"lua","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def lua_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    main_module: str.type = _,\n    native_starter_library: [None, str.type] = _,\n    package_style: [None, str.type] = _,\n    platform: [None, str.type] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    python_platform: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"lua_library()")," rule is used to group together Lua sources to be packaged into a top-level ",(0,i.mdx)("inlineCode",{parentName:"p"},"lua\\_binary()"),"rule."),(0,i.mdx)("h4",{id:"parameters-89"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": ",(0,i.mdx)("inlineCode",{parentName:"li"},"lua\\_library()"),"rules to this binary will access."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"main_module"),": The module which serves as the entry point for this rule.")),(0,i.mdx)("h4",{id:"details-53"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nlua_binary(\n  name = 'tailer',\n  main_module = 'tailer',\n  deps = [\n    ':tailerutils',\n  ],\n)\n\nlua_library(\n  name = 'tailerutils',\n  srcs = glob(['*.lua']),\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"lua_library"},"lua","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def lua_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    base_module: [None, str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    srcs: [[str.type], {str.type: str.type}] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"lua_library()")," rule is used to group together Lua sources to be packaged into a top-level ",(0,i.mdx)("inlineCode",{parentName:"p"},"lua\\_binary()"),"rule."),(0,i.mdx)("h4",{id:"parameters-90"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"base_module"),": The package for which the given specified sources and resources should reside in their final location in the top-level binary. If unset, the project relative directory that houses the BUCK file is used."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Other ",(0,i.mdx)("inlineCode",{parentName:"li"},"lua_library()")," rules which list ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," from which this rule imports modules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of ",(0,i.mdx)("inlineCode",{parentName:"li"},".lua")," files included in this library.")),(0,i.mdx)("h4",{id:"details-54"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that includes a single .py file.\nlua_library(\n  name = 'fileutil',\n  srcs = ['fileutil.lua'],\n)\n\n# A rule that uses glob() to include all sources in the directory which the\n# rule is defined.  It also lists a resource file that gets packaged with\n# the sources in this rule.\nlua_library(\n  name = 'testutil',\n  srcs = glob(['testutil/**/*.lua'],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"ndk_library"},"ndk","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def ndk_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    flags: [str.type] = _,\n    is_asset: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    srcs: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"ndk_library()")," is used to define a set of C/C++ files, an ",(0,i.mdx)("inlineCode",{parentName:"p"},"Android.mk")," and an ",(0,i.mdx)("inlineCode",{parentName:"p"},"Application.mk")," file that are used by the NDK's ",(0,i.mdx)("inlineCode",{parentName:"p"},"ndk-build")," tool to generate one or more shared objects."),(0,i.mdx)("h4",{id:"parameters-91"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": List of build targets to build before this rule."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"flags"),": Array of strings passed verbatim to ",(0,i.mdx)("inlineCode",{parentName:"li"},"ndk-build"),". Normally this is not needed, but in some cases you may want to put something here. For example, this can be used to build the libraries in debug mode (",(0,i.mdx)("inlineCode",{parentName:"li"},"NDK_DEBUG=1"),") or set the number of jobs spawned by ",(0,i.mdx)("inlineCode",{parentName:"li"},"ndk-build")," (by default, the same as the number of cores)."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"is_asset"),": Normally native shared objects end up in a directory in the root of the APK named ",(0,i.mdx)("inlineCode",{parentName:"li"},"lib/"),". If this parameter is set to ",(0,i.mdx)("inlineCode",{parentName:"li"},"True"),", then these objects are placed in ",(0,i.mdx)("inlineCode",{parentName:"li"},"assets/lib/"),". Placing shared objects in a non-standard location prevents Android from extracting them to the device's internal storage."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of files to compile for this rule. If not provided, ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck")," assumes that all files with the following extensions are part of the build: ",(0,i.mdx)("inlineCode",{parentName:"li"},"c, cpp, cc, cxx, h, hpp, mk"),".")),(0,i.mdx)("h4",{id:"details-55"},"Details"),(0,i.mdx)("p",null,"Additional notes:"),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"android_binary()")," that includes this library will\naggregate all of the native shared objects into a directory in the\nroot of the APK named ",(0,i.mdx)("inlineCode",{parentName:"p"},"lib/")," or ",(0,i.mdx)("inlineCode",{parentName:"p"},"assets/lib/"),"."),(0,i.mdx)("p",null,"Unlike the default invocation of ",(0,i.mdx)("inlineCode",{parentName:"p"},"ndk-build"),",\n",(0,i.mdx)("inlineCode",{parentName:"p"},"buck")," will put all intermediate files and build output\ninto a subdirectory under ",(0,i.mdx)("inlineCode",{parentName:"p"},"buck-out/gen"),"."),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"ndk_toolchain"},"ndk","_","toolchain"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def ndk_toolchain(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_runtime: [None, str.type] = _,\n    cxx_toolchain: str.type,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    objdump: str.type,\n    shared_runtime_path: [None, str.type] = _,\n    strip_apk_libs_flags: [None, [str.type]] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-92"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"ocaml_binary"},"ocaml","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def ocaml_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _ocaml_toolchain: str.type = _,\n    bytecode_only: [None, bool.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    linker_flags: [str.type] = _,\n    ocamldep_flags: [str.type] = _,\n    platform: [None, str.type] = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    srcs: [None, [str.type], {str.type: str.type}] = _,\n    warnings_flags: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ocaml","_","binary() rule builds both native and bytecode executables from the supplied set of OCaml and C source files and dependencies."),(0,i.mdx)("h4",{id:"parameters-93"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": The set of additional compiler flags to pass to ocaml compiler. It supports specifying ppx (see ",(0,i.mdx)("a",{parentName:"li",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/ocaml/testdata/compiler_flag_macros/BUCK.fixture"},"for example"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. It could include references to ocaml","_","library and cxx","_","library rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_deps"),": Platform specific dependencies. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of dependencies (same format as ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),") that are exported if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of source files to be compiled by this rule. It supports ","*",".ml, ","*",".mli, ","*",".mly, ","*",".mll, and ","*",".c files. (see  ",(0,i.mdx)("a",{parentName:"li",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/ocaml/testdata/ocaml/clib/BUCK.fixture"},"this test"),"  as C interop example and ",(0,i.mdx)("a",{parentName:"li",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/ocaml/testdata/ocaml/calc/BUCK.fixture"},"this test"),"  as parser and lexer example).")),(0,i.mdx)("h4",{id:"details-56"},"Details"),(0,i.mdx)("p",null,"Note: Buck is currently tested with 4.X OCaml series."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"For more examples, check out our ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/ocaml/testdata/"},"integration tests"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nocaml_binary(\n  name='greet',\n  srcs=[\n    'main.ml',\n    'lex.mll',\n    'parser.mly',\n    'hashtable.c',\n  ],\n  deps=[\n    ':greeting',\n    ':bridge',\n  ],\n)\n\nocaml_library(\n  name='greeting',\n  srcs=[\n    'greeting.ml',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\nocaml_library(\n  name='join',\n  srcs=[\n    'join.ml',\n  ],\n)\n\ncxx_library(\n  name='bridge',\n  srcs=[\n    'bridge.c',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"ocaml_library"},"ocaml","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def ocaml_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _ocaml_toolchain: str.type = _,\n    bytecode_only: bool.type = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    linker_flags: [str.type] = _,\n    native_plugin: bool.type = _,\n    ocamldep_flags: [str.type] = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    srcs: [None, [str.type], {str.type: str.type}] = _,\n    warnings_flags: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ocaml","_","library() rule builds a native and a bytecode libraries from the supplied set of OCaml source files and dependencies."),(0,i.mdx)("h4",{id:"parameters-94"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compiler_flags"),": The set of additional compiler flags to pass to ocaml compiler. It supports specifying ppx (see ",(0,i.mdx)("a",{parentName:"li",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/ocaml/testdata/compiler_flag_macros/BUCK.fixture"},"for example"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. It could include references to ocaml","_","library and cxx","_","library rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_deps"),": Platform specific dependencies. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of dependencies (same format as ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),") that are exported if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"deps")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of source files to be compiled by this rule. It supports ","*",".ml, ","*",".mli, ","*",".mly, ","*",".mll, and ","*",".c files. (see  ",(0,i.mdx)("a",{parentName:"li",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/ocaml/testdata/ocaml/clib/BUCK.fixture"},"this test"),"  as C interop example and ",(0,i.mdx)("a",{parentName:"li",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/ocaml/testdata/ocaml/calc/BUCK.fixture"},"this test"),"  as parser and lexer example).")),(0,i.mdx)("h4",{id:"details-57"},"Details"),(0,i.mdx)("p",null,"Note: Buck is currently tested with 4.X OCaml series."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"For more examples, check out our ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/ocaml/testdata/"},"integration tests"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nocaml_library(\n  name='greeting',\n  srcs=[\n    'greeting.ml',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"ocaml_object"},"ocaml","_","object"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def ocaml_object(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _ocaml_toolchain: str.type = _,\n    bytecode_only: [None, bool.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    linker_flags: [str.type] = _,\n    ocamldep_flags: [str.type] = _,\n    platform: [None, str.type] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    srcs: [None, [str.type], {str.type: str.type}] = _,\n    warnings_flags: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-95"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"ocaml_shared"},"ocaml","_","shared"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def ocaml_shared(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _ocaml_toolchain: str.type = _,\n    bytecode_only: [None, bool.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    linker_flags: [str.type] = _,\n    ocamldep_flags: [str.type] = _,\n    platform: [None, str.type] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    srcs: [None, [str.type], {str.type: str.type}] = _,\n    warnings_flags: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-96"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"platform"},"platform"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def platform(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    constraint_values: [str.type] = _,\n    deps: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-97"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"prebuilt_apple_framework"},"prebuilt","_","apple","_","framework"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def prebuilt_apple_framework(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _apple_toolchain: str.type = _,\n    _omnibus_environment: [None, str.type] = _,\n    code_sign_on_copy: [None, bool.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    exported_linker_flags: [str.type] = _,\n    exported_platform_linker_flags: [(str.type, [str.type])] = _,\n    framework: [None, str.type] = _,\n    frameworks: [str.type] = _,\n    labels: [str.type] = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    preferred_linkage: str.type = _,\n    supported_platforms_regex: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"prebuilt_apple_framework()")," rule represents a set of Objective-C/C++ source files and is very similar to a ",(0,i.mdx)("inlineCode",{parentName:"p"},"prebuilt_cxx_library()")," rule."),(0,i.mdx)("h4",{id:"parameters-98"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("h4",{id:"details-58"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_apple_framework(\n  name = 'MyPrebuiltFramework',\n  framework = 'myPrebuiltFramework.framework',\n  preferred_linkage = 'static',\n  visibility = [\n    'PUBLIC'\n  ]\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"prebuilt_cxx_library"},"prebuilt","_","cxx","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def prebuilt_cxx_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _omnibus_environment: [None, str.type] = _,\n    _target_os_type: str.type = _,\n    can_be_asset: bool.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_header_style: str.type = _,\n    exported_headers: [[str.type], {str.type: str.type}] = _,\n    exported_lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    exported_lang_preprocessor_flags: {str.type: [str.type]} = _,\n    exported_linker_flags: [str.type] = _,\n    exported_platform_deps: [(str.type, [str.type])] = _,\n    exported_platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    exported_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    exported_post_linker_flags: [str.type] = _,\n    exported_post_platform_linker_flags: [(str.type, [str.type])] = _,\n    exported_preprocessor_flags: [str.type] = _,\n    force_static: bool.type = _,\n    frameworks: [str.type] = _,\n    header_dirs: [None, [str.type]] = _,\n    header_namespace: [None, str.type] = _,\n    header_only: bool.type = _,\n    import_lib: [None, str.type] = _,\n    include_in_android_merge_map_output: bool.type = _,\n    labels: [str.type] = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_whole: bool.type = _,\n    link_without_soname: bool.type = _,\n    linker_flags: [str.type] = _,\n    platform_header_dirs: [None, [(str.type, [str.type])]] = _,\n    platform_import_lib: [None, [(str.type, str.type)]] = _,\n    platform_shared_lib: [None, [(str.type, str.type)]] = _,\n    platform_static_lib: [None, [(str.type, str.type)]] = _,\n    platform_static_pic_lib: [None, [(str.type, str.type)]] = _,\n    preferred_linkage: str.type = _,\n    provided: bool.type = _,\n    public_include_directories: [str.type] = _,\n    public_system_include_directories: [str.type] = _,\n    raw_headers: [str.type] = _,\n    shared_lib: [None, str.type] = _,\n    soname: [None, str.type] = _,\n    static_lib: [None, str.type] = _,\n    static_pic_lib: [None, str.type] = _,\n    supported_platforms_regex: [None, str.type] = _,\n    supports_merged_linking: [None, bool.type] = _,\n    supports_python_dlopen: bool.type = _,\n    supports_shared_library_interface: bool.type = _,\n    versioned_exported_lang_platform_preprocessor_flags: [({str.type: str.type}, {str.type: [(str.type, [str.type])]})] = _,\n    versioned_exported_lang_preprocessor_flags: [({str.type: str.type}, {str.type: [str.type]})] = _,\n    versioned_exported_platform_preprocessor_flags: [({str.type: str.type}, [(str.type, [str.type])])] = _,\n    versioned_exported_preprocessor_flags: [({str.type: str.type}, [str.type])] = _,\n    versioned_header_dirs: [None, [({str.type: str.type}, [str.type])]] = _,\n    versioned_import_lib: [None, [({str.type: str.type}, str.type)]] = _,\n    versioned_shared_lib: [None, [({str.type: str.type}, str.type)]] = _,\n    versioned_soname: [None, [({str.type: str.type}, str.type)]] = _,\n    versioned_static_lib: [None, [({str.type: str.type}, str.type)]] = _,\n    versioned_static_pic_lib: [None, [({str.type: str.type}, str.type)]] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"prebuilt_cxx_library()")," rule represents a set of native libraries and C/C++ header files and provides various flags to control how they are linked and exported."),(0,i.mdx)("h4",{id:"parameters-99"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),": Dependencies that will also appear to belong to any rules that depend on this one. This has two effects: ",(0,i.mdx)("em",{parentName:"li"}," Exported dependencies will also be included in the link line of dependents of this rules, but normal dependencies will not. ")," When ",(0,i.mdx)("inlineCode",{parentName:"li"},"reexport_all_header_dependencies = False"),", only exported headers of the rules specified here are re-exported."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_headers"),": The set of header files that are made available for inclusion to the source files in the target and all targets that transitively depend on it. These should be specified as either a list of header files or a dictionary of header names to header files. The headers can be included with ",(0,i.mdx)("inlineCode",{parentName:"li"},'#include "$HEADER_NAMESPACE/$HEADER_NAME"')," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"#include <$HEADER_NAMESPACE/$HEADER_NAME>"),", where ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAMESPACE")," is the value of the target's ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace")," attribute, and ",(0,i.mdx)("inlineCode",{parentName:"li"},"$HEADER_NAME")," is the header name if specified, and the filename of the header file otherwise. Note that the header name can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"). See ",(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_linker_flags"),": Flags to add to the linker command line when the output from this rule, or the output from any rule that transitively depends on this rule, is used in a link operation."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_platform_deps"),": Platform specific dependencies that will also appear to belong to any rules that depend on this one. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of external dependencies (same format as ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),") that are exported if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_platform_headers"),": Platform specific header files. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is either a list of header files or a dictionary of header names to header files that will be made available for inclusion to the source files in the target and all targets that transitively depend on it if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_platform_preprocessor_flags"),": Platform specific exported preprocessor flags. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of flags to use when preprocessing the source files in the target and all targets that transitively depend on it if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_preprocessor_flags")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"header_namespace"),": A path prefix when including headers of this target. Defaults to the path from the root of the repository to the directory where this target is defined. Can contain forward slashes (",(0,i.mdx)("inlineCode",{parentName:"li"},"/"),"), but cannot start with one. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"headers")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"header_only"),": Indicates if this library only consists of headers or not. If this is set to ",(0,i.mdx)("inlineCode",{parentName:"li"},"True"),", Buck will not link this library into any library that depends on it."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_shared_lib"),": Platform specific shared library. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element the path to the library. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared_lib")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_static_lib"),": Platform specific static library. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element the path to the library. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_lib")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_static_pic_lib"),": Platform specific static PIC library. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element the path to the library. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic_lib")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"shared_lib"),": The path to the library to use when performing shared linking."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"static_lib"),": The path to the library to use when performing static linking."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic_lib"),": The path to the library to use when performing static PIC linking."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"supported_platforms_regex"),": If present, an un-anchored regex (in java.util.regex.Pattern syntax) that matches all platforms that this library supports. It will not be built for other platforms."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"supports_merged_linking"),": Whether this rule supports building with the merged linking strategy when building for non-native binaries (e.g. when using ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig")," s ",(0,i.mdx)("inlineCode",{parentName:"li"},"merged")," setting).")),(0,i.mdx)("h4",{id:"details-59"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"A prebuilt library containing only headers that other libraries may need."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_cxx_library(\n  name = 'stdutil',\n  header_only = True,\n  header_dirs = [\n    'include',\n  ],\n)\n\n")),(0,i.mdx)("p",null," A prebuilt library with static and shared libs."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_cxx_library(\n  name = 'mylib',\n  soname = 'libmylib.so',\n  static_lib = 'libmylib.a',\n  static_pic_lib = 'libmylib_pic.a',\n  shared_lib = 'libmylib.so',\n  exported_headers = [\n    'mylib.h',\n  ],\n)\n\n")),(0,i.mdx)("p",null," A prebuilt library with multiple builds for multiple platforms."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_cxx_library(\n  name = 'mylib',\n  soname = 'libmylib.so',\n  platform_shared_lib = [\n    ('android-arm', 'android-arm/libmylib.so'),\n    ('android-x86', 'android-x86/libmylib.so'),\n    ('iphonesimulator-x86_64', 'iphonesimulator-x86_64/libmylib.so'),\n  ],\n  platform_static_lib = [\n    ('android-arm', 'android-arm/libmylib.a'),\n    ('android-x86', 'android-x86/libmylib.a'),\n    ('iphonesimulator-x86_64', 'iphonesimulator-x86_64/libmylib.a'),\n  ],\n  exported_headers = [\n    'mylib.h',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"prebuilt_cxx_library_group"},"prebuilt","_","cxx","_","library","_","group"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def prebuilt_cxx_library_group(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_platform_deps: [(str.type, [str.type])] = _,\n    exported_preprocessor_flags: [str.type] = _,\n    import_libs: {str.type: str.type} = _,\n    include_dirs: [str.type] = _,\n    include_in_android_merge_map_output: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    provided_shared_libs: {str.type: str.type} = _,\n    shared_libs: {str.type: str.type} = _,\n    shared_link: [str.type] = _,\n    static_libs: [str.type] = _,\n    static_link: [str.type] = _,\n    static_pic_libs: [str.type] = _,\n    static_pic_link: [str.type] = _,\n    supported_platforms_regex: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"prebuilt_cxx_library_group()")," rule represents a group of native libraries which should be handled together in a single rule, perhaps using special link-line construction."),(0,i.mdx)("h4",{id:"parameters-100"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),": Dependencies that will also appear to belong to any rules that depend on this one. This has two effects: ",(0,i.mdx)("em",{parentName:"li"}," Exported dependencies will also be included in the link line of dependents of this rules, but normal dependencies will not. ")," When ",(0,i.mdx)("inlineCode",{parentName:"li"},"reexport_all_header_dependencies = False"),", only exported headers of the rules specified here are re-exported."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exported_platform_deps"),": Platform specific dependencies that will also appear to belong to any rules that depend on this one. These should be specified as a list of pairs where the first element is an un-anchored regex (in java.util.regex.Pattern syntax) against which the platform name is matched, and the second element is a list of external dependencies (same format as ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps"),") that are exported if the platform matches the regex. See ",(0,i.mdx)("inlineCode",{parentName:"li"},"exported_deps")," for more information."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"provided_shared_libs"),": The map of system-provided shared library names to paths used when using the shared link style. The ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared_link")," parameter should refer to these libs using their library name."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"shared_libs"),": The map of shared library names to paths used when using the shared link style. The ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared_link")," parameter should refer to these libs using their library name."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"shared_link"),": The arguments to use when linking this library group using the shared link style. The actual paths to libraries should be listed in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared_libs")," parameter, and referenced via the the ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(lib [name])")," macro (or the ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(rel-lib [name])")," macro, when the shared library should be linked using the ",(0,i.mdx)("inlineCode",{parentName:"li"},"-L[dir] -l[name]")," style) in these args."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"static_libs"),": The paths to the libraries used when using the static link style. The ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_link")," parameter should refer to these libs using their index number."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"static_link"),": The arguments to use when linking this library group using the static link style. The actual paths to libraries should be listed in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_libs")," parameter, and referenced via the the ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(lib [index])")," macro in these args."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic_libs"),": The paths to the libraries used when using the static link style. The ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic_link")," parameter should refer to these libs using their index number."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic_link"),": The arguments to use when linking this library group using the static-pic link style. The actual paths to libraries should be listed in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic_libs")," parameter, and referenced via the the ",(0,i.mdx)("inlineCode",{parentName:"li"},"$(lib [index])")," macro in these args.")),(0,i.mdx)("h4",{id:"details-60"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"A prebuilt library group wrapping two libraries that must be linked together."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_cxx_library_group(\n  name = 'util',\n  static_link = [\n    '-Wl,--start-group',\n    '$(lib 0)',\n    '$(lib 1)',\n    '-Wl,--end-group',\n  ],\n  static_libs = [\n    'lib/liba.a',\n    'lib/libb.a',\n  ],\n  static_pic_link = [\n    '-Wl,--start-group',\n    '$(lib 0)',\n    '$(lib 1)',\n    '-Wl,--end-group',\n  ],\n  static_libs = [\n    'lib/liba_pic.a',\n    'lib/libb_pic.a',\n  ],\n  shared_link = [\n    '$(rel-lib liba.so)',\n    '$(rel-lib libb.so)',\n  ],\n  shared_libs = {\n    'liba.so': 'lib/liba.so',\n  },\n  provided_shared_libs = {\n    'libb.so': 'lib/libb.so',\n  },\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"prebuilt_dotnet_library"},"prebuilt","_","dotnet","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def prebuilt_dotnet_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    assembly: str.type,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"prebuilt_dotnet_library()")," rule is used to include prebuilt .Net assembles into your .Net code."),(0,i.mdx)("h4",{id:"parameters-101"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"assembly"),": The path to the DLL that this rule provides.")),(0,i.mdx)("h4",{id:"details-61"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_dotnet_library(\n  name = 'log4net',\n  assembly = 'log4net.dll',\n)\n\ncsharp_library(\n  name = 'example',\n  srcs = [\n    'Hello.cs',\n  ],\n  framework_ver = 'net46',\n  deps = [\n    ':log4net',\n    'System.dll',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"prebuilt_go_library"},"prebuilt","_","go","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def prebuilt_go_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    exported_deps: [str.type] = _,\n    labels: [str.type] = _,\n    library: str.type,\n    licenses: [str.type] = _,\n    package_name: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A prebuilt","_","go","_","library() rule provides a native library from the specified file."),(0,i.mdx)("h4",{id:"parameters-102"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Currently, this only supports go","_","library rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"library"),": Path to the precompiled Go library - typically of the form 'foo.a'."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"package_name"),': Sets the full name of the package being compiled. This defaults to the path from the buck root. (e.g. given a ./.buckconfig, a rule in ./a/b/BUCK defaults to package "a/b")')),(0,i.mdx)("h4",{id:"details-62"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"For more examples, check out our ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/features/go/testdata"},"integration tests"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_go_library(\n  name='greeting',\n  package_name='greeting',\n  library='greeting.a',\n  deps=[\n    ':join',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"prebuilt_jar"},"prebuilt","_","jar"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def prebuilt_jar(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _build_only_native_code: bool.type = _,\n    _dex_min_sdk_version: [None, int.type] = _,\n    _dex_toolchain: [None, str.type] = _,\n    _prebuilt_jar_toolchain: str.type = _,\n    binary_jar: str.type,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    generate_abi: bool.type = _,\n    javadoc_url: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: bool.type = _,\n    required_for_source_only_abi: bool.type = _,\n    source_jar: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"prebuilt_jar()")," rule is used to identify a JAR file that is checked into our repository as a precompiled binary rather than one that is built from source by Buck. Frequently, these are used to reference third-party JAR files (such as junit.jar) and are used as dependencies of ",(0,i.mdx)("inlineCode",{parentName:"p"},"java_library()")," rules."),(0,i.mdx)("h4",{id:"parameters-103"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"binary_jar"),": Path to the pre-built JAR file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Rules that must be built before this rule. Because the ",(0,i.mdx)("inlineCode",{parentName:"li"},"binary_jar")," is already built, there should be nothing to build, so this should be empty."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"javadoc_url"),": URL to the Javadoc for the ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," files in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"binary_jar"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"source_jar"),": Path to a JAR file that contains the ",(0,i.mdx)("inlineCode",{parentName:"li"},".java")," files to create the ",(0,i.mdx)("inlineCode",{parentName:"li"},".class")," in the ",(0,i.mdx)("inlineCode",{parentName:"li"},"binary_jar"),". This is frequently provided for debugging purposes.")),(0,i.mdx)("h4",{id:"details-63"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_jar(\n  name = 'junit',\n  binary_jar = 'junit-4.8.2.jar',\n  source_jar = 'junit-4.8.2-sources.jar',\n  javadoc_url = 'http://kentbeck.github.com/junit/javadoc/4.8/',\n)\n\njava_library(\n  name = 'tests',\n  srcs = glob(['tests/**/*Test.java']),\n  deps = [\n    ':junit',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"prebuilt_native_library"},"prebuilt","_","native","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def prebuilt_native_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    has_wrap_script: bool.type = _,\n    is_asset: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    native_libs: str.type\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"prebuilt_native_library()")," rule is used to bundle native libraries (i.e., ",(0,i.mdx)("inlineCode",{parentName:"p"},".so")," files) for Android."),(0,i.mdx)("h4",{id:"parameters-104"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"has_wrap_script"),": When using an exopackage, if this parameter is set to ",(0,i.mdx)("inlineCode",{parentName:"li"},"True"),", then the libraries for this rule are included in the primary APK even if native libraries would otherwise not be placed in it. This is intended for a native library directory that contains a ",(0,i.mdx)("a",{parentName:"li",href:"https://developer.android.com/ndk/guides/wrap-script"},"wrap.sh")," script, which must be included in the primary APK to take effect. Only one of ",(0,i.mdx)("inlineCode",{parentName:"li"},"is_asset")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"has_wrap_script")," can be set for a rule."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"is_asset"),": Normally native shared objects end up in a directory in the root of the APK named ",(0,i.mdx)("inlineCode",{parentName:"li"},"lib/"),". If this parameter is set to ",(0,i.mdx)("inlineCode",{parentName:"li"},"True"),", then these objects are placed in ",(0,i.mdx)("inlineCode",{parentName:"li"},"assets/lib/"),". Placing shared objects in a non-standard location prevents Android from extracting them to the device's internal storage.")),(0,i.mdx)("h4",{id:"details-64"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Most of the time, a ",(0,i.mdx)("inlineCode",{parentName:"p"},"prebuilt_native_library")," is private to the ",(0,i.mdx)("inlineCode",{parentName:"p"},"android\\_library()"),"that uses it:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_native_library(\n  name = 'native_libs',\n  native_libs = 'libs',\n)\n\nandroid_library(\n  name = 'my_lib',\n  srcs = glob(['*.java']),\n  deps = [\n    ':native_libs',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"prebuilt_ocaml_library"},"prebuilt","_","ocaml","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def prebuilt_ocaml_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    bytecode_c_libs: [str.type] = _,\n    bytecode_lib: [None, str.type] = _,\n    bytecode_only: bool.type = _,\n    c_libs: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    include_dir: [None, str.type] = _,\n    labels: [str.type] = _,\n    lib_dir: str.type = _,\n    lib_name: str.type = _,\n    licenses: [str.type] = _,\n    native_c_libs: [str.type] = _,\n    native_lib: [None, str.type] = _,\n    platform_deps: [(str.type, [str.type])] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-105"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"prebuilt_python_library"},"prebuilt","_","python","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def prebuilt_python_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _create_manifest_for_source_dir: str.type = _,\n    _extract: str.type = _,\n    _python_toolchain: str.type = _,\n    binary_src: str.type,\n    compile: bool.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    exclude_deps_from_merged_linking: bool.type = _,\n    ignore_compile_errors: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"prebuilt_python_library()")," rule is used to include prebuilt python packages into the output of a top-level ",(0,i.mdx)("inlineCode",{parentName:"p"},"python\\_binary()"),"or ",(0,i.mdx)("inlineCode",{parentName:"p"},"python\\_test()"),"rule."),(0,i.mdx)("h4",{id:"parameters-106"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"binary_src"),": The path to the ",(0,i.mdx)("inlineCode",{parentName:"li"},".whl")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},".egg")," to use.")),(0,i.mdx)("p",null,"Note: ",(0,i.mdx)("inlineCode",{parentName:"p"},".egg")," files have a very particular naming convention\nthat must be followed - otherwise pex will not find the dependency properly at runtime!"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Other ",(0,i.mdx)("inlineCode",{parentName:"li"},"prebuilt_python_library()")," rules which this library depends on. These may also be ",(0,i.mdx)("inlineCode",{parentName:"li"},"python_library")," rules if you want to depend on a source-based copy of the library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exclude_deps_from_merged_linking"),": When linking the top-level binary with a ",(0,i.mdx)("inlineCode",{parentName:"li"},"merged")," ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),", do not merge or re-link any native transitive deps of this library. This is useful if this library wraps prebuilt native extensions which cannot be re-linked as part of library merging."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": Set of arbitrary strings which allow you to annotate a ",(0,i.mdx)("inlineCode",{parentName:"li"},"build rule"),"with tags that can be searched for over an entire dependency tree using ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck query()")," .")),(0,i.mdx)("h4",{id:"details-65"},"Details"),(0,i.mdx)("p",null,"These prebuilt libraries can either be ",(0,i.mdx)("a",{parentName:"p",href:"https://www.python.org/dev/peps/pep-0427/"},"whl files")," or eggs"),(0,i.mdx)("p",null,"whls for most packages are available for download from ",(0,i.mdx)("a",{parentName:"p",href:"https://pypi.org"},"PyPI"),". The whl used may be\ndownloaded with ",(0,i.mdx)("inlineCode",{parentName:"p"},"remote\\_file()"),". However, Buck does not attempt to infer dependency information from pip,\nso that information will have to be imparted by the user."),(0,i.mdx)("p",null,"To create an egg for a package, run ",(0,i.mdx)("inlineCode",{parentName:"p"},"python setup.py bdist_egg")," in the package source distribution."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n# A simple prebuilt_python_library with no external dependencies.\nremote_file(\n  name = "requests-download",\n  url = "https://files.pythonhosted.org/packages/51/bd/23c926cd341ea6b7dd0b2a00aba99ae0f828be89d72b2190f27c11d4b7fb/requests-2.22.0-py2.py3-none-any.whl",\n  sha1 = "e1fc28120002395fe1f2da9aacea4e15a449d9ee",\n  out = "requests-2.22.0-py2.py3-none-any.whl",\n)\n\nprebuilt_python_library(\n  name = "requests",\n  binary_src = ":requests-download",\n)\n\n# A slightly more complex example\nprebuilt_python_library(\n  name = "greenlet",\n  binary_src = "greenlet-0.4.7-py2.7-macosx-10.10-x86_64.egg",\n)\n\nprebuilt_python_library(\n  name = "gevent",\n  binary_src = "gevent-1.0.2-py2.7-macosx-10.10-x86_64.egg",\n  deps = [\n    ":greenlet",\n  ],\n)\n\n')),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"prebuilt_rust_library"},"prebuilt","_","rust","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def prebuilt_rust_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _rust_toolchain: str.type = _,\n    contacts: [str.type] = _,\n    crate: str.type = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    link_style: [None, str.type] = _,\n    proc_macro: bool.type = _,\n    rlib: str.type\n) -> None\n")),(0,i.mdx)("p",null,"A prebuilt","_","rust","_","library() specifies a pre-built Rust crate, and any dependencies it may have on other crates (typically also prebuilt)."),(0,i.mdx)("h4",{id:"parameters-107"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Currently, this supports rust","_","library and prebuilt","_","rust","_","library rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"rlib"),": Path to the precompiled Rust crate - typically of the form 'libfoo.rlib', or 'libfoo-abc123def456.rlib' if it has symbol versioning metadata.")),(0,i.mdx)("h4",{id:"details-66"},"Details"),(0,i.mdx)("p",null,"Note: Buck is currently tested with (and therefore supports) version 1.32.0 of Rust."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_rust_library(\n  name = 'dailygreet',\n  rlib = 'libdailygreet.rlib',\n  deps = [\n    ':jinsy',\n  ],\n)\n\nprebuilt_rust_library(\n  name = 'jinsy',\n  rlib = 'libarbiter-6337e9cb899bd295.rlib',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"python_binary"},"python","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def python_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _create_manifest_for_source_dir: str.type = _,\n    _cxx_hacks: str.type = _,\n    _cxx_toolchain: str.type = _,\n    _exec_os_type: str.type = _,\n    _omnibus_environment: [None, str.type] = _,\n    _package_remotely: bool.type = _,\n    _python_toolchain: str.type = _,\n    _target_os_type: str.type = _,\n    auto_link_groups: bool.type = _,\n    base_module: [None, str.type] = _,\n    binary_linker_flags: [str.type] = _,\n    bolt_flags: [str.type] = _,\n    bolt_gdb_index: [None, str.type] = _,\n    bolt_profile: [None, str.type] = _,\n    build_args: [str.type] = _,\n    compile: [None, bool.type] = _,\n    compiler_flags: [str.type] = _,\n    constraint_overrides: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_main: str.type = _,\n    cxx_platform: [None, str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    deduplicate_merged_link_roots: [None, bool.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    devirt_enabled: bool.type = _,\n    dummy_omnibus: [None, str.type] = _,\n    enable_distributed_thinlto: bool.type = _,\n    executable_deps: [str.type] = _,\n    executable_name: [None, str.type] = _,\n    extension: [None, str.type] = _,\n    fat_lto: bool.type = _,\n    focused_list_target: [None, str.type] = _,\n    frameworks: [str.type] = _,\n    header_namespace: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    inplace_build_args: [str.type] = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_deps_query_whole: bool.type = _,\n    link_execution_preference: [None, str.type] = _,\n    link_group: [None, str.type] = _,\n    link_group_map: [None, str.type, [(str.type, [([None, str.type], str.type, [None, str.type, [str.type]], [None, str.type])], [None, {str.type: ""}])]] = _,\n    link_group_min_binary_node_count: [None, int.type] = _,\n    link_ordering: [None, str.type] = _,\n    link_style: str.type = _,\n    link_whole: bool.type = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    main: [None, str.type] = _,\n    main_module: [None, str.type] = _,\n    make_pex: [None, str.type] = _,\n    manifest_module_entries: [None, {str.type: {str.type: ""}}] = _,\n    native_link_strategy: [None, str.type] = _,\n    package_split_dwarf_dwp: bool.type = _,\n    package_style: [None, str.type] = _,\n    par_style: [None, str.type] = _,\n    platform: [None, str.type] = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preload_deps: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    prefer_stripped_native_objects: bool.type = _,\n    prefer_stripped_objects: bool.type = _,\n    prefix_header: [None, str.type] = _,\n    preload_deps: [str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    raw_headers: [str.type] = _,\n    resources: [[str.type], {str.type: str.type}] = _,\n    standalone_build_args: [str.type] = _,\n    static_extension_finder: str.type = _,\n    static_extension_utils: str.type = _,\n    thin_lto: bool.type = _,\n    version_universe: [None, str.type] = _,\n    weak_framework_names: [str.type] = _,\n    zip_safe: [None, bool.type] = _\n) -> None\n')),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"python_binary()")," rule is used to build a ",(0,i.mdx)("a",{parentName:"p",href:"http://pantsbuild.github.io/pex_design.html"},"PEX")," file\xe2\x80\x94an executable Python package\xe2\x80\x94that includes Python sources and resources from all transitive ",(0,i.mdx)("inlineCode",{parentName:"p"},"python\\_library()"),"dependencies."),(0,i.mdx)("h4",{id:"parameters-108"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"base_module"),": The package in which the main module should reside in its final location in the binary. If unset, Buck uses the project-relative directory that contains the BUCK file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deduplicate_merged_link_roots"),": When linking multiple top-level binaries with the ",(0,i.mdx)("inlineCode",{parentName:"li"},"merged")," ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),", coalesce root link rules which are identical across independent merged links."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": A list of ",(0,i.mdx)("inlineCode",{parentName:"li"},"python\\_library()"),"rules that specify Python modules to include in the PEX file\xe2\x80\x94including all transitive dependencies of these rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": Set of arbitrary strings which allow you to annotate a ",(0,i.mdx)("inlineCode",{parentName:"li"},"build rule"),"with tags that can be searched for over an entire dependency tree using ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck query()")," ."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Additional linker flags that should be applied to any linking which is specific to this rule. Note that whether these flags are used is dependent on the native link strategy selected in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig")," and currently applies only to the ",(0,i.mdx)("inlineCode",{parentName:"li"},"merged")," ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"; the ",(0,i.mdx)("inlineCode",{parentName:"li"},"separate")," link strategy pulls in shared libraries that are linked in the context of the rules that own them, such as ",(0,i.mdx)("inlineCode",{parentName:"li"},"cxx\\_library()"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"main"),": The Python file which serves as the entry point for the PEX. The interpreter initiates execution of the PEX with the code in this file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"main_module"),": The python module that should be the entry point of the binary. This should be a module name within a python","_","library that this binary depends on. Note that module names take ",(0,i.mdx)("inlineCode",{parentName:"li"},"base_module")," of the library into account. This property is mutually exclusive with ",(0,i.mdx)("inlineCode",{parentName:"li"},"main"),", and should be preferred to ",(0,i.mdx)("inlineCode",{parentName:"li"},"main"),", which is deprecated."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"package_style"),": Used to override the global packaging style that is set in ",(0,i.mdx)("inlineCode",{parentName:"li"},"["),".buckconfig",(0,i.mdx)("inlineCode",{parentName:"li"}," ]"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform"),": The name of the Python platform ",(0,i.mdx)("em",{parentName:"li"},"flavor")," to build against by default as defined in the buckconfig#",(0,i.mdx)("inlineCode",{parentName:"li"},"python"),"section of ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"preload_deps"),": A list of C/C++ library dependencies that need to be loaded before any other libraries when the PEX starts up. This requires dynamic loader support, such as ",(0,i.mdx)("inlineCode",{parentName:"li"},"LD_PRELOAD"),", found on most systems. This list is order- sensitive and the preload libraries listed here are passed down to the dynamic linker in the same order.")),(0,i.mdx)("h4",{id:"details-67"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Build a PEX from the Python files in the BUCK directory."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# BUCK\n\npython_binary(\n  name = 'tailer',\n  main_module = 'tailer',\n  deps = [\n    ':tailerutils',\n  ],\n)\n\npython_library(\n  name = 'tailerutils',\n  # The main module, tailer.py, is specified here.\n  # (Separated out from the glob pattern for clarity.)\n  srcs = glob(['tailer.py', '*.py']),\n)\n\n")),(0,i.mdx)("p",null,"Use the ",(0,i.mdx)("inlineCode",{parentName:"p"},"platform")," argument to select\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"[python#py2]")," platform as defined\nin ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n; .buckconfig\n\n[python#py2]\n  interpreter = /usr/bin/python2.7\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# BUCK\n\npython_binary(\n  name = 'bin',\n  platform = 'py2',\n  main_module = 'main',\n  deps = [\n    ':bar',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"python_bootstrap_binary"},"python","_","bootstrap","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def python_bootstrap_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _exec_os_type: str.type = _,\n    _python_bootstrap_toolchain: str.type = _,\n    _win_python_wrapper: [None, str.type] = _,\n    deps: [str.type] = _,\n    main: str.type\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-109"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"python_bootstrap_library"},"python","_","bootstrap","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def python_bootstrap_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    srcs: [str.type]\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-110"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"python_library"},"python","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def python_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _create_manifest_for_source_dir: str.type = _,\n    _cxx_toolchain: str.type = _,\n    _python_toolchain: str.type = _,\n    base_module: [None, str.type] = _,\n    contacts: [str.type] = _,\n    cxx_platform: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    exclude_deps_from_merged_linking: bool.type = _,\n    ignore_compile_errors: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    platform: [None, str.type] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_resources: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_srcs: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    resources: [[str.type], {str.type: str.type}] = _,\n    srcs: [[str.type], {str.type: str.type}] = _,\n    type_stubs: [[str.type], {str.type: str.type}] = _,\n    version_universe: [None, str.type] = _,\n    versioned_resources: [None, [({str.type: str.type}, [[str.type], {str.type: str.type}])]] = _,\n    versioned_srcs: [None, [({str.type: str.type}, [[str.type], {str.type: str.type}])]] = _,\n    zip_safe: [None, bool.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"python_library()")," rule is used to group together Python source files and resources to package them into a PEX using a top-level ",(0,i.mdx)("inlineCode",{parentName:"p"},"python\\_binary()"),"rule."),(0,i.mdx)("h4",{id:"parameters-111"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"base_module"),": The package in which the specified source files and resources should reside in their final location in the top-level binary. If unset, Buck uses the project-relative directory that contains the BUCK file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": Other ",(0,i.mdx)("inlineCode",{parentName:"li"},"python_library()")," rules that list ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs")," from which this rule imports modules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exclude_deps_from_merged_linking"),": When linking the top-level binary with a ",(0,i.mdx)("inlineCode",{parentName:"li"},"merged")," ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),", do not merge or re-link any native transitive deps of this library. This is useful if this library wraps prebuilt native extensions which cannot be re-linked as part of library merging."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": Set of arbitrary strings which allow you to annotate a ",(0,i.mdx)("inlineCode",{parentName:"li"},"build rule"),"with tags that can be searched for over an entire dependency tree using ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck query()")," ."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_resources"),": Python-platform-specific resource files. These should be specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched, and the second element is a list of resource files. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The platform name is a Python platform ",(0,i.mdx)("em",{parentName:"li"},"flavor")," defined in the buckconfig#",(0,i.mdx)("inlineCode",{parentName:"li"},"python"),"section of ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_srcs"),": Python-platform-specific source files. These should be specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched, and the second element is a list of source files. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The platform name is a Python platform ",(0,i.mdx)("em",{parentName:"li"},"flavor")," defined in the buckconfig#",(0,i.mdx)("inlineCode",{parentName:"li"},"python"),"section of ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of Python (",(0,i.mdx)("inlineCode",{parentName:"li"},".py"),") files to include in this library.")),(0,i.mdx)("h4",{id:"details-68"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Include Python source files and resource files."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# BUCK\n\n# A rule that includes a single Python file.\npython_library(\n  name = 'fileutil',\n  srcs = ['fileutil.py'],\n  deps = [\n    '//third_party/python-magic:python-magic',\n  ],\n)\n\n# A rule that uses glob() to include all Python source files in the\n# directory in which the rule is defined. The rule also specifies a\n# resource file that gets packaged with the source file.\npython_library(\n  name = 'testutil',\n  srcs = glob(['testutil/**/*.py']),\n  resources = [\n    'testdata.dat',\n  ],\n)\n\n")),(0,i.mdx)("p",null,"Use the ",(0,i.mdx)("inlineCode",{parentName:"p"},"platform_srcs")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"platform_resources")," arguments\nto pull in source files and resources only when building for a specific Python platform."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n; .buckconfig\n\n[python#py2]\n  interpreter = /usr/bin/python2.7\n\n[python#py3]\n  interpreter = /usr/bin/python3.4\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# BUCK\n\npython_library(\n  name = 'utils',\n  platform_srcs = [\n    ('py2', ['foo.py']),\n    ('py3', ['bar.py']),\n  ],\n  platform_resources = [\n    ('py2', ['foo.dat']),\n    ('py3', ['bar.dat']),\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"python_needed_coverage_test"},"python","_","needed","_","coverage","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def python_needed_coverage_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _inject_test_env: str.type = _,\n    contacts: [str.type] = _,\n    env: {str.type: str.type} = _,\n    labels: [str.type] = _,\n    needed_coverage: [(int.type, str.type, [None, str.type])] = _,\n    remote_execution: [None, {str.type: [None, bool.type, str.type, {str.type: str.type}]}] = _,\n    test: str.type\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-112"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"python_test"},"python","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def python_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _create_manifest_for_source_dir: str.type = _,\n    _cxx_hacks: str.type = _,\n    _cxx_toolchain: str.type = _,\n    _exec_os_type: str.type = _,\n    _inject_test_env: str.type = _,\n    _omnibus_environment: [None, str.type] = _,\n    _python_toolchain: str.type = _,\n    _target_os_type: str.type = _,\n    _test_main: str.type = _,\n    additional_coverage_targets: [str.type] = _,\n    auto_link_groups: bool.type = _,\n    base_module: [None, str.type] = _,\n    binary_linker_flags: [str.type] = _,\n    bolt_flags: [str.type] = _,\n    bolt_gdb_index: [None, str.type] = _,\n    bolt_profile: [None, str.type] = _,\n    build_args: [str.type] = _,\n    compile: [None, bool.type] = _,\n    compiler_flags: [str.type] = _,\n    constraint_overrides: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_main: str.type = _,\n    cxx_platform: [None, str.type] = _,\n    cxx_runtime_type: [None, str.type] = _,\n    deduplicate_merged_link_roots: [None, bool.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    defaults: {str.type: str.type} = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    devirt_enabled: bool.type = _,\n    dummy_omnibus: [None, str.type] = _,\n    enable_distributed_thinlto: bool.type = _,\n    env: {str.type: str.type} = _,\n    exclude_deps_from_merged_linking: bool.type = _,\n    executable_deps: [str.type] = _,\n    executable_name: [None, str.type] = _,\n    extension: [None, str.type] = _,\n    fat_lto: bool.type = _,\n    focused_list_target: [None, str.type] = _,\n    frameworks: [str.type] = _,\n    header_namespace: [None, str.type] = _,\n    headers: [[str.type], {str.type: str.type}] = _,\n    headers_as_raw_headers_mode: [None, str.type] = _,\n    include_directories: [str.type] = _,\n    inplace_build_args: [str.type] = _,\n    labels: [str.type] = _,\n    lang_compiler_flags: {str.type: [str.type]} = _,\n    lang_platform_compiler_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_platform_preprocessor_flags: {str.type: [(str.type, [str.type])]} = _,\n    lang_preprocessor_flags: {str.type: [str.type]} = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    link_deps_query_whole: bool.type = _,\n    link_execution_preference: [None, str.type] = _,\n    link_group: [None, str.type] = _,\n    link_group_map: [None, str.type, [(str.type, [([None, str.type], str.type, [None, str.type, [str.type]], [None, str.type])], [None, {str.type: ""}])]] = _,\n    link_group_min_binary_node_count: [None, int.type] = _,\n    link_ordering: [None, str.type] = _,\n    link_style: str.type = _,\n    link_whole: bool.type = _,\n    linker_extra_outputs: [str.type] = _,\n    linker_flags: [str.type] = _,\n    main_module: [None, str.type] = _,\n    make_pex: [None, str.type] = _,\n    manifest_module_entries: [None, {str.type: {str.type: ""}}] = _,\n    native_link_strategy: [None, str.type] = _,\n    needed_coverage: [(int.type, str.type, [None, str.type])] = _,\n    package_split_dwarf_dwp: bool.type = _,\n    package_style: [None, str.type] = _,\n    par_style: [None, str.type] = _,\n    platform: [None, str.type] = _,\n    platform_compiler_flags: [(str.type, [str.type])] = _,\n    platform_deps: [(str.type, [str.type])] = _,\n    platform_headers: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_linker_flags: [(str.type, [str.type])] = _,\n    platform_preload_deps: [(str.type, [str.type])] = _,\n    platform_preprocessor_flags: [(str.type, [str.type])] = _,\n    platform_resources: [(str.type, [[str.type], {str.type: str.type}])] = _,\n    platform_srcs: [(str.type, [[str.type, (str.type, [str.type])]])] = _,\n    post_linker_flags: [str.type] = _,\n    post_platform_linker_flags: [(str.type, [str.type])] = _,\n    precompiled_header: [None, str.type] = _,\n    prefer_stripped_native_objects: bool.type = _,\n    prefer_stripped_objects: bool.type = _,\n    prefix_header: [None, str.type] = _,\n    preload_deps: [str.type] = _,\n    preprocessor_flags: [str.type] = _,\n    raw_headers: [str.type] = _,\n    remote_execution: [None, {str.type: [None, bool.type, str.type, {str.type: str.type}]}] = _,\n    resources: [[str.type], {str.type: str.type}] = _,\n    runner: [None, str.type] = _,\n    specs: [None, str.type] = _,\n    srcs: [[str.type], {str.type: str.type}] = _,\n    standalone_build_args: [str.type] = _,\n    static_extension_finder: str.type = _,\n    static_extension_utils: str.type = _,\n    test_rule_timeout_ms: [None, int.type] = _,\n    thin_lto: bool.type = _,\n    version_universe: [None, str.type] = _,\n    versioned_resources: [None, [({str.type: str.type}, [[str.type], {str.type: str.type}])]] = _,\n    versioned_srcs: [None, [({str.type: str.type}, [[str.type], {str.type: str.type}])]] = _,\n    weak_framework_names: [str.type] = _,\n    zip_safe: [None, bool.type] = _\n) -> None\n')),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"python_test()")," rule defines a set of ",(0,i.mdx)("inlineCode",{parentName:"p"},".py")," files that contain tests to run via the ",(0,i.mdx)("a",{parentName:"p",href:"https://docs.python.org/2/library/unittest.html"},"Python unit testing framework"),"."),(0,i.mdx)("h4",{id:"parameters-113"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"base_module"),": The package in which the specified source files and resources should reside in their final location in the top-level binary. If unset, Buck uses the project-relative directory that contains the BUCK file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deduplicate_merged_link_roots"),": When linking multiple top-level binaries with the ",(0,i.mdx)("inlineCode",{parentName:"li"},"merged")," ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),", coalesce root link rules which are identical across independent merged links."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": ",(0,i.mdx)("inlineCode",{parentName:"li"},"python\\_library()"),"rules used by the tests in this rules sources."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": A map of environment names and values to set when running the test.")),(0,i.mdx)("p",null,"It is also possible to expand references to other rules within the ",(0,i.mdx)("strong",{parentName:"p"},"values")," of\nthese environment variables, using builtin ",(0,i.mdx)("inlineCode",{parentName:"p"},"string parameter macros"),"\n:"),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"$(location //path/to:target)"),"\nExpands to the location of the output of the build rule. This\nmeans that you can refer to these without needing to be aware of how\nBuck is storing data on the disk mid-build."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exclude_deps_from_merged_linking"),": When linking the top-level binary with a ",(0,i.mdx)("inlineCode",{parentName:"li"},"merged")," ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),", do not merge or re-link any native transitive deps of this library. This is useful if this library wraps prebuilt native extensions which cannot be re-linked as part of library merging."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": Set of arbitrary strings which allow you to annotate a ",(0,i.mdx)("inlineCode",{parentName:"li"},"build rule"),"with tags that can be searched for over an entire dependency tree using ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck query()")," ."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": Additional linker flags that should be applied to any linking which is specific to this rule. Note that whether these flags are used is dependent on the native link strategy selected in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig")," and currently applies only to the ",(0,i.mdx)("inlineCode",{parentName:"li"},"merged")," ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"; the ",(0,i.mdx)("inlineCode",{parentName:"li"},"separate")," link strategy pulls in shared libraries that are linked in the context of the rules that own them, such as ",(0,i.mdx)("inlineCode",{parentName:"li"},"cxx\\_library()"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"main_module"),": The main module used to run the tests. This parameter is normally not needed, as Buck will provide a default main module that runs all tests. However, you can override this with your own module to perform custom initialization or command line processing. Your custom module can import the standard Buck test main as ",(0,i.mdx)("inlineCode",{parentName:"li"},"__test_main__"),", and can invoke it's normal main function as ",(0,i.mdx)("inlineCode",{parentName:"li"},"__test_main__.main(sys.argv)"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"package_style"),": Used to override the global packaging style that is set in ",(0,i.mdx)("inlineCode",{parentName:"li"},"["),".buckconfig",(0,i.mdx)("inlineCode",{parentName:"li"}," ]"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform"),": The name of the Python platform ",(0,i.mdx)("em",{parentName:"li"},"flavor")," to build against by default as defined in the buckconfig#",(0,i.mdx)("inlineCode",{parentName:"li"},"python"),"section of ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"platform_resources"),": Python-platform-specific resource files. These should be specified as a list of pairs where the first element in each pair is an un-anchored regex against which the platform name is matched, and the second element is a list of resource files. The regex should use ",(0,i.mdx)("inlineCode",{parentName:"li"},"java.util.regex.Pattern")," syntax. The platform name is a Python platform ",(0,i.mdx)("em",{parentName:"li"},"flavor")," defined in the buckconfig#",(0,i.mdx)("inlineCode",{parentName:"li"},"python"),"section of ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"preload_deps"),": A list of C/C++ library dependencies that need to be loaded before any other libraries when the PEX starts up. This requires dynamic loader support, such as ",(0,i.mdx)("inlineCode",{parentName:"li"},"LD_PRELOAD"),", found on most systems. This list is order- sensitive and the preload libraries listed here are passed down to the dynamic linker in the same order."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of Python (",(0,i.mdx)("inlineCode",{parentName:"li"},".py"),") files to include in this library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"test_rule_timeout_ms"),": If set specifies the maximum amount of time (in milliseconds) in which all of the tests in this rule should complete. This overrides the default ",(0,i.mdx)("inlineCode",{parentName:"li"},"rule_timeout")," if any has been specified in ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig")," .")),(0,i.mdx)("h4",{id:"details-69"},"Details"),(0,i.mdx)("p",null,"If your test requires static files you should specify these in\nthe ",(0,i.mdx)("strong",{parentName:"p"},"resources")," or ",(0,i.mdx)("strong",{parentName:"p"},"platform","_","resources")," arguments.\nIf you do not specify these files, they won't be available when your\ntest runs."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# A rule that includes a single .py file containing tests.\npython_test(\n  name = 'fileutil_test',\n  srcs = ['fileutil_tests.py'],\n  deps = [\n    ':fileutil',\n  ],\n)\n\n# A rule that uses glob() to include all sources in the directory which the\n# rule is defined.  It also lists a resource file that gets packaged with\n# the sources in this rule.\npython_library(\n  name = 'fileutil',\n  srcs = glob(['fileutil/**/*.py']),\n  resources = [\n    'testdata.dat',\n  ],\n)\n\n")),(0,i.mdx)("p",null,"Here is an example of using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"platform\\_srcs")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"platform\\_resources"),"\nparameters to pull in sources/resources only when building for a specific\nPython platform:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n; .buckconfig\n[python#py2]\n  interpreter = /usr/bin/python2.7\n[python#py3]\n  interpreter = /usr/bin/python3.4\n\n")),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# BUCK\npython_test(\n  name = 'test',\n  platform_srcs = [\n    ('py2', ['foo.py']),\n    ('py3', ['bar.py']),\n  ],\n  platform_resources = [\n    ('py2', ['foo.dat']),\n    ('py3', ['bar.dat']),\n  ],\n)\n\n")),(0,i.mdx)("p",null,"Here is an example of using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"platform"),' parameter to select the "py2"\nPython platform as defined in ',(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig")," above:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# BUCK\npython_test(\n  name = 'bin',\n  platform = 'py2',\n  srcs = [\n    'foo.py',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"python_test_runner"},"python","_","test","_","runner"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def python_test_runner(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    main_module: str.type = _,\n    src: str.type\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-114"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"labels"),": Set of arbitrary strings which allow you to annotate a ",(0,i.mdx)("inlineCode",{parentName:"li"},"build rule"),"with tags that can be searched for over an entire dependency tree using ",(0,i.mdx)("inlineCode",{parentName:"li"},"buck query()")," .")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"remote_file"},"remote","_","file"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def remote_file(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _unzip_tool: str.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    out: [None, str.type] = _,\n    sha1: [None, str.type] = _,\n    sha256: [None, str.type] = _,\n    type: [None, str.type] = _,\n    url: str.type,\n    vpnless_url: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"remote_file()")," rule is used to download files from the Internet to be used as dependencies for other rules. These rules are downloaded by running ",(0,i.mdx)("inlineCode",{parentName:"p"},"fetch"),", or can be downloaded as part of ",(0,i.mdx)("inlineCode",{parentName:"p"},"build"),". See the note there about the ",(0,i.mdx)("inlineCode",{parentName:"p"},".buckconfig")," setting to configure that."),(0,i.mdx)("h4",{id:"parameters-115"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"out"),": An optional name to call the downloaded artifact. Buck will generate a default name if one is not provided that uses the ",(0,i.mdx)("inlineCode",{parentName:"li"},"name")," of the rule."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"type"),": An optional type of the downloaded file.")),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"data"),"\nRegular data file.\n",(0,i.mdx)("inlineCode",{parentName:"p"},"executable")),(0,i.mdx)("p",null," Executable file. Buck will ensure that output has appropriate permissions if applicable."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"exploded_zip")),(0,i.mdx)("p",null," Zip archive which will be automatically unzipped into an output directory."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"url"),": You can specify an ",(0,i.mdx)("inlineCode",{parentName:"li"},"http"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"https"),", or a ",(0,i.mdx)("inlineCode",{parentName:"li"},"mvn")," URL. If you specify a ",(0,i.mdx)("inlineCode",{parentName:"li"},"mvn")," URL, it will be decoded as described in the javadocs for MavenUrlDecoder See the example section below."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"vpnless_url"),": An optional additional URL from which this resource can be downloaded when off VPN. Meta-internal only.")),(0,i.mdx)("h4",{id:"details-70"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Here's an example of a ",(0,i.mdx)("inlineCode",{parentName:"p"},"remote_file()")," using an ",(0,i.mdx)("inlineCode",{parentName:"p"},"https")," URL."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nremote_file(\n  name = 'android-ndk-r10e-darwin-x86_64',\n  url = 'https://dl.google.com/android/ndk/android-ndk-r10e-darwin-x86_64.bin',\n  sha1 = 'b57c2b9213251180dcab794352bfc9a241bf2557',\n)\n\n")),(0,i.mdx)("p",null," Here's an example of a ",(0,i.mdx)("inlineCode",{parentName:"p"},"remote_file()")," using a ",(0,i.mdx)("inlineCode",{parentName:"p"},"mvn")," URL being referenced\nby a ",(0,i.mdx)("inlineCode",{parentName:"p"},"prebuilt\\_jar()"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nprebuilt_jar(\n  name = 'jetty-all',\n  binary_jar = 'jetty-all-9.2.10.v20150310.jar',\n  source_jar = ':jetty-source',\n)\n\nremote_file(\n  name = 'jetty-source',\n  out = 'jetty-all-9.2.10.v20150310-sources.jar',\n  url = 'mvn:org.eclipse.jetty.aggregate:jetty-all:src:9.2.10.v20150310',\n  sha1 = '311da310416d2feb3de227081d7c3f48742d7075',\n)\n\n")),(0,i.mdx)("p",null," Here's an example of a ",(0,i.mdx)("inlineCode",{parentName:"p"},"remote_file()")," using a ",(0,i.mdx)("inlineCode",{parentName:"p"},"mvn")," URI which uses a\nnon-default maven repository host."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nremote_file(\n  name = 'jetty-source',\n  out = 'jetty-all-9.2.10.v20150310-sources.jar',\n  url = 'mvn:https://maven-repo.com:org.eclipse.jetty.aggregate:jetty-all:src:9.2.10.v20150310',\n  sha1 = '311da310416d2feb3de227081d7c3f48742d7075',\n)\n\n")),(0,i.mdx)("p",null," Here's an example of a ",(0,i.mdx)("inlineCode",{parentName:"p"},"remote_file()")," using a ",(0,i.mdx)("inlineCode",{parentName:"p"},"mvn")," URI which uses a\nMaven classifier."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nremote_file(\n  name = 'groovy-groovysh-indy',\n  out = 'jetty-all-9.2.10.v20150310-sources.jar',\n  url = 'mvn:org.codehaus.groovy:groovy-groovysh:jar:indy:2.4.1',\n  sha1 = '1600fde728c885cc9506cb102deb1b494bd7c130',\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"robolectric_test"},"robolectric","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},'def robolectric_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _android_toolchain: str.type = _,\n    _build_only_native_code: bool.type = _,\n    _inject_test_env: str.type = _,\n    _is_building_android_binary: bool.type = _,\n    _java_test_toolchain: str.type = _,\n    _java_toolchain: str.type = _,\n    _kotlin_toolchain: str.type = _,\n    abi_generation_mode: [None, str.type] = _,\n    annotation_processing_tool: [None, str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_library_whitelist: [str.type] = _,\n    default_cxx_platform: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    extra_kotlinc_arguments: [str.type] = _,\n    extra_non_source_only_abi_kotlinc_arguments: [str.type] = _,\n    fork_mode: str.type = _,\n    friend_paths: [str.type] = _,\n    java: [None, str.type] = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    kotlin_compiler_plugins: {str.type: {str.type: str.type}} = _,\n    labels: [str.type] = _,\n    language: [None, str.type] = _,\n    licenses: [str.type] = _,\n    locales_for_binary_resources: [str.type] = _,\n    manifest: [None, str.type] = _,\n    manifest_entries: {str.type: ""} = _,\n    manifest_file: [None, str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    preferred_density_for_binary_resources: [None, str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    provided_deps_query: [None, str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resource_union_package: [None, str.type] = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    robolectric_manifest: str.type,\n    robolectric_runtime_dependencies: [str.type] = _,\n    robolectric_runtime_dependency: [None, str.type] = _,\n    run_test_separately: bool.type = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    srcs: [str.type] = _,\n    std_err_log_level: [None, int.type, str.type] = _,\n    std_out_log_level: [None, int.type, str.type] = _,\n    target: [None, str.type] = _,\n    test_case_timeout_ms: [None, int.type] = _,\n    test_rule_timeout_ms: [None, int.type] = _,\n    test_type: [None, str.type] = _,\n    use_cxx_libraries: [None, bool.type] = _,\n    use_dependency_order_classpath: [None, bool.type] = _,\n    use_jvm_abi_gen: [None, bool.type] = _,\n    vm_args: [str.type] = _\n) -> None\n')),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"robolectric_test()")," rule is used to define a set of ",(0,i.mdx)("inlineCode",{parentName:"p"},".java")," files that contain tests to run via JUnit with Robolectric test runner. It extends from ",(0,i.mdx)("inlineCode",{parentName:"p"},"java_test()")," rule."),(0,i.mdx)("h4",{id:"parameters-116"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"extra_kotlinc_arguments"),": List of additional arguments to pass into the Kotlin compiler."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"robolectric_manifest"),": An ",(0,i.mdx)("a",{parentName:"li",href:"http://developer.android.com/guide/topics/manifest/manifest-intro.html"},"Android Manifest")," for the rule to declare any permissions or intents it may need or want to handle. May either be a file or a ",(0,i.mdx)("inlineCode",{parentName:"li"},"android\\_manifest()"),"target."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"robolectric_runtime_dependency"),": Robolectric only runs in offline mode with buck. Specify the relative directory containing all the jars Robolectric uses at runtime.")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"rust_binary"},"rust","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def rust_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _exec_os_type: str.type = _,\n    _rust_toolchain: str.type = _,\n    _target_os_type: str.type = _,\n    contacts: [str.type] = _,\n    coverage: bool.type = _,\n    crate: [None, str.type] = _,\n    crate_root: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    edition: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    features: [str.type] = _,\n    flagged_deps: [(str.type, [str.type])] = _,\n    framework: bool.type = _,\n    incremental_build_mode: [None, str.type] = _,\n    incremental_enabled: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    link_style: [None, str.type] = _,\n    linker_flags: [str.type] = _,\n    mapped_srcs: {str.type: str.type} = _,\n    named_deps: {str.type: str.type} = _,\n    resources: [[str.type], {str.type: str.type}] = _,\n    rpath: bool.type = _,\n    rustc_flags: [str.type] = _,\n    rustdoc_flags: [str.type] = _,\n    srcs: [str.type] = _,\n    version_universe: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A rust","_","binary() rule builds a native executable from the supplied set of Rust source files and dependencies."),(0,i.mdx)("h4",{id:"parameters-117"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"crate_root"),": Set the name of the top-level source file for the crate, which can be used to override the default (see ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Currently, this supports rust","_","library and prebuilt","_","rust","_","library rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"edition"),": Set the language edition to be used for this rule. Can be set to any edition the compiler supports (",(0,i.mdx)("inlineCode",{parentName:"li"},"2018")," right now). If unset it uses the compiler's default (",(0,i.mdx)("inlineCode",{parentName:"li"},"2015"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": Set environment variables for this rule's invocations of rustc. The environment variable values may include macros which are expanded."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"features"),": The set of features to be enabled for this rule.")),(0,i.mdx)("p",null,"These are passed to ",(0,i.mdx)("inlineCode",{parentName:"p"},"rustc")," with ",(0,i.mdx)("inlineCode",{parentName:"p"},'--cfg feature="{feature}"'),", and can be used in the code with ",(0,i.mdx)("inlineCode",{parentName:"p"},'#[cfg(feature = "{feature}")]'),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be either ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"linker_flags"),": The set of additional flags to pass to the linker."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"mapped_srcs"),": Add source files along with a local path mapping. Rust is sensitive to the layout of source files, as the directory structure follows the module structure. However this is awkward if the source file is, for example, generated by another rule. In this case, you can set up a mapping from the actual source path to something that makes sense locally. For example ",(0,i.mdx)("inlineCode",{parentName:"li"},'mapped_srcs = {":generate-module", "src/generated.rs" }'),". These are added to the regular ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),", so a file should not be listed in both."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"named_deps"),": Add crate dependencies and define a local name by which to use that dependency by. This allows a crate to have multiple dependencies with the same crate name. For example: ",(0,i.mdx)("inlineCode",{parentName:"li"},'named_deps = {"local_name", ":some_rust_crate" }'),". The dependencies may also be non-Rust, but the alias is ignored. It has no effect on the symbols provided by a C/C++ library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"rpath"),': Set the "rpath" in the executable when using a shared link style.'),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"rustc_flags"),": The set of additional compiler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"rustc"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of Rust source files to be compiled by this rule.")),(0,i.mdx)("p",null,"One of the source files is the root module of the crate. By default this is ",(0,i.mdx)("inlineCode",{parentName:"p"},"lib.rs")," for libraries, ",(0,i.mdx)("inlineCode",{parentName:"p"},"main.rs")," for executables, or\nthe crate's name with ",(0,i.mdx)("inlineCode",{parentName:"p"},".rs")," appended. This can be overridden with the ",(0,i.mdx)("inlineCode",{parentName:"p"},"crate_root")," rule parameter."),(0,i.mdx)("h4",{id:"details-71"},"Details"),(0,i.mdx)("p",null,"If you invoke a build with the ",(0,i.mdx)("inlineCode",{parentName:"p"},"check")," flavor, then Buck will invoke rustc\nto check the code (typecheck, produce warnings, etc), but won't generate an executable code.\nWhen applied to binaries it produces no output; for libraries it produces metadata for\nconsumers of the library. When building with ",(0,i.mdx)("inlineCode",{parentName:"p"},"check"),", extra compiler flags from\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"rust.rustc_check_flags")," are added to the compiler's command line options,\nto allow for extra warnings, etc."),(0,i.mdx)("p",null,"Note: Buck is currently tested with (and therefore supports) version 1.32.0 of Rust."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"For more examples, check out our ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/rust/testdata/"},"integration tests"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nrust_binary(\n  name='greet',\n  srcs=[\n    'greet.rs',\n  ],\n  deps=[\n    ':greeting',\n  ],\n)\n\nrust_library(\n  name='greeting',\n  srcs=[\n    'greeting.rs',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\nrust_library(\n  name='join',\n  srcs=[\n    'join.rs',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"rust_library"},"rust","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def rust_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _exec_os_type: str.type = _,\n    _omnibus_environment: [None, str.type] = _,\n    _rust_toolchain: str.type = _,\n    _target_os_type: str.type = _,\n    contacts: [str.type] = _,\n    coverage: bool.type = _,\n    crate: [None, str.type] = _,\n    crate_dynamic: [None, str.type] = _,\n    crate_root: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    doc_deps: [str.type] = _,\n    doc_env: {str.type: [None, str.type]} = _,\n    doc_linker_flags: [str.type] = _,\n    doc_named_deps: {str.type: str.type} = _,\n    doctest_link_style: [None, str.type] = _,\n    doctests: [None, bool.type] = _,\n    edition: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    features: [str.type] = _,\n    flagged_deps: [(str.type, [str.type])] = _,\n    incremental_build_mode: [None, str.type] = _,\n    incremental_enabled: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    linker_flags: [str.type] = _,\n    mapped_srcs: {str.type: str.type} = _,\n    named_deps: {str.type: str.type} = _,\n    preferred_linkage: str.type = _,\n    proc_macro: bool.type = _,\n    resources: [[str.type], {str.type: str.type}] = _,\n    rustc_flags: [str.type] = _,\n    rustdoc_flags: [str.type] = _,\n    srcs: [str.type] = _,\n    supports_python_dlopen: [None, bool.type] = _,\n    version_universe: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A rust","_","library() rule builds a native library from the supplied set of Rust source files and dependencies."),(0,i.mdx)("h4",{id:"parameters-118"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"crate_root"),": Set the name of the top-level source file for the crate, which can be used to override the default (see ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Currently, this supports rust","_","library and prebuilt","_","rust","_","library rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"doctest_link_style"),": Like ",(0,i.mdx)("inlineCode",{parentName:"li"},"link_style")," on binaries, but applies specifically to doctests."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"edition"),": Set the language edition to be used for this rule. Can be set to any edition the compiler supports (",(0,i.mdx)("inlineCode",{parentName:"li"},"2018")," right now). If unset it uses the compiler's default (",(0,i.mdx)("inlineCode",{parentName:"li"},"2015"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": Set environment variables for this rule's invocations of rustc. The environment variable values may include macros which are expanded."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"features"),": The set of features to be enabled for this rule.")),(0,i.mdx)("p",null,"These are passed to ",(0,i.mdx)("inlineCode",{parentName:"p"},"rustc")," with ",(0,i.mdx)("inlineCode",{parentName:"p"},'--cfg feature="{feature}"'),", and can be used in the code with ",(0,i.mdx)("inlineCode",{parentName:"p"},'#[cfg(feature = "{feature}")]'),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"mapped_srcs"),": Add source files along with a local path mapping. Rust is sensitive to the layout of source files, as the directory structure follows the module structure. However this is awkward if the source file is, for example, generated by another rule. In this case, you can set up a mapping from the actual source path to something that makes sense locally. For example ",(0,i.mdx)("inlineCode",{parentName:"li"},'mapped_srcs = {":generate-module", "src/generated.rs" }'),". These are added to the regular ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),", so a file should not be listed in both."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"named_deps"),": Add crate dependencies and define a local name by which to use that dependency by. This allows a crate to have multiple dependencies with the same crate name. For example: ",(0,i.mdx)("inlineCode",{parentName:"li"},'named_deps = {"local_name", ":some_rust_crate" }'),". The dependencies may also be non-Rust, but the alias is ignored. It has no effect on the symbols provided by a C/C++ library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"rustc_flags"),": The set of additional compiler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"rustc"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of Rust source files to be compiled by this rule.")),(0,i.mdx)("p",null,"One of the source files is the root module of the crate. By default this is ",(0,i.mdx)("inlineCode",{parentName:"p"},"lib.rs")," for libraries, ",(0,i.mdx)("inlineCode",{parentName:"p"},"main.rs")," for executables, or\nthe crate's name with ",(0,i.mdx)("inlineCode",{parentName:"p"},".rs")," appended. This can be overridden with the ",(0,i.mdx)("inlineCode",{parentName:"p"},"crate_root")," rule parameter."),(0,i.mdx)("h4",{id:"details-72"},"Details"),(0,i.mdx)("p",null,"If you invoke a build with the ",(0,i.mdx)("inlineCode",{parentName:"p"},"check")," flavor, then Buck will invoke rustc\nto check the code (typecheck, produce warnings, etc), but won't generate an executable code.\nWhen applied to binaries it produces no output; for libraries it produces metadata for\nconsumers of the library. When building with ",(0,i.mdx)("inlineCode",{parentName:"p"},"check"),", extra compiler flags from\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"rust.rustc_check_flags")," are added to the compiler's command line options,\nto allow for extra warnings, etc."),(0,i.mdx)("p",null,"Note: Buck is currently tested with (and therefore supports) version 1.32.0 of Rust."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"For more examples, check out our ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/rust/testdata/"},"integration tests"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nrust_library(\n  name='greeting',\n  srcs=[\n    'greeting.rs',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"rust_test"},"rust","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def rust_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _cxx_toolchain: str.type = _,\n    _exec_os_type: str.type = _,\n    _inject_test_env: str.type = _,\n    _rust_toolchain: str.type = _,\n    _target_os_type: str.type = _,\n    contacts: [str.type] = _,\n    coverage: bool.type = _,\n    crate: [None, str.type] = _,\n    crate_root: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    default_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    edition: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    features: [str.type] = _,\n    flagged_deps: [(str.type, [str.type])] = _,\n    framework: bool.type = _,\n    incremental_build_mode: [None, str.type] = _,\n    incremental_enabled: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    link_style: [None, str.type] = _,\n    linker_flags: [str.type] = _,\n    mapped_srcs: {str.type: str.type} = _,\n    named_deps: {str.type: str.type} = _,\n    remote_execution: [None, {str.type: [None, bool.type, str.type, {str.type: str.type}]}] = _,\n    resources: [[str.type], {str.type: str.type}] = _,\n    rpath: bool.type = _,\n    rustc_flags: [str.type] = _,\n    rustdoc_flags: [str.type] = _,\n    srcs: [str.type] = _,\n    version_universe: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A rust","_","test() rule builds a Rust test native executable from the supplied set of Rust source files and dependencies and runs this test."),(0,i.mdx)("h4",{id:"parameters-119"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"crate_root"),": Set the name of the top-level source file for the crate, which can be used to override the default (see ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"deps"),": The set of dependencies of this rule. Currently, this supports rust","_","library and prebuilt","_","rust","_","library rules."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"edition"),": Set the language edition to be used for this rule. Can be set to any edition the compiler supports (",(0,i.mdx)("inlineCode",{parentName:"li"},"2018")," right now). If unset it uses the compiler's default (",(0,i.mdx)("inlineCode",{parentName:"li"},"2015"),")."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": Set environment variables for this rule's invocations of rustc. The environment variable values may include macros which are expanded."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"features"),": The set of features to be enabled for this rule.")),(0,i.mdx)("p",null,"These are passed to ",(0,i.mdx)("inlineCode",{parentName:"p"},"rustc")," with ",(0,i.mdx)("inlineCode",{parentName:"p"},'--cfg feature="{feature}"'),", and can be used in the code with ",(0,i.mdx)("inlineCode",{parentName:"p"},'#[cfg(feature = "{feature}")]'),"."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"link_style"),": Determines whether to build and link this rule's dependencies statically or dynamically. Can be either ",(0,i.mdx)("inlineCode",{parentName:"li"},"static"),", ",(0,i.mdx)("inlineCode",{parentName:"li"},"static_pic")," or ",(0,i.mdx)("inlineCode",{parentName:"li"},"shared"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"mapped_srcs"),": Add source files along with a local path mapping. Rust is sensitive to the layout of source files, as the directory structure follows the module structure. However this is awkward if the source file is, for example, generated by another rule. In this case, you can set up a mapping from the actual source path to something that makes sense locally. For example ",(0,i.mdx)("inlineCode",{parentName:"li"},'mapped_srcs = {":generate-module", "src/generated.rs" }'),". These are added to the regular ",(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),", so a file should not be listed in both."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"named_deps"),": Add crate dependencies and define a local name by which to use that dependency by. This allows a crate to have multiple dependencies with the same crate name. For example: ",(0,i.mdx)("inlineCode",{parentName:"li"},'named_deps = {"local_name", ":some_rust_crate" }'),". The dependencies may also be non-Rust, but the alias is ignored. It has no effect on the symbols provided by a C/C++ library."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"rustc_flags"),": The set of additional compiler flags to pass to ",(0,i.mdx)("inlineCode",{parentName:"li"},"rustc"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of Rust source files to be compiled by this rule.")),(0,i.mdx)("p",null,"One of the source files is the root module of the crate. By default this is ",(0,i.mdx)("inlineCode",{parentName:"p"},"lib.rs")," for libraries, ",(0,i.mdx)("inlineCode",{parentName:"p"},"main.rs")," for executables, or\nthe crate's name with ",(0,i.mdx)("inlineCode",{parentName:"p"},".rs")," appended. This can be overridden with the ",(0,i.mdx)("inlineCode",{parentName:"p"},"crate_root")," rule parameter."),(0,i.mdx)("h4",{id:"details-73"},"Details"),(0,i.mdx)("p",null,"Note: Buck is currently tested with (and therefore supports) version 1.32.0 of Rust."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"For more examples, check out our ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/buck/tree/dev/test/com/facebook/buck/rust/testdata/"},"integration tests"),"."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\nrust_test(\n  name='greet',\n  srcs=[\n    'greet.rs',\n  ],\n  deps=[\n    ':greeting',\n  ],\n)\n\nrust_library(\n  name='greeting',\n  srcs=[\n    'greeting.rs',\n  ],\n  deps=[\n    ':join',\n  ],\n)\n\nrust_library(\n  name='join',\n  srcs=[\n    'join.rs',\n  ],\n)\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"scala_library"},"scala","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def scala_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    abi_generation_mode: [None, str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    manifest_file: [None, str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    srcs: [str.type] = _,\n    target: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-120"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"scala_test"},"scala","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def scala_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    abi_generation_mode: [None, str.type] = _,\n    annotation_processor_deps: [str.type] = _,\n    annotation_processor_params: [str.type] = _,\n    annotation_processors: [str.type] = _,\n    contacts: [str.type] = _,\n    cxx_library_whitelist: [str.type] = _,\n    default_cxx_platform: [None, str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    deps_query: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    exported_deps: [str.type] = _,\n    exported_provided_deps: [str.type] = _,\n    extra_arguments: [str.type] = _,\n    fork_mode: str.type = _,\n    java_version: [None, str.type] = _,\n    javac: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    manifest_file: [None, str.type] = _,\n    maven_coords: [None, str.type] = _,\n    never_mark_as_unused_dependency: [None, bool.type] = _,\n    on_unused_dependencies: [None, str.type] = _,\n    plugins: [str.type] = _,\n    proguard_config: [None, str.type] = _,\n    provided_deps: [str.type] = _,\n    remove_classes: [str.type] = _,\n    required_for_source_only_abi: bool.type = _,\n    resources: [str.type] = _,\n    resources_root: [None, str.type] = _,\n    run_test_separately: bool.type = _,\n    runtime_deps: [str.type] = _,\n    source: [None, str.type] = _,\n    source_abi_verification_mode: [None, str.type] = _,\n    source_only_abi_deps: [str.type] = _,\n    srcs: [str.type] = _,\n    std_err_log_level: [None, int.type, str.type] = _,\n    std_out_log_level: [None, int.type, str.type] = _,\n    target: [None, str.type] = _,\n    test_case_timeout_ms: [None, int.type] = _,\n    test_rule_timeout_ms: [None, int.type] = _,\n    test_type: [None, str.type] = _,\n    use_cxx_libraries: [None, bool.type] = _,\n    use_dependency_order_classpath: [None, bool.type] = _,\n    vm_args: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-121"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"scene_kit_assets"},"scene","_","kit","_","assets"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def scene_kit_assets(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    path: str.type\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-122"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"sh_binary"},"sh","_","binary"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def sh_binary(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _target_os_type: str.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    main: str.type,\n    resources: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"An ",(0,i.mdx)("inlineCode",{parentName:"p"},"sh_binary()")," is used to execute a shell script."),(0,i.mdx)("h4",{id:"parameters-123"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"main"),": Either the path to the script (relative to the build file), or a ",(0,i.mdx)("inlineCode",{parentName:"li"},"build target"),". This file must be executable in order to be run."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"resources"),": A list of files or build rules that this rule requires in order to run. These could be things such as random data files.")),(0,i.mdx)("p",null,"When the script runs, the ",(0,i.mdx)("inlineCode",{parentName:"p"},"$BUCK_DEFAULT_RUNTIME_RESOURCES"),"\nenvironment variable specifies the directory that contains these resources.\nThis directory's location is determined entirely by Buck; the script should\nnot assume the directory's location."),(0,i.mdx)("p",null,"The resources are also made available in a tree structure that mirrors\ntheir locations in the source and ",(0,i.mdx)("inlineCode",{parentName:"p"},"buck-out")," trees. The\nenvironment variable ",(0,i.mdx)("inlineCode",{parentName:"p"},"$BUCK_PROJECT_ROOT")," specifies a directory\nthat contains all the resources, laid out in their locations relative to\nthe original buck project root."),(0,i.mdx)("h4",{id:"details-74"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"This sh","_","binary() just cats a sample data file back at the user."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n# $REPO/BUCK\nsh_binary(\n    name = "script",\n    main = "script.sh",\n    resources = [\n        "data.dat",\n    ],\n)\n\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n# Sample data file with data we need at runtime\n$ echo \"I'm a datafile\" > data.dat\n\n# Create a simple script that prints out the resource\n$ cat > script.sh\n#!/bin/sh\ncat $BUCK_DEFAULT_RUNTIME_RESOURCES/data.dat\n\n# Make sure the script is executable\n$ chmod u+x script.sh\n\n# Run the script, and see that it prints out the resource we provided\n$ buck run //:script\nJobs completed: 4. Time elapsed: 0.2s.\nBUILD SUCCEEDED\nI'm a datafile\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"sh_test"},"sh","_","test"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def sh_test(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _inject_test_env: str.type = _,\n    args: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    env: {str.type: str.type} = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    list_args: [None, [str.type]] = _,\n    list_env: [None, {str.type: str.type}] = _,\n    remote_execution: [None, {str.type: [None, bool.type, str.type, {str.type: str.type}]}] = _,\n    resources: [str.type] = _,\n    run_args: [str.type] = _,\n    run_env: {str.type: str.type} = _,\n    run_test_separately: bool.type = _,\n    test: [None, str.type] = _,\n    test_rule_timeout_ms: [None, int.type] = _,\n    type: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"sh_test()")," is a test rule that can pass results to the test runner by invoking a shell script."),(0,i.mdx)("h4",{id:"parameters-124"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"args"),": The list of arguments to invoke this script with. These are literal values, and no shell interpolation is done.")),(0,i.mdx)("p",null,"These can contain ",(0,i.mdx)("inlineCode",{parentName:"p"},"string parameter macros"),"\n, for example, to give the location of a generated binary to the test script."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": Environment variable overrides that should be used when running the script. The key is the variable name, and the value is its value.")),(0,i.mdx)("p",null,"The values can contain ",(0,i.mdx)("inlineCode",{parentName:"p"},"string parameter macros"),"\nsuch as the location of a generated binary to be used by the test script."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"test"),": Either the path to the script (relative to the build file), or a ",(0,i.mdx)("inlineCode",{parentName:"li"},"build target"),". This file must be executable in order to be run."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"type"),": If provided, this will be sent to any configured ",(0,i.mdx)("inlineCode",{parentName:"li"},".buckconfig"))),(0,i.mdx)("h4",{id:"details-75"},"Details"),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"NOTE:")," This rule is not currently supported on Windows."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"This sh","_","test() fails if a string does not match a value."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n# $REPO/BUCK\nsh_test(\n    name = "script_pass",\n    test = "script.sh",\n    args = ["--pass"],\n)\n\nsh_test(\n    name = "script_fail",\n    test = "script.sh",\n    args = ["--fail"],\n)\n\n\n')),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n# Create a simple script that prints out the resource\n$ cat > script.sh\n#!/bin/sh\nfor arg in $@; do\n  if [ "$arg" == "--pass" ]; then\n    echo "Passed"\n    exit 0;\n  fi\ndone\necho "Failed"\nexit 1\n\n# Make sure the script is executable\n$ chmod u+x script.sh\n\n# Run the script, and see that one test passes, one fails\n$ buck test //:script_pass //:script_fail\nFAILURE script.sh sh_test\nBuilding: finished in 0.0 sec (100%) 2/2 jobs, 0 updated\n  Total time: 0.0 sec\nTesting: finished in 0.0 sec (1 PASS/1 FAIL)\nRESULTS FOR //:script_fail //:script_pass\nFAIL    <100ms  0 Passed   0 Skipped   1 Failed   //:script_fail\nFAILURE script.sh sh_test\n====STANDARD OUT====\nFailed\n\nPASS    <100ms  1 Passed   0 Skipped   0 Failed   //:script_pass\nTESTS FAILED: 1 FAILURE\nFailed target: //:script_fail\nFAIL //:script_fail\n\n')),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"supermodule_target_graph"},"supermodule","_","target","_","graph"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def supermodule_target_graph(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    label_pattern: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    on_duplicate_entry: str.type = _,\n    out: str.type = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-125"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"swift_library"},"swift","_","library"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def swift_library(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    bridging_header: [None, str.type] = _,\n    compiler_flags: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    deps: [str.type] = _,\n    enable_cxx_interop: bool.type = _,\n    frameworks: [str.type] = _,\n    labels: [str.type] = _,\n    libraries: [str.type] = _,\n    licenses: [str.type] = _,\n    module_name: [None, str.type] = _,\n    preferred_linkage: str.type = _,\n    sdk_modules: [str.type] = _,\n    serialize_debugging_options: bool.type = _,\n    soname: [None, str.type] = _,\n    srcs: [str.type] = _,\n    supported_platforms_regex: [None, str.type] = _,\n    target_sdk_version: [None, str.type] = _,\n    uses_explicit_modules: bool.type = _,\n    version: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-126"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"swift_toolchain"},"swift","_","toolchain"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def swift_toolchain(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _internal_platform_path: [None, str.type] = _,\n    _internal_sdk_path: [None, str.type] = _,\n    _swiftc_wrapper: str.type = _,\n    architecture: [None, str.type] = _,\n    can_toolchain_emit_obj_c_header_textually: bool.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    explicit_modules_uses_gmodules: bool.type = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    object_format: str.type = _,\n    placeholder_tool: [None, str.type] = _,\n    platform_path: [None, str.type] = _,\n    prefix_serialized_debug_info: bool.type = _,\n    resource_dir: [None, str.type] = _,\n    runtime_paths_for_bundling: [str.type] = _,\n    runtime_paths_for_linking: [str.type] = _,\n    runtime_run_paths: [str.type] = _,\n    sdk_dependencies_path: [None, str.type] = _,\n    sdk_modules: [str.type] = _,\n    sdk_path: [None, str.type] = _,\n    static_runtime_paths: [str.type] = _,\n    swift_stdlib_tool: str.type,\n    swift_stdlib_tool_flags: [str.type] = _,\n    swiftc: str.type,\n    swiftc_flags: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-127"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"test_suite"},"test","_","suite"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def test_suite(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    test_deps: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"test_suite()")," is used to create a grouping of tests that should all be run by just testing this rule."),(0,i.mdx)("h4",{id:"parameters-128"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("h4",{id:"details-76"},"Details"),(0,i.mdx)("p",null,"This rule can then be given to ",(0,i.mdx)("inlineCode",{parentName:"p"},"buck test"),", and all tests that it depends on will be invoked.\nNote that the test","_","suite() target is not tested itself, it just tells buck to run other\ntests. It will not show up in calls to the external runner nor in the normal test output."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"This test","_","suite() sets up two different sets of tests to run, 'all' tests and 'slow' tests. Note that ",(0,i.mdx)("inlineCode",{parentName:"p"},"all_tests")," can depend on ",(0,i.mdx)("inlineCode",{parentName:"p"},"slow_tests"),", and all three tests are run."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n# instrumentation_tests/BUCK:\nsh_test(\n    name = "instrumentation_tests",\n    test = "instrumentation_tests.sh",\n    visibility = ["PUBLIC"],\n)\n\n# integration_tests/BUCK:\nsh_test(\n    name = "integration_tests",\n    test = "integration_tests.sh",\n    visibility = ["PUBLIC"],\n)\n\n# unit_tests/BUCK:\nsh_test(\n    name = "unit_tests",\n    test = "unit_tests.sh",\n    visibility = ["PUBLIC"],\n)\n\n# BUCK:\ntest_suite(\n    name = "slow_tests",\n    tests = [\n        "//instrumentation_tests:instrumentation_tests",\n        "//integration_tests:integration_tests",\n    ],\n)\n\ntest_suite(\n    name = "all_tests",\n    tests = [\n        ":slow_tests",\n        "//unit_tests:unit_tests",\n    ],\n)\n\n')),(0,i.mdx)("p",null,"Yields output like this when run:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n$ buck test //:slow_tests\n...\nRESULTS FOR //instrumentation_tests:instrumentation_tests //integration_tests:integration_tests\nPASS    <100ms  1 Passed   0 Skipped   0 Failed   //instrumentation_tests:instrumentation_tests\nPASS    <100ms  1 Passed   0 Skipped   0 Failed   //integration_tests:integration_tests\nTESTS PASSED\n...\n\n$ buck test //:all_tests\nRESULTS FOR //instrumentation_tests:instrumentation_tests //integration_tests:integration_tests //unit_tests:unit_tests\nPASS    <100ms  1 Passed   0 Skipped   0 Failed   //instrumentation_tests:instrumentation_tests\nPASS    <100ms  1 Passed   0 Skipped   0 Failed   //integration_tests:integration_tests\nPASS    <100ms  1 Passed   0 Skipped   0 Failed   //unit_tests:unit_tests\nTESTS PASSED\n\n")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"versioned_alias"},"versioned","_","alias"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def versioned_alias(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    versions: {str.type: str.type} = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-129"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"worker_tool"},"worker","_","tool"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def worker_tool(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _worker_tool_runner: str.type = _,\n    args: [str.type, [str.type]] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    env: {str.type: str.type} = _,\n    exe: [None, str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    max_workers: [None, int.type] = _,\n    max_workers_per_thread_percent: [None, int.type] = _,\n    persistent: [None, bool.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"Some external tools have high startup costs. To amortize those costs over the whole build rather than paying them for each rule invocation, use the ",(0,i.mdx)("inlineCode",{parentName:"p"},"worker_tool()")," rule in conjunction with ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule()"),". Buck then starts the external tool once and reuses it by communicating with it over ",(0,i.mdx)("inlineCode",{parentName:"p"},"stdin")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"stdout")," using a simple JSON protocol."),(0,i.mdx)("h4",{id:"parameters-130"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"args"),": A string of args that is passed to the executable represented by ",(0,i.mdx)("inlineCode",{parentName:"li"},"exe")," on initial startup."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"env"),": A map of environment variables that is passed to the executable represented by ",(0,i.mdx)("inlineCode",{parentName:"li"},"exe")," on initial startup."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exe"),": A ",(0,i.mdx)("inlineCode",{parentName:"li"},"build target"),"for a rule that outputs an executable, such as an ",(0,i.mdx)("inlineCode",{parentName:"li"},"sh\\_binary()"),". Buck runs this executable only once per build."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"max_workers"),": The maximum number of workers of this type that Buck starts. Use ",(0,i.mdx)("inlineCode",{parentName:"li"},"-1")," to allow the creation of as many workers as necessary."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"max_workers_per_thread_percent"),": The maximum ratio of workers of this type that Buck starts per thread, specified as a positive integer percentage (1-100). Must be greater than or equal to ",(0,i.mdx)("inlineCode",{parentName:"li"},"1")," and less than or equal to ",(0,i.mdx)("inlineCode",{parentName:"li"},"100"),". Only one of ",(0,i.mdx)("inlineCode",{parentName:"li"},"max_workers")," and ",(0,i.mdx)("inlineCode",{parentName:"li"},"max_workers_per_thread_percent")," may be specified."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"persistent"),": If set to true, Buck does not restart the tool unless the tool itself changes. This means the tool persists across multiple Buck commands without being shut down and may see the same rule being built more than once. Be careful not to use this setting with tools that don't expect to process the same input\u2014with different contents\u2014twice!")),(0,i.mdx)("h4",{id:"details-77"},"Details"),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"worker_tool")," rule can be referenced in the ",(0,i.mdx)("inlineCode",{parentName:"p"},"cmd")," parameter of\na ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule")," by using the macro:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\n$(worker //path/to:target)\n\n")),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"Consider the following ",(0,i.mdx)("inlineCode",{parentName:"p"},"build rules"),":"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n#\n# Buck\n#\nworker_tool(\n  name = 'ExternalToolWorker',\n  exe = ':ExternalTool',\n  args = '--arg1 --arg2'\n)\n\nsh_binary(\n  name = 'ExternalTool',\n  main = 'external_tool.sh',\n)\n\ngenrule(\n  name = 'TransformA',\n  out = 'OutputA.txt',\n  cmd = '$(worker :ExternalToolWorker) argA',\n)\n\ngenrule(\n  name = 'TransformB',\n  out = 'OutputB.txt',\n  cmd = '$(worker :ExternalToolWorker) argB',\n)\n\ngenrule(\n  name = 'TransformC',\n  out = 'OutputC.txt',\n  cmd = '$(worker :ExternalToolWorker) argC',\n)\n")),(0,i.mdx)("p",null," When doing a ",(0,i.mdx)("inlineCode",{parentName:"p"},"buck build")," on all three of the above ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrules"),", Buck\nfirst creates the worker process by invoking:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\n./external_tool.sh --arg1 --arg2\n\n")),(0,i.mdx)("p",null," Buck then communicates with this process using JSON over ",(0,i.mdx)("inlineCode",{parentName:"p"},"stdin"),",\nstarting with a handshake:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n[\n  {\n    "id": 0,\n    "type": "handshake",\n    "protocol_version": "0",\n    "capabilities": []\n  }\n\n')),(0,i.mdx)("p",null," Buck then waits for the tool to reply on ",(0,i.mdx)("inlineCode",{parentName:"p"},"stdout"),":"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n[\n  {\n    "id": 0,\n    "type": "handshake",\n    "protocol_version": "0",\n    "capabilities": []\n  }\n\n')),(0,i.mdx)("p",null," Then, when building the first ",(0,i.mdx)("inlineCode",{parentName:"p"},"genrule"),", Buck writes to ",(0,i.mdx)("inlineCode",{parentName:"p"},"stdin"),":"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n  ,{\n    "id": 1,\n    "type": "command",\n    "args_path": "/tmp/1.args",\n    "stdout_path": "/tmp/1.out",\n    "stderr_path": "/tmp/1.err"\n  }\n\n')),(0,i.mdx)("p",null," The file ",(0,i.mdx)("inlineCode",{parentName:"p"},"/tmp/1.args")," contains ",(0,i.mdx)("inlineCode",{parentName:"p"},"argA"),". The tool should\nperform the necessary work for this job and then write the job's output to the files\nsupplied by Buck\u2014in this case, ",(0,i.mdx)("inlineCode",{parentName:"p"},"/tmp/1.out")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"/tmp/1.err"),".\nOnce the job is done, the tool should reply to Buck on ",(0,i.mdx)("inlineCode",{parentName:"p"},"stdout")," with:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n  ,{\n    "id": 1,\n    "type": "result",\n    "exit_code": 0\n  }\n\n')),(0,i.mdx)("p",null," Once Buck hears back from the first genrule's job, it submits the second genrule's job in the\nsame fashion and awaits the response. When the build is all finished,\nBuck closes the JSON by writing to ",(0,i.mdx)("inlineCode",{parentName:"p"},"stdin"),":"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n]\n\n")),(0,i.mdx)("p",null," which signals the tool that it should exit after replying on ",(0,i.mdx)("inlineCode",{parentName:"p"},"stdout")," with:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n]\n\n")),(0,i.mdx)("p",null," In this example, Buck is guaranteed to invoke"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\n\n./external_tool.sh --arg1 --arg2\n\n")),(0,i.mdx)("p",null," only once during the build. The three jobs corresponding to the three genrules are submitted\nsynchronously to the single worker process."),(0,i.mdx)("p",null," Note that the ",(0,i.mdx)("inlineCode",{parentName:"p"},"id")," values in the messages are not necessarily increasing or sequential,\nbut they do have to match between the request message and the response message of a given job as\nwell as in the initial handshake."),(0,i.mdx)("p",null," If the tool receives a message type it cannot interpret it should answer with:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n{\n  "id": &ltn>,\n  "type": "error",\n  "exit_code": 1\n}\n\n')),(0,i.mdx)("p",null," If the tool receives a message type it can interpret, but the other attributes of the\nmessage are in an inconsistent state, it should answer with:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\n{\n  "id": &ltn>,\n  "type": "error",\n  "exit_code": 2\n}\n\n')),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"xcode_postbuild_script"},"xcode","_","postbuild","_","script"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def xcode_postbuild_script(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    cmd: str.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    input_file_lists: [str.type] = _,\n    inputs: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    output_file_lists: [str.type] = _,\n    outputs: [str.type] = _,\n    srcs: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-131"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"xcode_prebuild_script"},"xcode","_","prebuild","_","script"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def xcode_prebuild_script(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    cmd: str.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    input_file_lists: [str.type] = _,\n    inputs: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    output_file_lists: [str.type] = _,\n    outputs: [str.type] = _,\n    srcs: [str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-132"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"xcode_workspace_config"},"xcode","_","workspace","_","config"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def xcode_workspace_config(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    action_config_names: {str.type: str.type} = _,\n    additional_scheme_actions: [None, {str.type: {str.type: [str.type]}}] = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    environment_variables: [None, {str.type: {str.type: str.type}}] = _,\n    explicit_runnable_path: [None, str.type] = _,\n    extra_schemes: {str.type: str.type} = _,\n    extra_shallow_targets: [str.type] = _,\n    extra_targets: [str.type] = _,\n    extra_tests: [str.type] = _,\n    is_remote_runnable: [None, bool.type] = _,\n    labels: [str.type] = _,\n    launch_style: [None, str.type] = _,\n    licenses: [str.type] = _,\n    notification_payload_file: [None, str.type] = _,\n    src_target: [None, str.type] = _,\n    was_created_for_app_extension: [None, bool.type] = _,\n    watch_interface: [None, str.type] = _,\n    workspace_name: [None, str.type] = _\n) -> None\n")),(0,i.mdx)("h4",{id:"parameters-133"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one")),(0,i.mdx)("hr",null),(0,i.mdx)("h2",{id:"zip_file"},"zip","_","file"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-python"},"def zip_file(\n    *,\n    name: str.type,\n    default_target_platform: [None, str.type] = _,\n    target_compatible_with: [str.type] = _,\n    compatible_with: [str.type] = _,\n    exec_compatible_with: [str.type] = _,\n    visibility: [str.type] = _,\n    within_view: [str.type] = _,\n    tests: [str.type] = _,\n    _zip_file_toolchain: str.type = _,\n    contacts: [str.type] = _,\n    default_host_platform: [None, str.type] = _,\n    entries_to_exclude: [str.type] = _,\n    labels: [str.type] = _,\n    licenses: [str.type] = _,\n    on_duplicate_entry: str.type = _,\n    out: str.type = _,\n    srcs: [str.type] = _,\n    zip_srcs: [str.type] = _\n) -> None\n")),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"zip_file()")," allows builds to create basic zip files in a platform-agnostic way."),(0,i.mdx)("h4",{id:"parameters-134"},"Parameters"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"name"),": name of the target"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"default_target_platform"),": specifies the default target platform, used when no platforms are specified on the command line"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"target_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"exec_compatible_with"),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"visibility"),": a list of visibility patterns restricting what targets can depend on this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"within_view"),": a list of visibility patterns restricting what this target can depend on"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"tests"),": a list of targets that provide tests for this one"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"entries_to_exclude"),": List of regex expressions that describe entries that should not be included in the output zip file.")),(0,i.mdx)("p",null,"The regexes must be defined using ",(0,i.mdx)("inlineCode",{parentName:"p"},"java.util.regex.Pattern")," syntax."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"on_duplicate_entry"),": Action performed when Buck detects that zip","_","file input contains multiple entries with the same name.")),(0,i.mdx)("p",null,"The valid values are:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"overwrite")," (default): the last entry overwrites all previous entries with\nthe same name."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"append"),": all entries are added to the output file."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"fail"),": fail the build when duplicate entries are present."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"out"),": The name of the zip file that should be generated. This allows builds to use a meaningful target name coupled with a meaningful zip file name. The default value takes the rule's ",(0,i.mdx)("inlineCode",{parentName:"li"},"name")," and appends ",(0,i.mdx)("inlineCode",{parentName:"li"},".zip"),"."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"srcs"),": The set of files to include in the zip.")),(0,i.mdx)("p",null,"Each ",(0,i.mdx)("inlineCode",{parentName:"p"},"src")," will be added to the zip as follows:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"If the ",(0,i.mdx)("inlineCode",{parentName:"li"},"src")," is the output of another rule, the output\nwill be included using just the output's file name."),(0,i.mdx)("li",{parentName:"ul"},"If the ",(0,i.mdx)("inlineCode",{parentName:"li"},"src")," is a file relative to the rule's\ndeclaration, it will be included in the zip with its relative file\nname."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"zip_srcs"),": The set of zip files whose content to include in the output zip file.")),(0,i.mdx)("p",null,"Note that the order of files in ",(0,i.mdx)("inlineCode",{parentName:"p"},"zip_srcs")," matters because the same zip entry can be\nincluded from multiple files. See the ",(0,i.mdx)("inlineCode",{parentName:"p"},"on_duplicate_entry")," argument to learn how to\ncontrol the behavior when there are multiple entries with the same name."),(0,i.mdx)("p",null,"The entries from ",(0,i.mdx)("inlineCode",{parentName:"p"},"zip_srcs")," are added before files from ",(0,i.mdx)("inlineCode",{parentName:"p"},"srcs"),"."),(0,i.mdx)("h4",{id:"details-78"},"Details"),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("p",null,"This example will create a simple zip file."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},'\nzip_file(\n  # The output will be "example.zip"\n  name = \'example\',\n  srcs =\n    # These files will be found in the zip under "dir/"\n    glob([\'dir/**/*\']) +\n    [\n      # Imagine this generates the output\n      # "buck-out/gen/foo/hello.txt". This output will\n      # be found in the zip at "hello.txt"\n      \'//some/other:target\',\n\n    ],\n  zip_srcs = [\n     # The contents of this zip will be added to the generated zip.\n    \'amazing-library-1.0-sources.zip\',\n  ],\n  entries_to_exclude = [\n    "com/example/amazinglibrary/Source1.java",\n  ],\n)\n\n')),(0,i.mdx)("p",null,'If you were to examine the generated zip, the contents would look\nsomething like (assuming the output of\n"',(0,i.mdx)("inlineCode",{parentName:"p"},"//some/other:target"),"\" was a file who's path ended with\n",(0,i.mdx)("inlineCode",{parentName:"p"},"hello.txt"),', the "',(0,i.mdx)("inlineCode",{parentName:"p"},"dir"),'" glob found two files,\nand "',(0,i.mdx)("inlineCode",{parentName:"p"},"amazing-library-1.0-sources.zip"),'" contained two Java\nsource files):'),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"\ndir/file1.txt\ndir/subdir/file2.txt\nhello.txt\ncom/example/amazinglibrary/Source2.java\n\n")))}m.isMDXComponent=!0}}]);