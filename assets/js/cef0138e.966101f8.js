"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2593],{3905:(e,t,n)=>{n.r(t),n.d(t,{MDXContext:()=>u,MDXProvider:()=>s,mdx:()=>g,useMDXComponents:()=>p,withMDXComponents:()=>d});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o.apply(this,arguments)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),d=function(e){return function(t){var n=p(t.components);return a.createElement(e,o({},t,{components:n}))}},p=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=p(e.components);return a.createElement(u.Provider,{value:t},e.children)},m="mdxType",f={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),d=p(n),s=r,m=d["".concat(l,".").concat(s)]||d[s]||f[s]||o;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=h;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[m]="string"==typeof e?e:r,l[1]=i;for(var u=2;u<o;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},16375:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>u});var a=n(87462),r=(n(67294),n(3905));const o={id:"what-ran",title:"Finding Commands That Buck2 Ran"},l=void 0,i={unversionedId:"developers/what-ran",id:"developers/what-ran",title:"Finding Commands That Buck2 Ran",description:"Buck2 logs all the commands it runs. So, after you've run a build, you can query Buck2 to get access to the exact command it used.",source:"@site/../docs/developers/what-ran.md",sourceDirName:"developers",slug:"/developers/what-ran",permalink:"/docs/developers/what-ran",draft:!1,tags:[],version:"current",frontMatter:{id:"what-ran",title:"Finding Commands That Buck2 Ran"},sidebar:"manualSidebar",previous:{title:"Parity Testing",permalink:"/docs/developers/parity_script"},next:{title:"Environments",permalink:"/docs/developers/starlark/environment"}},c={},u=[{value:"What Ran output format",id:"what-ran-output-format",level:2},{value:"Using the What Ran output",id:"using-the-what-ran-output",level:2},{value:"Examples",id:"examples",level:2},{value:"Expired Digests",id:"expired-digests",level:2}],d={toc:u};function p(e){let{components:t,...n}=e;return(0,r.mdx)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("p",null,"Buck2 logs all the commands it runs. So, after you've run a build, you can query Buck2 to get access to the exact command it used."),(0,r.mdx)("p",null,"To do so, do your build as normal, then run ",(0,r.mdx)("inlineCode",{parentName:"p"},"buck2 log what-ran"),"."),(0,r.mdx)("h2",{id:"what-ran-output-format"},"What Ran output format"),(0,r.mdx)("p",null,"This will output a table showing all the commands that were executed, and how they were executed."),(0,r.mdx)("p",null,"The structure is as follows:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-sh"},"REASON  <TAB> TARGET <TAB> IDENTIFIER <TAB> EXECUTOR <TAB> REPRODUCER\n")),(0,r.mdx)("p",null,"Which should be used as follows:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"REASON - value is either ",(0,r.mdx)("inlineCode",{parentName:"li"},"build")," (for building a thing) or ",(0,r.mdx)("inlineCode",{parentName:"li"},"test")," (for running a test)."),(0,r.mdx)("li",{parentName:"ul"},"TARGET - the name of the build target that declared an action."),(0,r.mdx)("li",{parentName:"ul"},"IDENTIFIER - depends on the target but will usually be something like a file name or a module."),(0,r.mdx)("li",{parentName:"ul"},"EXECUTOR - value is either ",(0,r.mdx)("inlineCode",{parentName:"li"},"cache"),", ",(0,r.mdx)("inlineCode",{parentName:"li"},"re")," or ",(0,r.mdx)("inlineCode",{parentName:"li"},"local"),"."),(0,r.mdx)("li",{parentName:"ul"},"REPRODUCER - how you can re-run this yourself.")),(0,r.mdx)("h2",{id:"using-the-what-ran-output"},"Using the What Ran output"),(0,r.mdx)("p",null,"Use What Ran as follows:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"Start by identifying the command you're looking for:",(0,r.mdx)("ul",{parentName:"li"},(0,r.mdx)("li",{parentName:"ul"},"You can grep the output for a given target."),(0,r.mdx)("li",{parentName:"ul"},"You can then grep by identifier if necessary. For example, if you're after C++ compilation, try grepping for the basename of your file (for example, for ",(0,r.mdx)("inlineCode",{parentName:"li"},"fbcode/my/stuff.cpp"),", grep for ",(0,r.mdx)("inlineCode",{parentName:"li"},"stuff.cpp"),")."))),(0,r.mdx)("li",{parentName:"ul"},"Once you found it, reproduce as follows:",(0,r.mdx)("ul",{parentName:"li"},(0,r.mdx)("li",{parentName:"ul"},"If the executor was ",(0,r.mdx)("inlineCode",{parentName:"li"},"local"),", the command is in the output, so just run it. It's expected that you'll do this from the root of your project (use ",(0,r.mdx)("inlineCode",{parentName:"li"},"buck2 root --kind project")," to find where that is)."),(0,r.mdx)("li",{parentName:"ul"},"If the executor was ",(0,r.mdx)("inlineCode",{parentName:"li"},"re")," or ",(0,r.mdx)("inlineCode",{parentName:"li"},"cache"),", you're provided a RE digest of the form ",(0,r.mdx)("inlineCode",{parentName:"li"},"HASH:SIZE"),". Run ",(0,r.mdx)("inlineCode",{parentName:"li"},"frecli cas download-action HASH:SIZE")," to retrieve the action, then follow the instructions to run it.")))),(0,r.mdx)("h2",{id:"examples"},"Examples"),(0,r.mdx)("p",null,"The following ran locally:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"build  fbcode//scripts/torozco/getenv:getenv-san-conf-__generated-lib__ (archive_thin libgetenv-san-conf-__generated-lib__.pic.a)  local  fbcode/third-party-buck/platform010/build/llvm-fb/bin/llvm-ar qcsTD buck-out/v2/gen/fbcode/d839c731f5505c62/scripts/torozco/getenv/__getenv-san-conf-__generated-lib____/libgetenv-san-conf-__generated-lib__.pic.a buck-out/v2/gen/fbcode/d839c731f5505c62/scripts/torozco/getenv/__getenv-san-conf-__generated-lib____/__objects__/san-conf.c.pic.o\n")),(0,r.mdx)("p",null,"To repro, you'd run:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"fbcode/third-party-buck/platform010/build/llvm-fb/bin/llvm-ar qcsTD buck-out/v2/gen/fbcode/d839c731f5505c62/scripts/torozco/getenv/__getenv-san-conf-__generated-lib____/libgetenv-san-conf-__generated-lib__.pic.a buck-out/v2/gen/fbcode/d839c731f5505c62/scripts/torozco/getenv/__getenv-san-conf-__generated-lib____/__objects__/san-conf.c.pic.\n")),(0,r.mdx)("p",null,"The following ran on RE:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"build  fbcode//common/init:kill (cxx_compile Kill.cpp (pic))  re  97feca9d014155a80ec55fe27e6bb17f9d2f8574:94\n")),(0,r.mdx)("p",null,"To repro, you'd run:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"frecli cas download-action 97feca9d014155a80ec55fe27e6bb17f9d2f8574:94\n")),(0,r.mdx)("h2",{id:"expired-digests"},"Expired Digests"),(0,r.mdx)("p",null,"Note that if the action was a cache hit on RE, you might get an error when downloading it, indicating that it's not found. If that happens, it's because the cache entry is there but the inputs have expired."),(0,r.mdx)("p",null,"If this happens to you, run your build with ",(0,r.mdx)("inlineCode",{parentName:"p"},"--upload-all-actions"),"."))}p.isMDXComponent=!0}}]);